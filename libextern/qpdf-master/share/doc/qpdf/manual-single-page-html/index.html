<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QPDF 11.1.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/wraptable.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="#" class="icon icon-home"> QPDF
            <img src="_static/qpdf.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                11.1.1
              </div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-overview">What is QPDF?</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-license">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-download">Downloading QPDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-installation">Building and Installing QPDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-packaging">Notes for Packagers</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-cli">Running qpdf</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-qdf">QDF Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-library">Using the QPDF Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-weak-crypto">Weak Cryptography</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-json">qpdf JSON</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-contributing">Contributing to qpdf</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-design">Design and Library Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-qpdf-job">QPDFJob: a Job-Based Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-linearization">Linearization</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-object-streams">Object and Cross-Reference Streams</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-encryption">PDF Encryption</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-release-notes">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="index.html#document-acknowledgement">Acknowledgments</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">QPDF</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home"></a> &raquo;</li>
      <li>QPDF 11.1.1 documentation</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="qpdf-version-release">
<h1>QPDF version 11.1.1<a class="headerlink" href="#qpdf-version-release" title="Permalink to this heading"></a></h1>
<p>Welcome to the QPDF documentation! For the latest version of this
documentation, please visit <a class="reference external" href="https://qpdf.readthedocs.io">https://qpdf.readthedocs.io</a>.</p>
<div class="toctree-wrapper compound">
<span id="document-overview"></span><section id="what-is-qpdf">
<span id="overview"></span><h2>What is QPDF?<a class="headerlink" href="#what-is-qpdf" title="Permalink to this heading"></a></h2>
<p>QPDF is a program and C++ library for structural, content-preserving
transformations on PDF files. QPDF’s website is located at
<a class="reference external" href="https://qpdf.sourceforge.io/">https://qpdf.sourceforge.io/</a>. QPDF’s source code is hosted on github
at <a class="reference external" href="https://github.com/qpdf/qpdf">https://github.com/qpdf/qpdf</a>. You can find the latest version of
this documentation at <a class="reference external" href="https://qpdf.readthedocs.io/">https://qpdf.readthedocs.io/</a>.</p>
<p>QPDF provides many useful capabilities to developers of PDF-producing
software or for people who just want to look at the innards of a PDF
file to learn more about how they work. With QPDF, it is possible to
copy objects from one PDF file into another and to manipulate the list
of pages in a PDF file. This makes it possible to merge and split PDF
files. The QPDF library also makes it possible for you to create PDF
files from scratch. In this mode, you are responsible for supplying
all the contents of the file, while the QPDF library takes care of all
the syntactical representation of the objects, creation of cross
references tables and, if you use them, object streams, encryption,
linearization, and other syntactic details. You are still responsible
for generating PDF content on your own.</p>
<p>QPDF has been designed with very few external dependencies, and it is
intentionally very lightweight. QPDF is <em>not</em> a PDF content creation
library, a PDF viewer, or a program capable of converting PDF into other
formats. In particular, QPDF knows nothing about the semantics of PDF
content streams. If you are looking for something that can do that, you
should look elsewhere. However, once you have a valid PDF file, QPDF can
be used to transform that file in ways that perhaps your original PDF
creation tool can’t handle. For example, many programs generate simple PDF
files but can’t password-protect them, web-optimize them, or perform
other transformations of that type.</p>
<p>This documentation aims to be comprehensive, but there is also a <a class="reference external" href="https://github.com/qpdf/qpdf/wiki">wiki</a> for less polished material and
ongoing work.</p>
</section>
<span id="document-license"></span><section id="license">
<span id="id1"></span><h2>License<a class="headerlink" href="#license" title="Permalink to this heading"></a></h2>
<p>QPDF is licensed under <a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0">the Apache License, Version 2.0</a> (the “License”).
Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an “AS IS” BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
implied. See the License for the specific language governing
permissions and limitations under the License.</p>
</section>
<span id="document-download"></span><section id="downloading-qpdf">
<span id="download"></span><h2>Downloading QPDF<a class="headerlink" href="#downloading-qpdf" title="Permalink to this heading"></a></h2>
<p>QPDF is included in most Linux distributions. Native packages are
available for many other operating systems as well.</p>
<p>Other resources:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/qpdf/qpdf/releases/">GitHub release page</a></p></li>
<li><p><a class="reference external" href="https://github.com/qpdf/qpdf">GitHub project</a></p></li>
<li><p><a class="reference external" href="https://qpdf.sourceforge.io">QPDF project web site</a></p></li>
</ul>
</section>
<span id="document-installation"></span><section id="building-and-installing-qpdf">
<span id="installing"></span><h2>Building and Installing QPDF<a class="headerlink" href="#building-and-installing-qpdf" title="Permalink to this heading"></a></h2>
<p>This chapter describes how to build and install qpdf.</p>
<section id="dependencies">
<span id="prerequisites"></span><h3>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this heading"></a></h3>
<p>qpdf has few external dependencies. This section describes what you
need to build qpdf in various circumstances.</p>
<section id="basic-dependencies">
<h4>Basic Dependencies<a class="headerlink" href="#basic-dependencies" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>A C++ compiler that supports C++-14</p></li>
<li><p><a class="reference external" href="https://www.cmake.org">CMake</a> version 3.16 or later</p></li>
<li><p><a class="reference external" href="https://www.zlib.net/">zlib</a> or a compatible zlib implementation</p></li>
<li><p>A libjpeg-compatible library such as <a class="reference external" href="https://ijg.org/">jpeg</a> or
<a class="reference external" href="https://libjpeg-turbo.org/">libjpeg-turbo</a></p></li>
<li><p><em>Recommended but not required:</em> <a class="reference external" href="https://www.gnutls.org/">gnutls</a>
to be able to use the gnutls crypto provider and/or <a class="reference external" href="https://openssl.org/">openssl</a> to be able to use the openssl crypto
provider</p></li>
</ul>
<p>The qpdf source tree includes a few automatically generated files. The
code generator uses Python 3. Automatic code generation is off by
default. For a discussion, refer to <a class="reference internal" href="#build-options"><span class="std std-ref">Build Options</span></a>.</p>
</section>
<section id="test-dependencies">
<h4>Test Dependencies<a class="headerlink" href="#test-dependencies" title="Permalink to this heading"></a></h4>
<p>qpdf’s test suite is run by <code class="docutils literal notranslate"><span class="pre">ctest</span></code>, which is part of CMake, but
the tests themselves are implemented using an embedded copy of <a class="reference external" href="https://qtest.sourceforge.io">qtest</a>, which is implemented in perl. On
Windows, MSYS2’s perl is known to work.</p>
<p>qtest requires <a class="reference external" href="http://www.gnu.org/software/diffutils/">GNU diffutils</a> or any other diff that
supports <strong class="command">diff -u</strong>. The default <code class="docutils literal notranslate"><span class="pre">diff</span></code> command works on
GNU/Linux and MacOS.</p>
<p>Part of qpdf’s test suite does comparisons of the contents PDF files
by converting them to images and comparing the images. The image
comparison tests are disabled by default. Those tests are not required
for determining correctness of a qpdf build since the test suite also
contains expected output files that are compared literally. The image
comparison tests provide an extra check to make sure that any content
transformations don’t break the rendering of pages. Transformations
that affect the content streams themselves are off by default and are
only provided to help developers look into the contents of PDF files.
If you are making deep changes to the library that cause changes in
the contents of the files that qpdf generates, then you should enable
the image comparison tests. Enable them by setting the
<code class="docutils literal notranslate"><span class="pre">QPDF_TEST_COMPARE_IMAGES</span></code> environment variable to <code class="docutils literal notranslate"><span class="pre">1</span></code> before
running tests. Image comparison tests add these additional
requirements:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://www.simplesystems.org/libtiff/">libtiff</a> command-line
utilities</p></li>
<li><p><a class="reference external" href="https://www.ghostscript.com/">GhostScript</a> version 8.60 or newer</p></li>
</ul>
<p>Note: prior to qpdf 11, image comparison tests were enabled within
<code class="file docutils literal notranslate"><span class="pre">qpdf.test</span></code>, and you had to <em>disable</em> them by setting
<code class="docutils literal notranslate"><span class="pre">QPDF_SKIP_TEST_COMPARE_IMAGES</span></code> to <code class="docutils literal notranslate"><span class="pre">1</span></code>. This was done
automatically by <code class="docutils literal notranslate"><span class="pre">./configure</span></code>. Now you have to <em>enable</em> image
comparison tests by setting an environment variable. This change was
made because developers have to set the environment variable
themselves now rather than setting it through the build. Either way,
they are off by default.</p>
</section>
<section id="additional-requirements-on-windows">
<h4>Additional Requirements on Windows<a class="headerlink" href="#additional-requirements-on-windows" title="Permalink to this heading"></a></h4>
<ul class="simple">
<li><p>To build qpdf with Visual Studio, there are no additional
requirements when the default cmake options are used. You can build
qpdf from a Visual C++ command-line shell.</p></li>
<li><p>To build with mingw, MSYS2 is recommended with the mingw32 and/or
mingw64 tool chains. You can also build with MSVC from an MSYS2
environment.</p></li>
<li><p>qpdf’s test suite can run within the MSYS2 environment for both
mingw and MSVC-based builds.</p></li>
</ul>
<p>For additional notes, see <code class="file docutils literal notranslate"><span class="pre">README-windows.md</span></code> in the source
distribution.</p>
</section>
<section id="requirements-for-building-documentation">
<h4>Requirements for Building Documentation<a class="headerlink" href="#requirements-for-building-documentation" title="Permalink to this heading"></a></h4>
<p>The qpdf manual is written in reStructured Text and built with <a class="reference external" href="https://www.sphinx-doc.org">Sphinx</a> using the <a class="reference external" href="https://sphinx-rtd-theme.readthedocs.io">Read the Docs Sphinx Theme</a>. Versions of sphinx prior
to version 4.3.2 probably won’t work. Sphinx requires Python 3. In
order to build the HTML documentation from source, you need to install
sphinx and the theme, which you can typically do with <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span>
<span class="pre">sphinx</span> <span class="pre">sphinx_rtd_theme</span></code>. To build the PDF version of the
documentation, you need <code class="docutils literal notranslate"><span class="pre">pdflatex</span></code>, <code class="docutils literal notranslate"><span class="pre">latexmk</span></code>, and a fairly
complete LaTeX installation. Detailed requirements can be found in the
Sphinx documentation. To see how the documentation is built for the
qpdf distribution, refer to the <code class="file docutils literal notranslate"><span class="pre">build-scripts/build-doc</span></code> file
in the qpdf source distribution.</p>
</section>
</section>
<section id="build-instructions">
<span id="building"></span><h3>Build Instructions<a class="headerlink" href="#build-instructions" title="Permalink to this heading"></a></h3>
<p>Starting with qpdf 11, qpdf is built with <a class="reference external" href="https://www.cmake.org">CMake</a>.</p>
<section id="basic-build-invocation">
<h4>Basic Build Invocation<a class="headerlink" href="#basic-build-invocation" title="Permalink to this heading"></a></h4>
<p>qpdf uses cmake in an ordinary way, so refer to the CMake
documentation for details about how to run <code class="docutils literal notranslate"><span class="pre">cmake</span></code>. Here is a
brief summary.</p>
<p>You can usually just run</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cmake -S . -B build
cmake --build build
</pre></div>
</div>
<p>If you are using a multi-configuration generator such as MSVC, you
should pass <code class="docutils literal notranslate"><span class="pre">--config</span> <span class="pre">&lt;Config&gt;</span></code> (where <code class="docutils literal notranslate"><span class="pre">&lt;Config&gt;</span></code> is <code class="docutils literal notranslate"><span class="pre">Release</span></code>,
<code class="docutils literal notranslate"><span class="pre">Debug</span></code>, <code class="docutils literal notranslate"><span class="pre">RelWithDebInfo</span></code>, or <code class="docutils literal notranslate"><span class="pre">MinSizeRel</span></code> as discussed in the
CMake documentation) to the <em>build</em> command. If you are running a
single configuration generator such as the default Makefile generators
in Linux or MSYS, you may want to pass <code class="docutils literal notranslate"><span class="pre">-DCMAKE_BUILD_TYPE=&lt;Config&gt;</span></code>
to the original <code class="docutils literal notranslate"><span class="pre">cmake</span></code> command.</p>
<p>Run <code class="docutils literal notranslate"><span class="pre">ctest</span></code> to run the test suite. Since the real tests are
implemented with <a class="reference external" href="https://qtest.sourceforge.io/">qtest</a>, you will
want to pass <code class="docutils literal notranslate"><span class="pre">--verbose</span></code> to <code class="docutils literal notranslate"><span class="pre">cmake</span></code> so you can see the individual
test outputs. Otherwise, you will see a small number of <code class="docutils literal notranslate"><span class="pre">ctest</span></code>
commands that take a very long to run. If you want to run only a
specific test file in a specific test suite, you can set the <code class="docutils literal notranslate"><span class="pre">TESTS</span></code>
environment variable (used by <code class="docutils literal notranslate"><span class="pre">qtest-driver</span></code>) and pass the <code class="docutils literal notranslate"><span class="pre">-R</span></code>
parameter to <code class="docutils literal notranslate"><span class="pre">ctest</span></code>. For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>TESTS=qutil ctest --verbose -R libtests
</pre></div>
</div>
<p>would run only <code class="docutils literal notranslate"><span class="pre">qutil.test</span></code> from the <code class="docutils literal notranslate"><span class="pre">libtests</span></code> test suite.</p>
</section>
<section id="installation-and-packaging">
<span id="installation"></span><h4>Installation and Packaging<a class="headerlink" href="#installation-and-packaging" title="Permalink to this heading"></a></h4>
<p>Installation can be performed using <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">--install</span></code> or <code class="docutils literal notranslate"><span class="pre">cpack</span></code>.
For most normal use cases, <code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">--install</span></code> or <code class="docutils literal notranslate"><span class="pre">cpack</span></code> can be run
in the normal way as described in CMake documentation. qpdf follows
all normal installation conventions and uses CMake-defined variables
for standard behavior.</p>
<p>There are several components that can be installed separately:</p>
<table class="docutils align-default" id="id2">
<caption><span class="caption-text">Installation Components</span><a class="headerlink" href="#id2" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 5.9%" />
<col style="width: 94.1%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>cli</p></td>
<td><p>Command-line tools</p></td>
</tr>
<tr class="row-even"><td><p>lib</p></td>
<td><p>The runtime libraries; required if you built with shared
libraries</p></td>
</tr>
<tr class="row-odd"><td><p>dev</p></td>
<td><p>Static libraries, header files, and other files needed by
developers</p></td>
</tr>
<tr class="row-even"><td><p>doc</p></td>
<td><p>Documentation and, if selected for installation, the manual</p></td>
</tr>
<tr class="row-odd"><td><p>examples</p></td>
<td><p>Example source files</p></td>
</tr>
</tbody>
</table>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">lib</span></code> component installs only runtime libraries, not
header files or other files/links needed to build against qpdf. For
that, you need <code class="docutils literal notranslate"><span class="pre">dev</span></code>. If you are using shared libraries, the <code class="docutils literal notranslate"><span class="pre">dev</span></code>
will install files or create symbolic links that depend on files
installed by <code class="docutils literal notranslate"><span class="pre">lib</span></code>, so you will need to install both. If you wanted
to build software against the qpdf library and only wanted to install
the files you needed for that purpose, here are some examples:</p>
<ul>
<li><p>Install development files with static libraries only:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cmake -S . -B build -DCMAKE_BUILD_TYPE=RelWithDebInfo -DBUILD_SHARED_LIBS=OFF
cmake --build build --parallel --target libqpdf
cmake --install build --component dev
</pre></div>
</div>
</li>
<li><p>Install development files with shared libraries only:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cmake -S . -B build -DCMAKE_BUILD_TYPE=RelWithDebInfo -DBUILD_STATIC_LIBS=OFF
cmake --build build --parallel --target libqpdf
cmake --install build --component lib
cmake --install build --component dev
</pre></div>
</div>
</li>
<li><p>Install development files with shared and static libraries:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cmake -S . -B build -DCMAKE_BUILD_TYPE=RelWithDebInfo
cmake --build build --parallel --target libqpdf libqpdf_static
cmake --install build --component lib
cmake --install build --component dev
</pre></div>
</div>
</li>
</ul>
<p>There are also separate options, discussed in <a class="reference internal" href="#build-options"><span class="std std-ref">Build Options</span></a>,
that control how certain specific parts of the software are installed.</p>
</section>
</section>
<section id="build-options">
<span id="id1"></span><h3>Build Options<a class="headerlink" href="#build-options" title="Permalink to this heading"></a></h3>
<p>All available build options are defined in the the top-level
<code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file and have help text. You can see them using
any standard cmake front-end (like <code class="docutils literal notranslate"><span class="pre">cmake-gui</span></code> or <code class="docutils literal notranslate"><span class="pre">ccmake</span></code>). This
section describes options that apply to most users. If you are trying
to map autoconf options (from prior to qpdf 11) to cmake options,
please see <a class="reference internal" href="#autoconf-to-cmake"><span class="std std-ref">Converting From autoconf to cmake</span></a>.</p>
<p>If you are packaging qpdf for a distribution, you should also read
<a class="reference internal" href="index.html#packaging"><span class="std std-ref">Notes for Packagers</span></a>.</p>
<section id="basic-build-options">
<h4>Basic Build Options<a class="headerlink" href="#basic-build-options" title="Permalink to this heading"></a></h4>
<dl>
<dt>BUILD_DOC</dt><dd><p>Whether to build documentation with sphinx. You must have the
required tools installed.</p>
</dd>
<dt>BUILD_DOC_HTML</dt><dd><p>Visible when BUILD_DOC is selected. This option controls building
HTML documentation separately from PDF documentation since
the sphinx theme is only needed for the HTML documentation.</p>
</dd>
<dt>BUILD_DOC_PDF</dt><dd><p>Visible when BUILD_DOC is selected. This option controls building
PDF documentation separately from HTML documentation since
additional tools are required to build the PDF documentation.</p>
</dd>
<dt>BUILD_SHARED_LIBS, BUILD_STATIC_LIBS</dt><dd><p>You can configure whether to build shared libraries, static
libraries, or both. You must select at least one of these options.
For rapid iteration, select only one as this cuts the build time in
half.</p>
<p>On Windows, if you build with shared libraries, you must have the
output directory for libqpdf (e.g. <code class="file docutils literal notranslate"><span class="pre">libqpdf/Release</span></code> or
<code class="file docutils literal notranslate"><span class="pre">libqpdf</span></code> within the build directory) in your path so that the
compiled executables can find the DLL. Updating your path is not
necessary if you build with static libraries only.</p>
</dd>
<dt>QTEST_COLOR</dt><dd><p>Turn this on or off to control whether qtest uses color in its
output.</p>
</dd>
</dl>
</section>
<section id="options-for-working-on-qpdf">
<h4>Options for Working on qpdf<a class="headerlink" href="#options-for-working-on-qpdf" title="Permalink to this heading"></a></h4>
<dl class="simple">
<dt>CHECK_SIZES</dt><dd><p>The source file <code class="file docutils literal notranslate"><span class="pre">qpdf/sizes.cc</span></code> is used to display the sizes
of all objects in the public API. Consistency of its output between
releases is used as part of the check against accidental breakage of
the binary interface (ABI). Turning this on causes a test to be run
that ensures an exact match between classes in <code class="docutils literal notranslate"><span class="pre">sizes.cc</span></code> and
classes in the library’s public API. This option requires Python 3.</p>
</dd>
<dt>ENABLE_QTC</dt><dd><p>This is off by default, except in maintainer mode. When off,
<code class="docutils literal notranslate"><span class="pre">QTC::TC</span></code> calls are compiled out by having <code class="docutils literal notranslate"><span class="pre">QTC::TC</span></code> be an empty
inline function. The underlying <code class="docutils literal notranslate"><span class="pre">QTC::TC</span></code> remains in the library,
so it is possible to build and package the qpdf library with
<code class="docutils literal notranslate"><span class="pre">ENABLE_QTC</span></code> turned off while still allowing developer code to use
<code class="docutils literal notranslate"><span class="pre">QTC::TC</span></code> if desired. If you are modifying qpdf code, it’s a good
idea to have this on for more robust automated testing. Otherwise,
there’s no reason to have it on.</p>
</dd>
<dt>GENERATE_AUTO_JOB</dt><dd><p>Some qpdf source files are automatically generated from
<code class="file docutils literal notranslate"><span class="pre">job.yml</span></code> and the CLI documentation. If you are adding new
command-line arguments to the qpdf CLI or updating
<code class="file docutils literal notranslate"><span class="pre">manual/cli.rst</span></code> in the qpdf sources, you should turn this on.
This option requires Python 3.</p>
</dd>
<dt>WERROR</dt><dd><p>Make any compiler warnings into errors. We want qpdf to compile free
of warnings whenever possible, but there’s always a chance that a
compiler upgrade or tool change may cause warnings to appear that
weren’t there before. If you are testing qpdf with a new compiler,
you should turn this on.</p>
</dd>
</dl>
</section>
<section id="environment-specific-options">
<h4>Environment-Specific Options<a class="headerlink" href="#environment-specific-options" title="Permalink to this heading"></a></h4>
<dl>
<dt>SHOW_FAILED_TEST_OUTPUT</dt><dd><p>Ordinarily, qtest (which drives qpdf’s test suite) writes detailed
information about its output to the file <code class="docutils literal notranslate"><span class="pre">qtest.log</span></code> in the build
output directory. If you are running a build in a continuous
integration or automated environment where you can’t get to those
files, you should enable this option and also run <code class="docutils literal notranslate"><span class="pre">ctest</span>
<span class="pre">--verbose</span></code> or <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">--output-on-failure</span></code>. This will cause
detailed test failure output to be written into the build log.</p>
</dd>
<dt>CI_MODE</dt><dd><p>Turning this on sets options used in qpdf’s continuous integration
environment to ensure we catch as many problems as possible.
Specifically, this option enables <code class="docutils literal notranslate"><span class="pre">SHOW_FAILED_TEST_OUTPUT</span></code> and
<code class="docutils literal notranslate"><span class="pre">WERROR</span></code> and forces the native crypto provider to be built.</p>
</dd>
<dt>MAINTAINER_MODE</dt><dd><p>Turning this option on sets options that should be on if you are
maintaining qpdf. In turns on the following:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">BUILD_DOC</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CHECK_SIZES</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ENABLE_QTC</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GENERATE_AUTO_JOB</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">WERROR</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">REQUIRE_NATIVE_CRYPTO</span></code></p></li>
</ul>
<p>It is possible to turn <code class="docutils literal notranslate"><span class="pre">BUILD_DOC</span></code> off in maintainer mode so that
the extra requirements for building documentation don’t have to be
available.</p>
</dd>
</dl>
</section>
<section id="build-time-crypto-selection">
<span id="crypto-build"></span><h4>Build-time Crypto Selection<a class="headerlink" href="#build-time-crypto-selection" title="Permalink to this heading"></a></h4>
<p>Since version 9.1.0, qpdf can use external crypto providers in
addition to its native provider. For a general discussion, see
<a class="reference internal" href="#crypto"><span class="std std-ref">Crypto Providers</span></a>. This section discusses how to configure which crypto
providers are compiled into qpdf.</p>
<p>In nearly all cases, external crypto providers should be preferred
over the native one. However, if you are not concerned about working
with encrypted files and want to reduce the number of dependencies,
the native crypto provider is fully supported.</p>
<p>By default, qpdf’s build enables every external crypto providers whose
dependencies are available and only enables the native crypto provider
if no external providers are available. You can change this behavior
with the options described here.</p>
<dl class="simple">
<dt>USE_IMPLICIT_CRYPTO</dt><dd><p>This is on by default. If turned off, only explicitly selected
crypto providers will be built. You must use at least one of the
<code class="docutils literal notranslate"><span class="pre">REQUIRE</span></code> options below.</p>
</dd>
<dt>ALLOW_CRYPTO_NATIVE</dt><dd><p>This option is only available when USE_IMPLICIT_CRYPTO is selected,
in which case it is on by default. Turning it off prevents qpdf from
falling back to the native crypto provider when no external provider
is available.</p>
</dd>
<dt>REQUIRE_CRYPTO_NATIVE</dt><dd><p>Build the native crypto provider even if other options are
available.</p>
</dd>
<dt>REQUIRE_CRYPTO_GNUTLS</dt><dd><p>Require the gnutls crypto provider. Turning this on makes in an
error if the gnutls library is not available.</p>
</dd>
<dt>REQUIRE_CRYPTO_OPENSSL</dt><dd><p>Require the openssl crypto provider. Turning this on makes in an
error if the openssl library is not available.</p>
</dd>
<dt>DEFAULT_CRYPTO</dt><dd><p>Explicitly select which crypto provider is used by default. See
<a class="reference internal" href="#crypto-runtime"><span class="std std-ref">Runtime Crypto Provider Selection</span></a> for information about run-time selection of
the crypto provider. If not specified, qpdf will pick gnutls if
available, otherwise openssl if available, and finally native as a
last priority.</p>
</dd>
</dl>
<p>Example: if you wanted to build with only the gnutls crypto provider,
you should run cmake with <code class="docutils literal notranslate"><span class="pre">-DUSE_IMPLICIT_CRYPTO=0</span>
<span class="pre">-DREQUIRE_CRYPTO_GNUTLS=1</span></code>.</p>
</section>
<section id="advanced-build-options">
<h4>Advanced Build Options<a class="headerlink" href="#advanced-build-options" title="Permalink to this heading"></a></h4>
<p>These options are used only for special purposes and are not relevant
to most users.</p>
<dl>
<dt>AVOID_WINDOWS_HANDLE</dt><dd><p>Disable use of the <code class="docutils literal notranslate"><span class="pre">HANDLE</span></code> type in Windows. This can be useful if
you are building for certain embedded Windows environments. Some
functionality won’t work, but you can still process PDF files from
memory in this configuration.</p>
</dd>
<dt>BUILD_DOC_DIST, INSTALL_MANUAL</dt><dd><p>By default, installing qpdf does not include a pre-built copy of the
manual. Instead, it installs a README file that tells people where
to find the manual online. If you want to install the manual, you
must enable the <code class="docutils literal notranslate"><span class="pre">INSTALL_MANUAL</span></code> option, and you must have a
<code class="docutils literal notranslate"><span class="pre">doc-dist</span></code> directory in the manual directory of the build. The
<code class="docutils literal notranslate"><span class="pre">doc-dist</span></code> directory is created if <code class="docutils literal notranslate"><span class="pre">BUILD_DOC_DIST</span></code> is selected
and <code class="docutils literal notranslate"><span class="pre">BUILD_DOC_PDF</span></code> and <code class="docutils literal notranslate"><span class="pre">BUILD_DOC_HTML</span></code> are both on.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">BUILD_DOC_DIST</span></code> and <code class="docutils literal notranslate"><span class="pre">INSTALL_MANUAL</span></code> options are separate
and independent because of the additional tools required to build
documentation. In particular, for qpdf’s official release
preparation, a <code class="docutils literal notranslate"><span class="pre">doc-dist</span></code> directory is built in Linux and then
extracted into the Windows builds so that it can be included in the
Windows installers. This prevents us from having to build the
documentation in a Windows environment. For additional discussion,
see <a class="reference internal" href="index.html#doc-packaging-rationale"><span class="std std-ref">Documentation Packaging Rationale</span></a>.</p>
</dd>
<dt>INSTALL_CMAKE_PACKAGE</dt><dd><p>Controls whether or not to install qpdf’s cmake configuration file
(on by default).</p>
</dd>
<dt>INSTALL_EXAMPLES</dt><dd><p>Controls whether or not to install qpdf’s example source files with
documentation (on by default).</p>
</dd>
<dt>INSTALL_PKGCONFIG</dt><dd><p>Controls whether or not to install qpdf’s pkg-config configuration
file (on by default).</p>
</dd>
<dt>OSS_FUZZ</dt><dd><p>Turning this option on changes the build of the fuzzers in a manner
specifically required by Google’s oss-fuzz project. There is no
reason to turn this on for any other reason. It is enabled by the
build script that builds qpdf from that context.</p>
</dd>
<dt>SKIP_OS_SECURE_RANDOM, USE_INSECURE_RANDOM</dt><dd><p>The native crypto implementation uses the operating systems’s secure
random number source when available. It is not used when an external
crypto provider is in use. If you are building in a very specialized
environment where you are not using an external crypto provider but
can’t use the OS-provided secure random number generator, you can
turn both of these options on. This will cause qpdf to fall back to
an insecure random number generator, which may generate guessable
random numbers. The resulting qpdf is still secure, but encrypted
files may be more subject to brute force attacks. Unless you know
you need these options for a specialized purpose, you don’t need
them. These options were added to qpdf in response to a special
request from a user who needed to run a specialized PDF-related task
in an embedded environment that didn’t have a secure random number
source.</p>
</dd>
</dl>
</section>
<section id="building-without-wchar-t">
<h4>Building without wchar_t<a class="headerlink" href="#building-without-wchar-t" title="Permalink to this heading"></a></h4>
<p>It is possible to build qpdf on a system that doesn’t have
<code class="docutils literal notranslate"><span class="pre">wchar_t</span></code>. The resulting build of qpdf is not API-compatible with a
regular qpdf build, so this option cannot be selected from cmake. This
option was added to qpdf to support installation on a very stripped
down embedded environment that included only a partial implementation
of the standard C++ library.</p>
<p>You can disable use of <code class="docutils literal notranslate"><span class="pre">wchar_t</span></code> in qpdf’s code by defining the
<code class="docutils literal notranslate"><span class="pre">QPDF_NO_WCHAR_T</span></code> preprocessor symbol in your build (e.g. by
including <code class="docutils literal notranslate"><span class="pre">-DQPDF_NO_WCHAR_T</span></code> in <code class="docutils literal notranslate"><span class="pre">CFLAGS</span></code> and <code class="docutils literal notranslate"><span class="pre">CXXFLAGS</span></code>).</p>
<p>While <code class="docutils literal notranslate"><span class="pre">wchar_t</span></code> is part of the C++ standard library and should be
present on virtually every system, there are some stripped down
systems, such as those targeting certain embedded environments, that
lack <code class="docutils literal notranslate"><span class="pre">wchar_t</span></code>. Internally, qpdf uses UTF-8 encoding for everything,
so there is nothing important in qpdf’s API that uses <code class="docutils literal notranslate"><span class="pre">wchar_t</span></code>.
However, there are some helper methods for converting between
<code class="docutils literal notranslate"><span class="pre">wchar_t*</span></code> and <code class="docutils literal notranslate"><span class="pre">char*</span></code>.</p>
<p>If you are building in an environment that does not support
<code class="docutils literal notranslate"><span class="pre">wchar_t</span></code>, you can define the preprocessor symbol
<code class="docutils literal notranslate"><span class="pre">QPDF_NO_WCHAR_T</span></code> in your build. This will work whether you are
building qpdf and need to avoid compiling the code that uses wchar_t
or whether you are building client code that uses qpdf.</p>
<p>Note that, when you build code with libqpdf, it is <em>not necessary</em> to
have the definition of <code class="docutils literal notranslate"><span class="pre">QPDF_NO_WCHAR_T</span></code> in your build match what
was defined when the library was built as long as you are not calling
any of the methods that use <code class="docutils literal notranslate"><span class="pre">wchar_t</span></code>.</p>
</section>
</section>
<section id="crypto-providers">
<span id="crypto"></span><h3>Crypto Providers<a class="headerlink" href="#crypto-providers" title="Permalink to this heading"></a></h3>
<p>Starting with qpdf 9.1.0, the qpdf library can be built with multiple
implementations of providers of cryptographic functions, which we refer
to as “crypto providers.” At the time of writing, a crypto
implementation must provide MD5 and SHA2 (256, 384, and 512-bit) hashes
and RC4 and AES256 with and without CBC encryption. In the future, if
digital signature is added to qpdf, there may be additional requirements
beyond this. Some of these are weak cryptographic algorithms. For a
discussion of why they’re needed, see <a class="reference internal" href="index.html#weak-crypto"><span class="std std-ref">Weak Cryptography</span></a>.</p>
<p>The available crypto provider implementations are <code class="docutils literal notranslate"><span class="pre">gnutls</span></code>,
<code class="docutils literal notranslate"><span class="pre">openssl</span></code>, and <code class="docutils literal notranslate"><span class="pre">native</span></code>. OpenSSL support was added in qpdf 10.0.0
with support for OpenSSL added in 10.4.0. GnuTLS support was
introduced in qpdf 9.1.0. Additional implementations can be added as
needed. It is also possible for a developer to provide their own
implementation without modifying the qpdf library.</p>
<p>For information about selecting which crypto providers are compiled
into qpdf, see <a class="reference internal" href="#crypto-build"><span class="std std-ref">Build-time Crypto Selection</span></a>.</p>
<section id="runtime-crypto-provider-selection">
<span id="crypto-runtime"></span><h4>Runtime Crypto Provider Selection<a class="headerlink" href="#runtime-crypto-provider-selection" title="Permalink to this heading"></a></h4>
<p>You can use the <a class="reference internal" href="index.html#option-show-crypto" title="option-show-crypto"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--show-crypto</span></code></a> option to <strong class="command">qpdf</strong> to
get a list of available crypto providers. The default provider is
always listed first, and the rest are listed in lexical order. Each
crypto provider is listed on a line by itself with no other text,
enabling the output of this command to be used easily in scripts.</p>
<p>You can override which crypto provider is used by setting the
<code class="docutils literal notranslate"><span class="pre">QPDF_CRYPTO_PROVIDER</span></code> environment variable. There are few reasons
to ever do this, but you might want to do it if you were explicitly
trying to compare behavior of two different crypto providers while
testing performance or reproducing a bug. It could also be useful for
people who are implementing their own crypto providers.</p>
</section>
<section id="crypto-provider-information-for-developers">
<span id="crypto-develop"></span><h4>Crypto Provider Information for Developers<a class="headerlink" href="#crypto-provider-information-for-developers" title="Permalink to this heading"></a></h4>
<p>If you are writing code that uses libqpdf and you want to force a
certain crypto provider to be used, you can call the method
<code class="docutils literal notranslate"><span class="pre">QPDFCryptoProvider::setDefaultProvider</span></code>. The argument is the name
of a built-in or developer-supplied provider. To add your own crypto
provider, you have to create a class derived from <code class="docutils literal notranslate"><span class="pre">QPDFCryptoImpl</span></code>
and register it with <code class="docutils literal notranslate"><span class="pre">QPDFCryptoProvider</span></code>. For additional
information, see comments in <code class="file docutils literal notranslate"><span class="pre">include/qpdf/QPDFCryptoImpl.hh</span></code>.</p>
</section>
<section id="crypto-provider-design-notes">
<span id="crypto-design"></span><h4>Crypto Provider Design Notes<a class="headerlink" href="#crypto-provider-design-notes" title="Permalink to this heading"></a></h4>
<p>This section describes a few bits of rationale for why the crypto
provider interface was set up the way it was. You don’t need to know any
of this information, but it’s provided for the record and in case it’s
interesting.</p>
<p>As a general rule, I want to avoid as much as possible including large
blocks of code that are conditionally compiled such that, in most
builds, some code is never built. This is dangerous because it makes it
very easy for invalid code to creep in unnoticed. As such, I want it to
be possible to build qpdf with all available crypto providers, and this
is the way I build qpdf for local development. At the same time, if a
particular packager feels that it is a security liability for qpdf to
use crypto functionality from other than a library that gets
considerable scrutiny for this specific purpose (such as gnutls,
openssl, or nettle), then I want to give that packager the ability to
completely disable qpdf’s native implementation. Or if someone wants to
avoid adding a dependency on one of the external crypto providers, I
don’t want the availability of the provider to impose additional
external dependencies within that environment. Both of these are
situations that I know to be true for some users of qpdf.</p>
<p>I want registration and selection of crypto providers to be thread-safe,
and I want it to work deterministically for a developer to provide their
own crypto provider and be able to set it up as the default. This was
the primary motivation behind requiring C++-11 as doing so enabled me to
exploit the guaranteed thread safety of local block static
initialization. The <code class="docutils literal notranslate"><span class="pre">QPDFCryptoProvider</span></code> class uses a singleton
pattern with thread-safe initialization to create the singleton instance
of <code class="docutils literal notranslate"><span class="pre">QPDFCryptoProvider</span></code> and exposes only static methods in its public
interface. In this way, if a developer wants to call any
<code class="docutils literal notranslate"><span class="pre">QPDFCryptoProvider</span></code> methods, the library guarantees the
<code class="docutils literal notranslate"><span class="pre">QPDFCryptoProvider</span></code> is fully initialized and all built-in crypto
providers are registered. Making <code class="docutils literal notranslate"><span class="pre">QPDFCryptoProvider</span></code> actually know
about all the built-in providers may seem a bit sad at first, but this
choice makes it extremely clear exactly what the initialization behavior
is. There’s no question about provider implementations automatically
registering themselves in a nondeterministic order. It also means that
implementations do not need to know anything about the provider
interface, which makes them easier to test in isolation. Another
advantage of this approach is that a developer who wants to develop
their own crypto provider can do so in complete isolation from the qpdf
library and, with just two calls, can make qpdf use their provider in
their application. If they decided to contribute their code, plugging it
into the qpdf library would require a very small change to qpdf’s source
code.</p>
<p>The decision to make the crypto provider selectable at runtime was one I
struggled with a little, but I decided to do it for various reasons.
Allowing an end user to switch crypto providers easily could be very
useful for reproducing a potential bug. If a user reports a bug that
some cryptographic thing is broken, I can easily ask that person to try
with the <code class="docutils literal notranslate"><span class="pre">QPDF_CRYPTO_PROVIDER</span></code> variable set to different values. The
same could apply in the event of a performance problem. This also makes
it easier for qpdf’s own test suite to exercise code with different
providers without having to make every program that links with qpdf
aware of the possibility of multiple providers. In qpdf’s continuous
integration environment, the entire test suite is run for each supported
crypto provider. This is made simple by being able to select the
provider using an environment variable.</p>
<p>Finally, making crypto providers selectable in this way establish a
pattern that I may follow again in the future for stream filter
providers. One could imagine a future enhancement where someone could
provide their own implementations for basic filters like
<code class="docutils literal notranslate"><span class="pre">/FlateDecode</span></code> or for other filters that qpdf doesn’t support.
Implementing the registration functions and internal storage of
registered providers was also easier using C++-11’s functional
interfaces, which was another reason to require C++-11 at this time.</p>
</section>
</section>
<section id="converting-from-autoconf-to-cmake">
<span id="autoconf-to-cmake"></span><h3>Converting From autoconf to cmake<a class="headerlink" href="#converting-from-autoconf-to-cmake" title="Permalink to this heading"></a></h3>
<p>Versions of qpdf before qpdf 11 were built with <code class="docutils literal notranslate"><span class="pre">autoconf</span></code> and a
home-grown GNU Make-based build system. If you built qpdf with special
<code class="docutils literal notranslate"><span class="pre">./configure</span></code> options, this section can help you switch them over to
<code class="docutils literal notranslate"><span class="pre">cmake</span></code>.</p>
<p>In most cases, there is a one-to-one mapping between configure options
and cmake options. There are a few exceptions:</p>
<ul class="simple">
<li><p>The cmake build behaves differently with respect to whether or not
to include support for the native crypto provider. Specifically, it
is not implicitly enabled unless explicitly requested if there are
other options available. You can force it to be included by enabling
<code class="docutils literal notranslate"><span class="pre">REQUIRE_CRYPTO_NATIVE</span></code>. For details, see <a class="reference internal" href="#crypto-build"><span class="std std-ref">Build-time Crypto Selection</span></a>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">--enable-external-libs</span></code> option is no longer available. The
cmake build detects the presence of <code class="docutils literal notranslate"><span class="pre">external-libs</span></code> automatically.
See <code class="file docutils literal notranslate"><span class="pre">README-windows.md</span></code> in the source distribution for a more
in-depth discussion.</p></li>
<li><p>The sense of the option representing use of the OS-provided secure
random number generator has been reversed: the
<code class="docutils literal notranslate"><span class="pre">--enable-os-secure-random</span></code>, which was on by default, has been
replaced by the <code class="docutils literal notranslate"><span class="pre">SKIP_OS_SECURE_RANDOM</span></code> option, which is off by
default. The option’s new name and behavior match the preprocessor
symbol that it turns on.</p></li>
<li><p>Non-default test configuration is selected with environment
variables rather than cmake. The old <code class="docutils literal notranslate"><span class="pre">./configure</span></code> options just
set environment variables. Note that the sense of the variable for
image comparison tests has been reversed. It used to be that you had
to set <code class="docutils literal notranslate"><span class="pre">QPDF_SKIP_TEST_COMPARE_IMAGES</span></code> to <code class="docutils literal notranslate"><span class="pre">1</span></code> to <em>disable</em> image
comparison tests. This was done by default. Now you have to set
<code class="docutils literal notranslate"><span class="pre">QPDF_TEST_COMPARE_IMAGES</span></code> to <code class="docutils literal notranslate"><span class="pre">1</span></code> to <em>enable</em> image comparison
tests. Either way, they are off by default.</p></li>
<li><p>Non-user-visible change: the preprocessor symbol that triggers the
export of functions into the public ABI (application binary
interface) has been changed from <code class="docutils literal notranslate"><span class="pre">DLL_EXPORT</span></code> to
<code class="docutils literal notranslate"><span class="pre">libqpdf_EXPORTS</span></code>. This detail is encapsulated in the build and is
only relevant to people who are building qpdf on their own or who
may have previously needed to work around a collision between qpdf’s
use of <code class="docutils literal notranslate"><span class="pre">DLL_EXPORT</span></code> and someone else’s use of the same symbol.</p></li>
<li><p>A handful of options that were specific to autoconf or the old build
system have been dropped.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cmake</span> <span class="pre">--install</span></code> installs example source code in
<code class="docutils literal notranslate"><span class="pre">doc/qpdf/examples</span></code> in the <code class="docutils literal notranslate"><span class="pre">examples</span></code> installation component.
Packagers are encouraged to package this with development files if
there is no separate doc package. This can be turned off by
disabling the <code class="docutils literal notranslate"><span class="pre">INSTALL_EXAMPLES</span></code> build option.</p></li>
</ul>
<p>There are some new options available in the cmake build that were not
available in the autoconf build. This table shows the old options and
their equivalents in cmake.</p>
<table class="docutils align-default" id="id3">
<caption><span class="caption-text">configure flags to cmake options</span><a class="headerlink" href="#id3" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 40.0%" />
<col style="width: 60.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>enable-avoid-windows-handle</p></td>
<td><p>AVOID_WINDOWS_HANDLE</p></td>
</tr>
<tr class="row-even"><td><p>enable-check-autofiles</p></td>
<td><p>none – not relevant to cmake</p></td>
</tr>
<tr class="row-odd"><td><p>enable-crypto-gnutls</p></td>
<td><p>REQUIRE_CRYPTO_GNUTLS</p></td>
</tr>
<tr class="row-even"><td><p>enable-crypto-native</p></td>
<td><p>REQUIRE_CRYPTO_NATIVE (but see above)</p></td>
</tr>
<tr class="row-odd"><td><p>enable-crypto-openssl</p></td>
<td><p>REQUIRE_CRYPTO_OPENSSL</p></td>
</tr>
<tr class="row-even"><td><p>enable-doc-maintenance</p></td>
<td><p>BUILD_DOC</p></td>
</tr>
<tr class="row-odd"><td><p>enable-external-libs</p></td>
<td><p>none – detected automatically</p></td>
</tr>
<tr class="row-even"><td><p>enable-html-doc</p></td>
<td><p>BUILD_DOC_HTML</p></td>
</tr>
<tr class="row-odd"><td><p>enable-implicit-crypto</p></td>
<td><p>USE_IMPLICIT_CRYPTO</p></td>
</tr>
<tr class="row-even"><td><p>enable-insecure-random</p></td>
<td><p>USE_INSECURE_RANDOM</p></td>
</tr>
<tr class="row-odd"><td><p>enable-ld-version-script</p></td>
<td><p>none – detected automatically</p></td>
</tr>
<tr class="row-even"><td><p>enable-maintainer-mode</p></td>
<td><p>MAINTAINER_MODE (slight differences)</p></td>
</tr>
<tr class="row-odd"><td><p>enable-os-secure-random (on by default)</p></td>
<td><p>SKIP_OS_SECURE_RANDOM (off by default)</p></td>
</tr>
<tr class="row-even"><td><p>enable-oss-fuzz</p></td>
<td><p>OSS_FUZZ</p></td>
</tr>
<tr class="row-odd"><td><p>enable-pdf-doc</p></td>
<td><p>BUILD_DOC_PDF</p></td>
</tr>
<tr class="row-even"><td><p>enable-rpath</p></td>
<td><p>none – cmake handles rpath correctly</p></td>
</tr>
<tr class="row-odd"><td><p>enable-show-failed-test-output</p></td>
<td><p>SHOW_FAILED_TEST_OUTPUT</p></td>
</tr>
<tr class="row-even"><td><p>enable-test-compare-images</p></td>
<td><p>set the <code class="docutils literal notranslate"><span class="pre">QPDF_TEST_COMPARE_IMAGES</span></code> environment variable</p></td>
</tr>
<tr class="row-odd"><td><p>enable-werror</p></td>
<td><p>WERROR</p></td>
</tr>
<tr class="row-even"><td><p>with-buildrules</p></td>
<td><p>none – not relevant to cmake</p></td>
</tr>
<tr class="row-odd"><td><p>with-default-crypto</p></td>
<td><p>DEFAULT_CRYPTO</p></td>
</tr>
<tr class="row-even"><td><p>large-file-test-path</p></td>
<td><p>set the <code class="docutils literal notranslate"><span class="pre">QPDF_LARGE_FILE_TEST_PATH</span></code> environment variable</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<span id="document-packaging"></span><section id="notes-for-packagers">
<span id="packaging"></span><h2>Notes for Packagers<a class="headerlink" href="#notes-for-packagers" title="Permalink to this heading"></a></h2>
<p>If you are packaging qpdf for an operating system distribution, this
chapter is for you. Otherwise, feel free to skip.</p>
<section id="build-options">
<h3>Build Options<a class="headerlink" href="#build-options" title="Permalink to this heading"></a></h3>
<p>For a detailed discussion of build options, please refer to
<a class="reference internal" href="index.html#build-options"><span class="std std-ref">Build Options</span></a>. This section calls attention to options that are
particularly useful to packagers.</p>
<ul class="simple">
<li><p>Perl must be present at build time. Prior to qpdf version 9.1.1,
there was a runtime dependency on perl, but this is no longer the
case.</p></li>
<li><p>Make sure you are getting the intended behavior with regard to crypto
providers. Read <a class="reference internal" href="index.html#crypto-build"><span class="std std-ref">Build-time Crypto Selection</span></a> for details.</p></li>
<li><p>Use of <code class="docutils literal notranslate"><span class="pre">SHOW_FAILED_TEST_OUTPUT</span></code> is recommended for building in
continuous integration or other automated environments as it makes
it possible to see test failures in build logs. This should be
combined with either <code class="docutils literal notranslate"><span class="pre">ctest</span> <span class="pre">--verbose</span></code> or <code class="docutils literal notranslate"><span class="pre">ctest</span>
<span class="pre">--output-on-failure</span></code>.</p></li>
<li><p>qpdf’s install targets do not install completion files by default
since there is no standard location for them. As a packager, it’s
good if you install them wherever your distribution expects such
files to go. You can find completion files to install in the
<code class="file docutils literal notranslate"><span class="pre">completions</span></code> directory. See the <code class="file docutils literal notranslate"><span class="pre">completions/README.md</span></code>
file for more information.</p></li>
<li><p>Starting with qpdf 11, qpdf’s default installation installs source
files from the examples directory with documentation. Prior to qpdf
11, this was a recommendation for packagers but was not done
automatically.</p></li>
</ul>
</section>
<section id="package-tests">
<span id="id1"></span><h3>Package Tests<a class="headerlink" href="#package-tests" title="Permalink to this heading"></a></h3>
<p>The <code class="file docutils literal notranslate"><span class="pre">pkg-test</span></code> directory contains very small test shell scripts
that are designed to help smoke-test an installation of qpdf. They
were designed to be used with debian’s <a class="reference external" href="https://wiki.debian.org/ContinuousIntegration/autopkgtest">autopkgtest</a>
framework but can be used by others. Please see
<code class="file docutils literal notranslate"><span class="pre">pkg-test/README.md</span></code> in the source distribution for details.</p>
</section>
<section id="packaging-documentation">
<span id="packaging-doc"></span><h3>Packaging Documentation<a class="headerlink" href="#packaging-documentation" title="Permalink to this heading"></a></h3>
<p>Starting in qpdf version 10.5, pre-built documentation is no longer
distributed with the qpdf source distribution. Here are a few options
you may want to consider for your packages:</p>
<ul>
<li><p><strong>Do nothing</strong></p>
<p>When you run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">install</span></code>, the file <code class="file docutils literal notranslate"><span class="pre">README-doc.txt</span></code> is
installed in the documentation directory. That file tells the reader
where to find the documentation online and where to go to download
offline copies of the documentation. This is the option selected by
the debian packages.</p>
</li>
<li><p><strong>Embed pre-built documentation</strong></p>
<p>You can obtain pre-built documentation and extract its contents into
your distribution. This is what the Windows binary distributions
available from the qpdf release site do. You can find the pre-built
documentation in the release area in the file
<code class="file docutils literal notranslate"><span class="pre">qpdf-</span><em><span class="pre">version</span></em><span class="pre">-doc.zip</span></code>. For an example of this approach,
look at qpdf’s GitHub actions build scripts. The
<code class="file docutils literal notranslate"><span class="pre">build-scripts/build-doc</span></code> script builds with
<code class="docutils literal notranslate"><span class="pre">-DBUILD_DOC_DIST=1</span></code> to create the documentation distribution. The
<code class="file docutils literal notranslate"><span class="pre">build-scripts/build-windows</span></code> script extracts it into the
build tree and builds with <code class="docutils literal notranslate"><span class="pre">-DINSTALL_MANUAL=1</span></code> to include it in
the installer.</p>
</li>
<li><p><strong>Build the documentation yourself</strong></p>
<p>You can build the documentation as part of your build process. Be
sure to pass <code class="docutils literal notranslate"><span class="pre">-DBUILD_DOC_DIST=1</span></code> and <code class="docutils literal notranslate"><span class="pre">-DINSTALL_MANUAL=1</span></code> to
cmake. This is what the AppImage build does. The latest version of
Sphinx at the time of the initial conversion a sphinx-based
documentation was 4.3.2. Older versions are not guaranteed to work.</p>
</li>
</ul>
<section id="documentation-packaging-rationale">
<span id="doc-packaging-rationale"></span><h4>Documentation Packaging Rationale<a class="headerlink" href="#documentation-packaging-rationale" title="Permalink to this heading"></a></h4>
<p>This section describes the reason for things being the way they are.
It’s for information only; you don’t have to know any of this to
package qpdf.</p>
<p>What is the reason for this change? Prior to qpdf 10.5, the qpdf
manual was a docbook XML file. The generated documents were the
product of running the file through build-time style sheets and
contained no copyrighted material of their own. Starting with version
10.5, the manual is written in reStructured Text and built with <a class="reference external" href="https://www.sphinx-doc.org">Sphinx</a>. This change was made to make it much
easier to automatically generate portions of the documentation and to
make the documentation easier to work with. The HTML output of Sphinx
is also much more readable, usable, and suitable for online
consumption than the output of the docbook style sheets. The downsides
are that the generated HTML documentation now contains Javascript code
and embedded fonts, and the PDF version of the documentation is no
longer as suitable for printing (at least as of the 10.5 distribution)
since external link targets are no longer shown and cross references
no longer contain page number information. The presence of copyrighted
material in the generated documentation, even though things are
licensed with MIT and BSD licenses, complicates the job of the
packager in various ways. For one thing, it means the
<code class="file docutils literal notranslate"><span class="pre">NOTICE.md</span></code> file in the source repository would have to keep up
with the copyright information for files that are not controlled in
the repository. Additionally, some distributions (notably
Debian/Ubuntu) discourage inclusion of sphinx-generated documentation
in packages, preferring you instead to build the documentation as part
of the package build process and to depend at runtime on a shared
package that contains the code. At the time of the conversion of the
qpdf manual from docbook to sphinx, newer versions of both sphinx and
the html theme were required than were available in some of most of
the Debian/Ubuntu versions for which qpdf was packaged.</p>
<p>Since always-on Internet connectivity is much more common than it used
to be, many users of qpdf would prefer to consume the documentation
online anyway, and the lack of pre-built documentation in the
distribution won’t be as big of a deal. However there are still some
people who can’t or choose not to view documentation online. For them,
pre-built documentation is still available.</p>
</section>
</section>
</section>
<span id="document-cli"></span><section id="running-qpdf">
<span id="using"></span><h2>Running qpdf<a class="headerlink" href="#running-qpdf" title="Permalink to this heading"></a></h2>
<p>This chapter describes how to run the qpdf program from the command
line.</p>
<section id="basic-invocation">
<span id="invocation"></span><h3>Basic Invocation<a class="headerlink" href="#basic-invocation" title="Permalink to this heading"></a></h3>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Usage: qpdf [infile] [options] [outfile]
</pre></div>
</div>
<p>The <strong class="command">qpdf</strong> command reads the PDF file <code class="samp docutils literal notranslate"><em><span class="pre">infile</span></em></code>,
applies various transformations or modifications to the file in
memory, and writes the result to <code class="samp docutils literal notranslate"><em><span class="pre">outfile</span></em></code>. When run with no
options, the output file is functionally identical to the input file
but may be structurally reorganized, and orphaned objects are removed
from the file. Many options are available for applying transformations
or modifications to the file.</p>
<p><code class="samp docutils literal notranslate"><em><span class="pre">infile</span></em></code> can be a regular file, or it can be
<a class="reference internal" href="#option-empty" title="option-empty"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--empty</span></code></a> to start with an empty PDF file. There is no way
to use standard input since the input file has to be seekable.</p>
<p><code class="samp docutils literal notranslate"><em><span class="pre">outfile</span></em></code> can be a regular file, <code class="docutils literal notranslate"><span class="pre">-</span></code> to represent standard
output, or <a class="reference internal" href="#option-replace-input" title="option-replace-input"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--replace-input</span></code></a> to indicate that the input file
should be overwritten. The output file does not have to be seekable,
even when generating linearized files. You can also use
<a class="reference internal" href="#option-split-pages" title="option-split-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--split-pages</span></code></a> to create separate output files for each
page (or group of pages) instead of a single output file.</p>
<p>Password-protected files may be opened by specifying a password with
<a class="reference internal" href="#option-password" title="option-password"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--password</span></code></a>.</p>
<p>All options other than help options (see <a class="reference internal" href="#help-options"><span class="std std-ref">Help/Information</span></a>) require
an input file. If inspection or JSON options (see
<a class="reference internal" href="#inspection-options"><span class="std std-ref">PDF Inspection</span></a> and <a class="reference internal" href="#json-options"><span class="std std-ref">JSON Options</span></a>) or help options are
given, an output file must not be given. Otherwise, an output file is
required.</p>
<p>If <code class="samp docutils literal notranslate"><span class="pre">&#64;filename</span></code> appears as a word anywhere in the command-line,
it will be read line by line, and each line will be treated as a
command-line argument. Leading and trailing whitespace is
intentionally not removed from lines, which makes it possible to
handle arguments that start or end with spaces. The <code class="samp docutils literal notranslate"><span class="pre">&#64;-</span></code> option
allows arguments to be read from standard input. This allows qpdf to
be invoked with an arbitrary number of arbitrarily long arguments. It
is also very useful for avoiding having to pass passwords on the
command line, though see also <a class="reference internal" href="#option-password-file" title="option-password-file"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--password-file</span></code></a>. Note that
the <code class="samp docutils literal notranslate"><span class="pre">&#64;filename</span></code> can’t appear in the middle of an argument, so
constructs such as <code class="samp docutils literal notranslate"><span class="pre">--arg=&#64;filename</span></code> will not work. Instead, you
would have to include the option and its parameter (e.g.,
<code class="samp docutils literal notranslate"><span class="pre">--option=parameter</span></code>) as a line in the <code class="file docutils literal notranslate"><span class="pre">filename</span></code> file and
just pass <code class="samp docutils literal notranslate"><span class="pre">&#64;filename</span></code> on the command line.</p>
<section id="related-options">
<h4>Related Options<a class="headerlink" href="#related-options" title="Permalink to this heading"></a></h4>
<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-empty">
<span class="sig-name descname"><span class="pre">--empty</span></span><a class="headerlink" href="#option-empty" title="Permalink to this definition"></a></dt>
<dd><p>This option may be given in place of <code class="samp docutils literal notranslate"><em><span class="pre">infile</span></em></code>. This causes
qpdf to use a dummy input file that contains zero pages. This
option is useful in conjunction with <a class="reference internal" href="#option-pages" title="option-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--pages</span></code></a>. See
<a class="reference internal" href="#page-selection"><span class="std std-ref">Page Selection</span></a> for details.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-replace-input">
<span class="sig-name descname"><span class="pre">--replace-input</span></span><a class="headerlink" href="#option-replace-input" title="Permalink to this definition"></a></dt>
<dd><p>This option may be given in place of <code class="samp docutils literal notranslate"><em><span class="pre">outfile</span></em></code>. This causes
qpdf to replace the input file with the output. It does this by
writing to <code class="file docutils literal notranslate"><em><span class="pre">infilename</span></em><span class="pre">.~qpdf-temp#</span></code> and, when done,
overwriting the input file with the temporary file. If there were
any warnings, the original input is saved as
<code class="file docutils literal notranslate"><em><span class="pre">infilename</span></em><span class="pre">.~qpdf-orig</span></code>. If there are errors, the input
file is left untouched.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-job-json-file">
<span class="sig-name descname"><span class="pre">--job-json-file=file</span></span><a class="headerlink" href="#option-job-json-file" title="Permalink to this definition"></a></dt>
<dd><p>Specify the name of a file whose contents are expected to contain a
QPDFJob JSON file. This file is read and treated as if the
equivalent command-line arguments were supplied. It can be repeated
and mixed freely with other options. Run <code class="docutils literal notranslate"><span class="pre">qpdf</span></code> with
<a class="reference internal" href="#option-job-json-help" title="option-job-json-help"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--job-json-help</span></code></a> for a description of the job JSON input
file format. For more information, see <a class="reference internal" href="index.html#qpdf-job"><span class="std std-ref">QPDFJob: a Job-Based Interface</span></a>. Note that
this is unrelated to <a class="reference internal" href="#option-json" title="option-json"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json</span></code></a> but may be combined with
it.</p>
</dd></dl>

</section>
</section>
<section id="exit-status">
<span id="id1"></span><h3>Exit Status<a class="headerlink" href="#exit-status" title="Permalink to this heading"></a></h3>
<p>The exit status of <strong class="command">qpdf</strong> may be interpreted as follows:</p>
<table class="docutils align-default" id="id23">
<caption><span class="caption-text">Exit Codes</span><a class="headerlink" href="#id23" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 5.9%" />
<col style="width: 94.1%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>0</p></td>
<td><p>no errors or warnings were found</p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>not used</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>errors were found; the file was not processed</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>warnings were found without errors</p></td>
</tr>
</tbody>
</table>
<p>Notes:</p>
<ul class="simple">
<li><p>A PDF file may have problems that qpdf can’t detect.</p></li>
<li><p>With the <a class="reference internal" href="#option-warning-exit-0" title="option-warning-exit-0"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--warning-exit-0</span></code></a> option, exit status <code class="docutils literal notranslate"><span class="pre">0</span></code> is
used even if there are warnings.</p></li>
<li><p><strong class="command">qpdf</strong> does not exit with status <code class="docutils literal notranslate"><span class="pre">1</span></code> since the shell uses
this exit code if it is unable to invoke the command.</p></li>
<li><p>If both errors and warnings were found, exit status <code class="docutils literal notranslate"><span class="pre">2</span></code> is used.</p></li>
<li><p>The <a class="reference internal" href="#option-is-encrypted" title="option-is-encrypted"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--is-encrypted</span></code></a> and <a class="reference internal" href="#option-requires-password" title="option-requires-password"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--requires-password</span></code></a>
options use different exit codes. See their help for details.</p></li>
</ul>
<section id="id2">
<h4>Related Options<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h4>
<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-warning-exit-0">
<span class="sig-name descname"><span class="pre">--warning-exit-0</span></span><a class="headerlink" href="#option-warning-exit-0" title="Permalink to this definition"></a></dt>
<dd><p>If there were warnings only and no errors, exit with exit code
<code class="docutils literal notranslate"><span class="pre">0</span></code> instead of <code class="docutils literal notranslate"><span class="pre">3</span></code>. When combined with <a class="reference internal" href="#option-no-warn" title="option-no-warn"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--no-warn</span></code></a>,
the effect is for <strong class="command">qpdf</strong> to completely ignore warnings.</p>
</dd></dl>

</section>
</section>
<section id="shell-completion">
<span id="id3"></span><h3>Shell Completion<a class="headerlink" href="#shell-completion" title="Permalink to this heading"></a></h3>
<p><strong class="command">qpdf</strong> provides its own completion support for zsh and bash.
You can enable bash completion with <strong class="command">eval $(qpdf
--completion-bash)</strong> and zsh completion with <strong class="command">eval $(qpdf
--completion-zsh)</strong>. If <strong class="command">qpdf</strong> is not in your path, you should
use an absolute path to qpdf in the above invocation. If you invoke it
with a relative path, it will warn you, and the completion won’t work
if you’re in a different directory.</p>
<p><strong class="command">qpdf</strong> will use <code class="docutils literal notranslate"><span class="pre">argv[0]</span></code> to figure out where its
executable is. This may produce unwanted results in some cases,
especially if you are trying to use completion with a copy of qpdf that
is run directly out of the source tree or that is invoked with a
wrapper script. You can specify a full path to the qpdf you want to
use for completion in the <code class="docutils literal notranslate"><span class="pre">QPDF_EXECUTABLE</span></code> environment variable.</p>
<section id="id4">
<h4>Related Options<a class="headerlink" href="#id4" title="Permalink to this heading"></a></h4>
<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-completion-bash">
<span class="sig-name descname"><span class="pre">--completion-bash</span></span><a class="headerlink" href="#option-completion-bash" title="Permalink to this definition"></a></dt>
<dd><p>Output a completion command you can eval to enable shell completion
from bash.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-completion-zsh">
<span class="sig-name descname"><span class="pre">--completion-zsh</span></span><a class="headerlink" href="#option-completion-zsh" title="Permalink to this definition"></a></dt>
<dd><p>Output a completion command you can eval to enable shell completion
from zsh.</p>
</dd></dl>

</section>
</section>
<section id="help-information">
<span id="help-options"></span><h3>Help/Information<a class="headerlink" href="#help-information" title="Permalink to this heading"></a></h3>
<p>Help options provide some information about qpdf itself. Help options
are only valid as the first and only command-line argument.</p>
<section id="id5">
<h4>Related Options<a class="headerlink" href="#id5" title="Permalink to this heading"></a></h4>
<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-help">
<span class="sig-name descname"><span class="pre">--help[=--option|topic]</span></span><a class="headerlink" href="#option-help" title="Permalink to this definition"></a></dt>
<dd><p>Display command-line invocation help. Use <code class="samp docutils literal notranslate"><span class="pre">--help=</span><em><span class="pre">--option</span></em></code>
for help on a specific option and <code class="samp docutils literal notranslate"><span class="pre">--help=</span><em><span class="pre">topic</span></em></code> for help
on a help topic and also provides a list of available help topics.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-version">
<span class="sig-name descname"><span class="pre">--version</span></span><a class="headerlink" href="#option-version" title="Permalink to this definition"></a></dt>
<dd><p>Display the version of qpdf. The version number displayed is the
one that is compiled into the qpdf library. If you don’t see the
version number you expect, you may have more than one version of
<strong class="command">qpdf</strong> installed and may not have your library path set up
correctly.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-copyright">
<span class="sig-name descname"><span class="pre">--copyright</span></span><a class="headerlink" href="#option-copyright" title="Permalink to this definition"></a></dt>
<dd><p>Display copyright and license information.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-show-crypto">
<span class="sig-name descname"><span class="pre">--show-crypto</span></span><a class="headerlink" href="#option-show-crypto" title="Permalink to this definition"></a></dt>
<dd><p>Show a list of available crypto providers, each on a line by
itself. The default provider is always listed first. See
<a class="reference internal" href="index.html#crypto"><span class="std std-ref">Crypto Providers</span></a> for more information about crypto providers.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-job-json-help">
<span class="sig-name descname"><span class="pre">--job-json-help</span></span><a class="headerlink" href="#option-job-json-help" title="Permalink to this definition"></a></dt>
<dd><p>Describe the format of the QPDFJob JSON input used by
<a class="reference internal" href="#option-job-json-file" title="option-job-json-file"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--job-json-file</span></code></a>. For more information about QPDFJob,
see <a class="reference internal" href="index.html#qpdf-job"><span class="std std-ref">QPDFJob: a Job-Based Interface</span></a>.</p>
</dd></dl>

</section>
</section>
<section id="general-options">
<span id="id6"></span><h3>General Options<a class="headerlink" href="#general-options" title="Permalink to this heading"></a></h3>
<p>This section describes general options that control <strong class="command">qpdf</strong>’s
behavior. They are not necessarily related to the specific operation
that is being performed and may be used whether or not an output file
is being created.</p>
<section id="id7">
<h4>Related Options<a class="headerlink" href="#id7" title="Permalink to this heading"></a></h4>
<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-password">
<span class="sig-name descname"><span class="pre">--password=password</span></span><a class="headerlink" href="#option-password" title="Permalink to this definition"></a></dt>
<dd><p>Specifies a password for accessing encrypted, password-protected
files. To read the password from a file or standard input, you can
use <a class="reference internal" href="#option-password-file" title="option-password-file"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--password-file</span></code></a>.</p>
<p>Prior to 8.4.0, in the case of passwords that contain characters
that fall outside of 7-bit US-ASCII, qpdf left the burden of
supplying properly encoded encryption and decryption passwords to
the user. Starting in qpdf 8.4.0, qpdf does this automatically in
most cases. For an in-depth discussion, please see
<a class="reference internal" href="#unicode-passwords"><span class="std std-ref">Unicode Passwords</span></a>. Previous versions of this manual
described workarounds using the <strong class="command">iconv</strong> command. Such
workarounds are no longer required or recommended starting with
qpdf 8.4.0. However, for backward compatibility, qpdf attempts to
detect those workarounds and do the right thing in most cases.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-password-file">
<span class="sig-name descname"><span class="pre">--password-file=filename</span></span><a class="headerlink" href="#option-password-file" title="Permalink to this definition"></a></dt>
<dd><p>Reads the first line from the specified file and uses it as the
password for accessing encrypted files. <code class="samp docutils literal notranslate"><em><span class="pre">filename</span></em></code> may be
<code class="docutils literal notranslate"><span class="pre">-</span></code> to read the password from standard input, but if you do that
the password is echoed and there is no prompt, so use <code class="docutils literal notranslate"><span class="pre">-</span></code> with
caution. Note that leading and trailing spaces are not stripped
from the password.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-verbose">
<span class="sig-name descname"><span class="pre">--verbose</span></span><a class="headerlink" href="#option-verbose" title="Permalink to this definition"></a></dt>
<dd><p>Increase verbosity of output. This includes information about files
created, image optimization, and several other operations. In some
cases, it also displays additional information when inspection
options (see <a class="reference internal" href="#inspection-options"><span class="std std-ref">PDF Inspection</span></a>) are used.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-progress">
<span class="sig-name descname"><span class="pre">--progress</span></span><a class="headerlink" href="#option-progress" title="Permalink to this definition"></a></dt>
<dd><p>Indicate progress while writing output files. Progress indication
does not start until writing starts, so there may be a delay before
progress indicators are seen if complicated transformations are
being applied before the write process begins.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-no-warn">
<span class="sig-name descname"><span class="pre">--no-warn</span></span><a class="headerlink" href="#option-no-warn" title="Permalink to this definition"></a></dt>
<dd><p>Suppress writing of warnings to stderr. If warnings were detected
and suppressed, <strong class="command">qpdf</strong> will still exit with exit code 3.
To completely ignore warnings, also specify
<a class="reference internal" href="#option-warning-exit-0" title="option-warning-exit-0"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--warning-exit-0</span></code></a>. Use with caution as qpdf is not
always successful in recovering from situations that cause warnings
to be issued.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-deterministic-id">
<span class="sig-name descname"><span class="pre">--deterministic-id</span></span><a class="headerlink" href="#option-deterministic-id" title="Permalink to this definition"></a></dt>
<dd><p>Generate a secure, random document ID using deterministic values.
This prevents use of timestamp and output file name information in
the ID generation. Instead, at some slight additional runtime cost,
the ID field is generated to include a digest of the significant
parts of the content of the output PDF file. This means that a
given qpdf operation should generate the same ID each time it is
run, which can be useful when caching results or for generation of
some test data. Use of this flag is not compatible with creation of
encrypted files. This option can be useful for testing. See also
<a class="reference internal" href="#option-static-id" title="option-static-id"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--static-id</span></code></a>.</p>
<p>While qpdf will generate the same deterministic ID given the same
output PDF, there is no guarantee that different versions of qpdf
will generate exactly the same PDF output for the same input and
options. While care is taken to avoid gratuitous changes to qpdf’s
PDF generation, new versions of qpdf may include changes or bug
fixes that cause slightly different PDF code to be generated. Such
changes are noted in the release notes.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-allow-weak-crypto">
<span class="sig-name descname"><span class="pre">--allow-weak-crypto</span></span><a class="headerlink" href="#option-allow-weak-crypto" title="Permalink to this definition"></a></dt>
<dd><p>Encrypted PDF files using 40-bit keys or 128-bit keys without AES
use the insecure <em>RC4</em> encryption algorithm. Starting with version
11.0, qpdf’s default behavior is to refuse to write files using RC4
encryption. Use this option to allow creation of such files. In
versions 10.4 through 10.6, attempting to create weak encrypted
files was a warning, rather than an error, without this flag. See
<a class="reference internal" href="index.html#weak-crypto"><span class="std std-ref">Weak Cryptography</span></a> for additional details.</p>
<p>No check is performed for weak crypto when preserving encryption
parameters from or copying encryption parameters from other files.
The rationale for this is discussed in <a class="reference internal" href="index.html#weak-crypto"><span class="std std-ref">Weak Cryptography</span></a>.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-keep-files-open">
<span class="sig-name descname"><span class="pre">--keep-files-open=[y|n]</span></span><a class="headerlink" href="#option-keep-files-open" title="Permalink to this definition"></a></dt>
<dd><p>This option controls whether qpdf keeps individual files open while
merging. By default, qpdf keeps files open when merging unless more
than 200 files are specified, in which case files are opened as
needed and closed when finished. Repeatedly opening
and closing files may impose a large performance penalty with some
file systems, especially networked file systems. If you know that
you have a large enough open file limit and are suffering from
performance problems, or if you have an open file limit smaller
than 200, you can use this option to override the default behavior
by specifying <code class="samp docutils literal notranslate"><span class="pre">--keep-files-open=y</span></code> to force <strong class="command">qpdf</strong>
to keep files open or <code class="samp docutils literal notranslate"><span class="pre">--keep-files-open=n</span></code> to force it to
only open files as needed. See also
<a class="reference internal" href="#option-keep-files-open-threshold" title="option-keep-files-open-threshold"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--keep-files-open-threshold</span></code></a>.</p>
<p>Historical note: prior to version 8.1.0, qpdf always kept all files
open, but this meant that the number of files that could be merged
was limited by the operating system’s open file limit. Version
8.1.0 opened files as they were referenced and closed them after
each read, but this caused a major performance impact. Version
8.2.0 optimized the performance but did so in a way that, for local
file systems, there was a small but unavoidable performance hit,
but for networked file systems the performance impact could be
very high. The current behavior was introduced in qpdf version
8.2.1.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-keep-files-open-threshold">
<span class="sig-name descname"><span class="pre">--keep-files-open-threshold=count</span></span><a class="headerlink" href="#option-keep-files-open-threshold" title="Permalink to this definition"></a></dt>
<dd><p>If specified, overrides the default value of 200 used as the
threshold for qpdf deciding whether or not to keep files open. See
<a class="reference internal" href="#option-keep-files-open" title="option-keep-files-open"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--keep-files-open</span></code></a> for details.</p>
</dd></dl>

</section>
</section>
<section id="advanced-control-options">
<span id="id8"></span><h3>Advanced Control Options<a class="headerlink" href="#advanced-control-options" title="Permalink to this heading"></a></h3>
<p>Advanced control options control qpdf’s behavior in ways that would
normally never be needed by a user but that may be useful to
developers or people investigating problems with specific files.</p>
<section id="id9">
<h4>Related Options<a class="headerlink" href="#id9" title="Permalink to this heading"></a></h4>
<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-password-is-hex-key">
<span class="sig-name descname"><span class="pre">--password-is-hex-key</span></span><a class="headerlink" href="#option-password-is-hex-key" title="Permalink to this definition"></a></dt>
<dd><p>Overrides the usual computation/retrieval of the PDF file’s
encryption key from user/owner password with an explicit
specification of the encryption key. When this option is specified,
the parameter to the <a class="reference internal" href="#option-password" title="option-password"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--password</span></code></a> option is interpreted as
a hexadecimal-encoded key value. This only applies to the password
used to open the main input file. It does not apply to other files
opened by <a class="reference internal" href="#option-pages" title="option-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--pages</span></code></a> or other options or to files being
written.</p>
<p>Most users will never have a need for this option, and no standard
viewers support this mode of operation, but it can be useful for
forensic or investigatory purposes. For example, if a PDF file is
encrypted with an unknown password, a brute-force attack using the
key directly is sometimes more efficient than one using the
password. Also, if a file is heavily damaged, it may be possible to
derive the encryption key and recover parts of the file using it
directly. To expose the encryption key used by an encrypted file
that you can open normally, use the
<a class="reference internal" href="#option-show-encryption-key" title="option-show-encryption-key"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--show-encryption-key</span></code></a> option.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-suppress-password-recovery">
<span class="sig-name descname"><span class="pre">--suppress-password-recovery</span></span><a class="headerlink" href="#option-suppress-password-recovery" title="Permalink to this definition"></a></dt>
<dd><p>Ordinarily, qpdf attempts to automatically compensate for passwords
encoded with the wrong character encoding. This option suppresses
that behavior. Under normal conditions, there are no reasons to use
this option. See <a class="reference internal" href="#unicode-passwords"><span class="std std-ref">Unicode Passwords</span></a> for a discussion.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-password-mode">
<span class="sig-name descname"><span class="pre">--password-mode=mode</span></span><a class="headerlink" href="#option-password-mode" title="Permalink to this definition"></a></dt>
<dd><p>This option can be used to fine-tune how qpdf interprets Unicode
(non-ASCII) password strings passed on the command line. With the
exception of the <code class="samp docutils literal notranslate"><span class="pre">hex-bytes</span></code> mode, these only apply to
passwords provided when encrypting files. The <code class="samp docutils literal notranslate"><span class="pre">hex-bytes</span></code>
mode also applies to passwords specified for reading files. For
additional discussion of the supported password modes and when you
might want to use them, see <a class="reference internal" href="#unicode-passwords"><span class="std std-ref">Unicode Passwords</span></a>. The following
modes are supported:</p>
<ul class="simple">
<li><p><code class="samp docutils literal notranslate"><span class="pre">auto</span></code>: Automatically determine whether the specified
password is a properly encoded Unicode (UTF-8) string, and
transcode it as required by the PDF spec based on the type of
encryption being applied. On Windows starting with version 8.4.0,
and on almost all other modern platforms, incoming passwords will
be properly encoded in UTF-8, so this is almost always what you
want.</p></li>
<li><p><code class="samp docutils literal notranslate"><span class="pre">unicode</span></code>: Tells qpdf that the incoming password is UTF-8,
overriding whatever its automatic detection determines. The only
difference between this mode and <code class="samp docutils literal notranslate"><span class="pre">auto</span></code> is that qpdf will
fail with an error message if the password is not valid UTF-8
instead of falling back to <code class="samp docutils literal notranslate"><span class="pre">bytes</span></code> mode with a warning.</p></li>
<li><p><code class="samp docutils literal notranslate"><span class="pre">bytes</span></code>: Interpret the password as a literal byte string.
For non-Windows platforms, this is what versions of qpdf prior to
8.4.0 did. For Windows platforms, there is no way to specify
strings of binary data on the command line directly, but you can
use a <code class="samp docutils literal notranslate"><span class="pre">&#64;filename</span></code> option or <a class="reference internal" href="#option-password-file" title="option-password-file"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--password-file</span></code></a> to
do it, in which case this option forces qpdf to respect the
string of bytes as provided. Note that this option may cause you
to encrypt PDF files with passwords that will not be usable by
other readers.</p></li>
<li><p><code class="samp docutils literal notranslate"><span class="pre">hex-bytes</span></code>: Interpret the password as a hex-encoded
string. This provides a way to pass binary data as a password on
all platforms including Windows. As with <code class="samp docutils literal notranslate"><span class="pre">bytes</span></code>, this
option may allow creation of files that can’t be opened by other
readers. This mode affects qpdf’s interpretation of passwords
specified for decrypting files as well as for encrypting them. It
makes it possible to specify strings that are encoded in some
manner other than the system’s default encoding.</p></li>
</ul>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-suppress-recovery">
<span class="sig-name descname"><span class="pre">--suppress-recovery</span></span><a class="headerlink" href="#option-suppress-recovery" title="Permalink to this definition"></a></dt>
<dd><p>Prevents qpdf from attempting to reconstruct a file’s cross
reference table when there are errors reading objects from the
file. Recovery is triggered by a variety of situations. While
usually successful, it uses heuristics that don’t work on all
files. If this option is given, <strong class="command">qpdf</strong> fails on the first
error it encounters.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-ignore-xref-streams">
<span class="sig-name descname"><span class="pre">--ignore-xref-streams</span></span><a class="headerlink" href="#option-ignore-xref-streams" title="Permalink to this definition"></a></dt>
<dd><p>Tells qpdf to ignore any cross-reference streams, falling back to
any embedded cross-reference tables or triggering document
recovery. Ordinarily, qpdf reads cross-reference streams when they
are present in a PDF file. If this option is specified,
qpdf will ignore any cross-reference streams for hybrid PDF files.
The purpose of hybrid files is to make some content available to
viewers that are not aware of cross-reference streams. It is almost
never desirable to ignore them. The only time when you might want
to use this feature is if you are testing creation of hybrid PDF
files and wish to see how a PDF consumer that doesn’t understand
object and cross-reference streams would interpret such a file.</p>
</dd></dl>

</section>
</section>
<section id="pdf-transformation">
<span id="transformation-options"></span><h3>PDF Transformation<a class="headerlink" href="#pdf-transformation" title="Permalink to this heading"></a></h3>
<p>The options discussed in this section tell qpdf to apply
transformations that change the structure of a PDF file without
changing its content. Examples include creating linearized
(web-optimized) files, adding or removing encryption, restructuring
files for older viewers, and rewriting files for human inspection. See
also <a class="reference internal" href="#modification-options"><span class="std std-ref">PDF Modification</span></a>.</p>
<section id="id10">
<h4>Related Options<a class="headerlink" href="#id10" title="Permalink to this heading"></a></h4>
<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-linearize">
<span class="sig-name descname"><span class="pre">--linearize</span></span><a class="headerlink" href="#option-linearize" title="Permalink to this definition"></a></dt>
<dd><p>Create linearized (web-optimized) output files. Linearized files
are formatted in a way that allows compliant readers to begin
displaying a PDF file before it is fully downloaded. Ordinarily,
the entire file must be present before it can be rendered because
important cross-reference information typically appears at the end
of the file.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-encrypt">
<span class="sig-name descname"><span class="pre">--encrypt</span> <span class="pre">user-password</span> <span class="pre">owner-password</span> <span class="pre">key-length</span> <span class="pre">[options]</span> <span class="pre">--</span></span><a class="headerlink" href="#option-encrypt" title="Permalink to this definition"></a></dt>
<dd><p>This flag starts encryption options, used to create encrypted
files. Please see <a class="reference internal" href="#encryption-options"><span class="std std-ref">Encryption</span></a> for details.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-decrypt">
<span class="sig-name descname"><span class="pre">--decrypt</span></span><a class="headerlink" href="#option-decrypt" title="Permalink to this definition"></a></dt>
<dd><p>Create an output file with no encryption even if the input file is
encrypted. This option overrides the default behavior of preserving
whatever encryption was present on the input file. This
functionality is not intended to be used for bypassing copyright
restrictions or other restrictions placed on files by their
producers. See also <a class="reference internal" href="#option-copy-encryption" title="option-copy-encryption"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--copy-encryption</span></code></a>.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-copy-encryption">
<span class="sig-name descname"><span class="pre">--copy-encryption=file</span></span><a class="headerlink" href="#option-copy-encryption" title="Permalink to this definition"></a></dt>
<dd><p>Copy all encryption parameters, including the user password, the
owner password, and all security restrictions, from the specified
file instead of preserving the encryption details from the input
file. This works even if only one of the user password or owner
password is known. If the encryption file requires a password, use
the <a class="reference internal" href="#option-encryption-file-password" title="option-encryption-file-password"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--encryption-file-password</span></code></a> option to set it. Note
that copying the encryption parameters from a file also copies the
first half of <code class="docutils literal notranslate"><span class="pre">/ID</span></code> from the file since this is part of the
encryption parameters. This option can be useful if you need to
decrypt a file to make manual changes to it or to change it outside
of qpdf, and then want to restore the original encryption on the
file without having to manual specify all the individual settings.
See also <a class="reference internal" href="#option-decrypt" title="option-decrypt"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--decrypt</span></code></a>.</p>
<p>Checks for weak cryptographic algorithms are intentionally not made
by this operation. See <a class="reference internal" href="index.html#weak-crypto"><span class="std std-ref">Weak Cryptography</span></a> for the rationale.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-encryption-file-password">
<span class="sig-name descname"><span class="pre">--encryption-file-password=password</span></span><a class="headerlink" href="#option-encryption-file-password" title="Permalink to this definition"></a></dt>
<dd><p>If the file specified with <a class="reference internal" href="#option-copy-encryption" title="option-copy-encryption"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--copy-encryption</span></code></a>
requires a password, supply the password using this option. This
option is necessary because the <a class="reference internal" href="#option-password" title="option-password"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--password</span></code></a> option
applies to the input file, not the file from which encryption is
being copied.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-qdf">
<span class="sig-name descname"><span class="pre">--qdf</span></span><a class="headerlink" href="#option-qdf" title="Permalink to this definition"></a></dt>
<dd><p>Create a PDF file suitable for viewing and editing in a text
editor. This is to edit the PDF code, not the page contents. To
edit a QDF file, your text editor must preserve binary data. In a
QDF file, all streams that can be uncompressed are uncompressed,
and content streams are normalized, among other changes. The
companion tool <strong class="command">fix-qdf</strong> can be used to repair hand-edited
QDF files. QDF is a feature specific to the qpdf tool. For
additional information, see <a class="reference internal" href="index.html#qdf"><span class="std std-ref">QDF Mode</span></a>. Note that
<a class="reference internal" href="#option-linearize" title="option-linearize"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--linearize</span></code></a> disables QDF mode.</p>
<p>QDF mode has full support for object streams, but sometimes it’s
easier to locate a specific object if object streams are disabled.
When trying to understand some PDF construct by inspecting an
existing file, it can be useful to combine <code class="samp docutils literal notranslate"><span class="pre">--qdf</span></code> with
<code class="samp docutils literal notranslate"><span class="pre">--object-streams=disable</span></code>.</p>
<p>This flag changes some of the defaults of other options: stream
data is uncompressed, content streams are normalized, and
encryption is removed. These defaults can still be overridden by
specifying the appropriate options with <code class="samp docutils literal notranslate"><span class="pre">--qdf</span></code>.
Additionally, in QDF mode, stream lengths are stored as indirect
objects, objects are formatted in a less efficient but more
readable fashion, and the documents are interspersed with comments
that make it easier for the user to find things and also make it
possible for <strong class="command">fix-qdf</strong> to work properly. When editing QDF
files, it is not necessary to maintain the object formatting.</p>
<p>When normalizing content, if qpdf runs into any lexical errors, it
will print a warning indicating that content may be damaged. If you
want to create QDF files without content normalization, specify
<code class="samp docutils literal notranslate"><span class="pre">--qdf</span> <span class="pre">--normalize-content=n</span></code>. You can also create a non-QDF
file with uncompressed streams using
<code class="samp docutils literal notranslate"><span class="pre">--stream-data=uncompress</span></code>. Either option will uncompress all
the streams but will not attempt to normalize content. Please note
that if you are using content normalization or QDF mode for the
purpose of manually inspecting files, you don’t have to care about
this.</p>
<p>See also <a class="reference internal" href="#option-no-original-object-ids" title="option-no-original-object-ids"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--no-original-object-ids</span></code></a>.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-no-original-object-ids">
<span class="sig-name descname"><span class="pre">--no-original-object-ids</span></span><a class="headerlink" href="#option-no-original-object-ids" title="Permalink to this definition"></a></dt>
<dd><p>Suppresses inclusion of original object ID comments in QDF files.
This can be useful when generating QDF files for test purposes,
particularly when comparing them to determine whether two PDF files
have identical content. The original object ID comment is there by
default because it makes it easier to trace objects back to the
original file.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-compress-streams">
<span class="sig-name descname"><span class="pre">--compress-streams=[y|n]</span></span><a class="headerlink" href="#option-compress-streams" title="Permalink to this definition"></a></dt>
<dd><p>By default, or with <code class="samp docutils literal notranslate"><span class="pre">--compress-streams=y</span></code>, qpdf will
compress streams using the flate compression algorithm (used by zip
and gzip) unless those streams are compressed in some other way.
This analysis is made after qpdf attempts to uncompress streams and
is therefore closely related to <a class="reference internal" href="#option-decode-level" title="option-decode-level"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--decode-level</span></code></a>. To
suppress this behavior and leave streams streams uncompressed, use
<code class="samp docutils literal notranslate"><span class="pre">--compress-streams=n</span></code>. In QDF mode (see <a class="reference internal" href="index.html#qdf"><span class="std std-ref">QDF Mode</span></a> and
<a class="reference internal" href="#option-qdf" title="option-qdf"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--qdf</span></code></a>), the default is to leave streams uncompressed.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-decode-level">
<span class="sig-name descname"><span class="pre">--decode-level=parameter</span></span><a class="headerlink" href="#option-decode-level" title="Permalink to this definition"></a></dt>
<dd><p>Controls which streams qpdf tries to decode. The default is
<code class="samp docutils literal notranslate"><span class="pre">generalized</span></code>.</p>
<p>The following values for <code class="samp docutils literal notranslate"><em><span class="pre">parameter</span></em></code> are available:</p>
<ul class="simple">
<li><p><code class="samp docutils literal notranslate"><span class="pre">none</span></code>: do not attempt to decode any streams. This is the
default with <a class="reference internal" href="#option-json-output" title="option-json-output"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-output</span></code></a>.</p></li>
<li><p><code class="samp docutils literal notranslate"><span class="pre">generalized</span></code>: decode streams filtered with supported
generalized filters: <code class="docutils literal notranslate"><span class="pre">/LZWDecode</span></code>, <code class="docutils literal notranslate"><span class="pre">/FlateDecode</span></code>,
<code class="docutils literal notranslate"><span class="pre">/ASCII85Decode</span></code>, and <code class="docutils literal notranslate"><span class="pre">/ASCIIHexDecode</span></code>. We define
generalized filters as those to be used for general-purpose
compression or encoding, as opposed to filters specifically
designed for image data. This is the default except when
<a class="reference internal" href="#option-json-output" title="option-json-output"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-output</span></code></a> is given.</p></li>
<li><p><code class="samp docutils literal notranslate"><span class="pre">specialized</span></code>: in addition to generalized, decode streams
with supported non-lossy specialized filters; currently this is
just <code class="docutils literal notranslate"><span class="pre">/RunLengthDecode</span></code></p></li>
<li><p><code class="samp docutils literal notranslate"><span class="pre">all</span></code>: in addition to generalized and specialized, decode
streams with supported lossy filters; currently this is just
<code class="docutils literal notranslate"><span class="pre">/DCTDecode</span></code> (JPEG)</p></li>
</ul>
<p>There are several filters that <strong class="command">qpdf</strong> does not support.
These are left untouched regardless of the option. Future versions
of qpdf may support additional filters.</p>
<p>Because the default value is <code class="docutils literal notranslate"><span class="pre">generalized</span></code>, qpdf’s default
behavior is to uncompress any stream that is encoded using
non-lossy filters that qpdf understands. If
<code class="docutils literal notranslate"><span class="pre">--compress-streams=y</span></code> is also in effect, which is the default
(see <a class="reference internal" href="#option-compress-streams" title="option-compress-streams"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--compress-streams</span></code></a>), the overall effect is that
qpdf will recompress streams with generalized filters using flate
compression, effectively eliminating LZW and ASCII-based filters.
This is usually desirable behavior but can be disabled with
<code class="docutils literal notranslate"><span class="pre">--decode-level=none</span></code>. Note that <code class="docutils literal notranslate"><span class="pre">--decode-level=none</span></code> is the
default when <a class="reference internal" href="#option-json-output" title="option-json-output"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-output</span></code></a> is specified, but it can be
overridden in that case as well.</p>
<p>As a special case, streams already compressed with <code class="docutils literal notranslate"><span class="pre">/FlateDecode</span></code>
are not uncompressed and recompressed. You can change this behavior
with <a class="reference internal" href="#option-recompress-flate" title="option-recompress-flate"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--recompress-flate</span></code></a>.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-stream-data">
<span class="sig-name descname"><span class="pre">--stream-data=parameter</span></span><a class="headerlink" href="#option-stream-data" title="Permalink to this definition"></a></dt>
<dd><p>Controls transformation of stream data. This option predates the
<a class="reference internal" href="#option-compress-streams" title="option-compress-streams"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--compress-streams</span></code></a> and <a class="reference internal" href="#option-decode-level" title="option-decode-level"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--decode-level</span></code></a>
options. Those options can be used to achieve the same effect with
more control. The value of <code class="samp docutils literal notranslate"><em><span class="pre">parameter</span></em></code> may be one of the
following:</p>
<ul class="simple">
<li><p><code class="samp docutils literal notranslate"><span class="pre">compress</span></code>: recompress stream data when possible (default);
equivalent to <code class="samp docutils literal notranslate"><span class="pre">--compress-streams=y</span></code>
<code class="samp docutils literal notranslate"><span class="pre">--decode-level=generalized</span></code>. Does not recompress streams
already compressed with <code class="docutils literal notranslate"><span class="pre">/FlateDecode</span></code> unless
<a class="reference internal" href="#option-recompress-flate" title="option-recompress-flate"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--recompress-flate</span></code></a> is also specified.</p></li>
<li><p><code class="samp docutils literal notranslate"><span class="pre">preserve</span></code>: leave all stream data as is; equivalent to
<code class="samp docutils literal notranslate"><span class="pre">--compress-streams=n</span></code> <code class="samp docutils literal notranslate"><span class="pre">--decode-level=none</span></code></p></li>
<li><p><code class="samp docutils literal notranslate"><span class="pre">uncompress</span></code>: uncompress stream data compressed with
generalized filters when possible; equivalent to
<code class="samp docutils literal notranslate"><span class="pre">--compress-streams=n</span></code> <code class="samp docutils literal notranslate"><span class="pre">--decode-level=generalized</span></code></p></li>
</ul>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-recompress-flate">
<span class="sig-name descname"><span class="pre">--recompress-flate</span></span><a class="headerlink" href="#option-recompress-flate" title="Permalink to this definition"></a></dt>
<dd><p>The default generalized compression scheme used by PDF is flate
(<code class="docutils literal notranslate"><span class="pre">/FlateDecode</span></code>), which is the same as used by <strong class="command">zip</strong> and
<strong class="command">gzip</strong>. Usually qpdf just leaves these alone. This option
tells <strong class="command">qpdf</strong> to uncompress and recompress streams
compressed with flate. This can be useful when combined with
<a class="reference internal" href="#option-compression-level" title="option-compression-level"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--compression-level</span></code></a>. Using this option may make
<strong class="command">qpdf</strong> much slower when writing output files.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-compression-level">
<span class="sig-name descname"><span class="pre">--compression-level=level</span></span><a class="headerlink" href="#option-compression-level" title="Permalink to this definition"></a></dt>
<dd><p>When writing new streams that are compressed with <code class="docutils literal notranslate"><span class="pre">/FlateDecode</span></code>,
use the specified compression level. The value of <code class="samp docutils literal notranslate"><span class="pre">level</span></code>
should be a number from 1 to 9 and is passed directly to zlib,
which implements deflate compression. Lower numbers compress less
and are faster; higher numbers compress more and are slower. Note
that <strong class="command">qpdf</strong> doesn’t uncompress and recompress streams
compressed with flate by default. To have this option apply to
already compressed streams, you should also specify
<a class="reference internal" href="#option-recompress-flate" title="option-recompress-flate"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--recompress-flate</span></code></a>. If your goal is to shrink the size
of PDF files, you should also use
<code class="samp docutils literal notranslate"><span class="pre">--object-streams=generate</span></code>. If you omit this option, qpdf
defers to the compression library’s default behavior.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-normalize-content">
<span class="sig-name descname"><span class="pre">--normalize-content=[y|n]</span></span><a class="headerlink" href="#option-normalize-content" title="Permalink to this definition"></a></dt>
<dd><p>Enables or disables normalization of newlines in PDF content
streams to UNIX-style newlines, which is useful for viewing files
in a programmer-friendly text edit across multiple platforms.
Content normalization is off by default, but is automatically
enabled by <a class="reference internal" href="#option-qdf" title="option-qdf"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--qdf</span></code></a> (see also <a class="reference internal" href="index.html#qdf"><span class="std std-ref">QDF Mode</span></a>). It is not
recommended to use this option for production use. If qpdf runs
into any lexical errors while normalizing content, it will print a
warning indicating that content may be damaged.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-object-streams">
<span class="sig-name descname"><span class="pre">--object-streams=mode</span></span><a class="headerlink" href="#option-object-streams" title="Permalink to this definition"></a></dt>
<dd><p>Controls handling of object streams. The value of <code class="samp docutils literal notranslate"><em><span class="pre">mode</span></em></code>
may be one of the following:</p>
<table class="docutils align-default" id="id24">
<caption><span class="caption-text">Object Stream Modes</span><a class="headerlink" href="#id24" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 11.1%" />
<col style="width: 88.9%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="samp docutils literal notranslate"><span class="pre">preserve</span></code></p></td>
<td><p>preserve original object streams, if any (the default)</p></td>
</tr>
<tr class="row-even"><td><p><code class="samp docutils literal notranslate"><span class="pre">disable</span></code></p></td>
<td><p>create output files with no object streams</p></td>
</tr>
<tr class="row-odd"><td><p><code class="samp docutils literal notranslate"><span class="pre">generate</span></code></p></td>
<td><p>create object streams, and compress objects when possible</p></td>
</tr>
</tbody>
</table>
<p>Object streams are PDF streams that contain other objects. Putting
objects into object streams allows the PDF objects themselves to be
compressed, which can result in much smaller PDF files. Combining
this option with <a class="reference internal" href="#option-compression-level" title="option-compression-level"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--compression-level</span></code></a> and
<a class="reference internal" href="#option-recompress-flate" title="option-recompress-flate"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--recompress-flate</span></code></a> can often result in the creation of
smaller PDF files.</p>
<p>Object streams, also known as compressed objects, were introduced
into the PDF specification at version 1.5 around 2003. Some ancient
PDF viewers may not support files with object streams. qpdf can be
used to transform files with object streams into files without object
streams or vice versa.</p>
<p>In <code class="samp docutils literal notranslate"><span class="pre">preserve</span></code> mode, the relationship between objects and the
streams that contain them is preserved from the original file. If
the file has no object streams, qpdf will not add any. In
<code class="samp docutils literal notranslate"><span class="pre">disable</span></code> mode, all objects are written as regular,
uncompressed objects. The resulting file should be structurally
readable by older PDF viewers, though there is still a chance that
the file may contain other content that some older readers can’t
support. In <code class="samp docutils literal notranslate"><span class="pre">generate</span></code> mode, qpdf will create its own object
streams. This will usually result in more compact PDF files. In
this mode, qpdf will also make sure the PDF version number in the
header is at least 1.5.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-preserve-unreferenced">
<span class="sig-name descname"><span class="pre">--preserve-unreferenced</span></span><a class="headerlink" href="#option-preserve-unreferenced" title="Permalink to this definition"></a></dt>
<dd><p>Tells qpdf to preserve objects that are not referenced when writing
the file. Ordinarily any object that is not referenced in a
traversal of the document from the trailer dictionary will be
discarded. Disabling this default behavior may be useful in working
with some damaged files or inspecting files with known unreferenced
objects.</p>
<p>This flag is ignored for linearized files and has the effect of
causing objects in the new file to be written ordered by object ID
from the original file. This does not mean that object numbers will
be the same since qpdf may create stream lengths as direct or
indirect differently from the original file, and the original file
may have gaps in its numbering.</p>
<p>See also <a class="reference internal" href="#option-preserve-unreferenced-resources" title="option-preserve-unreferenced-resources"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--preserve-unreferenced-resources</span></code></a>, which does
something completely different.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-remove-unreferenced-resources">
<span class="sig-name descname"><span class="pre">--remove-unreferenced-resources=parameter</span></span><a class="headerlink" href="#option-remove-unreferenced-resources" title="Permalink to this definition"></a></dt>
<dd><p>Parameters: <code class="docutils literal notranslate"><span class="pre">auto</span></code> (the default), <code class="docutils literal notranslate"><span class="pre">yes</span></code>, or <code class="docutils literal notranslate"><span class="pre">no</span></code>.</p>
<p>Starting with qpdf 8.1, when splitting pages, qpdf is able to
attempt to remove images and fonts that are not used by a page even
if they are referenced in the page’s resources dictionary. When
shared resources are in use, this behavior can greatly reduce the
file sizes of split pages, but the analysis is very slow. In
versions from 8.1 through 9.1.1, qpdf did this analysis by default.
Starting in qpdf 10.0.0, if <code class="docutils literal notranslate"><span class="pre">auto</span></code> is used, qpdf does a quick
analysis of the file to determine whether the file is likely to
have unreferenced objects on pages, a pattern that frequently
occurs when resource dictionaries are shared across multiple pages
and rarely occurs otherwise. If it discovers this pattern, then it
will attempt to remove unreferenced resources. Usually this means
you get the slower splitting speed only when it’s actually going to
create smaller files. You can suppress removal of unreferenced
resources altogether by specifying <code class="docutils literal notranslate"><span class="pre">no</span></code> or force qpdf to do the
full algorithm by specifying <code class="docutils literal notranslate"><span class="pre">yes</span></code>.</p>
<p>Other than cases in which you don’t care about file size and care a
lot about runtime, there are few reasons to use this option,
especially now that <code class="docutils literal notranslate"><span class="pre">auto</span></code> mode is supported. One reason to use
this is if you suspect that qpdf is removing resources it shouldn’t
be removing. If you encounter such a case, please report it as a bug at
<a class="reference external" href="https://github.com/qpdf/qpdf/issues/">https://github.com/qpdf/qpdf/issues/</a>.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-preserve-unreferenced-resources">
<span class="sig-name descname"><span class="pre">--preserve-unreferenced-resources</span></span><a class="headerlink" href="#option-preserve-unreferenced-resources" title="Permalink to this definition"></a></dt>
<dd><p>This is a synonym for <code class="samp docutils literal notranslate"><span class="pre">--remove-unreferenced-resources=no</span></code>.
See <a class="reference internal" href="#option-remove-unreferenced-resources" title="option-remove-unreferenced-resources"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--remove-unreferenced-resources</span></code></a>.</p>
<p>See also <a class="reference internal" href="#option-preserve-unreferenced" title="option-preserve-unreferenced"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--preserve-unreferenced</span></code></a>, which does something
completely different. To reduce confusion, you should use
<code class="samp docutils literal notranslate"><span class="pre">--remove-unreferenced-resources=no</span></code> instead.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-newline-before-endstream">
<span class="sig-name descname"><span class="pre">--newline-before-endstream</span></span><a class="headerlink" href="#option-newline-before-endstream" title="Permalink to this definition"></a></dt>
<dd><p>Tell qpdf to insert a newline before the <code class="docutils literal notranslate"><span class="pre">endstream</span></code> keyword,
not counted in the length, after any stream content even if the
last character of the stream was a newline. This may result in two
newlines in some cases. This is a requirement of PDF/A. While qpdf
doesn’t specifically know how to generate PDF/A-compliant PDFs,
this at least prevents it from removing compliance on already
compliant files.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-coalesce-contents">
<span class="sig-name descname"><span class="pre">--coalesce-contents</span></span><a class="headerlink" href="#option-coalesce-contents" title="Permalink to this definition"></a></dt>
<dd><p>When a page’s contents are split across multiple streams, this
option causes qpdf to combine them into a single stream. Use of
this option is never necessary for ordinary usage, but it can help
when working with some files in some cases. For example, this can
be combined with QDF mode or content normalization to make it
easier to look at all of a page’s contents at once. It is common
for PDF writers to create multiple content streams for a variety of
reasons such as making it easier to modify page contents and
splitting very large content streams so PDF viewers may be able to
use less memory.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-externalize-inline-images">
<span class="sig-name descname"><span class="pre">--externalize-inline-images</span></span><a class="headerlink" href="#option-externalize-inline-images" title="Permalink to this definition"></a></dt>
<dd><p>Convert inline images to regular images. By default, images whose
data is at least 1,024 bytes are converted when this option is
selected. Use <a class="reference internal" href="#option-ii-min-bytes" title="option-ii-min-bytes"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--ii-min-bytes</span></code></a> to change the size
threshold. This option is implicitly selected when
<a class="reference internal" href="#option-optimize-images" title="option-optimize-images"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--optimize-images</span></code></a> is selected unless
<a class="reference internal" href="#option-keep-inline-images" title="option-keep-inline-images"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--keep-inline-images</span></code></a> is also specified.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-ii-min-bytes">
<span class="sig-name descname"><span class="pre">--ii-min-bytes=size-in-bytes</span></span><a class="headerlink" href="#option-ii-min-bytes" title="Permalink to this definition"></a></dt>
<dd><p>Avoid converting inline images whose size is below the specified
minimum size to regular images. The default is 1,024 bytes. Use 0
for no minimum.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-min-version">
<span class="sig-name descname"><span class="pre">--min-version=version</span></span><a class="headerlink" href="#option-min-version" title="Permalink to this definition"></a></dt>
<dd><p>Force the PDF version of the output file to be at least
<code class="samp docutils literal notranslate"><em><span class="pre">version</span></em></code>. In other words, if the input file has a lower
version than the specified version, the specified version will be
used. If the input file has a higher version, the input file’s
original version will be used. It is seldom necessary to use this
option since qpdf will automatically increase the version as needed
when adding features that require newer PDF readers.</p>
<p>The version number may be expressed in the form
<code class="samp docutils literal notranslate"><em><span class="pre">major</span></em><span class="pre">.</span><em><span class="pre">minor</span></em><span class="pre">[.</span><em><span class="pre">extension-level</span></em><span class="pre">]</span></code>. If
<code class="samp docutils literal notranslate"><span class="pre">.</span><em><span class="pre">extension-level</span></em></code>, is given, version is interpreted as
<code class="samp docutils literal notranslate"><em><span class="pre">major.minor</span></em></code> at extension level <code class="samp docutils literal notranslate"><em><span class="pre">extension-level</span></em></code>.
For example, version <code class="docutils literal notranslate"><span class="pre">1.7.8</span></code> represents version 1.7 at extension
level 8. Note that minimal syntax checking is done on the command
line. <strong class="command">qpdf</strong> does not check whether the specified version
is actually required.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-force-version">
<span class="sig-name descname"><span class="pre">--force-version=version</span></span><a class="headerlink" href="#option-force-version" title="Permalink to this definition"></a></dt>
<dd><p>This option forces the PDF version to be the exact version
specified <em>even when the file may have content that is not
supported in that version</em>. The version number is interpreted in
the same way as with <a class="reference internal" href="#option-min-version" title="option-min-version"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--min-version</span></code></a> so that extension
levels can be set. In some cases, forcing the output file’s PDF
version to be lower than that of the input file will cause qpdf to
disable certain features of the document. Specifically, 256-bit
keys are disabled if the version is less than 1.7 with extension
level 8 (except the deprecated, unsupported “R5” format is allowed
with extension levels 3 through 7), AES encryption is disabled if
the version is less than 1.6, cleartext metadata and object streams
are disabled if less than 1.5, 128-bit encryption keys are disabled
if less than 1.4, and all encryption is disabled if less than 1.3.
Even with these precautions, qpdf won’t be able to do things like
eliminate use of newer image compression schemes, transparency
groups, or other features that may have been added in more recent
versions of PDF.</p>
<p>As a general rule, with the exception of big structural things like
the use of object streams or AES encryption, PDF viewers are
supposed to ignore features they don’t support. This means that
forcing the version to a lower version may make it possible to open
your PDF file with an older version, though bear in mind that some
of the original document’s functionality may be lost.</p>
</dd></dl>

</section>
</section>
<section id="page-ranges">
<span id="id11"></span><h3>Page Ranges<a class="headerlink" href="#page-ranges" title="Permalink to this heading"></a></h3>
<p>Several <strong class="command">qpdf</strong> command-line options use page ranges. This
section describes the syntax of a page range.</p>
<ul class="simple">
<li><p>A plain number indicates a page numbered from <code class="docutils literal notranslate"><span class="pre">1</span></code>, so <code class="docutils literal notranslate"><span class="pre">1</span></code>
represents the first page.</p></li>
<li><p>A number preceded by <code class="docutils literal notranslate"><span class="pre">r</span></code> counts from the end, so <code class="docutils literal notranslate"><span class="pre">r1</span></code> is the
last page, <code class="docutils literal notranslate"><span class="pre">r2</span></code> is the second-to-last page, etc.</p></li>
<li><p>The letter <code class="docutils literal notranslate"><span class="pre">z</span></code> represents the last page and is the same as <code class="docutils literal notranslate"><span class="pre">r1</span></code>.</p></li>
<li><p>Page numbers may appear in any order separated by commas.</p></li>
<li><p>Two page numbers separated by dashes represents the inclusive range
of pages from the first to the second. If the first number is higher
than the second number, it is the range of pages in reverse.</p></li>
<li><p>The range may be appended with <code class="docutils literal notranslate"><span class="pre">:odd</span></code> or <code class="docutils literal notranslate"><span class="pre">:even</span></code> to select only
pages from the resulting range in odd or even positions. In this
case, odd and even refer to positions in the final range, not
whether the original page number is odd or even.</p></li>
</ul>
<table class="docutils align-default" id="id25">
<caption><span class="caption-text">Example Page Ranges</span><a class="headerlink" href="#id25" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 20.0%" />
<col style="width: 80.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">1,6,4</span></code></p></td>
<td><p>pages 1, 6, and 4 in that order</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">3-7</span></code></p></td>
<td><p>pages 3 through 7 inclusive in increasing order</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">7-3</span></code></p></td>
<td><p>pages 7, 6, 5, 4, and 3 in that order</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">1-z</span></code></p></td>
<td><p>all pages in order</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">z-1</span></code></p></td>
<td><p>all pages in reverse order</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">1,3,5-9,15-12</span></code></p></td>
<td><p>pages 1, 3, 5, 6, 7, 8, 9, 15, 14, 13, and 12 in that order</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">r3-r1</span></code></p></td>
<td><p>the last three pages of the document</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">r1-r3</span></code></p></td>
<td><p>the last three pages of the document in reverse order</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">1-20:even</span></code></p></td>
<td><p>even pages from 2 to 20</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">5,7-9,12</span></code></p></td>
<td><p>pages 5, 7, 8, 9, and 12</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">5,7-9,12:odd</span></code></p></td>
<td><p>pages 5, 8, and 12, which are the pages in odd positions from
the original set of 5, 7, 8, 9, 12</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">5,7-9,12:even</span></code></p></td>
<td><p>pages 7 and 9, which are the pages in even positions from the
original set of 5, 7, 8, 9, 12</p></td>
</tr>
</tbody>
</table>
</section>
<section id="pdf-modification">
<span id="modification-options"></span><h3>PDF Modification<a class="headerlink" href="#pdf-modification" title="Permalink to this heading"></a></h3>
<p>Modification options make systematic changes to certain parts of the
PDF, causing the PDF to render differently from the original. See also
<a class="reference internal" href="#transformation-options"><span class="std std-ref">PDF Transformation</span></a>.</p>
<section id="id12">
<h4>Related Options<a class="headerlink" href="#id12" title="Permalink to this heading"></a></h4>
<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-pages">
<span class="sig-name descname"><span class="pre">--pages</span> <span class="pre">file</span> <span class="pre">[--password=password]</span> <span class="pre">[page-range]</span> <span class="pre">[...]</span> <span class="pre">--</span></span><a class="headerlink" href="#option-pages" title="Permalink to this definition"></a></dt>
<dd><p>This flag starts page selection options, which are used to select
pages from one or more input files to perform operations such as
splitting, merging, and collating files.</p>
<p>Please see <a class="reference internal" href="#page-selection"><span class="std std-ref">Page Selection</span></a> for details about selecting pages.</p>
<p>See also <a class="reference internal" href="#option-split-pages" title="option-split-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--split-pages</span></code></a>, <a class="reference internal" href="#option-collate" title="option-collate"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--collate</span></code></a>,
<a class="reference internal" href="#page-ranges"><span class="std std-ref">Page Ranges</span></a>.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-collate">
<span class="sig-name descname"><span class="pre">--collate[=n]</span></span><a class="headerlink" href="#option-collate" title="Permalink to this definition"></a></dt>
<dd><p>This option causes <strong class="command">qpdf</strong> to collate rather than
concatenate pages specified with <a class="reference internal" href="#option-pages" title="option-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--pages</span></code></a>. With a
numeric parameter, collate in groups of <code class="samp docutils literal notranslate"><em><span class="pre">n</span></em></code>. The default
is 1.</p>
<p>Please see <a class="reference internal" href="#page-selection"><span class="std std-ref">Page Selection</span></a> for additional details.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-split-pages">
<span class="sig-name descname"><span class="pre">--split-pages[=n]</span></span><a class="headerlink" href="#option-split-pages" title="Permalink to this definition"></a></dt>
<dd><p>Write each group of <code class="samp docutils literal notranslate"><em><span class="pre">n</span></em></code> pages to a separate output file. If
<code class="samp docutils literal notranslate"><em><span class="pre">n</span></em></code> is not specified, create single pages. Output file
names are generated as follows:</p>
<ul class="simple">
<li><p>If the string <code class="docutils literal notranslate"><span class="pre">%d</span></code> appears in the output file name, it is
replaced with a range of zero-padded page numbers starting
from 1.</p></li>
<li><p>Otherwise, if the output file name ends in <code class="file docutils literal notranslate"><span class="pre">.pdf</span></code> (case
insensitive), a zero-padded page range, preceded by a dash, is
inserted before the file extension.</p></li>
<li><p>Otherwise, the file name is appended with a zero-padded page
range preceded by a dash.</p></li>
</ul>
<p>Zero padding is added to all page numbers in file names so that all
the numbers are the same length, which causes the output filenames
to sort lexically in numerical order.</p>
<p>Page ranges are a single number in the case of single-page groups or
two numbers separated by a dash otherwise.</p>
<p>Here are some examples. In these examples, <code class="file docutils literal notranslate"><span class="pre">infile.pdf</span></code> has
12 pages.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">qpdf</span> <span class="pre">--split-pages</span> <span class="pre">infile.pdf</span> <span class="pre">%d-out</span></code>: output files are
<code class="file docutils literal notranslate"><span class="pre">01-out</span></code> through <code class="file docutils literal notranslate"><span class="pre">12-out</span></code> with no extension.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">qpdf</span> <span class="pre">--split-pages=2</span> <span class="pre">infile.pdf</span> <span class="pre">outfile.pdf</span></code>: output files are
<code class="file docutils literal notranslate"><span class="pre">outfile-01-02.pdf</span></code> through <code class="file docutils literal notranslate"><span class="pre">outfile-11-12.pdf</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">qpdf</span> <span class="pre">--split-pages</span> <span class="pre">infile.pdf</span> <span class="pre">something.else</span></code> would generate
files <code class="file docutils literal notranslate"><span class="pre">something.else-01</span></code> through
<code class="file docutils literal notranslate"><span class="pre">something.else-12</span></code>. The extension <code class="docutils literal notranslate"><span class="pre">.else</span></code> is not treated
in any special way regarding the placement of the number.</p></li>
</ul>
<p>Note that outlines, threads, and other document-level features of
the original PDF file are not preserved. For each page of output,
this option creates an empty PDF and copies a single page from the
output into it. If you require the document-level data, you will
have to run <strong class="command">qpdf</strong> with the <a class="reference internal" href="#option-pages" title="option-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--pages</span></code></a> option
once for each page. Using <a class="reference internal" href="#option-split-pages" title="option-split-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--split-pages</span></code></a> is much faster
if you don’t require the document-level data. A future version of
qpdf may support preservation of some document-level information.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-overlay">
<span class="sig-name descname"><span class="pre">--overlay</span> <span class="pre">file</span> <span class="pre">[options]</span> <span class="pre">--</span></span><a class="headerlink" href="#option-overlay" title="Permalink to this definition"></a></dt>
<dd><p>Overlay pages from another file on the output.</p>
<p>See <a class="reference internal" href="#overlay-underlay"><span class="std std-ref">Overlay and Underlay</span></a> for details.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-underlay">
<span class="sig-name descname"><span class="pre">--underlay</span> <span class="pre">file</span> <span class="pre">[options]</span> <span class="pre">--</span></span><a class="headerlink" href="#option-underlay" title="Permalink to this definition"></a></dt>
<dd><p>Underlay pages from another file on the output.</p>
<p>See <a class="reference internal" href="#overlay-underlay"><span class="std std-ref">Overlay and Underlay</span></a> for details.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-flatten-rotation">
<span class="sig-name descname"><span class="pre">--flatten-rotation</span></span><a class="headerlink" href="#option-flatten-rotation" title="Permalink to this definition"></a></dt>
<dd><p>For each page that is rotated using the <code class="docutils literal notranslate"><span class="pre">/Rotate</span></code> key in the
page’s dictionary, remove the <code class="docutils literal notranslate"><span class="pre">/Rotate</span></code> key and implement the
identical rotation semantics by modifying the page’s contents. This
option can be useful to prepare files for buggy PDF applications
that don’t properly handle rotated pages. There is usually no
reason to use this option unless you are working around a specific
problem.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-flatten-annotations">
<span class="sig-name descname"><span class="pre">--flatten-annotations=parameter</span></span><a class="headerlink" href="#option-flatten-annotations" title="Permalink to this definition"></a></dt>
<dd><p>This option collapses annotations into the pages’ contents with
special handling for form fields. Ordinarily, an annotation is
rendered separately and on top of the page. Combining annotations
into the page’s contents effectively freezes the placement of the
annotations, making them look right after various page
transformations. The library functionality backing this option was
added for the benefit of programs that want to create <em>n-up</em> page
layouts and other similar things that don’t work well with
annotations. The value of <code class="samp docutils literal notranslate"><em><span class="pre">parameter</span></em></code> may be any of the
following:</p>
<table class="docutils align-default" id="id26">
<caption><span class="caption-text">Flatten Annotation Parameters</span><a class="headerlink" href="#id26" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 11.1%" />
<col style="width: 88.9%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="samp docutils literal notranslate"><span class="pre">all</span></code></p></td>
<td><p>include all annotations that are not marked invisible or
hidden</p></td>
</tr>
<tr class="row-even"><td><p><code class="samp docutils literal notranslate"><span class="pre">print</span></code></p></td>
<td><p>only include annotations that should appear when the page is
printed</p></td>
</tr>
<tr class="row-odd"><td><p><code class="samp docutils literal notranslate"><span class="pre">screen</span></code></p></td>
<td><p>omit annotations that should not appear on the screen</p></td>
</tr>
</tbody>
</table>
<p>In a PDF file, interactive form fields have a value and,
independently, a set of instructions, called an appearance, to
render the filled-in field. If a form is filled in by a program
that doesn’t know how to update the appearances, they may become
inconsistent with the fields’ values. If qpdf detects this case,
its default behavior is not to flatten those annotations because
doing so would cause the value of the form field to be lost. This
gives you a chance to go back and resave the form with a program
that knows how to generate appearances. qpdf itself can generate
appearances with some limitations. See the
<a class="reference internal" href="#option-generate-appearances" title="option-generate-appearances"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--generate-appearances</span></code></a> option for details.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-rotate">
<span class="sig-name descname"><span class="pre">--rotate=[+|-]angle[:page-range]</span></span><a class="headerlink" href="#option-rotate" title="Permalink to this definition"></a></dt>
<dd><p>Rotate the specified range of pages by the specified angle, which
must be a multiple of 90 degrees.</p>
<p>The value of <code class="samp docutils literal notranslate"><em><span class="pre">angle</span></em></code> may be <code class="docutils literal notranslate"><span class="pre">0</span></code>, <code class="docutils literal notranslate"><span class="pre">90</span></code>, <code class="docutils literal notranslate"><span class="pre">180</span></code>, or <code class="docutils literal notranslate"><span class="pre">270</span></code>.</p>
<p>For a description of the syntax of <code class="samp docutils literal notranslate"><em><span class="pre">page-range</span></em></code>, see
<a class="reference internal" href="#page-ranges"><span class="std std-ref">Page Ranges</span></a>. If the page range is omitted, the rotation is
applied to all pages.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">+</span></code> is prepended to <code class="samp docutils literal notranslate"><em><span class="pre">angle</span></em></code>, the angle is added, so an
angle of <code class="docutils literal notranslate"><span class="pre">+90</span></code> indicates a 90-degree clockwise rotation. If <code class="docutils literal notranslate"><span class="pre">-</span></code>
is prepended, the angle is subtracted, so <code class="docutils literal notranslate"><span class="pre">-90</span></code> is a 90-degree
counterclockwise rotation and is exactly the same as <code class="docutils literal notranslate"><span class="pre">+270</span></code>.</p>
<p>If neither <code class="docutils literal notranslate"><span class="pre">+</span></code> or <code class="docutils literal notranslate"><span class="pre">-</span></code> is prepended, the rotation angle is set
exactly. You almost always want <code class="docutils literal notranslate"><span class="pre">+</span></code> or <code class="docutils literal notranslate"><span class="pre">-</span></code> since, without
inspecting the actual PDF code, it is impossible to know whether a
page that appears to be rotate is rotated “naturally” or has been
rotated by specifying rotation. For example, if a page appears to
contain a portrait-mode image rotated by 90 degrees so that the top
of the image is on the right edge of the page, there is no way to
tell by visual inspection whether the literal top of the image is
the top of the page or whether the literal top of the image is the
right edge and the page is already rotated in the PDF. Specifying a
rotation angle of <code class="docutils literal notranslate"><span class="pre">-90</span></code> will produce an image that appears
upright in either case. Use of absolute rotation angles should be
reserved for cases in which you have specific knowledge about the
way the PDF file is constructed.</p>
<p>Examples:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">qpdf</span> <span class="pre">in.pdf</span> <span class="pre">out.pdf</span> <span class="pre">--rotate=+90:2,4,6</span> <span class="pre">--rotate=+180:7-8</span></code>:
rotate pages 2, 4, and 6 by 90 degrees clockwise from their
original rotation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">qpdf</span> <span class="pre">in.pdf</span> <span class="pre">out.pdf</span> <span class="pre">--rotate=+180</span></code>: rotate all pages by 180
degrees</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">qpdf</span> <span class="pre">in.pdf</span> <span class="pre">out.pdf</span> <span class="pre">--rotate=0</span></code>: force each page to be displayed
in its natural orientation, which would undo the effect of any
rotations previously applied in page metadata.</p></li>
</ul>
<p>See also <a class="reference internal" href="#option-flatten-rotation" title="option-flatten-rotation"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--flatten-rotation</span></code></a>.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-generate-appearances">
<span class="sig-name descname"><span class="pre">--generate-appearances</span></span><a class="headerlink" href="#option-generate-appearances" title="Permalink to this definition"></a></dt>
<dd><p>If a file contains interactive form fields and indicates that the
appearances are out of date with the values of the form, this flag
will regenerate appearances, subject to a few limitations. Note
that there is usually no reason to do this, but it can be
necessary before using the <a class="reference internal" href="#option-flatten-annotations" title="option-flatten-annotations"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--flatten-annotations</span></code></a>
option. Here is a summary of the limitations.</p>
<ul class="simple">
<li><p>Radio button and checkbox appearances use the pre-set values in
the PDF file. <strong class="command">qpdf</strong> just makes sure that the correct
appearance is displayed based on the value of the field. This is
fine for PDF files that create their forms properly. Some PDF
writers save appearances for fields when they change, which could
cause some controls to have inconsistent appearances.</p></li>
<li><p>For text fields and list boxes, any characters that fall outside
of US-ASCII or, if detected, “Windows ANSI” or “Mac Roman”
encoding, will be replaced by the <code class="docutils literal notranslate"><span class="pre">?</span></code> character.
<strong class="command">qpdf</strong> does not know enough about fonts and encodings to
correctly represent characters that fall outside of this range.</p></li>
<li><p>For variable text fields where the default appearance stream
specifies that the font should be auto-sized, a fixed font size
is used rather than calculating the font size.</p></li>
<li><p>Quadding is ignored. Quadding is used to specify whether the
contents of a field should be left, center, or right aligned with
the field.</p></li>
<li><p>Rich text, multi-line, and other more elaborate formatting
directives are ignored.</p></li>
<li><p>There is no support for multi-select fields or signature fields.</p></li>
</ul>
<p>Appearances generated by <strong class="command">qpdf</strong> should be good enough for
simple forms consisting of ASCII characters where the original file
followed the PDF specification and provided template information
for text field appearances. If <strong class="command">qpdf</strong> doesn’t do a good
enough job with your form, use an external application to save your
filled-in form before processing it with <strong class="command">qpdf</strong>. Most PDF
viewers that support filling in of forms will generate appearance
streams. Some of them will even do it for forms filled in with
characters outside the original font’s character range by embedding
additional fonts as needed.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-optimize-images">
<span class="sig-name descname"><span class="pre">--optimize-images</span></span><a class="headerlink" href="#option-optimize-images" title="Permalink to this definition"></a></dt>
<dd><p>This flag causes qpdf to recompress all images that are not
compressed with DCT (JPEG) using DCT compression as long as doing
so decreases the size in bytes of the image data and the image does
not fall below minimum specified dimensions. Useful information is
provided when used in combination with <a class="reference internal" href="#option-verbose" title="option-verbose"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--verbose</span></code></a>. See
also the <a class="reference internal" href="#option-oi-min-width" title="option-oi-min-width"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--oi-min-width</span></code></a>, <a class="reference internal" href="#option-oi-min-height" title="option-oi-min-height"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--oi-min-height</span></code></a>,
and <a class="reference internal" href="#option-oi-min-area" title="option-oi-min-area"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--oi-min-area</span></code></a> options. By default, inline images
are converted to regular images and optimized as well. Use
<a class="reference internal" href="#option-keep-inline-images" title="option-keep-inline-images"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--keep-inline-images</span></code></a> to prevent inline images from
being included.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-oi-min-width">
<span class="sig-name descname"><span class="pre">--oi-min-width=width</span></span><a class="headerlink" href="#option-oi-min-width" title="Permalink to this definition"></a></dt>
<dd><p>Avoid optimizing images whose width is below the specified amount. If
omitted, the default is 128 pixels. Use 0 for no minimum.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-oi-min-height">
<span class="sig-name descname"><span class="pre">--oi-min-height=height</span></span><a class="headerlink" href="#option-oi-min-height" title="Permalink to this definition"></a></dt>
<dd><p>Avoid optimizing images whose height is below the specified amount.
If omitted, the default is 128 pixels. Use 0 for no minimum.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-oi-min-area">
<span class="sig-name descname"><span class="pre">--oi-min-area=area-in-pixels</span></span><a class="headerlink" href="#option-oi-min-area" title="Permalink to this definition"></a></dt>
<dd><p>Avoid optimizing images whose pixel count
(<code class="samp docutils literal notranslate"><em><span class="pre">width</span></em></code> × <code class="samp docutils literal notranslate"><em><span class="pre">height</span></em></code>) is below the specified amount.
If omitted, the default is 16,384 pixels. Use 0 for no minimum.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-keep-inline-images">
<span class="sig-name descname"><span class="pre">--keep-inline-images</span></span><a class="headerlink" href="#option-keep-inline-images" title="Permalink to this definition"></a></dt>
<dd><p>Prevent inline images from being included in image optimization
done by <a class="reference internal" href="#option-optimize-images" title="option-optimize-images"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--optimize-images</span></code></a>.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-remove-page-labels">
<span class="sig-name descname"><span class="pre">--remove-page-labels</span></span><a class="headerlink" href="#option-remove-page-labels" title="Permalink to this definition"></a></dt>
<dd><p>Exclude page labels (explicit page numbers) from the output file.</p>
</dd></dl>

</section>
</section>
<section id="encryption">
<span id="encryption-options"></span><h3>Encryption<a class="headerlink" href="#encryption" title="Permalink to this heading"></a></h3>
<p>This section describes the options used to create encrypted files. For
other options related to encryption, see also <a class="reference internal" href="#option-decrypt" title="option-decrypt"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--decrypt</span></code></a>
and <a class="reference internal" href="#option-copy-encryption" title="option-copy-encryption"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--copy-encryption</span></code></a>. For a more in-depth technical
discussion of how PDF encryption works internally, see
<a class="reference internal" href="index.html#pdf-encryption"><span class="std std-ref">PDF Encryption</span></a>.</p>
<p>To create an encrypted file, use</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>--encrypt user-password owner-password key-length [options] --
</pre></div>
</div>
<p>Either or both of <code class="samp docutils literal notranslate"><em><span class="pre">user-password</span></em></code> and <code class="samp docutils literal notranslate"><em><span class="pre">owner-password</span></em></code>
may be empty strings. <code class="samp docutils literal notranslate"><em><span class="pre">key-length</span></em></code> may be <code class="docutils literal notranslate"><span class="pre">40</span></code>, <code class="docutils literal notranslate"><span class="pre">128</span></code>, or
<code class="docutils literal notranslate"><span class="pre">256</span></code>. Encryption options are terminated by <code class="docutils literal notranslate"><span class="pre">--</span></code> by itself.</p>
<p>40-bit encryption is insecure, as is 128-bit encryption without AES.
Use 256-bit encryption unless you have a specific reason to use an
insecure format, such as testing or compatibility with very old
viewers. You must use the <a class="reference internal" href="#option-allow-weak-crypto" title="option-allow-weak-crypto"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--allow-weak-crypto</span></code></a> flag to
create encrypted files that use insecure cryptographic algorithms. The
<a class="reference internal" href="#option-allow-weak-crypto" title="option-allow-weak-crypto"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--allow-weak-crypto</span></code></a> flag appears outside of <code class="docutils literal notranslate"><span class="pre">--encrypt</span>
<span class="pre">...</span> <span class="pre">--</span></code> (before <code class="docutils literal notranslate"><span class="pre">--encrypt</span></code> or after <code class="docutils literal notranslate"><span class="pre">--</span></code>).</p>
<p>If <code class="samp docutils literal notranslate"><em><span class="pre">key-length</span></em></code> is 256, the minimum PDF version is 1.7 with
extension level 8, and the AES-based encryption format used is the one
described in the PDF 2.0 specification. Using 128-bit encryption
forces the PDF version to be at least 1.4, or if AES is used, 1.6.
Using 40-bit encryption forces the PDF version to be at least 1.3.</p>
<p>When 256-bit encryption is used, PDF files with empty owner
passwords are insecure. To create such files, you must specify the
<a class="reference internal" href="#option-allow-insecure" title="option-allow-insecure"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--allow-insecure</span></code></a> option.</p>
<p>Available options vary by key length. Not all readers respect all
restrictions. The default for each permission option is to be fully
permissive. These restrictions may or may not be enforced by any
particular reader. <strong class="command">qpdf</strong> allows very granular setting of
restrictions. Some readers may not recognize the combination of
options you specify. If you specify certain combinations of
restrictions and find a reader that doesn’t seem to honor them as you
expect, it is most likely not a bug in <strong class="command">qpdf</strong>. qpdf itself
does not obey encryption restrictions already imposed on the file.
Doing so would be meaningless since qpdf can be used to remove
encryption from the file entirely.</p>
<p>Here is a summary of encryption options. Details are provided in the
help for each option.</p>
<table class="docutils align-default" id="id27">
<caption><span class="caption-text">Options for 40-bit Encryption Only</span><a class="headerlink" href="#id27" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--annotate=[y|n]</span></code></p></td>
<td><p>restrict comments, filling forms, and signing</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--extract=[y|n]</span></code></p></td>
<td><p>restrict text/graphic extraction</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--modify=[y|n]</span></code></p></td>
<td><p>restrict document modification</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--print=[y|n]</span></code></p></td>
<td><p>restrict printing</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="id28">
<caption><span class="caption-text">Options for 128-bit or 256-bit Encryption</span><a class="headerlink" href="#id28" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--accessibility=[y|n]</span></code></p></td>
<td><p>restrict accessibility (usually ignored)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--annotate=[y|n]</span></code></p></td>
<td><p>restrict commenting/filling form fields</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--assemble=[y|n]</span></code></p></td>
<td><p>restrict document assembly</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--extract=[y|n]</span></code></p></td>
<td><p>restrict text/graphic extraction</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--form=[y|n]</span></code></p></td>
<td><p>restrict filling form fields</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--modify-other=[y|n]</span></code></p></td>
<td><p>restrict other modifications</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--modify=modify-opt</span></code></p></td>
<td><p>control modify access by level</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--print=print-opt</span></code></p></td>
<td><p>control printing access</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--cleartext-metadata</span></code></p></td>
<td><p>prevent encryption of metadata</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="id29">
<caption><span class="caption-text">Options for 128-bit Encryption Only</span><a class="headerlink" href="#id29" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 35.0%" />
<col style="width: 65.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--use-aes=[y|n]</span></code></p></td>
<td><p>indicates whether to use AES encryption</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--force-V4</span></code></p></td>
<td><p>forces use of V=4 encryption handler</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="id30">
<caption><span class="caption-text">Options for 256-bit Encryption Only</span><a class="headerlink" href="#id30" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--force-R5</span></code></p></td>
<td><p>forces use of deprecated <code class="docutils literal notranslate"><span class="pre">R=5</span></code> encryption algorithm</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--allow-insecure</span></code></p></td>
<td><p>allow user password with empty owner password</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="id31">
<caption><span class="caption-text">Values for <code class="samp docutils literal notranslate"><em><span class="pre">print-opt</span></em></code></span><a class="headerlink" href="#id31" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 20.0%" />
<col style="width: 80.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">none</span></code></p></td>
<td><p>disallow printing</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">low</span></code></p></td>
<td><p>allow only low-resolution printing</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">full</span></code></p></td>
<td><p>allow full printing</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="id32">
<caption><span class="caption-text">Values for <code class="samp docutils literal notranslate"><em><span class="pre">modify-opt</span></em></code></span><a class="headerlink" href="#id32" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 20.0%" />
<col style="width: 80.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">none</span></code></p></td>
<td><p>allow no modifications</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">assembly</span></code></p></td>
<td><p>allow document assembly only</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">form</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">assembly</span></code> permissions plus filling in form fields and
signing</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">annotate</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">form</span></code> permissions plus commenting and modifying forms</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">all</span></code></p></td>
<td><p>allow full document modification</p></td>
</tr>
</tbody>
</table>
<section id="id13">
<h4>Related Options<a class="headerlink" href="#id13" title="Permalink to this heading"></a></h4>
<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-accessibility">
<span class="sig-name descname"><span class="pre">--accessibility=[y|n]</span></span><a class="headerlink" href="#option-accessibility" title="Permalink to this definition"></a></dt>
<dd><p>Enable/disable extraction of text for accessibility to visually
impaired users. The default is to be fully permissive. The qpdf
library disregards this field when AES is used with 128-bit
encryption or when 256-bit encryption is used. You should never
disable accessibility unless you are explicitly doing so for
creating test files. The PDF spec says that conforming readers
should disregard this permission and always allow accessibility.</p>
<p>This option is not available with 40-bit encryption.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-annotate">
<span class="sig-name descname"><span class="pre">--annotate=[y|n]</span></span><a class="headerlink" href="#option-annotate" title="Permalink to this definition"></a></dt>
<dd><p>Enable/disable modifying annotations including making comments and
filling in form fields. The default is to be fully permissive. For
128-bit and 256-bit encryption, this also enables editing,
creating, and deleting form fields unless <code class="samp docutils literal notranslate"><span class="pre">--modify-other=n</span></code>
or <code class="samp docutils literal notranslate"><span class="pre">--modify=none</span></code> is also specified.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-assemble">
<span class="sig-name descname"><span class="pre">--assemble=[y|n]</span></span><a class="headerlink" href="#option-assemble" title="Permalink to this definition"></a></dt>
<dd><p>Enable/disable document assembly (rotation and reordering of
pages). The default is to be fully permissive.</p>
<p>This option is not available with 40-bit encryption.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-extract">
<span class="sig-name descname"><span class="pre">--extract=[y|n]</span></span><a class="headerlink" href="#option-extract" title="Permalink to this definition"></a></dt>
<dd><p>Enable/disable text/graphic extraction for purposes other than
accessibility. The default is to be fully permissive.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-form">
<span class="sig-name descname"><span class="pre">--form=[y|n]</span></span><a class="headerlink" href="#option-form" title="Permalink to this definition"></a></dt>
<dd><p>Enable/disable whether filling form fields is allowed even if
modification of annotations is disabled. The default is to be fully
permissive.</p>
<p>This option is not available with 40-bit encryption.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-modify-other">
<span class="sig-name descname"><span class="pre">--modify-other=[y|n]</span></span><a class="headerlink" href="#option-modify-other" title="Permalink to this definition"></a></dt>
<dd><p>Enable/disable modifications not controlled by
<a class="reference internal" href="#option-assemble" title="option-assemble"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--assemble</span></code></a>, <a class="reference internal" href="#option-annotate" title="option-annotate"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--annotate</span></code></a>, or
<a class="reference internal" href="#option-form" title="option-form"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--form</span></code></a>. <code class="docutils literal notranslate"><span class="pre">--modify-other=n</span></code> is implied by any of the
other <a class="reference internal" href="#option-modify" title="option-modify"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--modify</span></code></a> options except for <code class="docutils literal notranslate"><span class="pre">--modify=all</span></code>. The
default is to be fully permissive.</p>
<p>This option is not available with 40-bit encryption.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-modify">
<span class="sig-name descname"><span class="pre">--modify=modify-opt</span></span><a class="headerlink" href="#option-modify" title="Permalink to this definition"></a></dt>
<dd><p>For 40-bit files, <code class="samp docutils literal notranslate"><em><span class="pre">modify-opt</span></em></code> may only be <code class="docutils literal notranslate"><span class="pre">y</span></code> or <code class="docutils literal notranslate"><span class="pre">n</span></code>
and controls all aspects of document modification. The default is
to be fully permissive.</p>
<p>For 128-bit and 256-bit encryption, <code class="samp docutils literal notranslate"><em><span class="pre">modify-opt</span></em></code> values
allow enabling and disabling levels of restriction in a manner
similar to how some PDF creation tools do it:</p>
<table class="docutils align-default" id="id33">
<caption><span class="caption-text"><code class="samp docutils literal notranslate"><em><span class="pre">modify-opt</span></em></code> for 128-bit and 256-bit Encryption</span><a class="headerlink" href="#id33" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 11.1%" />
<col style="width: 88.9%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">none</span></code></p></td>
<td><p>allow no modifications</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">assembly</span></code></p></td>
<td><p>allow document assembly only</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">form</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">assembly</span></code> permissions plus filling in form fields and
signing</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">annotate</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">form</span></code> permissions plus commenting and modifying forms</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">all</span></code></p></td>
<td><p>allow full document modification (the default)</p></td>
</tr>
</tbody>
</table>
<p>Modify options correspond to the more granular options as follows:</p>
<table class="docutils align-default" id="id34">
<caption><span class="caption-text">Mapping <code class="samp docutils literal notranslate"><em><span class="pre">modify-opt</span></em></code> to Other Options</span><a class="headerlink" href="#id34" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 11.1%" />
<col style="width: 88.9%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">none</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--modify-other=n</span> <span class="pre">--annotate=n</span> <span class="pre">--form=n</span> <span class="pre">--assemble=n</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">assembly</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--modify-other=n</span> <span class="pre">--annotate=n</span> <span class="pre">--form=n</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">form</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--modify-other=n</span> <span class="pre">--annotate=n</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">annotate</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--modify-other=n</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">all</span></code></p></td>
<td><p>no other modify options (the default)</p></td>
</tr>
</tbody>
</table>
<p>You can combine this option with the options listed above. If you
do, later options override earlier options.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-print">
<span class="sig-name descname"><span class="pre">--print=print-opt</span></span><a class="headerlink" href="#option-print" title="Permalink to this definition"></a></dt>
<dd><p>Control what kind of printing is allowed. The default is to be
fully permissive. For 40-bit encryption, <code class="samp docutils literal notranslate"><em><span class="pre">print-opt</span></em></code> may
only be <code class="docutils literal notranslate"><span class="pre">y</span></code> or <code class="docutils literal notranslate"><span class="pre">n</span></code> and enables or disables all printing. For
128-bit and 256-bit encryption, <code class="samp docutils literal notranslate"><em><span class="pre">print-opt</span></em></code> may have the
following values:</p>
<table class="docutils align-default" id="id35">
<caption><span class="caption-text"><code class="samp docutils literal notranslate"><em><span class="pre">print-opt</span></em></code> Values</span><a class="headerlink" href="#id35" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 11.1%" />
<col style="width: 88.9%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="samp docutils literal notranslate"><span class="pre">none</span></code></p></td>
<td><p>disallow printing</p></td>
</tr>
<tr class="row-even"><td><p><code class="samp docutils literal notranslate"><span class="pre">low</span></code></p></td>
<td><p>allow low-resolution printing only</p></td>
</tr>
<tr class="row-odd"><td><p><code class="samp docutils literal notranslate"><span class="pre">full</span></code></p></td>
<td><p>allow full printing (the default)</p></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-cleartext-metadata">
<span class="sig-name descname"><span class="pre">--cleartext-metadata</span></span><a class="headerlink" href="#option-cleartext-metadata" title="Permalink to this definition"></a></dt>
<dd><p>If specified, any metadata stream in the document will be left
unencrypted even if the rest of the document is encrypted. This also
forces the PDF version to be at least 1.5.</p>
<p>This option is not available with 40-bit encryption.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-use-aes">
<span class="sig-name descname"><span class="pre">--use-aes=[y|n]</span></span><a class="headerlink" href="#option-use-aes" title="Permalink to this definition"></a></dt>
<dd><p>Enables/disables use of the more secure AES encryption with 128-bit
encryption. Specifying <code class="docutils literal notranslate"><span class="pre">--use-aes=y</span></code> forces the PDF version to be
at least 1.6. This option is only available with 128-bit
encryption. The default is <code class="docutils literal notranslate"><span class="pre">n</span></code> for compatibility reasons. Use
256-bit encryption instead.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-allow-insecure">
<span class="sig-name descname"><span class="pre">--allow-insecure</span></span><a class="headerlink" href="#option-allow-insecure" title="Permalink to this definition"></a></dt>
<dd><p>Allow creation of PDF files with 256-bit keys where the user
password is non-empty and the owner password is empty. Files
created in this way are insecure since they can be opened without a
password, and restrictions will not be enforced. Users would
ordinarily never want to create such files. If you are using qpdf
to intentionally created strange files for testing (a valid use of
qpdf!), this option allows you to create such insecure files. This
option is only available with 256-bit encryption.</p>
<p>See <a class="reference internal" href="index.html#pdf-passwords"><span class="std std-ref">User and Owner Passwords</span></a> for a more technical discussion of this
issue.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-force-V4">
<span class="sig-name descname"><span class="pre">--force-V4</span></span><a class="headerlink" href="#option-force-V4" title="Permalink to this definition"></a></dt>
<dd><p>Use of this option forces the <code class="docutils literal notranslate"><span class="pre">V</span></code> and <code class="docutils literal notranslate"><span class="pre">R</span></code> parameters in the
document’s encryption dictionary to be set to the value <code class="docutils literal notranslate"><span class="pre">4</span></code>. As
qpdf will automatically do this when required, there is no reason
to ever use this option. It exists primarily for use in testing
qpdf itself. This option also forces the PDF version to be at least
1.5.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-force-R5">
<span class="sig-name descname"><span class="pre">--force-R5</span></span><a class="headerlink" href="#option-force-R5" title="Permalink to this definition"></a></dt>
<dd><p>Use an undocumented, unsupported, deprecated encryption algorithm
that existed only in Acrobat version IX. This option should not be
used except for compatibility testing. If specified, qpdf sets the
minimum version to 1.7 at extension level 3.</p>
</dd></dl>

</section>
</section>
<section id="page-selection">
<span id="id14"></span><h3>Page Selection<a class="headerlink" href="#page-selection" title="Permalink to this heading"></a></h3>
<p><strong class="command">qpdf</strong> allows you to use the <a class="reference internal" href="#option-pages" title="option-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--pages</span></code></a> option to
split and merge PDF files by selecting pages from one or more input
files.</p>
<p>Usage: <code class="samp docutils literal notranslate"><span class="pre">qpdf</span> <em><span class="pre">in.pdf</span></em> <span class="pre">--pages</span> <span class="pre">input-file</span> <span class="pre">[--password=</span><em><span class="pre">password</span></em><span class="pre">]</span> <span class="pre">[</span><em><span class="pre">page-range</span></em><span class="pre">]</span> <span class="pre">[...]</span> <span class="pre">--</span> <em><span class="pre">out.pdf</span></em></code></p>
<p>Between <code class="docutils literal notranslate"><span class="pre">--pages</span></code> and the <code class="docutils literal notranslate"><span class="pre">--</span></code> that terminates pages option,
repeat the following:</p>
<p><code class="samp docutils literal notranslate"><em><span class="pre">filename</span></em> <span class="pre">[--password=</span><em><span class="pre">password</span></em><span class="pre">]</span> <span class="pre">[</span><em><span class="pre">page-range</span></em><span class="pre">]</span></code></p>
<dl class="simple">
<dt>Notes:</dt><dd><ul class="simple">
<li><p>The password option is needed only for password-protected files.
If you specify the same file more than once, you only need to supply
the password the first time.</p></li>
<li><p>The page range may be omitted. If omitted, all pages are included.</p></li>
<li><p>Document-level information, such as outlines, tags, etc., is taken
from the primary input file (in the above example, <code class="file docutils literal notranslate"><span class="pre">in.pdf</span></code>)
and is preserved in <code class="file docutils literal notranslate"><span class="pre">out.pdf</span></code>. You can use
<a class="reference internal" href="#option-empty" title="option-empty"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--empty</span></code></a> in place of an input file to start from an
empty file and just copy pages equally from all files.</p></li>
<li><p>You can use <code class="docutils literal notranslate"><span class="pre">.</span></code> as a shorthand for the primary input file, if not
empty.</p></li>
</ul>
</dd>
</dl>
<p>See <a class="reference internal" href="#page-ranges"><span class="std std-ref">Page Ranges</span></a> for help on specifying a page range.</p>
<p>Use <code class="samp docutils literal notranslate"><span class="pre">--collate=</span><em><span class="pre">n</span></em></code> to cause pages to be collated in groups of
<code class="samp docutils literal notranslate"><em><span class="pre">n</span></em></code> pages (default 1) instead of concatenating the input. Note
that the <a class="reference internal" href="#option-collate" title="option-collate"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--collate</span></code></a> appears outside of <code class="docutils literal notranslate"><span class="pre">--pages</span> <span class="pre">...</span> <span class="pre">--</span></code>
(before <code class="docutils literal notranslate"><span class="pre">--pages</span></code> or after <code class="docutils literal notranslate"><span class="pre">--</span></code>). Pages are pulled from each
document in turn. When a document is out of pages, it is skipped. See
examples below.</p>
<section id="examples">
<h4>Examples<a class="headerlink" href="#examples" title="Permalink to this heading"></a></h4>
<ul>
<li><p>Start with <code class="file docutils literal notranslate"><span class="pre">in.pdf</span></code> and append all pages from <code class="file docutils literal notranslate"><span class="pre">a.pdf</span></code>
and the even pages from <code class="file docutils literal notranslate"><span class="pre">b.pdf</span></code>, and write the output to
<code class="file docutils literal notranslate"><span class="pre">out.pdf</span></code>. Document-level information from <code class="file docutils literal notranslate"><span class="pre">in.pdf</span></code> is
retained. Note the use of <code class="docutils literal notranslate"><span class="pre">.</span></code> to refer to <code class="file docutils literal notranslate"><span class="pre">in.pdf</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>qpdf in.pdf --pages . a.pdf b.pdf:even -- out.pdf
</pre></div>
</div>
</li>
<li><p>Take all the pages from <code class="file docutils literal notranslate"><span class="pre">a.pdf</span></code>, all the pages from
<code class="file docutils literal notranslate"><span class="pre">b.pdf</span></code> in reverse, and only pages 3 and 6 from <code class="file docutils literal notranslate"><span class="pre">c.pdf</span></code>
and write the result to <code class="file docutils literal notranslate"><span class="pre">out.pdf</span></code>. Document-level metadata is
discarded from all input files. The password <code class="docutils literal notranslate"><span class="pre">x</span></code> is used to open
<code class="file docutils literal notranslate"><span class="pre">b.pdf</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>qpdf --empty --pages a.pdf b.pdf --password=x z-1 c.pdf 3,6
</pre></div>
</div>
</li>
<li><p>Scan a document with double-sided printing by scanning the fronts
into <code class="file docutils literal notranslate"><span class="pre">odd.pdf</span></code> and the backs into <code class="file docutils literal notranslate"><span class="pre">even.pdf</span></code>. Collate
the results into <code class="file docutils literal notranslate"><span class="pre">all.pdf</span></code>. This takes the first page of
<code class="file docutils literal notranslate"><span class="pre">odd.pdf</span></code>, the first page of <code class="file docutils literal notranslate"><span class="pre">even.pdf</span></code>, the second page
of <code class="file docutils literal notranslate"><span class="pre">odd.pdf</span></code>, the second page of <code class="file docutils literal notranslate"><span class="pre">even.pdf</span></code>, etc.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>qpdf --collate odd.pdf --pages . even.pdf -- all.pdf
  OR
qpdf --collate --empty --pages odd.pdf even.pdf -- all.pdf
</pre></div>
</div>
</li>
<li><p>When collating, any number of files and page ranges can be
specified. If any file has fewer pages, that file is just skipped
when its pages have all been included. For example, if you ran</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>qpdf --collate --empty --pages a.pdf 1-5 b.pdf 6-4 c.pdf r1 -- out.pdf
</pre></div>
</div>
<p>you would get the following pages in this order:</p>
<ul class="simple">
<li><p>a.pdf page 1</p></li>
<li><p>b.pdf page 6</p></li>
<li><p>c.pdf last page</p></li>
<li><p>a.pdf page 2</p></li>
<li><p>b.pdf page 5</p></li>
<li><p>a.pdf page 3</p></li>
<li><p>b.pdf page 4</p></li>
<li><p>a.pdf page 4</p></li>
<li><p>a.pdf page 5</p></li>
</ul>
</li>
<li><p>You can specify a numeric parameter to <a class="reference internal" href="#option-collate" title="option-collate"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--collate</span></code></a>. With
<code class="samp docutils literal notranslate"><span class="pre">--collate=</span><em><span class="pre">n</span></em></code>, pull groups of <code class="samp docutils literal notranslate"><em><span class="pre">n</span></em></code> pages from each
file, as always, stopping when there are no more pages. For example,
if you ran</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>qpdf --collate=2 --empty --pages a.pdf 1-5 b.pdf 6-4 c.pdf r1 -- out.pdf
</pre></div>
</div>
<p>you would get the following pages in this order:</p>
<ul class="simple">
<li><p>a.pdf page 1</p></li>
<li><p>a.pdf page 2</p></li>
<li><p>b.pdf page 6</p></li>
<li><p>b.pdf page 5</p></li>
<li><p>c.pdf last page</p></li>
<li><p>a.pdf page 3</p></li>
<li><p>a.pdf page 4</p></li>
<li><p>b.pdf page 4</p></li>
<li><p>a.pdf page 5</p></li>
</ul>
</li>
<li><p>Take pages 1 through 5 from <code class="file docutils literal notranslate"><span class="pre">file1.pdf</span></code> and pages 11 through
15 in reverse from <code class="file docutils literal notranslate"><span class="pre">file2.pdf</span></code>, taking document-level metadata
from <code class="file docutils literal notranslate"><span class="pre">file2.pdf</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>qpdf file2.pdf --pages file1.pdf 1-5 . 15-11 -- outfile.pdf
</pre></div>
</div>
</li>
<li><p>Here’s a more contrived example. If, for some reason, you wanted to
take the first page of an encrypted file called
<code class="file docutils literal notranslate"><span class="pre">encrypted.pdf</span></code> with password <code class="docutils literal notranslate"><span class="pre">pass</span></code> and repeat it twice in
an output file without any shared data between the two copies of
page 1, and if you wanted to drop document-level metadata but
preserve encryption, you could run</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>qpdf --empty --copy-encryption=encrypted.pdf \
     --encryption-file-password=pass \
     --pages encrypted.pdf --password=pass 1 \
           ./encrypted.pdf --password=pass 1 -- \
     outfile.pdf
</pre></div>
</div>
<p>Note that we had to specify the password all three times because
giving a password as <a class="reference internal" href="#option-encryption-file-password" title="option-encryption-file-password"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--encryption-file-password</span></code></a> doesn’t
count for page selection, and as far as qpdf is concerned,
<code class="file docutils literal notranslate"><span class="pre">encrypted.pdf</span></code> and <code class="file docutils literal notranslate"><span class="pre">./encrypted.pdf</span></code> are separate
files. (This is by design. See <a class="reference internal" href="#page-limitations"><span class="std std-ref">Limitations</span></a> for a
discussion.) These are all corner cases that most users should
hopefully never have to be bothered with.</p>
</li>
</ul>
</section>
<section id="limitations">
<span id="page-limitations"></span><h4>Limitations<a class="headerlink" href="#limitations" title="Permalink to this heading"></a></h4>
<p>With the exception of page labels (page numbers), <strong class="command">qpdf</strong>
doesn’t yet have full support for handling document-level data as it
relates to pages. Certain document-level features such as form fields,
outlines (bookmarks), and article tags among others, are copied in
their entirety from the primary input file. Starting with qpdf version
8.3, page labels are preserved from all files unless
<a class="reference internal" href="#option-remove-page-labels" title="option-remove-page-labels"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--remove-page-labels</span></code></a> is specified.</p>
<p>It is expected that a future version of <strong class="command">qpdf</strong> will have more
complete and configurable behavior regarding document-level metadata.
In the meantime, semantics of splitting and merging vary across
features. For example, the document’s outlines (bookmarks) point to
actual page objects, so if you select some pages and not others,
bookmarks that point to pages that are in the output file will work,
and remaining bookmarks will not work. If you don’t want to preserve
the primary file’s metadata, use <a class="reference internal" href="#option-empty" title="option-empty"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--empty</span></code></a> as the primary
input file.</p>
<p>Visit <a class="reference external" href="https://github.com/qpdf/qpdf/issues?q=is%3Aopen+is%3Aissue+label%3Apages">qpdf issues labeled with “pages”</a>
or look at the <code class="file docutils literal notranslate"><span class="pre">TODO</span></code> file in the qpdf source distribution for
some of the ideas.</p>
<p>Prior to <strong class="command">qpdf</strong> version 8.4, it was not possible to specify
the same page from the same file directly more than once, and a
workaround of specifying the same file in more than one way was
required. Version 8.4 removes this limitation, but when the same page
is copied more than once, all its data is shared between the pages.
Sometimes this is fine, but sometimes it may not work correctly,
particularly if there are form fields or you intend to perform other
modifications on one of the pages. A future version of qpdf should
address this more completely. You can work around this by specifying
the same file in two different ways. For example <strong class="command">qpdf
in.pdf --pages . 1 ./in.pdf 1 -- out.pdf</strong> would create a file with two
copies of the first page of the input, and the two copies would not
share any objects in common. This includes fonts, images, and anything
else the page references.</p>
</section>
</section>
<section id="overlay-and-underlay">
<span id="overlay-underlay"></span><h3>Overlay and Underlay<a class="headerlink" href="#overlay-and-underlay" title="Permalink to this heading"></a></h3>
<p>You can use <strong class="command">qpdf</strong> to overlay or underlay pages from other
files onto the output generated by qpdf. Specify overlay or underlay
as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>{--overlay|--underlay} file [options] --
</pre></div>
</div>
<p>Overlay and underlay options are processed late, so they can be
combined with other options like merging and will apply to the final
output. The <code class="docutils literal notranslate"><span class="pre">--overlay</span></code> and <code class="docutils literal notranslate"><span class="pre">--underlay</span></code> options work the same
way, except underlay pages are drawn underneath the page to which they
are applied, possibly obscured by the original page, and overlay files
are drawn on top of the page to which they are applied, possibly
obscuring the page. You can combine overlay and underlay, but you can
only specify each option at most one time.</p>
<p>The default behavior of overlay and underlay is that pages are taken
from the overlay/underlay file in sequence and applied to
corresponding pages in the output until there are no more output
pages. If the overlay or underlay file runs out of pages, remaining
output pages are left alone. This behavior can be modified by options,
which are provided between the <code class="docutils literal notranslate"><span class="pre">--overlay</span></code> or <code class="docutils literal notranslate"><span class="pre">--underlay</span></code> flag
and the <code class="docutils literal notranslate"><span class="pre">--</span></code> option. The following options are supported:</p>
<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-to">
<span class="sig-name descname"><span class="pre">--to=page-range</span></span><a class="headerlink" href="#option-to" title="Permalink to this definition"></a></dt>
<dd><blockquote>
<div></div></blockquote>
<p>Specify a page range (see <a class="reference internal" href="#page-ranges"><span class="std std-ref">Page Ranges</span></a>) that indicates which
pages in the output should have the overlay/underlay applied. If not
specified, overlay/underlay are applied to all pages.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-from">
<span class="sig-name descname"><span class="pre">--from=[page-range]</span></span><a class="headerlink" href="#option-from" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Specify a page range that indicates which pages in the
overlay/underlay file will be used for overlay or underlay. If not
specified, all pages will be used. The “from” pages are used until
they are exhausted, after which any pages specified with
<a class="reference internal" href="#option-repeat" title="option-repeat"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--repeat</span></code></a> are used. If you are using the
<a class="reference internal" href="#option-repeat" title="option-repeat"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--repeat</span></code></a> option, you can use <code class="docutils literal notranslate"><span class="pre">--from=</span></code> to provide an
empty set of “from” pages.</p>
<p>This Can be left empty by omitting
<code class="samp docutils literal notranslate"><em><span class="pre">page-range</span></em></code></p>
<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-repeat">
<span class="sig-name descname"><span class="pre">--repeat=page-range</span></span><a class="headerlink" href="#option-repeat" title="Permalink to this definition"></a></dt>
<dd></dd></dl>

<p>Specify an optional page range that indicates which pages in the
overlay/underlay file will be repeated after the “from” pages are used
up. If you want to apply a repeat a range of pages starting with the
first page of output, you can explicitly use <code class="docutils literal notranslate"><span class="pre">--from=</span></code>.</p>
<section id="id15">
<h4>Examples<a class="headerlink" href="#id15" title="Permalink to this heading"></a></h4>
<ul>
<li><p>Overlay the first three pages from file <code class="file docutils literal notranslate"><span class="pre">o.pdf</span></code> onto the first
three pages of the output, then overlay page 4 from <code class="file docutils literal notranslate"><span class="pre">o.pdf</span></code>
onto pages 4 and 5 of the output. Leave remaining output pages
untouched.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>qpdf in.pdf --overlay o.pdf --to=1-5 --from=1-3 --repeat=4 -- out.pdf
</pre></div>
</div>
</li>
<li><p>Underlay page 1 of <code class="file docutils literal notranslate"><span class="pre">footer.pdf</span></code> on all odd output pages, and
underlay page 2 of <code class="file docutils literal notranslate"><span class="pre">footer.pdf</span></code> on all even output pages.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>qpdf in.pdf --underlay footer.pdf --from= --repeat=1,2 -- out.pdf
</pre></div>
</div>
</li>
<li><p>Combine two files and overlay the single page from watermark.pdf on
the result.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>qpdf --empty --pages a.pdf b.pdf -- \
     --overlay watermark.pdf --from= --repeat=1 -- out.pdf
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="embedded-files-attachments">
<span id="attachments"></span><h3>Embedded Files/Attachments<a class="headerlink" href="#embedded-files-attachments" title="Permalink to this heading"></a></h3>
<p>It is possible to list, add, or delete embedded files (also known as
attachments) and to copy attachments from other files. See also
<a class="reference internal" href="#option-list-attachments" title="option-list-attachments"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--list-attachments</span></code></a> and <a class="reference internal" href="#option-show-attachment" title="option-show-attachment"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--show-attachment</span></code></a>.</p>
<section id="id16">
<h4>Related Options<a class="headerlink" href="#id16" title="Permalink to this heading"></a></h4>
<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-add-attachment">
<span class="sig-name descname"><span class="pre">--add-attachment</span> <span class="pre">file</span> <span class="pre">[options]</span> <span class="pre">--</span></span><a class="headerlink" href="#option-add-attachment" title="Permalink to this definition"></a></dt>
<dd><p>This flag starts add attachment options, which are used to add
attachments to a file.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--add-attachment</span></code> flag and its options may be repeated to
add multiple attachments. Please see <a class="reference internal" href="#add-attachment"><span class="std std-ref">Options for Adding Attachments</span></a> for
additional details.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-copy-attachments-from">
<span class="sig-name descname"><span class="pre">--copy-attachments-from</span> <span class="pre">file</span> <span class="pre">[options]</span> <span class="pre">--</span></span><a class="headerlink" href="#option-copy-attachments-from" title="Permalink to this definition"></a></dt>
<dd><p>This flag starts copy attachment options, which are used to copy
attachments from other files.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--copy-attachments-from</span></code> flag and its options may be
repeated to copy attachments from multiple files. Please see
<a class="reference internal" href="#copy-attachments"><span class="std std-ref">Options for Copying Attachments</span></a> for additional details.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-remove-attachment">
<span class="sig-name descname"><span class="pre">--remove-attachment=key</span></span><a class="headerlink" href="#option-remove-attachment" title="Permalink to this definition"></a></dt>
<dd><p>Remove the specified attachment. This doesn’t only remove the
attachment from the embedded files table but also clears out the
file specification to ensure that the attachment is actually not
present in the output file. That means that any potential internal
links to the attachment will be broken. Run with <a class="reference internal" href="#option-verbose" title="option-verbose"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--verbose</span></code></a> to
see status of the removal. Use <a class="reference internal" href="#option-list-attachments" title="option-list-attachments"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--list-attachments</span></code></a> to find
the attachment key. This option may be repeated to remove multiple
attachments.</p>
</dd></dl>

</section>
<section id="pdf-date-format">
<span id="pdf-dates"></span><h4>PDF Date Format<a class="headerlink" href="#pdf-date-format" title="Permalink to this heading"></a></h4>
<p>When a date is required, the date should conform to the PDF date
format specification, which is <code class="samp docutils literal notranslate"><span class="pre">D:</span><em><span class="pre">yyyymmddhhmmssz</span></em></code> where
<code class="samp docutils literal notranslate"><em><span class="pre">z</span></em></code> is either literally upper case <code class="docutils literal notranslate"><span class="pre">Z</span></code> for UTC or a
timezone offset in the form <code class="samp docutils literal notranslate"><em><span class="pre">-hh'mm'</span></em></code> or <code class="samp docutils literal notranslate"><em><span class="pre">+hh'mm'</span></em></code>.
Negative timezone offsets indicate time before UTC. Positive offsets
indicate how far after. For example, US Eastern Standard Time
(America/New_York) is <code class="docutils literal notranslate"><span class="pre">-05'00'</span></code>, and Indian Standard Time
(Asia/Calcutta) is <code class="docutils literal notranslate"><span class="pre">+05'30'</span></code>.</p>
<table class="docutils align-default" id="id36">
<caption><span class="caption-text">PDF Date Examples</span><a class="headerlink" href="#id36" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">D:20210207161528-05'00'</span></code></p></td>
<td><p>February 7, 2021 at 4:15:28 p.m.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">D:20210207211528Z</span></code></p></td>
<td><p>February 7, 2021 at 21:15:28 UTC</p></td>
</tr>
</tbody>
</table>
</section>
<section id="options-for-adding-attachments">
<span id="add-attachment"></span><h4>Options for Adding Attachments<a class="headerlink" href="#options-for-adding-attachments" title="Permalink to this heading"></a></h4>
<p>These options are valid between <a class="reference internal" href="#option-add-attachment" title="option-add-attachment"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--add-attachment</span></code></a> and <code class="docutils literal notranslate"><span class="pre">--</span></code>.</p>
<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-key">
<span class="sig-name descname"><span class="pre">--key=key</span></span><a class="headerlink" href="#option-key" title="Permalink to this definition"></a></dt>
<dd><p>Specify the key to use for the attachment in the embedded files
table. It defaults to the last element of the attached file’s
filename. For example, if you say <code class="docutils literal notranslate"><span class="pre">--add-attachment</span>
<span class="pre">/home/user/image.png</span></code>, the default key will be just <code class="docutils literal notranslate"><span class="pre">image.png</span></code>.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-filename">
<span class="sig-name descname"><span class="pre">--filename=name</span></span><a class="headerlink" href="#option-filename" title="Permalink to this definition"></a></dt>
<dd><p>Specify the filename to be used for the attachment. This is what is
usually displayed to the user and is the name most graphical PDF
viewers will use when saving a file. It defaults to the last
element of the attached file’s filename. For example, if you say
<code class="docutils literal notranslate"><span class="pre">--add-attachment</span> <span class="pre">/home/user/image.png</span></code>, the default key will be
just <code class="docutils literal notranslate"><span class="pre">image.png</span></code>.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-creationdate">
<span class="sig-name descname"><span class="pre">--creationdate=date</span></span><a class="headerlink" href="#option-creationdate" title="Permalink to this definition"></a></dt>
<dd><p>Specify the attachment’s creation date in PDF format; defaults to
the current time. See <a class="reference internal" href="#pdf-dates"><span class="std std-ref">PDF Date Format</span></a> for information about the
date format.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-moddate">
<span class="sig-name descname"><span class="pre">--moddate=date</span></span><a class="headerlink" href="#option-moddate" title="Permalink to this definition"></a></dt>
<dd><p>Specify the attachment’s modification date in PDF format; defaults
to the current time. See <a class="reference internal" href="#pdf-dates"><span class="std std-ref">PDF Date Format</span></a> for information about the
date format.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-mimetype">
<span class="sig-name descname"><span class="pre">--mimetype=type/subtype</span></span><a class="headerlink" href="#option-mimetype" title="Permalink to this definition"></a></dt>
<dd><p>Specify the mime type for the attachment, such as <code class="docutils literal notranslate"><span class="pre">text/plain</span></code>,
<code class="docutils literal notranslate"><span class="pre">application/pdf</span></code>, <code class="docutils literal notranslate"><span class="pre">image/png</span></code>, etc. The qpdf library does not
automatically determine the mime type. In a UNIX-like environment,
the <strong class="command">file</strong> command can often provide this information. In
MacOS, you can use <code class="samp docutils literal notranslate"><span class="pre">file</span> <span class="pre">-I</span> <em><span class="pre">filename</span></em></code>. In Linux, it’s
<code class="samp docutils literal notranslate"><span class="pre">file</span> <span class="pre">-i</span> <em><span class="pre">filename</span></em></code>.</p>
<p>Implementation note: the mime type appears in a field called
<code class="docutils literal notranslate"><span class="pre">/Subtype</span></code> in the PDF file, but that field actually includes the
full type and subtype of the mime type. This is because <code class="docutils literal notranslate"><span class="pre">/Type</span></code>
already means something else in PDF.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-description">
<span class="sig-name descname"><span class="pre">--description=&quot;text&quot;</span></span><a class="headerlink" href="#option-description" title="Permalink to this definition"></a></dt>
<dd><p>Supply descriptive text for the attachment, displayed by some PDF
viewers.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-replace">
<span class="sig-name descname"><span class="pre">--replace</span></span><a class="headerlink" href="#option-replace" title="Permalink to this definition"></a></dt>
<dd><p>Indicate that any existing attachment with the same key should be
replaced by the new attachment. Otherwise, <strong class="command">qpdf</strong> gives an
error if an attachment with that key is already present.</p>
</dd></dl>

</section>
<section id="options-for-copying-attachments">
<span id="copy-attachments"></span><h4>Options for Copying Attachments<a class="headerlink" href="#options-for-copying-attachments" title="Permalink to this heading"></a></h4>
<p>Options in this section are valid between
<a class="reference internal" href="#option-copy-attachments-from" title="option-copy-attachments-from"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--copy-attachments-from</span></code></a> and <code class="docutils literal notranslate"><span class="pre">--</span></code>.</p>
<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-prefix">
<span class="sig-name descname"><span class="pre">--prefix=prefix</span></span><a class="headerlink" href="#option-prefix" title="Permalink to this definition"></a></dt>
<dd><p>Only required if the file from which attachments are being copied
has attachments with keys that conflict with attachments already
in the file. In this case, the specified prefix will be prepended
to each key. This affects only the key in the embedded files
table, not the file name. The PDF specification doesn’t preclude
multiple attachments having the same file name.</p>
</dd></dl>

</section>
</section>
<section id="pdf-inspection">
<span id="inspection-options"></span><h3>PDF Inspection<a class="headerlink" href="#pdf-inspection" title="Permalink to this heading"></a></h3>
<p>These options provide tools for inspecting PDF files. When any of the
options in this section are specified, no output file may be given.</p>
<section id="id17">
<h4>Related Options<a class="headerlink" href="#id17" title="Permalink to this heading"></a></h4>
<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-is-encrypted">
<span class="sig-name descname"><span class="pre">--is-encrypted</span></span><a class="headerlink" href="#option-is-encrypted" title="Permalink to this definition"></a></dt>
<dd><p>Silently exit with a code indicating the file’s encryption status:</p>
<table class="docutils align-default" id="id37">
<caption><span class="caption-text">Exit Codes for <code class="docutils literal notranslate"><span class="pre">--is-encrypted</span></code></span><a class="headerlink" href="#id37" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 5.9%" />
<col style="width: 94.1%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
<td><p>the file is encrypted</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">1</span></code></p></td>
<td><p>not used</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">2</span></code></p></td>
<td><p>the file is not encrypted</p></td>
</tr>
</tbody>
</table>
<p>This option can be used for password-protected files even if you
don’t know the password.</p>
<p>This option is useful for shell scripts. Other options are ignored
if this is given. This option is mutually exclusive with
<a class="reference internal" href="#option-requires-password" title="option-requires-password"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--requires-password</span></code></a>. Both this option and
<a class="reference internal" href="#option-requires-password" title="option-requires-password"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--requires-password</span></code></a> exit with status <code class="docutils literal notranslate"><span class="pre">2</span></code> for
non-encrypted files.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-requires-password">
<span class="sig-name descname"><span class="pre">--requires-password</span></span><a class="headerlink" href="#option-requires-password" title="Permalink to this definition"></a></dt>
<dd><p>Silently exit with a code indicating the file’s password status:</p>
<table class="docutils align-default" id="id38">
<caption><span class="caption-text">Exit Codes for <code class="docutils literal notranslate"><span class="pre">--requires-password</span></code></span><a class="headerlink" href="#id38" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 5.9%" />
<col style="width: 94.1%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
<td><p>a password, other than as supplied, is required</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">1</span></code></p></td>
<td><p>not used</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">2</span></code></p></td>
<td><p>the file is not encrypted</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">3</span></code></p></td>
<td><p>the file is encrypted, and correct password (if any) has
been supplied</p></td>
</tr>
</tbody>
</table>
<p>Use with the <a class="reference internal" href="#option-password" title="option-password"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--password</span></code></a> option to specify the password
to test.</p>
<p>The choice of exit status <code class="docutils literal notranslate"><span class="pre">0</span></code> to mean that a password is required
is to enable code like</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="o">[</span> qpdf --requires-password file.pdf <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
    <span class="c1"># prompt for password</span>
<span class="k">fi</span>
</pre></div>
</div>
<p>If a password is supplied with <a class="reference internal" href="#option-password" title="option-password"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--password</span></code></a>, that
password is used to open the file just as with any normal
invocation of <strong class="command">qpdf</strong>. That means that using this option
with <a class="reference internal" href="#option-password" title="option-password"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--password</span></code></a> can be used to check the correctness of
the password. In that case, an exit status of <code class="docutils literal notranslate"><span class="pre">3</span></code> means the file
works with the supplied password. This option is mutually exclusive
with <a class="reference internal" href="#option-is-encrypted" title="option-is-encrypted"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--is-encrypted</span></code></a>. Both this option and
<a class="reference internal" href="#option-is-encrypted" title="option-is-encrypted"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--is-encrypted</span></code></a> exit with status <code class="docutils literal notranslate"><span class="pre">2</span></code> for non-encrypted
files.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-check">
<span class="sig-name descname"><span class="pre">--check</span></span><a class="headerlink" href="#option-check" title="Permalink to this definition"></a></dt>
<dd><p>Check the file’s structure as well as encryption, linearization,
and encoding of stream data, and write information about the file
to standard output. An exit status of <code class="docutils literal notranslate"><span class="pre">0</span></code> indicates syntactic
correctness of the PDF file. Note that <code class="samp docutils literal notranslate"><span class="pre">--check</span></code> writes
nothing to standard error when everything is valid, so if you are
using this to programmatically validate files in bulk, it is safe
to run without output redirected to <code class="file docutils literal notranslate"><span class="pre">/dev/null</span></code> and just
check for a <code class="docutils literal notranslate"><span class="pre">0</span></code> exit code.</p>
<p>A file for which <code class="samp docutils literal notranslate"><span class="pre">--check</span></code> reports no errors may still have
errors in stream data content or may contain constructs that don’t
conform to the PDF specification, but it should be syntactically
valid. If <code class="samp docutils literal notranslate"><span class="pre">--check</span></code> reports any errors, qpdf will exit with a
status of <code class="docutils literal notranslate"><span class="pre">2</span></code>. There are some recoverable conditions that
<code class="samp docutils literal notranslate"><span class="pre">--check</span></code> detects. These are issued as warnings instead of
errors. If qpdf finds no errors but finds warnings, it will exit
with a status of <code class="docutils literal notranslate"><span class="pre">3</span></code>. When <code class="samp docutils literal notranslate"><span class="pre">--check</span></code> is combined with other
options, checks are always performed before any other options are
processed. For erroneous files, <code class="samp docutils literal notranslate"><span class="pre">--check</span></code> will cause qpdf to
attempt to recover, after which other options are effectively
operating on the recovered file. Combining <code class="samp docutils literal notranslate"><span class="pre">--check</span></code> with
other options in this way can be useful for manually recovering
severely damaged files.</p>
<p>See also <a class="reference internal" href="#exit-status"><span class="std std-ref">Exit Status</span></a>.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-show-encryption">
<span class="sig-name descname"><span class="pre">--show-encryption</span></span><a class="headerlink" href="#option-show-encryption" title="Permalink to this definition"></a></dt>
<dd><p>This option shows document encryption parameters. It also shows the
document’s user password if the owner password is given and the
file was encrypted using older encryption formats that allow user
password recovery. (See <a class="reference internal" href="index.html#pdf-encryption"><span class="std std-ref">PDF Encryption</span></a> for a technical
discussion of this feature.) The output of <code class="docutils literal notranslate"><span class="pre">--show-encryption</span></code> is
included in the output of <a class="reference internal" href="#option-check" title="option-check"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--check</span></code></a>.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-show-encryption-key">
<span class="sig-name descname"><span class="pre">--show-encryption-key</span></span><a class="headerlink" href="#option-show-encryption-key" title="Permalink to this definition"></a></dt>
<dd><p>When encryption information is being displayed, as when
<a class="reference internal" href="#option-check" title="option-check"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--check</span></code></a> or <a class="reference internal" href="#option-show-encryption" title="option-show-encryption"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--show-encryption</span></code></a> is given, display the
computed or retrieved encryption key as a hexadecimal string. This
value is not ordinarily useful to users, but it can be used as the
parameter to <a class="reference internal" href="#option-password" title="option-password"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--password</span></code></a> if the <a class="reference internal" href="#option-password-is-hex-key" title="option-password-is-hex-key"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--password-is-hex-key</span></code></a>
is specified. Note that, when PDF files are encrypted, passwords
and other metadata are used only to compute an encryption key, and
the encryption key is what is actually used for encryption. This
enables retrieval of that key. See <a class="reference internal" href="index.html#pdf-encryption"><span class="std std-ref">PDF Encryption</span></a> for a
technical discussion.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-check-linearization">
<span class="sig-name descname"><span class="pre">--check-linearization</span></span><a class="headerlink" href="#option-check-linearization" title="Permalink to this definition"></a></dt>
<dd><p>Check to see whether a file is linearized and, if so, whether the
linearization hint tables are correct. qpdf does not check all
aspects of linearization. A linearized PDF file with linearization
errors that is otherwise correct is almost always readable by a PDF
viewer. As such, “errors” in PDF linearization are treated by
<strong class="command">qpdf</strong> as warnings.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-show-linearization">
<span class="sig-name descname"><span class="pre">--show-linearization</span></span><a class="headerlink" href="#option-show-linearization" title="Permalink to this definition"></a></dt>
<dd><p>Check and display all data in the linearization hint tables.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-show-xref">
<span class="sig-name descname"><span class="pre">--show-xref</span></span><a class="headerlink" href="#option-show-xref" title="Permalink to this definition"></a></dt>
<dd><p>Show the contents of the cross-reference table or stream in a
human-readable form. The cross-reference data gives the offset of
regular objects and the object stream ID and 0-based index within
the object stream for compressed objects. This is especially useful
for files with cross-reference streams, which are stored in a
binary format. If the file is invalid and cross reference table
reconstruction is performed, this option will show the information
in the reconstructed table.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-show-object">
<span class="sig-name descname"><span class="pre">--show-object={trailer|obj[,gen]}</span></span><a class="headerlink" href="#option-show-object" title="Permalink to this definition"></a></dt>
<dd><p>Show the contents of the given object. This is especially useful
for inspecting objects that are inside of object streams (also
known as “compressed objects”).</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-raw-stream-data">
<span class="sig-name descname"><span class="pre">--raw-stream-data</span></span><a class="headerlink" href="#option-raw-stream-data" title="Permalink to this definition"></a></dt>
<dd><p>When used with <a class="reference internal" href="#option-show-object" title="option-show-object"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--show-object</span></code></a>, if the object is a
stream, write the raw (compressed) binary stream data to standard
output instead of the object’s contents. Avoid combining this with
other inspection options to avoid commingling the stream data with
other output. See also <a class="reference internal" href="#option-filtered-stream-data" title="option-filtered-stream-data"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--filtered-stream-data</span></code></a>.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-filtered-stream-data">
<span class="sig-name descname"><span class="pre">--filtered-stream-data</span></span><a class="headerlink" href="#option-filtered-stream-data" title="Permalink to this definition"></a></dt>
<dd><p>When used with <a class="reference internal" href="#option-show-object" title="option-show-object"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--show-object</span></code></a>, if the object is a stream,
write the filtered (uncompressed, potentially binary) stream data
to standard output instead of the object’s contents. If the stream
is filtered using filters that qpdf does not support, an error will
be issued. This option acts as if <code class="docutils literal notranslate"><span class="pre">--decode-level=all</span></code> was
specified (see <a class="reference internal" href="#option-decode-level" title="option-decode-level"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--decode-level</span></code></a>), so it will uncompress
images compressed with supported lossy compression schemes. Avoid
combining this with other inspection options to avoid commingling
the stream data with other output.</p>
<p>This option may be combined with <a class="reference internal" href="#option-normalize-content" title="option-normalize-content"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--normalize-content</span></code></a>.
If you do this, qpdf will attempt to run content normalization even
if the stream is not a content stream, which will probably produce
unusable results.</p>
<p>See also <a class="reference internal" href="#option-raw-stream-data" title="option-raw-stream-data"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--raw-stream-data</span></code></a>.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-show-npages">
<span class="sig-name descname"><span class="pre">--show-npages</span></span><a class="headerlink" href="#option-show-npages" title="Permalink to this definition"></a></dt>
<dd><p>Print the number of pages in the input file on a line by itself.
Since the number of pages appears by itself on a line, this option
can be useful for scripting if you need to know the number of pages
in a file.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-show-pages">
<span class="sig-name descname"><span class="pre">--show-pages</span></span><a class="headerlink" href="#option-show-pages" title="Permalink to this definition"></a></dt>
<dd><p>Show the object and generation number for each page dictionary
object and for each content stream associated with the page. Having
this information makes it more convenient to inspect objects from a
particular page. See also <a class="reference internal" href="#option-with-images" title="option-with-images"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--with-images</span></code></a>.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-with-images">
<span class="sig-name descname"><span class="pre">--with-images</span></span><a class="headerlink" href="#option-with-images" title="Permalink to this definition"></a></dt>
<dd><p>When used with <a class="reference internal" href="#option-show-pages" title="option-show-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--show-pages</span></code></a>, also shows the object and
generation numbers for the image objects on each page.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-list-attachments">
<span class="sig-name descname"><span class="pre">--list-attachments</span></span><a class="headerlink" href="#option-list-attachments" title="Permalink to this definition"></a></dt>
<dd><p>Show the <em>key</em> and stream number for each embedded file. With
<a class="reference internal" href="#option-verbose" title="option-verbose"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--verbose</span></code></a>, additional information, including preferred
file name, description, dates, and more are also displayed. The key
is usually but not always equal to the file name and is needed by
some of the other options. See also <a class="reference internal" href="#attachments"><span class="std std-ref">Embedded Files/Attachments</span></a>. Note that
this option displays dates in PDF timestamp syntax. When attachment
information is included in json output in the <code class="docutils literal notranslate"><span class="pre">&quot;attachments&quot;</span></code> key
(see <a class="reference internal" href="#option-json" title="option-json"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json</span></code></a>), dates are shown (just within that object)
in ISO-8601 format.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-show-attachment">
<span class="sig-name descname"><span class="pre">--show-attachment=key</span></span><a class="headerlink" href="#option-show-attachment" title="Permalink to this definition"></a></dt>
<dd><p>Write the contents of the specified attachment to standard output
as binary data. The key should match one of the keys shown by
<a class="reference internal" href="#option-list-attachments" title="option-list-attachments"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--list-attachments</span></code></a>. If this option is given more than
once, only the last attachment will be shown. See also
<a class="reference internal" href="#attachments"><span class="std std-ref">Embedded Files/Attachments</span></a>.</p>
</dd></dl>

</section>
</section>
<section id="json-options">
<span id="id18"></span><h3>JSON Options<a class="headerlink" href="#json-options" title="Permalink to this heading"></a></h3>
<p>It is possible to view information about PDF files in a JSON format.
See <a class="reference internal" href="index.html#json"><span class="std std-ref">qpdf JSON</span></a> for details about the qpdf JSON format.</p>
<section id="id19">
<h4>Related Options<a class="headerlink" href="#id19" title="Permalink to this heading"></a></h4>
<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-json">
<span class="sig-name descname"><span class="pre">--json[=version]</span></span><a class="headerlink" href="#option-json" title="Permalink to this definition"></a></dt>
<dd><p>Generate a JSON representation of the file. This is described in
depth in <a class="reference internal" href="index.html#json"><span class="std std-ref">qpdf JSON</span></a>. The version parameter can be used to specify
which version of the qpdf JSON format should be output. The version
number be a number or <code class="docutils literal notranslate"><span class="pre">latest</span></code>. The default is <code class="docutils literal notranslate"><span class="pre">latest</span></code>. As of
qpdf 11, the latest version is <code class="docutils literal notranslate"><span class="pre">2</span></code>. If you have code that reads
qpdf JSON output, you can tell what version of the JSON output you
have from the <code class="docutils literal notranslate"><span class="pre">&quot;version&quot;</span></code> key in the output. Use the
<a class="reference internal" href="#option-json-help" title="option-json-help"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-help</span></code></a> option to get a description of the JSON
object.</p>
<p>Starting with qpdf 11, when this option is specified, an output
file is optional (for backward compatibility) and defaults to
standard output. You may specify an output file to write the JSON
to a file rather than standard output. (Example: <code class="docutils literal notranslate"><span class="pre">qpdf</span> <span class="pre">--json</span>
<span class="pre">in.pdf</span> <span class="pre">out.json</span></code>)</p>
<p>Stream data is only included if <a class="reference internal" href="#option-json-output" title="option-json-output"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-output</span></code></a> is
specified or if a value other than <code class="docutils literal notranslate"><span class="pre">none</span></code> is passed to
<a class="reference internal" href="#option-json-stream-data" title="option-json-stream-data"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-stream-data</span></code></a>.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-json-help">
<span class="sig-name descname"><span class="pre">--json-help[=version]</span></span><a class="headerlink" href="#option-json-help" title="Permalink to this definition"></a></dt>
<dd><p>Describe the format of the corresponding version of JSON output by
writing to standard output a JSON object with the same structure as
the JSON generated by qpdf. In the output written by
<code class="docutils literal notranslate"><span class="pre">--json-help</span></code>, each key’s value is a description of the key. The
specific contract guaranteed by qpdf in its JSON representation is
explained in more detail in the <a class="reference internal" href="index.html#json"><span class="std std-ref">qpdf JSON</span></a>. The default version of
help is version <code class="docutils literal notranslate"><span class="pre">2</span></code>, as with the <a class="reference internal" href="#option-json" title="option-json"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json</span></code></a> flag.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-json-key">
<span class="sig-name descname"><span class="pre">--json-key=key</span></span><a class="headerlink" href="#option-json-key" title="Permalink to this definition"></a></dt>
<dd><p>This option is repeatable. If given, only the specified top-level
keys will be included in the JSON output. Otherwise, all keys will
be included. If not given, all keys will be included, unless
<a class="reference internal" href="#option-json-output" title="option-json-output"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-output</span></code></a> was specified, in which case, only the
<code class="docutils literal notranslate"><span class="pre">&quot;qpdf&quot;</span></code> key will be included by default. If
<a class="reference internal" href="#option-json-output" title="option-json-output"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-output</span></code></a> was not given, the <code class="docutils literal notranslate"><span class="pre">version</span></code> and
<code class="docutils literal notranslate"><span class="pre">parameters</span></code> keys will always appear in the output.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-json-object">
<span class="sig-name descname"><span class="pre">--json-object={trailer|obj[,gen]}</span></span><a class="headerlink" href="#option-json-object" title="Permalink to this definition"></a></dt>
<dd><p>This option is repeatable. If given, only specified objects will be
shown in the objects dictionary in the JSON output. Otherwise, all
objects will be shown. See <a class="reference internal" href="index.html#json"><span class="std std-ref">qpdf JSON</span></a> for details about the qpdf
JSON format.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-json-stream-data">
<span class="sig-name descname"><span class="pre">--json-stream-data={none|inline|file}</span></span><a class="headerlink" href="#option-json-stream-data" title="Permalink to this definition"></a></dt>
<dd><p>When used with <a class="reference internal" href="#option-json" title="option-json"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json</span></code></a>, this option controls
whether streams in JSON output should be omitted, written inline
(base64-encoded) or written to a file. If <code class="docutils literal notranslate"><span class="pre">file</span></code> is chosen, the
file will be the name of the output file appended with
<code class="samp docutils literal notranslate"><span class="pre">-</span><em><span class="pre">nnn</span></em></code> where <code class="samp docutils literal notranslate"><em><span class="pre">nnn</span></em></code> is the object number. The stream
data file prefix can be overridden with
<a class="reference internal" href="#option-json-stream-prefix" title="option-json-stream-prefix"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-stream-prefix</span></code></a>. The default value is <code class="docutils literal notranslate"><span class="pre">none</span></code>,
except when <a class="reference internal" href="#option-json-output" title="option-json-output"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-output</span></code></a> is specified, in which case
the default is <code class="docutils literal notranslate"><span class="pre">inline</span></code>.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-json-stream-prefix">
<span class="sig-name descname"><span class="pre">--json-stream-prefix=file-prefix</span></span><a class="headerlink" href="#option-json-stream-prefix" title="Permalink to this definition"></a></dt>
<dd><p>When used with <code class="docutils literal notranslate"><span class="pre">--json-stream-data=file</span></code>,
<code class="docutils literal notranslate"><span class="pre">--json-stream-data=file-prefix</span></code> sets the prefix for stream data
files, overriding the default, which is to use the output file
name. Whatever is given here will be appended with <code class="samp docutils literal notranslate"><span class="pre">-</span><em><span class="pre">nnn</span></em></code>
to create the name of the file that will contain the data for the
stream stream in object <code class="samp docutils literal notranslate"><em><span class="pre">nnn</span></em></code>.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-json-output">
<span class="sig-name descname"><span class="pre">--json-output[=version]</span></span><a class="headerlink" href="#option-json-output" title="Permalink to this definition"></a></dt>
<dd><p>Implies <a class="reference internal" href="#option-json" title="option-json"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json</span></code></a> at the specified version. This option
changes several default values, all of which can be overridden by
specifying the stated option:</p>
<ul class="simple">
<li><p>The default value for <a class="reference internal" href="#option-json-stream-data" title="option-json-stream-data"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-stream-data</span></code></a> changes from
<code class="docutils literal notranslate"><span class="pre">none</span></code> to <code class="docutils literal notranslate"><span class="pre">inline</span></code>.</p></li>
<li><p>The default value for <a class="reference internal" href="#option-decode-level" title="option-decode-level"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--decode-level</span></code></a> changes from
<code class="docutils literal notranslate"><span class="pre">generalized</span></code> to <code class="docutils literal notranslate"><span class="pre">none</span></code>.</p></li>
<li><p>By default, only the <code class="docutils literal notranslate"><span class="pre">&quot;qpdf&quot;</span></code> key is included in the JSON
output, but you can add additional keys with
<a class="reference internal" href="#option-json-key" title="option-json-key"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-key</span></code></a>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">&quot;version&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;parameters&quot;</span></code> keys will be excluded from
the JSON output.</p></li>
</ul>
<p>If you want to look at the contents of streams easily as you would
in QDF mode (see <a class="reference internal" href="index.html#qdf"><span class="std std-ref">QDF Mode</span></a>), you can use
<code class="docutils literal notranslate"><span class="pre">--decode-level=generalized</span></code> and <code class="docutils literal notranslate"><span class="pre">--json-stream-data=file</span></code> for
a convenient way to do that.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-json-input">
<span class="sig-name descname"><span class="pre">--json-input</span></span><a class="headerlink" href="#option-json-input" title="Permalink to this definition"></a></dt>
<dd><p>Treat the input file as a JSON file in qpdf JSON format. The input
file must be complete and include all stream data. The JSON version
must be at least 2. All top-level keys are ignored except for
<code class="docutils literal notranslate"><span class="pre">&quot;qpdf&quot;</span></code>. For information about converting between PDF and JSON,
please see <a class="reference internal" href="index.html#json"><span class="std std-ref">qpdf JSON</span></a>.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-update-from-json">
<span class="sig-name descname"><span class="pre">--update-from-json=qpdf-json-file</span></span><a class="headerlink" href="#option-update-from-json" title="Permalink to this definition"></a></dt>
<dd><p>This option updates a PDF file from the specified qpdf JSON file.
For a information about how to use this option, please see
<a class="reference internal" href="index.html#json"><span class="std std-ref">qpdf JSON</span></a>.</p>
</dd></dl>

</section>
</section>
<section id="options-for-testing-or-debugging">
<span id="test-options"></span><h3>Options for Testing or Debugging<a class="headerlink" href="#options-for-testing-or-debugging" title="Permalink to this heading"></a></h3>
<p>The options below are useful when writing automated test code that
includes files created by qpdf or when testing qpdf itself. When
changes are made to qpdf, care is taken to avoid gratuitously changing
the output of PDF files. This is to make it easier to do direct
comparisons in test suites with files created by qpdf. However, there
are no guarantees that the PDF output won’t change such as in the
event of a bug fix or feature enhancement to some aspect of the output
that qpdf creates.</p>
<section id="idempotency">
<span id="id20"></span><h4>Idempotency<a class="headerlink" href="#idempotency" title="Permalink to this heading"></a></h4>
<p>Note about idempotency of byte-for-byte content: there is no
expectation that qpdf is idempotent in the general case. In other
words, there is no expectation that, when qpdf is run on its own
output, it will create <em>byte-for-byte</em> identical output, even though
it will create semantically identical files. There are a variety of
reasons for this including document ID generation, which includes a
random element, as well as the interaction of stream length encoding
with dictionary key sorting.</p>
<p>It is possible to get idempotent behavior by using the
<a class="reference internal" href="#option-static-id" title="option-static-id"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--static-id</span></code></a> or <a class="reference internal" href="#option-deterministic-id" title="option-deterministic-id"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--deterministic-id</span></code></a> option with
qpdf and running it <em>three</em> times so that you are processing the
output of qpdf on its own previous output. For example, in this
sequence of commands:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>qpdf any-file.pdf 1.pdf
qpdf --static-id 1.pdf 2.pdf
qpdf --static-id 2.pdf 3.pdf
</pre></div>
</div>
<p>the files <code class="file docutils literal notranslate"><span class="pre">2.pdf</span></code> and <code class="file docutils literal notranslate"><span class="pre">3.pdf</span></code> should be <em>byte-for-byte</em>
identical. The qpdf test suite relies on this behavior. See also
<a class="reference internal" href="#option-static-aes-iv" title="option-static-aes-iv"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--static-aes-iv</span></code></a>.</p>
</section>
<section id="id21">
<h4>Related Options<a class="headerlink" href="#id21" title="Permalink to this heading"></a></h4>
<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-static-id">
<span class="sig-name descname"><span class="pre">--static-id</span></span><a class="headerlink" href="#option-static-id" title="Permalink to this definition"></a></dt>
<dd><p>Use a fixed value for the document ID (<code class="docutils literal notranslate"><span class="pre">/ID</span></code> in the trailer).
<strong>This is intended for testing only. Never use it for production
files.</strong> If you are trying to get the same ID each time for a given
file and you are not generating encrypted files, consider using the
<a class="reference internal" href="#option-deterministic-id" title="option-deterministic-id"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--deterministic-id</span></code></a> option.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-static-aes-iv">
<span class="sig-name descname"><span class="pre">--static-aes-iv</span></span><a class="headerlink" href="#option-static-aes-iv" title="Permalink to this definition"></a></dt>
<dd><p>Use a static initialization vector for AES-CBC. This is intended
for testing only so that output files can be reproducible. Never
use it for production files. <strong>This option in particular is not
secure since it significantly weakens the encryption.</strong> When
combined with <a class="reference internal" href="#option-static-id" title="option-static-id"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--static-id</span></code></a> and using the three-step
process described in <a class="reference internal" href="#idempotency"><span class="std std-ref">Idempotency</span></a>, it is possible to create
byte-for-byte idempotent output with PDF files that use 256-bit
encryption to assist with creating reproducible test suites.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-linearize-pass1">
<span class="sig-name descname"><span class="pre">--linearize-pass1=file</span></span><a class="headerlink" href="#option-linearize-pass1" title="Permalink to this definition"></a></dt>
<dd><p>Write the first pass of linearization to the named file. <em>The
resulting file is not a valid PDF file.</em> This option is useful only
for debugging <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code>’s linearization code. When qpdf
linearizes files, it writes the file in two passes, using the first
pass to calculate sizes and offsets that are required for hint
tables and the linearization dictionary. Ordinarily, the first pass
is discarded. This option enables it to be captured, allowing
inspection of the file before values calculated in pass 1 are
inserted into the file for pass 2.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-test-json-schema">
<span class="sig-name descname"><span class="pre">--test-json-schema</span></span><a class="headerlink" href="#option-test-json-schema" title="Permalink to this definition"></a></dt>
<dd><p>This is used by qpdf’s test suite to check consistency between the
output of <code class="docutils literal notranslate"><span class="pre">qpdf</span> <span class="pre">--json</span></code> and the output of <code class="docutils literal notranslate"><span class="pre">qpdf</span> <span class="pre">--json-help</span></code>.
This option causes an extra copy of the generated JSON to appear in
memory and is therefore unsuitable for use with large files. This
is why it’s also not on by default.</p>
</dd></dl>

<dl class="qpdf option">
<dt class="sig sig-object qpdf" id="option-report-memory-usage">
<span class="sig-name descname"><span class="pre">--report-memory-usage</span></span><a class="headerlink" href="#option-report-memory-usage" title="Permalink to this definition"></a></dt>
<dd><p>This is used by qpdf’s performance test suite to report the maximum
amount of memory used in supported environments.</p>
</dd></dl>

</section>
</section>
<section id="unicode-passwords">
<span id="id22"></span><h3>Unicode Passwords<a class="headerlink" href="#unicode-passwords" title="Permalink to this heading"></a></h3>
<p>At the library API level, all methods that perform encryption and
decryption interpret passwords as strings of bytes. It is up to the
caller to ensure that they are appropriately encoded. Starting with qpdf
version 8.4.0, qpdf will attempt to make this easier for you when
interacting with qpdf via its command line interface. The PDF specification
requires passwords used to encrypt files with 40-bit or 128-bit
encryption to be encoded with PDF Doc encoding. This encoding is a
single-byte encoding that supports ISO-Latin-1 and a handful of other
commonly used characters. It has a large overlap with Windows ANSI but
is not exactly the same. There is generally no way to provide PDF Doc
encoded strings on the command line. As such, qpdf versions prior to
8.4.0 would often create PDF files that couldn’t be opened with other
software when given a password with non-ASCII characters to encrypt a
file with 40-bit or 128-bit encryption. Starting with qpdf 8.4.0, qpdf
recognizes the encoding of the parameter and transcodes it as needed.
The rest of this section provides the details about exactly how qpdf
behaves. Most users will not need to know this information, but it might
be useful if you have been working around qpdf’s old behavior or if you
are using qpdf to generate encrypted files for testing other PDF
software.</p>
<p>A note about Windows: when qpdf builds, it attempts to determine what it
has to do to use <code class="docutils literal notranslate"><span class="pre">wmain</span></code> instead of <code class="docutils literal notranslate"><span class="pre">main</span></code> on Windows. The <code class="docutils literal notranslate"><span class="pre">wmain</span></code>
function is an alternative entry point that receives all arguments as
UTF-16-encoded strings. When qpdf starts up this way, it converts all
the strings to UTF-8 encoding and then invokes the regular main. This
means that, as far as qpdf is concerned, it receives its command-line
arguments with UTF-8 encoding, just as it would in any modern Linux or
UNIX environment.</p>
<p>If a file is being encrypted with 40-bit or 128-bit encryption and the
supplied password is not a valid UTF-8 string, qpdf will fall back to
the behavior of interpreting the password as a string of bytes. If you
have old scripts that encrypt files by passing the output of
<strong class="command">iconv</strong> to qpdf, you no longer need to do that,
but if you do, qpdf should still work. The only exception would be for
the extremely unlikely case of a password that is encoded with a
single-byte encoding but also happens to be valid UTF-8. Such a password
would contain strings of even numbers of characters that alternate
between accented letters and symbols. In the extremely unlikely event
that you are intentionally using such passwords and qpdf is thwarting
you by interpreting them as UTF-8, you can use
<code class="samp docutils literal notranslate"><span class="pre">--password-mode=bytes</span></code> to suppress qpdf’s
automatic behavior.</p>
<p>The <a class="reference internal" href="#option-password-mode" title="option-password-mode"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--password-mode</span></code></a> option, as described earlier
in this chapter, can be used to change qpdf’s interpretation of supplied
passwords. There are very few reasons to use this option. One would be
the unlikely case described in the previous paragraph in which the
supplied password happens to be valid UTF-8 but isn’t supposed to be
UTF-8. Your best bet would be just to provide the password as a valid
UTF-8 string, but you could also use
<code class="samp docutils literal notranslate"><span class="pre">--password-mode=bytes</span></code>. Another reason to use
<code class="samp docutils literal notranslate"><span class="pre">--password-mode=bytes</span></code> would be to intentionally
generate PDF files encrypted with passwords that are not properly
encoded. The qpdf test suite does this to generate invalid files for the
purpose of testing its password recovery capability. If you were trying
to create intentionally incorrect files for a similar purposes, the
<code class="samp docutils literal notranslate"><span class="pre">bytes</span></code> password mode can enable you to do this.</p>
<p>When qpdf attempts to decrypt a file with a password that contains
non-ASCII characters, it will generate a list of alternative passwords
by attempting to interpret the password as each of a handful of
different coding systems and then transcode them to the required format.
This helps to compensate for the supplied password being given in the
wrong coding system, such as would happen if you used the
<strong class="command">iconv</strong> workaround that was previously needed.
It also generates passwords by doing the reverse operation: translating
from correct in incorrect encoding of the password. This would enable
qpdf to decrypt files using passwords that were improperly encoded by
whatever software encrypted the files, including older versions of qpdf
invoked without properly encoded passwords. The combination of these two
recovery methods should make qpdf transparently open most encrypted
files with the password supplied correctly but in the wrong coding
system. There are no real downsides to this behavior, but if you don’t
want qpdf to do this, you can use the
<a class="reference internal" href="#option-suppress-password-recovery" title="option-suppress-password-recovery"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--suppress-password-recovery</span></code></a> option. One reason
to do that is to ensure that you know the exact password that was used
to encrypt the file.</p>
<p>With these changes, qpdf now generates compliant passwords in most
cases. There are still some exceptions. In particular, the PDF
specification directs compliant writers to normalize Unicode passwords
and to perform certain transformations on passwords with bidirectional
text. Implementing this functionality requires using a real Unicode
library like ICU. If a client application that uses qpdf wants to do
this, the qpdf library will accept the resulting passwords, but qpdf
will not perform these transformations itself. It is possible that this
will be addressed in a future version of qpdf. The <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code>
methods that enable encryption on the output file accept passwords as
strings of bytes.</p>
<p>Please note that the <a class="reference internal" href="#option-password-is-hex-key" title="option-password-is-hex-key"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--password-is-hex-key</span></code></a> option is
unrelated to all this. That flag bypasses the normal process of going
from password to encryption key entirely, allowing the raw
encryption key to be specified directly. That behavior is useful for
forensic purposes or for brute-force recovery of files with unknown
passwords and has nothing to do with the document’s actual passwords.</p>
</section>
</section>
<span id="document-qdf"></span><section id="qdf-mode">
<span id="qdf"></span><h2>QDF Mode<a class="headerlink" href="#qdf-mode" title="Permalink to this heading"></a></h2>
<p>In QDF mode, qpdf creates PDF files in what we call <em>QDF
form</em>. A PDF file in QDF form, sometimes called a QDF
file, is a completely valid PDF file that has <code class="docutils literal notranslate"><span class="pre">%QDF-1.0</span></code> as its third
line (after the pdf header and binary characters) and has certain other
characteristics. The purpose of QDF form is to make it possible to edit
PDF files, with some restrictions, in an ordinary text editor. This can
be very useful for experimenting with different PDF constructs or for
making one-off edits to PDF files (though there are other reasons why
this may not always work). Note that QDF mode does not support
linearized files. If you enable linearization, QDF mode is automatically
disabled.</p>
<p>It is ordinarily very difficult to edit PDF files in a text editor for
two reasons: most meaningful data in PDF files is compressed, and PDF
files are full of offset and length information that makes it hard to
add or remove data. A QDF file is organized in a manner such that, if
edits are kept within certain constraints, the
<strong class="command">fix-qdf</strong> program, distributed with qpdf, is
able to restore edited files to a correct state. The
<strong class="command">fix-qdf</strong> program takes no command-line
arguments. It reads a possibly edited QDF file from standard input and
writes a repaired file to standard output.</p>
<p>For another way to work with PDF files in an editor, see <a class="reference internal" href="index.html#json"><span class="std std-ref">qpdf JSON</span></a>.
Using qpdf JSON format allows you to edit the PDF file semantically
without having to be concerned about PDF syntax. However, QDF files
are actually valid PDF files, so the feedback cycle may be faster if
previewing with a PDF reader. Also, since QDF files are valid PDF, you
can experiment with all aspects of the PDF file, including syntax.</p>
<p>The following attributes characterize a QDF file:</p>
<ul class="simple">
<li><p>All objects appear in numerical order in the PDF file, including when
objects appear in object streams.</p></li>
<li><p>Objects are printed in an easy-to-read format, and all line endings
are normalized to UNIX line endings.</p></li>
<li><p>Unless specifically overridden, streams appear uncompressed (when
qpdf supports the filters and they are compressed with a non-lossy
compression scheme), and most content streams are normalized (line
endings are converted to just a UNIX-style linefeeds).</p></li>
<li><p>All streams lengths are represented as indirect objects, and the
stream length object is always the next object after the stream. If
the stream data does not end with a newline, an extra newline is
inserted, and a special comment appears after the stream indicating
that this has been done.</p></li>
<li><p>If the PDF file contains object streams, if object stream <em>n</em>
contains <em>k</em> objects, those objects are numbered from <em>n+1</em> through
<em>n+k</em>, and the object number/offset pairs appear on a separate line
for each object. Additionally, each object in the object stream is
preceded by a comment indicating its object number and index. This
makes it very easy to find objects in object streams.</p></li>
<li><p>All beginnings of objects, <code class="docutils literal notranslate"><span class="pre">stream</span></code> tokens, <code class="docutils literal notranslate"><span class="pre">endstream</span></code> tokens,
and <code class="docutils literal notranslate"><span class="pre">endobj</span></code> tokens appear on lines by themselves. A blank line
follows every <code class="docutils literal notranslate"><span class="pre">endobj</span></code> token.</p></li>
<li><p>If there is a cross-reference stream, it is unfiltered.</p></li>
<li><p>Page dictionaries and page content streams are marked with special
comments that make them easy to find.</p></li>
<li><p>Comments precede each object indicating the object number of the
corresponding object in the original file.</p></li>
</ul>
<p>When editing a QDF file, any edits can be made as long as the above
constraints are maintained. This means that you can freely edit a page’s
content without worrying about messing up the QDF file. It is also
possible to add new objects so long as those objects are added after the
last object in the file or subsequent objects are renumbered. If a QDF
file has object streams in it, you can always add the new objects before
the xref stream and then change the number of the xref stream, since
nothing generally ever references it by number.</p>
<p>It is not generally practical to remove objects from QDF files without
messing up object numbering, but if you remove all references to an
object, you can run qpdf on the file (after running
<strong class="command">fix-qdf</strong>), and qpdf will omit the now-orphaned
object.</p>
<p>When <strong class="command">fix-qdf</strong> is run, it goes through the file
and recomputes the following parts of the file:</p>
<ul class="simple">
<li><p>the <code class="docutils literal notranslate"><span class="pre">/N</span></code>, <code class="docutils literal notranslate"><span class="pre">/W</span></code>, and <code class="docutils literal notranslate"><span class="pre">/First</span></code> keys of all object stream
dictionaries</p></li>
<li><p>the pairs of numbers representing object numbers and offsets of
objects in object streams</p></li>
<li><p>all stream lengths</p></li>
<li><p>the cross-reference table or cross-reference stream</p></li>
<li><p>the offset to the cross-reference table or cross-reference stream
following the <code class="docutils literal notranslate"><span class="pre">startxref</span></code> token</p></li>
</ul>
</section>
<span id="document-library"></span><section id="using-the-qpdf-library">
<span id="using-library"></span><h2>Using the QPDF Library<a class="headerlink" href="#using-the-qpdf-library" title="Permalink to this heading"></a></h2>
<section id="using-qpdf-from-c">
<span id="using-from-cxx"></span><h3>Using QPDF from C++<a class="headerlink" href="#using-qpdf-from-c" title="Permalink to this heading"></a></h3>
<p>The source tree for the qpdf package has an
<code class="file docutils literal notranslate"><span class="pre">examples</span></code> directory that contains a few
example programs. The <code class="file docutils literal notranslate"><span class="pre">libqpdf/QPDFJob.cc</span></code> source
file also serves as a useful example since it exercises almost all of
the qpdf library’s public interface. The best source of documentation on
the library itself is reading comments in
<code class="file docutils literal notranslate"><span class="pre">include/qpdf/QPDF.hh</span></code>,
<code class="file docutils literal notranslate"><span class="pre">include/qpdf/QPDFWriter.hh</span></code>, and
<code class="file docutils literal notranslate"><span class="pre">include/qpdf/QPDFObjectHandle.hh</span></code>.</p>
<p>All header files are installed in the
<code class="file docutils literal notranslate"><span class="pre">include/qpdf</span></code> directory. It is recommend that
you use <code class="docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&lt;qpdf/QPDF.hh&gt;</span></code> rather than adding
<code class="file docutils literal notranslate"><span class="pre">include/qpdf</span></code> to your include path.</p>
<p>qpdf installs a <code class="docutils literal notranslate"><span class="pre">pkg-config</span></code> configuration with package name
<code class="docutils literal notranslate"><span class="pre">libqpdf</span></code> and a <code class="docutils literal notranslate"><span class="pre">cmake</span></code> configuration with package name <code class="docutils literal notranslate"><span class="pre">qpdf</span></code>.
The <code class="docutils literal notranslate"><span class="pre">libqpdf</span></code> target is exported in the <code class="docutils literal notranslate"><span class="pre">qpdf::</span></code> namespace. The
following is an example of a <code class="file docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> file for a
single-file executable that links with qpdf:</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">cmake_minimum_required</span><span class="p">(</span><span class="s">VERSION</span><span class="w"> </span><span class="s">3.16</span><span class="p">)</span>
<span class="nb">project</span><span class="p">(</span><span class="s">some-application</span><span class="w"> </span><span class="s">LANGUAGES</span><span class="w"> </span><span class="s">CXX</span><span class="p">)</span>
<span class="nb">find_package</span><span class="p">(</span><span class="s">qpdf</span><span class="p">)</span>
<span class="nb">add_executable</span><span class="p">(</span><span class="s">some-application</span><span class="w"> </span><span class="s">some-application.cc</span><span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="s">some-application</span><span class="w"> </span><span class="s">qpdf::libqpdf</span><span class="p">)</span>
</pre></div>
</div>
<p>The qpdf library is safe to use in a multithreaded program, but no
individual <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object instance (including <code class="docutils literal notranslate"><span class="pre">QPDF</span></code>,
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>, or <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code>) can be used in more than one
thread at a time. Multiple threads may simultaneously work with
different instances of these and all other QPDF objects.</p>
</section>
<section id="using-qpdf-from-other-languages">
<span id="using-other-languages"></span><h3>Using QPDF from other languages<a class="headerlink" href="#using-qpdf-from-other-languages" title="Permalink to this heading"></a></h3>
<p>The qpdf library is implemented in C++, which makes it hard to use
directly in other languages. There are a few things that can help.</p>
<dl class="simple">
<dt>“C”</dt><dd><p>The qpdf library includes a “C” language interface that provides a
subset of the overall capabilities. The header file
<code class="file docutils literal notranslate"><span class="pre">qpdf/qpdf-c.h</span></code> includes information about
its use. As long as you use a C++ linker, you can link C programs
with qpdf and use the C API. For languages that can directly load
methods from a shared library, the C API can also be useful. People
have reported success using the C API from other languages on Windows
by directly calling functions in the DLL.</p>
</dd>
<dt>Python</dt><dd><p>A Python module called
<a class="reference external" href="https://pypi.org/project/pikepdf/">pikepdf</a> provides a clean and
highly functional set of Python bindings to the qpdf library. Using
pikepdf, you can work with PDF files in a natural way and combine
qpdf’s capabilities with other functionality provided by Python’s
rich standard library and available modules.</p>
</dd>
<dt>Other Languages Starting with version 11.0.0, the <strong class="command">qpdf</strong></dt><dd><p>command-line tool can produce an unambiguous JSON representation of
a PDF file and can also create or update PDF files using this JSON
representation. qpdf versions from 8.3.0 through 10.6.3 had a more
limited JSON output format. The qpdf JSON format makes it possible
to inspect and modify the structure of a PDF file down to the
object level from the command-line or from any language that can
handle JSON data. Please see <a class="reference internal" href="index.html#json"><span class="std std-ref">qpdf JSON</span></a> for details.</p>
</dd>
<dt>Wrappers</dt><dd><p>The <a class="reference external" href="https://github.com/qpdf/qpdf/wiki">qpdf Wiki</a> contains a
list of <a class="reference external" href="https://github.com/qpdf/qpdf/wiki/qpdf-Wrappers">Wrappers around qpdf</a>. These may
have varying degrees of functionality or completeness. If you know
of (or have written) a wrapper that you’d like include, open an
issue at <a class="reference external" href="https://github.com/qpdf/qpdf/issues/new">https://github.com/qpdf/qpdf/issues/new</a> and ask for it to
be added to the list.</p>
</dd>
</dl>
</section>
<section id="a-note-about-unicode-file-names">
<span id="unicode-files"></span><h3>A Note About Unicode File Names<a class="headerlink" href="#a-note-about-unicode-file-names" title="Permalink to this heading"></a></h3>
<p>When strings are passed to qpdf library routines either as <code class="docutils literal notranslate"><span class="pre">char*</span></code> or
as <code class="docutils literal notranslate"><span class="pre">std::string</span></code>, they are treated as byte arrays except where
otherwise noted. When Unicode is desired, qpdf wants UTF-8 unless
otherwise noted in comments in header files. In modern UNIX/Linux
environments, this generally does the right thing. In Windows, it’s a
bit more complicated. Starting in qpdf 8.4.0, passwords that contain
Unicode characters are handled much better, and starting in qpdf 8.4.1,
the library attempts to properly handle Unicode characters in filenames.
In particular, in Windows, if a UTF-8 encoded string is used as a
filename in either <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> or <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code>, it is internally
converted to <code class="docutils literal notranslate"><span class="pre">wchar_t*</span></code>, and Unicode-aware Windows APIs are used. As
such, qpdf will generally operate properly on files with non-ASCII
characters in their names as long as the filenames are UTF-8 encoded for
passing into the qpdf library API, but there are still some rough edges,
such as the encoding of the filenames in error messages or CLI output
messages. Patches or bug reports are welcome for any continuing issues
with Unicode file names in Windows.</p>
</section>
</section>
<span id="document-weak-crypto"></span><section id="weak-cryptography">
<span id="weak-crypto"></span><h2>Weak Cryptography<a class="headerlink" href="#weak-cryptography" title="Permalink to this heading"></a></h2>
<p>For help with compiler errors in qpdf 11.0 or newer, see
<a class="reference internal" href="#breaking-crypto-api"><span class="std std-ref">API-Breaking Changes in qpdf 11.0</span></a>.</p>
<p>Since 2006, the PDF specification has offered ways to create encrypted
PDF files without using weak cryptography, though it took a few years
for many PDF readers and writers to catch up. It is still necessary to
support weak encryption algorithms to read encrypted PDF files that
were created using weak encryption algorithms, including all PDF files
created before the modern formats were introduced or widely supported.</p>
<p>Starting with version 10.4, qpdf began taking steps to reduce the
likelihood of a user <em>accidentally</em> creating PDF files with insecure
cryptography but will continue to allow creation of such files
indefinitely with explicit acknowledgment. The restrictions on use of
weak cryptography were made stricter with qpdf 11.</p>
<section id="definition-of-weak-cryptographic-algorithm">
<h3>Definition of Weak Cryptographic Algorithm<a class="headerlink" href="#definition-of-weak-cryptographic-algorithm" title="Permalink to this heading"></a></h3>
<p>We divide weak cryptographic algorithms into two categories: weak
encryption and weak hashing. Encryption is encoding data such that a
key of some sort is required to decode it. Hashing is creating a short
value from data in such a way that it is extremely improbable to find
two documents with the same hash (known has a hash collision) and
extremely difficult to intentionally create a document with a specific
hash or two documents with the same hash.</p>
<p>When we say that an encryption algorithm is weak, we either mean that
a mathematical flaw has been discovered that makes it inherently
insecure or that it is sufficiently simple that modern computer
technology makes it possible to use “brute force” to crack. For
example, when 40-bit keys were originally introduced, it wasn’t
practical to consider trying all possible keys, but today such a thing
is possible.</p>
<p>When we say that a hashing algorithm is weak, we mean that, either
because of mathematical flaw or insufficient complexity, it is
computationally feasible to intentionally construct a hash collision.</p>
<p>While weak encryption should always be avoided, there are cases in
which it is safe to use a weak hashing algorithm when security is not
a factor. For example, a weak hashing algorithm should not be used as
the only mechanism to test whether a file has been tampered with. In
other words, you can’t use a weak hash as a digital signature. There
is no harm, however, in using a weak hash as a way to sort or index
documents as long as hash collisions are tolerated. It is also common
to use weak hashes as checksums, which are often used a check that a
file wasn’t damaged in transit or storage, though for true integrity,
a strong hash would be better.</p>
<p>Note that qpdf must always retain support for weak cryptographic
algorithms since this is required for reading older PDF files that use
it. Additionally, qpdf will always retain the ability to create files
using weak cryptographic algorithms since, as a development tool, qpdf
explicitly supports creating older or deprecated types of PDF files
since these are sometimes needed to test or work with older versions of
software. Even if other cryptography libraries drop support for RC4 or
MD5, qpdf can always fall back to its internal implementations of those
algorithms, so they are not going to disappear from qpdf.</p>
</section>
<section id="uses-of-weak-encryption-in-qpdf">
<h3>Uses of Weak Encryption in qpdf<a class="headerlink" href="#uses-of-weak-encryption-in-qpdf" title="Permalink to this heading"></a></h3>
<p>When PDF files are encrypted using 40-bit encryption or 128-bit
encryption without AES, then the weak <em>RC4</em> algorithm is used. You can
avoid using weak encryption in qpdf by always using 256-bit
encryption. Unless you are trying to create files that need to be
opened with PDF readers from before about 2010 (by which time most
readers had added support for the stronger encryption algorithms) or
are creating insecure files explicitly for testing or some similar
purpose, there is no reason to use anything other than 256-bit
encryption.</p>
<p>By default, qpdf refuses to write a file that uses weak encryption.
You can explicitly allow this by specifying the
<a class="reference internal" href="index.html#option-allow-weak-crypto" title="option-allow-weak-crypto"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--allow-weak-crypto</span></code></a> option.</p>
<p>In qpdf 11, all library methods that could potentially cause files to
be written with weak encryption were deprecated, and methods to enable
weak encryption were either given explicit names indicating this or
take required arguments to enable the insecure behavior.</p>
<p>There is one exception: when encryption parameters are copied from the
input file or another file to the output file, there is no prohibition
or even warning against using insecure encryption. The reason is that
many qpdf operations simply preserve whatever encryption is there, and
requiring confirmation to <em>preserve</em> insecure encryption would cause
qpdf to break when non-encryption-related operations were performed on
files that happened to be encrypted. Failing or generating warnings in
this case would likely have the effect of making people use the
<a class="reference internal" href="index.html#option-allow-weak-crypto" title="option-allow-weak-crypto"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--allow-weak-crypto</span></code></a> option blindly, which would be worse
than just letting those files go so that explicit, conscious selection
of weak crypto would be more likely to be noticed. Why, you might ask,
does this apply to <a class="reference internal" href="index.html#option-copy-encryption" title="option-copy-encryption"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--copy-encryption</span></code></a> as well as to the
default behavior preserving encryption? The answer is that
<a class="reference internal" href="index.html#option-copy-encryption" title="option-copy-encryption"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--copy-encryption</span></code></a> works with an unencrypted file as input,
which enables workflows where one may start with a file, decrypt it
<em>just in case</em>, perform a series of operations, and then reapply the
original encryption, <em>if any</em>. Also, one may have a template used for
encryption that one may apply to a variety of output files, and it
would be annoying to be warned about it for every output file.</p>
</section>
<section id="uses-of-weak-hashing-in-qpdf">
<h3>Uses of Weak Hashing In QPDF<a class="headerlink" href="#uses-of-weak-hashing-in-qpdf" title="Permalink to this heading"></a></h3>
<p>The PDF specification makes use the weak <em>MD5</em> hashing algorithm in
several places. While it is used in the encryption algorithms,
breaking MD5 would not be adequate to crack an encrypted file when
256-bit encryption is in use, so using 256-bit encryption is adequate
for avoiding the use of MD5 for anything security-sensitive.</p>
<p>MD5 is used in the following non-security-sensitive ways:</p>
<ul>
<li><p>Generation of the document ID. The document ID is an input parameter
to the document encryption but is not itself considered to be
secure. They are supposed to be unique, but they are not
tamper-resistent in non-encrypted PDF files, and hash collisions
must be tolerated.</p>
<p>The PDF specification recommends but does not require the use of MD5
in generation of document IDs. Usually there is also a random
component to document ID generation. There is a qpdf-specific
feature of generating a <em>deterministic ID</em> (see
<a class="reference internal" href="index.html#option-deterministic-id" title="option-deterministic-id"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--deterministic-id</span></code></a>) which also uses MD5. While it would
certainly be possible to change the deterministic ID algorithm to
not use MD5, doing so would break all previous deterministic IDs
(which would render the feature useless for many cases) and would
offer very little benefit since even a securely generated document
ID is not itself a security-sensitive value.</p>
</li>
<li><p>Checksums in embedded file streams – the PDF specification
specifies the use of MD5.</p></li>
</ul>
<p>It is therefore not possible completely avoid the use of MD5 with
qpdf, but as long as you are using 256-bit encryption, it is not used
in a security-sensitive fashion.</p>
</section>
<section id="api-breaking-changes-in-qpdf-11-0">
<span id="breaking-crypto-api"></span><h3>API-Breaking Changes in qpdf 11.0<a class="headerlink" href="#api-breaking-changes-in-qpdf-11-0" title="Permalink to this heading"></a></h3>
<p>In qpdf 11, several deprecated functions and methods were removed.
These methods provided an incomplete API. Alternatives were added in
qpdf 8.4.0. The removed functions are</p>
<ul class="simple">
<li><p>C API: <code class="docutils literal notranslate"><span class="pre">qpdf_set_r3_encryption_parameters</span></code>,
<code class="docutils literal notranslate"><span class="pre">qpdf_set_r4_encryption_parameters</span></code>,
<code class="docutils literal notranslate"><span class="pre">qpdf_set_r5_encryption_parameters</span></code>,
<code class="docutils literal notranslate"><span class="pre">qpdf_set_r6_encryption_parameters</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code>: overloaded versions of these methods with fewer
arguments: <code class="docutils literal notranslate"><span class="pre">setR3EncryptionParameters</span></code>,
<code class="docutils literal notranslate"><span class="pre">setR4EncryptionParameters</span></code>, <code class="docutils literal notranslate"><span class="pre">setR5EncryptionParameters</span></code>, and
<code class="docutils literal notranslate"><span class="pre">setR6EncryptionParameters</span></code></p></li>
</ul>
<p>Additionally, remaining functions/methods had their names changed to
signal that they are insecure and to force developers to make a
decision. If you intentionally want to continue to use insecure
cryptographic algorithms and create insecure files, you can change
your code just add <code class="docutils literal notranslate"><span class="pre">_insecure</span></code> or <code class="docutils literal notranslate"><span class="pre">Insecure</span></code> to the end of the
function as needed. (Note the disappearance of <code class="docutils literal notranslate"><span class="pre">2</span></code> in some of the C
functions as well.) Better, you should migrate your code to use more
secure encryption as documented in <code class="file docutils literal notranslate"><span class="pre">QPDFWriter.hh</span></code>. Use the
<code class="docutils literal notranslate"><span class="pre">R6</span></code> methods (or their corresponding C functions) to create files
with 256-bit encryption.</p>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">Renamed Functions</span><a class="headerlink" href="#id1" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 50.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Old Name</p></th>
<th class="head"><p>New Name</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>qpdf_set_r2_encryption_parameters</p></td>
<td><p>qpdf_set_r2_encryption_parameters_insecure</p></td>
</tr>
<tr class="row-odd"><td><p>qpdf_set_r3_encryption_parameters2</p></td>
<td><p>qpdf_set_r3_encryption_parameters_insecure</p></td>
</tr>
<tr class="row-even"><td><p>qpdf_set_r4_encryption_parameters2</p></td>
<td><p>qpdf_set_r2_encryption_parameters_insecure</p></td>
</tr>
<tr class="row-odd"><td><p>QPDFWriter::setR2EncryptionParameters</p></td>
<td><p>QPDFWriter::setR2EncryptionParametersInsecure</p></td>
</tr>
<tr class="row-even"><td><p>QPDFWriter::setR3EncryptionParameters</p></td>
<td><p>QPDFWriter::setR3EncryptionParametersInsecure</p></td>
</tr>
<tr class="row-odd"><td><p>QPDFWriter::setR4EncryptionParameters</p></td>
<td><p>QPDFWriter::setR4EncryptionParametersInsecure</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<span id="document-json"></span><section id="qpdf-json">
<span id="json"></span><h2>qpdf JSON<a class="headerlink" href="#qpdf-json" title="Permalink to this heading"></a></h2>
<section id="overview">
<span id="json-overview"></span><h3>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h3>
<p>Beginning with qpdf version 11.0.0, the qpdf library and command-line
program can produce a JSON representation of a PDF file. qpdf version
11 introduces JSON format version 2. Prior to qpdf 11, versions 8.3.0
onward had a more limited JSON representation accessible only from the
command-line. For details on what changed, see <a class="reference internal" href="#json-v2-changes"><span class="std std-ref">Changes from JSON v1 to v2</span></a>.
The rest of this chapter documents qpdf JSON version 2.</p>
<p>Please note: this chapter discusses <em>qpdf JSON format</em>, which
represents the contents of a PDF file. This is distinct from the
<em>QPDFJob JSON format</em> which provides a higher-level interface
interacting with qpdf the way the command-line tool does. For
information about that, see <a class="reference internal" href="index.html#qpdf-job"><span class="std std-ref">QPDFJob: a Job-Based Interface</span></a>.</p>
<p>The qpdf JSON format is specific to qpdf. The <a class="reference internal" href="index.html#option-json" title="option-json"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json</span></code></a>
command-line flag causes creation of a JSON representation the objects
in a PDF file along with JSON-formatted summaries of other information
about the file. This functionality is built into <code class="docutils literal notranslate"><span class="pre">QPDFJob</span></code> and can
be accessed from the <code class="docutils literal notranslate"><span class="pre">qpdf</span></code> command-line tool or from the
<code class="docutils literal notranslate"><span class="pre">QPDFJob</span></code> C or C++ API.</p>
<p>Starting with qpdf JSON version 2, from qpdf 11.0.0, the JSON output
includes an unambiguous and complete representation of the PDF objects
and header. The information without the JSON-formatted summaries of
other information is also available using the <code class="docutils literal notranslate"><span class="pre">QPDF::writeJSON</span></code>
method.</p>
<p>By default, stream data is omitted from the JSON data, but it can be
included by specifying the <a class="reference internal" href="index.html#option-json-stream-data" title="option-json-stream-data"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-stream-data</span></code></a> option. With
stream data included, the generated JSON file completely represents a
PDF file. You can think of this as using JSON as an <em>alternative
syntax</em> for representing a PDF file. Using qpdf JSON, it is possible
to convert a PDF file to JSON, manipulate the structure or contents of
the objects at a low level, and convert the results back to a PDF
file. This functionality can be accessed from the command-line with
the <a class="reference internal" href="index.html#option-json-input" title="option-json-input"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-input</span></code></a>, and <a class="reference internal" href="index.html#option-update-from-json" title="option-update-from-json"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--update-from-json</span></code></a>
flags, or from the API using the <code class="docutils literal notranslate"><span class="pre">QPDF::createFromJSON</span></code>, and
<code class="docutils literal notranslate"><span class="pre">QPDF::updateFromJSON</span></code> methods. The <a class="reference internal" href="index.html#option-json-output" title="option-json-output"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-output</span></code></a> flag
changes a handful of defaults so that the resulting JSON is as close
as possible to the original input and is ready for being converted
back to PDF.</p>
<p>The qpdf JSON data includes unreferenced objects. This may be
addressed in a future version of qpdf. For now, that means that
certain objects that are not useful in the JSON representation are
included. This includes linearization and encryption dictionaries,
linearization hint streams, object streams, and the cross-reference
(xref) stream associated with the trailer dictionary where applicable.
For the best experience with qpdf JSON, you can run the file through
qpdf first to remove encryption, linearization, and object streams.
For example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>qpdf --decrypt --object-streams=disable in.pdf out.pdf
qpdf --json-output out.pdf out.json
</pre></div>
</div>
</section>
<section id="json-terminology">
<span id="id1"></span><h3>JSON Terminology<a class="headerlink" href="#json-terminology" title="Permalink to this heading"></a></h3>
<p>Notes about terminology:</p>
<ul class="simple">
<li><p>In JavaScript and JSON, that thing that has keys and values is
typically called an <em>object</em>.</p></li>
<li><p>In PDF, that thing that has keys and values is typically called a
<em>dictionary</em>. An <em>object</em> is a PDF object such as integer, real,
boolean, null, string, array, dictionary, or stream.</p></li>
<li><p>Some languages that use JSON call an <em>object</em> a <em>dictionary</em>, a
<em>map</em>, or a <em>hash</em>.</p></li>
<li><p>Sometimes, it’s called on <em>object</em> if it has fixed keys and a
<em>dictionary</em> if it has variable keys.</p></li>
</ul>
<p>This manual is not entirely consistent about its use of <em>dictionary</em>
vs. <em>object</em> because sometimes one term or another is clearer in
context. Just be aware of the ambiguity when reading the manual. We
frequently use the term <em>dictionary</em> to refer to a JSON object because
of the consistency with PDF terminology, particular when referring to
a dictionary that contains information PDF objects.</p>
</section>
<section id="what-qpdf-json-is-not">
<span id="id2"></span><h3>What qpdf JSON is not<a class="headerlink" href="#what-qpdf-json-is-not" title="Permalink to this heading"></a></h3>
<p>Please note that qpdf JSON offers a convenient syntax for manipulating
PDF files at a low level using JSON syntax. JSON syntax is much easier
to work with than native PDF syntax, and there are good JSON libraries
in virtually every commonly used programming language. Working with
PDF objects in JSON removes the need to worry about stream lengths,
cross reference tables, and PDF-specific representations of Unicode or
binary strings that appear outside of content streams. It does not
eliminate the need to understand the semantic structure of PDF files.
Working with qpdf JSON still requires familiarity with the PDF
specification.</p>
<p>In particular, qpdf JSON <em>does not</em> provide any of the following
capabilities:</p>
<ul class="simple">
<li><p>Text extraction. While you could use qpdf JSON syntax to navigate to
a page’s content streams and font structures, text within pages is
still encoded using PDF syntax within content streams, and there is
no assistance for text extraction.</p></li>
<li><p>Reflowing text, document structure. qpdf JSON does not add any new
information or insight into the content of PDF files. If you have a
PDF file that lacks any structural information, qpdf JSON won’t help
you solve any of those problems.</p></li>
</ul>
<p>This is what we mean when we say that JSON provides a <em>alternative
syntax</em> for working with PDF data. Semantically, it is identical to
native PDF.</p>
</section>
<section id="qpdf-json-format">
<span id="id3"></span><h3>qpdf JSON Format<a class="headerlink" href="#qpdf-json-format" title="Permalink to this heading"></a></h3>
<p>This section describes how qpdf represents PDF objects in JSON format.
It also describes how to work with qpdf JSON to create or
modify PDF files.</p>
<section id="qpdf-json-object-representation">
<span id="json-objects"></span><h4>qpdf JSON Object Representation<a class="headerlink" href="#qpdf-json-object-representation" title="Permalink to this heading"></a></h4>
<p>This section describes the representation of PDF objects in qpdf JSON
version 2. An example appears in <a class="reference internal" href="#json-example"><span class="std std-ref">qpdf JSON Example</span></a>.</p>
<p>PDF objects are represented within the <code class="docutils literal notranslate"><span class="pre">&quot;qpdf&quot;</span></code> entry of a qpdf JSON
file. The <code class="docutils literal notranslate"><span class="pre">&quot;qpdf&quot;</span></code> entry is a two-element array. The first element
is a dictionary containing header-like information about the file such
as the PDF version. The second element is a dictionary containing all
the objects in the PDF file. We refer to this as the <em>objects
dictionary</em>.</p>
<p>The first element contains the following keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;jsonversion&quot;</span></code> – a number indicating the JSON version used for
writing. This will always be <code class="docutils literal notranslate"><span class="pre">2</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;pdfversion&quot;</span></code> – a string containing PDF version as indicated in
the PDF header (e.g. <code class="docutils literal notranslate"><span class="pre">&quot;1.7&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;2.0&quot;</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pushedinheritedpageresources</span></code> – a boolean indicating whether the
library pushed inherited resources down to the page level. Certain
library calls cause this to happen, and qpdf needs to know when
reading a JSON file back in whether it should do this as it may
cause certain objects to be renumbered. This field is ignored when
<a class="reference internal" href="index.html#option-update-from-json" title="option-update-from-json"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--update-from-json</span></code></a> was not given.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">calledgetallpages</span></code> – a boolean indicating whether
<code class="docutils literal notranslate"><span class="pre">getAllPages</span></code> was called prior to writing the JSON output. This
method causes page tree repair to occur, which may renumber some
objects (in very rare cases of corrupted page trees), so qpdf needs
to know this information when reading a JSON file back in. This
field is ignored when <a class="reference internal" href="index.html#option-update-from-json" title="option-update-from-json"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--update-from-json</span></code></a> was not given.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;maxobjectid&quot;</span></code> – a number indicating the object ID of the
highest numbered object in the file. This is provided to make it
easier for software that wants to add new objects to the file as you
can safely start with one above that number when creating new
objects. Note that the value of <code class="docutils literal notranslate"><span class="pre">&quot;maxobjectid&quot;</span></code> may be higher than
the actual maximum object that appears in the input PDF since it
takes into consideration any dangling indirect object references
from the original file. This prevents you from unwittingly creating
an object that doesn’t exist but that is referenced, which may have
unintended side effects. (The PDF specification explicitly allows
dangling references and says to treat them as nulls. This can happen
if objects are removed from a PDF file.)</p></li>
</ul>
<p>The second element is the objects dictionary. Each key in the objects
dictionary is either <code class="docutils literal notranslate"><span class="pre">&quot;trailer&quot;</span></code> or a string of the form
<code class="samp docutils literal notranslate"><span class="pre">&quot;obj:</span><em><span class="pre">O</span></em> <em><span class="pre">G</span></em> <span class="pre">R&quot;</span></code> where <code class="samp docutils literal notranslate"><em><span class="pre">O</span></em></code> and <code class="samp docutils literal notranslate"><em><span class="pre">G</span></em></code> are the
object and generation numbers and <code class="docutils literal notranslate"><span class="pre">R</span></code> is the literal string <code class="docutils literal notranslate"><span class="pre">R</span></code>.
This is the PDF syntax for the indirect object reference prepended by
<code class="docutils literal notranslate"><span class="pre">obj:</span></code>. The value, representing the object itself, is a JSON object
whose structure is described below.</p>
<dl>
<dt>Top-level Stream Objects</dt><dd><p>Stream objects are represented as a JSON object with the single key
<code class="docutils literal notranslate"><span class="pre">&quot;stream&quot;</span></code>. The stream object has a key called <code class="docutils literal notranslate"><span class="pre">&quot;dict&quot;</span></code> whose
value is the stream dictionary as an object value (described below)
with the <code class="docutils literal notranslate"><span class="pre">&quot;/Length&quot;</span></code> key omitted. Other keys are determined by the
value for json stream data (<a class="reference internal" href="index.html#option-json-stream-data" title="option-json-stream-data"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-stream-data</span></code></a>, or a
parameter of type <code class="docutils literal notranslate"><span class="pre">qpdf_json_stream_data_e</span></code>) as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">none</span></code>: stream data is not represented; no other keys are
present
specified.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">inline</span></code>: the stream data appears as a base64-encoded string as
the value of the <code class="docutils literal notranslate"><span class="pre">&quot;data&quot;</span></code> key</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">file</span></code>: the stream data is written to a file, and the path to
the file is stored in the <code class="docutils literal notranslate"><span class="pre">&quot;datafile&quot;</span></code> key. A relative path is
interpreted as relative to the current directory when qpdf is
invoked.</p></li>
</ul>
<p>Keys other than <code class="docutils literal notranslate"><span class="pre">&quot;dict&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;data&quot;</span></code>, and <code class="docutils literal notranslate"><span class="pre">&quot;datafile&quot;</span></code> are
ignored. This is primarily for future compatibility in case a newer
version of qpdf includes additional information.</p>
<p>As with the native PDF representation, the stream data must be
consistent with whatever filters and decode parameters are specified
in the stream dictionary.</p>
</dd>
<dt>Top-level Non-stream Objects</dt><dd><p>Non-stream objects are represented as a dictionary with the single
key <code class="docutils literal notranslate"><span class="pre">&quot;value&quot;</span></code>. Other keys are ignored for future compatibility.
The value’s structure is described in “Object Values” below.</p>
<p>Note: in files that use object streams, the trailer “dictionary” is
actually a stream, but in the JSON representation, the value of the
<code class="docutils literal notranslate"><span class="pre">&quot;trailer&quot;</span></code> key is always written as a dictionary (with a
<code class="docutils literal notranslate"><span class="pre">&quot;value&quot;</span></code> key like other non-stream objects). There will also be a
a stream object whose key is the object ID of the cross-reference
stream, even though this stream will generally be unreferenced. This
makes it possible to assume <code class="docutils literal notranslate"><span class="pre">&quot;trailer&quot;</span></code> points to a dictionary
without having to consider whether the file uses object streams or
not. It is also consistent with how <code class="docutils literal notranslate"><span class="pre">QPDF::getTrailer</span></code> behaves in
the C++ API.</p>
</dd>
<dt>Object Values</dt><dd><p>Within <code class="docutils literal notranslate"><span class="pre">&quot;value&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;stream&quot;.&quot;dict&quot;</span></code>, PDF objects are
represented as follows:</p>
<ul>
<li><p>Objects of type Boolean or null are represented as JSON objects of
the same type.</p></li>
<li><p>Objects that are numeric are represented as numeric in the JSON
without regard to precision. Internally, qpdf stores numeric
values as strings, so qpdf will preserve arbitrary precision
numerical values when reading and writing JSON. It is likely that
other JSON readers and writers will have implementation-dependent
ways of handling numerical values that are out of range.</p></li>
<li><p>Name objects are represented as JSON strings that start with <code class="docutils literal notranslate"><span class="pre">/</span></code>
and are followed by the PDF name in canonical form with all PDF
syntax resolved. For example, the name whose canonical form (per
the PDF specification) is <code class="docutils literal notranslate"><span class="pre">text/plain</span></code> would be represented in
JSON as <code class="docutils literal notranslate"><span class="pre">&quot;/text/plain&quot;</span></code> and in PDF as <code class="docutils literal notranslate"><span class="pre">&quot;/text#2fplain&quot;</span></code>.</p></li>
<li><p>Indirect object references are represented as JSON strings that
look like a PDF indirect object reference and have the form
<code class="samp docutils literal notranslate"><span class="pre">&quot;</span><em><span class="pre">O</span></em> <em><span class="pre">G</span></em> <span class="pre">R&quot;</span></code> where <code class="samp docutils literal notranslate"><em><span class="pre">O</span></em></code> and <code class="samp docutils literal notranslate"><em><span class="pre">G</span></em></code> are the
object and generation numbers and <code class="docutils literal notranslate"><span class="pre">R</span></code> is the literal string
<code class="docutils literal notranslate"><span class="pre">R</span></code>. For example, <code class="docutils literal notranslate"><span class="pre">&quot;3</span> <span class="pre">0</span> <span class="pre">R&quot;</span></code> would represent a reference to the
object with object ID 3 and generation 0.</p></li>
<li><p>PDF strings are represented as JSON strings in one of two ways:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;u:utf8-encoded-string&quot;</span></code>: this format is used when the PDF
string can be unambiguously represented as a Unicode string and
contains no unprintable characters. This is the case whether the
input string is encoded as UTF-16, UTF-8 (as allowed by PDF
2.0), or PDF doc encoding. Strings are only represented this way
if they can be encoded without loss of information.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;b:hex-string&quot;</span></code>: this format is used to represent any binary
string value that can’t be represented as a Unicode string.
<code class="docutils literal notranslate"><span class="pre">hex-string</span></code> must have an even number of characters that range
from <code class="docutils literal notranslate"><span class="pre">a</span></code> through <code class="docutils literal notranslate"><span class="pre">f</span></code>, <code class="docutils literal notranslate"><span class="pre">A</span></code> through <code class="docutils literal notranslate"><span class="pre">F</span></code>, or <code class="docutils literal notranslate"><span class="pre">0</span></code> through
<code class="docutils literal notranslate"><span class="pre">9</span></code>.</p></li>
</ul>
<p>qpdf writes empty strings as <code class="docutils literal notranslate"><span class="pre">&quot;u:&quot;</span></code>, but both <code class="docutils literal notranslate"><span class="pre">&quot;b:&quot;</span></code> and
<code class="docutils literal notranslate"><span class="pre">&quot;u:&quot;</span></code> are valid representations of the empty string.</p>
<p>There is full support for UTF-16 surrogate pairs. Binary strings
encoded with <code class="docutils literal notranslate"><span class="pre">&quot;b:...&quot;</span></code> are the internal PDF representations.
As such, the following are equivalent:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;u:\ud83e\udd54&quot;</span></code> – representation of U+1F954 as a surrogate
pair in JSON syntax</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;b:FEFFD83EDD54&quot;</span></code> – representation of U+1F954 as the bytes
of a UTF-16 string in PDF syntax with the leading <code class="docutils literal notranslate"><span class="pre">FEFF</span></code>
indicating UTF-16</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;b:efbbbff09fa594&quot;</span></code> – representation of U+1F954 as the
bytes of a UTF-8 string in PDF syntax (as allowed by PDF 2.0)
with the leading <code class="docutils literal notranslate"><span class="pre">EF</span></code>, <code class="docutils literal notranslate"><span class="pre">BB</span></code>, <code class="docutils literal notranslate"><span class="pre">BF</span></code> sequence (which is just
UTF-8 encoding of <code class="docutils literal notranslate"><span class="pre">FEFF</span></code>).</p></li>
<li><p>A JSON string whose contents are <code class="docutils literal notranslate"><span class="pre">u:</span></code> followed by the UTF-8
representation of U+1F954. This is the potato emoji.
Unfortunately, I am not able to render it in the PDF version
of this manual.</p></li>
</ul>
</li>
<li><p>PDF arrays are represented as JSON arrays of objects as described
above</p></li>
<li><p>PDF dictionaries are represented as JSON objects whose keys are
the string representations of names and whose values are
representations of PDF objects.</p></li>
</ul>
</dd>
</dl>
<p>Note that writing JSON output is done by <code class="docutils literal notranslate"><span class="pre">QPDF</span></code>, not <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code>.
As such, none of the things <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> does apply. This includes
recompression of streams, renumbering of objects, removal of
unreferenced objects, encryption, decryption, linearization, QDF
mode, etc. See <a class="reference internal" href="index.html#rewriting"><span class="std std-ref">Writing PDF Files</span></a> for a more in-depth discussion. This
has a few noteworthy implications:</p>
<ul class="simple">
<li><p>Decryption is handled transparently by qpdf. As there are no QPDF
APIs, even internal to the library, that allow retrieval of
encrypted data in its raw, encrypted form, qpdf JSON always includes
decrypted data. It is possible that a future version of qpdf may
allow access to raw, encrypted string and stream data.</p></li>
<li><p>Objects that are related to a PDF file’s structure, rather than its
content, are included in the JSON output, even though they are not
particularly useful. In a future version of qpdf, this may be fixed,
and the <a class="reference internal" href="index.html#option-preserve-unreferenced" title="option-preserve-unreferenced"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--preserve-unreferenced</span></code></a> flag may be able to be
used to get the existing behavior. For now, to avoid this, run the
file through <code class="docutils literal notranslate"><span class="pre">qpdf</span> <span class="pre">--decrypt</span> <span class="pre">--object-streams=disable</span> <span class="pre">in.pdf</span>
<span class="pre">out.pdf</span></code> to generate a new PDF file that contains no unreferenced
or structural objects.</p>
<ul>
<li><p>Linearized PDF files include a linearization dictionary which is not
referenced from any other object and which references the
linearization hint stream by offset. The JSON from a linearized PDF
file contains both of these objects, even though they are not useful
in the JSON. Offset information is not represented in the JSON, so
there’s no way to find the linearization hint stream from the
JSON. If a new PDF is created from JSON that was written, the
objects will be read back in but will just be unreferenced objects
that will be ignored by <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> when the file is rewritten.</p></li>
<li><p>The JSON from a file with object streams will include the original
object stream and will also include all the objects in the stream
as top-level objects.</p></li>
<li><p>In files with object streams, the trailer “dictionary” is a
stream. In qpdf JSON files, the <code class="docutils literal notranslate"><span class="pre">&quot;trailer&quot;</span></code> key will contain a
dictionary with all the keys in it relating to the stream, and the
stream will also appear as an unreferenced object.</p></li>
<li><p>Encrypted files are decrypted, but the encryption dictionary still
appears in the JSON output.</p></li>
</ul>
</li>
</ul>
</section>
<section id="qpdf-json-example">
<span id="json-example"></span><h4>qpdf JSON Example<a class="headerlink" href="#qpdf-json-example" title="Permalink to this heading"></a></h4>
<p>The JSON below shows an example of a simple PDF file represented in
qpdf JSON format.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;qpdf&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;jsonversion&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;pdfversion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.3&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;pushedinheritedpageresources&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;calledgetallpages&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;maxobjectid&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;obj:1 0 R&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/Pages&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3 0 R&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/Catalog&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;obj:2 0 R&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/Author&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;u:Digits of π&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/CreationDate&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;u:D:20220731155308-05&#39;00&#39;&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/Creator&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;u:A person typing in Emacs&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/Keywords&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;u:potato, example&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/ModDate&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;u:D:20220731155308-05&#39;00&#39;&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/Producer&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;u:qpdf&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/Subject&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;u:Example&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/Title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;u:Something potato-related&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;obj:3 0 R&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/Count&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/Kids&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;4 0 R&quot;</span><span class="w"></span>
<span class="w">          </span><span class="p">],</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/Pages&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;obj:4 0 R&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/Contents&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5 0 R&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/MediaBox&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">            </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="mi">0</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="mi">612</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="mi">792</span><span class="w"></span>
<span class="w">          </span><span class="p">],</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/Parent&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;3 0 R&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/Resources&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;/Font&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">              </span><span class="nt">&quot;/F1&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;6 0 R&quot;</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">          </span><span class="p">},</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/Page&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;obj:5 0 R&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;stream&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eJxzCuFSUNB3M1QwMlEISQOyzY2AyEAhJAXI1gjIL0ksyddUCMnicg3hAgDLAQnI&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;dict&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="nt">&quot;/Filter&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/FlateDecode&quot;</span><span class="w"></span>
<span class="w">          </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;obj:6 0 R&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/BaseFont&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/Helvetica&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/Encoding&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/WinAnsiEncoding&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/Subtype&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/Type1&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/Font&quot;</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">},</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;trailer&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/ID&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;b:98b5a26966fba4d3a769b715b2558da6&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">            </span><span class="s2">&quot;b:6bea23330e0b9ff0ddb47b6757fb002e&quot;</span><span class="w"></span>
<span class="w">          </span><span class="p">],</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/Info&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2 0 R&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/Root&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1 0 R&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">          </span><span class="nt">&quot;/Size&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">7</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">]</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="qpdf-json-input">
<span id="json-input"></span><h4>qpdf JSON Input<a class="headerlink" href="#qpdf-json-input" title="Permalink to this heading"></a></h4>
<p>The qpdf JSON output can be used in two different ways:</p>
<ul class="simple">
<li><p>By using the <a class="reference internal" href="index.html#option-json-input" title="option-json-input"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-input</span></code></a> flag or calling
<code class="docutils literal notranslate"><span class="pre">QPDF::createFromJSON</span></code> in place of <code class="docutils literal notranslate"><span class="pre">QPDF::processFile</span></code>, a qpdf
JSON file can be used in place of a PDF file as the input to qpdf.</p></li>
<li><p>By using the <a class="reference internal" href="index.html#option-update-from-json" title="option-update-from-json"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--update-from-json</span></code></a> flag or calling
<code class="docutils literal notranslate"><span class="pre">QPDF::updateFromJSON</span></code> on an initialized <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object, a qpdf
JSON file can be used to apply changes to an existing <code class="docutils literal notranslate"><span class="pre">QPDF</span></code>
object. That <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object can have come from any source including
a PDF file, a qpdf JSON file, or the result of any other process
that results in a valid, initialized <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object.</p></li>
</ul>
<p>Here are some important things to know about qpdf JSON input.</p>
<ul>
<li><p>When a qpdf JSON file is used as the primary input file, it must be
complete. This means</p>
<ul class="simple">
<li><p>A JSON version number must be specified with the <code class="docutils literal notranslate"><span class="pre">&quot;jsonversion&quot;</span></code>
key in the first array element</p></li>
<li><p>A PDF version number must be specified with the <code class="docutils literal notranslate"><span class="pre">&quot;pdfversion&quot;</span></code>
key in the first array element</p></li>
<li><p>Stream data must be present for all streams</p></li>
<li><p>The trailer dictionary must be present, though only the
<code class="docutils literal notranslate"><span class="pre">&quot;/Root&quot;</span></code> key is required.</p></li>
</ul>
</li>
<li><p>Certain fields from the input are ignored whether creating or
updating from a JSON file:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;maxobjectid&quot;</span></code> is ignored, so it is not necessary to update it
when adding new objects.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;/Length&quot;</span></code> is ignored in all stream dictionaries. qpdf doesn’t
put it there when it creates JSON output, and it is not necessary
to add it.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;/Size&quot;</span></code> is ignored if it appears in a trailer dictionary as
that is always recomputed by <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code>.</p></li>
<li><p>Unknown keys at the top level of the file, within <code class="docutils literal notranslate"><span class="pre">&quot;qpdf&quot;</span></code>, and
at the top level of each individual PDF object (inside the
dictionary that has the <code class="docutils literal notranslate"><span class="pre">&quot;value&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;stream&quot;</span></code> key) and
directly within <code class="docutils literal notranslate"><span class="pre">&quot;stream&quot;</span></code> are ignored for future compatibility.
This includes other top-level keys generated by <code class="docutils literal notranslate"><span class="pre">qpdf</span></code> itself
(such as <code class="docutils literal notranslate"><span class="pre">&quot;pages&quot;</span></code>). As such, those keys don’t have to be
consistent with the <code class="docutils literal notranslate"><span class="pre">&quot;qpdf&quot;</span></code> key if modifying a JSON file for
conversion back to PDF. If you wish to store application-specific
metadata, you can do so by adding a key whose name starts with
<code class="docutils literal notranslate"><span class="pre">x-</span></code>. qpdf is guaranteed not to add any of its own keys that
starts with <code class="docutils literal notranslate"><span class="pre">x-</span></code>. Note that any <code class="docutils literal notranslate"><span class="pre">&quot;version&quot;</span></code> key at the top
level is ignored. The JSON version is obtained from the
<code class="docutils literal notranslate"><span class="pre">&quot;jsonversion&quot;</span></code> key of the first element of the <code class="docutils literal notranslate"><span class="pre">&quot;qpdf&quot;</span></code>
field.</p></li>
</ul>
</li>
<li><p>The values of <code class="docutils literal notranslate"><span class="pre">&quot;calledgetallpages&quot;</span></code> and
<code class="docutils literal notranslate"><span class="pre">&quot;pushedinheritedpageresources&quot;</span></code> are ignored when creating a file.
When updating a file, they treated as <code class="docutils literal notranslate"><span class="pre">false</span></code> if omitted.</p></li>
<li><p>When qpdf reads a PDF file, the internal object numbers are always
preserved. However, when qpdf writes a file using <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code>,
<code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> does its own numbering and, in general, does not
preserve input object numbers. That means that a qpdf JSON file that
is used to update an existing PDF must have object numbers that
match the input file it is modifying. In practical terms, this means
that you can’t use a JSON file created from one PDF file to modify
the <em>output of running qpdf on that file</em>.</p>
<p>To put this more concretely, the following is valid:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>qpdf --json-output in.pdf pdf.json
# edit pdf.json
qpdf in.pdf out.pdf --update-from-json=pdf.json
</pre></div>
</div>
<p>The following will produce unpredictable and probably incorrect
results because <code class="docutils literal notranslate"><span class="pre">out.pdf</span></code> won’t have the same object numbers as
<code class="docutils literal notranslate"><span class="pre">pdf.json</span></code> and <code class="docutils literal notranslate"><span class="pre">in.pdf</span></code>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>qpdf --json-output in.pdf pdf.json
# edit pdf.json
qpdf in.pdf out.pdf --update-from-json=pdf.json
# edit pdf.json again
# Don&#39;t do this
qpdf out.pdf out2.pdf --update-from-json=pdf.json
</pre></div>
</div>
</li>
<li><p>When updating from a JSON file (<a class="reference internal" href="index.html#option-update-from-json" title="option-update-from-json"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--update-from-json</span></code></a>,
<code class="docutils literal notranslate"><span class="pre">QPDF::updateFromJSON</span></code>), existing objects are updated in place.
This has the following implications:</p>
<ul class="simple">
<li><p>If the object you are updating is a stream, you may omit both
<code class="docutils literal notranslate"><span class="pre">&quot;data&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;datafile&quot;</span></code>. In that case the original stream
data is preserved. You must always provide a stream dictionary,
but it may be empty. Note that an empty stream dictionary will
clear the old dictionary. There is no way to indicate that an old
stream dictionary should be left alone, so if your intention is to
replace the stream data and preserve the dictionary, the original
dictionary must appear in the JSON file.</p></li>
<li><p>You can change one object type to another object type including
replacing a stream with a non-stream or a non-stream with a
stream. If you replace a non-stream with a stream, you must
provide data for the stream.</p></li>
<li><p>Objects that you do not wish to modify can be omitted from the
JSON. That includes the trailer. That means you can use the output
of a qpdf JSON file that was written using
<a class="reference internal" href="index.html#option-json-object" title="option-json-object"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-object</span></code></a> to have it include only the objects you
intend to modify.</p></li>
<li><p>You can omit the <code class="docutils literal notranslate"><span class="pre">&quot;pdfversion&quot;</span></code> key. The input PDF version will
be preserved.</p></li>
</ul>
</li>
</ul>
</section>
<section id="qpdf-json-workflow-cli">
<span id="json-workflow-cli"></span><h4>qpdf JSON Workflow: CLI<a class="headerlink" href="#qpdf-json-workflow-cli" title="Permalink to this heading"></a></h4>
<p>This section includes a few examples of using qpdf JSON.</p>
<ul>
<li><p>Convert a PDF file to JSON format, edit the JSON, and convert back
to PDF. This is an alternative to using QDF mode (see <a class="reference internal" href="index.html#qdf"><span class="std std-ref">QDF Mode</span></a>) to
modify PDF files in a text editor. Each method has its own
advantages and disadvantages.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>qpdf --json-output in.pdf pdf.json
# edit pdf.json
qpdf --json-input pdf.json out.pdf
</pre></div>
</div>
</li>
<li><p>Extract only a specific object into a JSON file, modify the object
in JSON, and use the modified object to update the original PDF. In
this case, we’re editing object 4, whatever that may happen to be.
You would have to know through some other means which object you
wanted to edit, such as by looking at other JSON output or using a
tool (possibly but not necessarily qpdf) to identify the object.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>qpdf --json-output in.pdf pdf.json --json-object=4,0
# edit pdf.json
qpdf in.pdf --update-from-json=pdf.json out.pdf
</pre></div>
</div>
<p>Rather than using <a class="reference internal" href="index.html#option-json-object" title="option-json-object"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-object</span></code></a> as in the above example,
you could edit the JSON file to remove the objects you didn’t need.
You could also just leave them there, though the update process
would be slower.</p>
<p>You could also add new objects to a file by adding them to
<code class="docutils literal notranslate"><span class="pre">pdf.json</span></code>. Just be sure the object number doesn’t conflict with
an existing object. The <code class="docutils literal notranslate"><span class="pre">&quot;maxobjectid&quot;</span></code> field in the original
output can help with this. You don’t have to update it if you add
objects as it is ignored when the file is read back in.</p>
</li>
<li><p>Use <a class="reference internal" href="index.html#option-json-input" title="option-json-input"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-input</span></code></a> and <a class="reference internal" href="index.html#option-json-output" title="option-json-output"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-output</span></code></a> together
to demonstrate preservation of object numbers. In this example,
<code class="docutils literal notranslate"><span class="pre">a.json</span></code> and <code class="docutils literal notranslate"><span class="pre">b.json</span></code> will have the same objects and object
numbers. The files may not be identical since strings may be
normalized, fields may appear in a different order, etc. However
<code class="docutils literal notranslate"><span class="pre">b.json</span></code> and <code class="docutils literal notranslate"><span class="pre">c.json</span></code> are probably identical.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>qpdf --json-output in.pdf a.json
qpdf --json-input --json-output a.json b.json
qpdf --json-input --json-output b.json c.json
</pre></div>
</div>
</li>
</ul>
</section>
<section id="qpdf-json-workflow-api">
<span id="json-workflow-api"></span><h4>qpdf JSON Workflow: API<a class="headerlink" href="#qpdf-json-workflow-api" title="Permalink to this heading"></a></h4>
<p>Everything that can be done using the qpdf CLI can be done using the
C++ API. See comments in <code class="file docutils literal notranslate"><span class="pre">QPDF.hh</span></code> for <code class="docutils literal notranslate"><span class="pre">writeJSON</span></code>,
<code class="docutils literal notranslate"><span class="pre">createFromJSON</span></code>, and <code class="docutils literal notranslate"><span class="pre">updateFromJSON</span></code> for details.</p>
</section>
</section>
<section id="json-compatibility-guarantees">
<span id="json-guarantees"></span><h3>JSON Compatibility Guarantees<a class="headerlink" href="#json-compatibility-guarantees" title="Permalink to this heading"></a></h3>
<p>The qpdf JSON representation includes a JSON serialization of the raw
objects in the PDF file as well as some computed information in a more
easily extracted format. QPDF provides some guarantees about its JSON
format. These guarantees are designed to simplify the experience of a
developer working with the JSON format.</p>
<dl>
<dt>Compatibility</dt><dd><p>The top-level JSON object is a dictionary (JSON “object”). The JSON
output contains various nested dictionaries and arrays. With the
exception of dictionaries that are populated by the fields of
PDF objects from the file, all instances of a dictionary are
guaranteed to have exactly the same keys.</p>
<p>The top-level JSON structure contains a <code class="docutils literal notranslate"><span class="pre">&quot;version&quot;</span></code> key whose
value is simple integer. The value of the <code class="docutils literal notranslate"><span class="pre">version</span></code> key will be
incremented if a non-compatible change is made. A non-compatible
change would be any change that involves removal of a key, a change
to the format of data pointed to by a key, or a semantic change
that requires a different interpretation of a previously existing
key. Note that, starting with version 2, the JSON version also
appears in the <code class="docutils literal notranslate"><span class="pre">&quot;jsonversion&quot;</span></code> field of the first element of
<code class="docutils literal notranslate"><span class="pre">&quot;qpdf&quot;</span></code> field.</p>
<p>Within a specific qpdf JSON version, future versions of qpdf are
free to add additional keys but not to remove keys or change the
type of object that a key points to. That means that consumers of
qpdf JSON should ignore keys they don’t know about.</p>
</dd>
<dt>Documentation</dt><dd><p>The <strong class="command">qpdf</strong> command can be invoked with the
<a class="reference internal" href="index.html#option-json-help" title="option-json-help"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-help</span></code></a> option. This will output a JSON
structure that has the same structure as the JSON output that qpdf
generates, except that each field in the help output is a description
of the corresponding field in the JSON output. The specific
guarantees are as follows:</p>
<ul class="simple">
<li><p>A dictionary in the help output means that the corresponding
location in the actual JSON output is also a dictionary with
exactly the same keys; that is, no keys present in help are
absent in the real output, and no keys will be present in the
real output that are not in help. It is possible for a key to be
present and have a value that is explicitly <code class="docutils literal notranslate"><span class="pre">null</span></code>. As a
special case, if the dictionary has a single key whose name
starts with <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> and ends with <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>, it means that the JSON
output is a dictionary that can have any value as a key. This is
used for cases in which the keys of the dictionary are things
like object IDs.</p></li>
<li><p>A string in the help output is a description of the item that
appears in the corresponding location of the actual output. The
corresponding output can have any value including <code class="docutils literal notranslate"><span class="pre">null</span></code>.</p></li>
<li><p>A single-element array in the help output indicates that the
corresponding location in the actual output is either a single
item or is an array of any length. The single item or each
element of the array has whatever format is implied by the single
element of the help output’s array.</p></li>
<li><p>A multi-element array in the help output indicates that the
corresponding location in the actual output is an array of the
same length. Each element of the output array has whatever format
is implied by the corresponding element of the help output’s
array.</p></li>
</ul>
<p>For example, the help output indicates includes a <code class="docutils literal notranslate"><span class="pre">&quot;pagelabels&quot;</span></code>
key whose value is an array of one element. That element is a
dictionary with keys <code class="docutils literal notranslate"><span class="pre">&quot;index&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;label&quot;</span></code>. In addition to
describing the meaning of those keys, this tells you that the actual
JSON output will contain a <code class="docutils literal notranslate"><span class="pre">pagelabels</span></code> array, each of whose
elements is a dictionary that contains an <code class="docutils literal notranslate"><span class="pre">index</span></code> key, a <code class="docutils literal notranslate"><span class="pre">label</span></code>
key, and no other keys.</p>
</dd>
<dt>Directness and Simplicity</dt><dd><p>The JSON output contains the value of every object in the file, but
it also contains some summary data. This is analogous to how qpdf’s
library interface works. The summary data is similar to the helper
functions in that it allows you to look at certain aspects of the
PDF file without having to understand all the nuances of the PDF
specification, while the raw objects allow you to mine the PDF for
anything that the higher-level interfaces are lacking. It is
especially useful to create a JSON file with the <code class="docutils literal notranslate"><span class="pre">&quot;pages&quot;</span></code> and
<code class="docutils literal notranslate"><span class="pre">&quot;qpdf&quot;</span></code> keys and to use the <code class="docutils literal notranslate"><span class="pre">&quot;pages&quot;</span></code> information to find a
page rather than navigating the pages tree manually. This can be
done safely, and changes can made to the objects dictionary without
worrying about keeping <code class="docutils literal notranslate"><span class="pre">&quot;pages&quot;</span></code> up to date since it is ignored
when reading the file back in.</p>
</dd>
</dl>
</section>
<section id="json-special-considerations">
<span id="json-considerations"></span><h3>JSON: Special Considerations<a class="headerlink" href="#json-special-considerations" title="Permalink to this heading"></a></h3>
<p>For the most part, the built-in JSON help tells you everything you need
to know about the JSON format, but there are a few non-obvious things to
be aware of:</p>
<ul class="simple">
<li><p>If a PDF file has certain types of errors in its pages tree (such as
page objects that are direct or multiple pages sharing the same
object ID), qpdf will automatically repair the pages tree. If you
specify <code class="docutils literal notranslate"><span class="pre">&quot;qpdf&quot;</span></code> (or, with qpdf JSON version 1, <code class="docutils literal notranslate"><span class="pre">&quot;objects&quot;</span></code> or
<code class="docutils literal notranslate"><span class="pre">&quot;objectinfo&quot;</span></code>) without any other keys, you will see the original
pages tree without any corrections. If you specify any of keys that
require page tree traversal (for example, <code class="docutils literal notranslate"><span class="pre">&quot;pages&quot;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&quot;outlines&quot;</span></code>, or <code class="docutils literal notranslate"><span class="pre">&quot;pagelabel&quot;</span></code>), then <code class="docutils literal notranslate"><span class="pre">&quot;qpdf&quot;</span></code> (and
<code class="docutils literal notranslate"><span class="pre">&quot;objects&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;objectinfo&quot;</span></code>) will show the repaired page
tree so that object references will be consistent throughout the
file. You can tell if this has happened by looking at the
<code class="docutils literal notranslate"><span class="pre">&quot;calledgetallpages&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;pushedinheritedpageresources&quot;</span></code>
fields in the first element of the <code class="docutils literal notranslate"><span class="pre">&quot;qpdf&quot;</span></code> array.</p></li>
<li><p>While qpdf guarantees that keys present in the help will be present
in the output, those fields may be null or empty if the information
is not known or absent in the file. Also, if you specify
<a class="reference internal" href="index.html#option-json-key" title="option-json-key"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-key</span></code></a>, the keys that are not listed
will be excluded entirely except for those that
<a class="reference internal" href="index.html#option-json-help" title="option-json-help"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-help</span></code></a> says are always present.</p></li>
<li><p>In a few places, there are keys with names containing
<code class="docutils literal notranslate"><span class="pre">pageposfrom1</span></code>. The values of these keys are null or an integer. If
an integer, they point to a page index within the file numbering from
1. Note that JSON indexes from 0, and you would also use 0-based
indexing using the API. However, 1-based indexing is easier in this
case because the command-line syntax for specifying page ranges is
1-based. If you were going to write a program that looked through
the JSON for information about specific pages and then use the
command-line to extract those pages, 1-based indexing is easier.
Besides, it’s more convenient to subtract 1 in a real programming
language than it is to add 1 in shell code.</p></li>
<li><p>The image information included in the <code class="docutils literal notranslate"><span class="pre">page</span></code> section of the JSON
output includes the key <code class="docutils literal notranslate"><span class="pre">&quot;filterable&quot;</span></code>. Note that the value of
this field may depend on the <a class="reference internal" href="index.html#option-decode-level" title="option-decode-level"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--decode-level</span></code></a> that you
invoke qpdf with. The JSON output includes a top-level key
<code class="docutils literal notranslate"><span class="pre">&quot;parameters&quot;</span></code> that indicates the decode level that was used for
computing whether a stream was filterable. For example, jpeg images
will be shown as not filterable by default, but they will be shown
as filterable if you run <strong class="command">qpdf --json
--decode-level=all</strong>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">encrypt</span></code> key’s values will be populated for non-encrypted
files. Some values will be null, and others will have values that
apply to unencrypted files.</p></li>
<li><p>The qpdf library itself never loads an entire PDF into memory. This
remains true for PDF files represented in JSON format. In general,
qpdf will hold the entire object structure in memory once a file has
been fully read (objects are loaded into memory lazily but stay
there once loaded), but it will never have more than two copies of a
stream in memory at once. That said, if you ask qpdf to write JSON
to memory, it will do so, so be careful about this if you are
working with very large PDF files. There is nothing in the qpdf
library itself that prevents working with PDF files much larger than
available system memory. qpdf can both read and write such files in
JSON format. If you need to work with a PDF file’s json
representation in memory, it is recommended that you use either
<code class="docutils literal notranslate"><span class="pre">none</span></code> or <code class="docutils literal notranslate"><span class="pre">file</span></code> as the argument to
<a class="reference internal" href="index.html#option-json-stream-data" title="option-json-stream-data"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-stream-data</span></code></a>, or if using the API, use
<code class="docutils literal notranslate"><span class="pre">qpdf_sj_none</span></code> or <code class="docutils literal notranslate"><span class="pre">pdf_sj_file</span></code> as the json stream data value.
If using <code class="docutils literal notranslate"><span class="pre">none</span></code>, you can use other means to obtain the stream
data.</p></li>
</ul>
</section>
<section id="changes-from-json-v1-to-v2">
<span id="json-v2-changes"></span><h3>Changes from JSON v1 to v2<a class="headerlink" href="#changes-from-json-v1-to-v2" title="Permalink to this heading"></a></h3>
<p>The following changes were made to qpdf’s JSON output format for
version 2.</p>
<ul class="simple">
<li><p>The representation of objects has changed. For details, see
<a class="reference internal" href="#json-objects"><span class="std std-ref">qpdf JSON Object Representation</span></a>.</p>
<ul>
<li><p>The representation of strings is now unambiguous for all strings.
Strings a prefixed with either <code class="docutils literal notranslate"><span class="pre">u:</span></code> for Unicode strings or
<code class="docutils literal notranslate"><span class="pre">b:</span></code> for byte strings.</p></li>
<li><p>Names are shown in qpdf’s canonical form rather than in PDF
syntax. (Example: the PDF-syntax name <code class="docutils literal notranslate"><span class="pre">/text#2fplain</span></code> appeared
as <code class="docutils literal notranslate"><span class="pre">&quot;/text#2fplain&quot;</span></code> in v1 but appears as <code class="docutils literal notranslate"><span class="pre">&quot;/text/plain&quot;</span></code> in
v2.</p></li>
<li><p>The top-level representation of an object in <code class="docutils literal notranslate"><span class="pre">&quot;objects&quot;</span></code> is a
dictionary containing either a <code class="docutils literal notranslate"><span class="pre">&quot;value&quot;</span></code> key or a <code class="docutils literal notranslate"><span class="pre">&quot;stream&quot;</span></code>
key, making it possible to distinguish streams from other objects.</p></li>
</ul>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">&quot;objectinfo&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;objects&quot;</span></code> keys have been removed in
favor of a representation in <code class="docutils literal notranslate"><span class="pre">&quot;qpdf&quot;</span></code> that includes header
information and differentiates between a stream and other kinds of
objects. In v1, it was not possible to tell a stream from a
dictionary within <code class="docutils literal notranslate"><span class="pre">&quot;objects&quot;</span></code>, and the PDF version was not
captured at all.</p></li>
<li><p>Within the objects dictionary, keys are now <code class="samp docutils literal notranslate"><span class="pre">&quot;obj:</span><em><span class="pre">O</span></em> <em><span class="pre">G</span></em> <span class="pre">R&quot;</span></code>
where <code class="samp docutils literal notranslate"><em><span class="pre">O</span></em></code> and <code class="samp docutils literal notranslate"><em><span class="pre">G</span></em></code> are the object and generation
number. <code class="docutils literal notranslate"><span class="pre">&quot;trailer&quot;</span></code> remains the key for the trailer dictionary. In
v1, the <code class="docutils literal notranslate"><span class="pre">obj:</span></code> prefix was not present. The rationale for this
change is as follows:</p>
<ul>
<li><p>Having a unique prefix (<code class="docutils literal notranslate"><span class="pre">obj:</span></code>) makes it much easier to search
in the JSON file for the definition of an object</p></li>
<li><p>Having the key still contain <code class="docutils literal notranslate"><span class="pre">O</span> <span class="pre">G</span> <span class="pre">R</span></code> makes it much easier to
construct the key from an indirect reference. You just have to
prepend <code class="docutils literal notranslate"><span class="pre">obj:</span></code>. There is no need to parse the indirect object
reference.</p></li>
</ul>
</li>
<li><p>In the <code class="docutils literal notranslate"><span class="pre">&quot;encrypt&quot;</span></code> object, the <code class="docutils literal notranslate"><span class="pre">&quot;modifyannotations&quot;</span></code> was
misspelled as <code class="docutils literal notranslate"><span class="pre">&quot;moddifyannotations&quot;</span></code> in v1. This has been
corrected.</p></li>
</ul>
<section id="motivation-for-qpdf-json-version-2">
<h4>Motivation for qpdf JSON version 2<a class="headerlink" href="#motivation-for-qpdf-json-version-2" title="Permalink to this heading"></a></h4>
<p>qpdf JSON version 2 was created to make it possible to manipulate PDF
files using JSON syntax instead of native PDF syntax. This makes it
possible to make low-level updates to PDF files from just about any
programming language or even to do so from the command-line using
tools like <code class="docutils literal notranslate"><span class="pre">jq</span></code> or any editor that’s capable of working with JSON
files. There were several limitations of JSON format version 1 that
made this impossible:</p>
<ul class="simple">
<li><p>Strings, names, and indirect object references in the original PDF
file were all converted to strings in the JSON representation. For
casual human inspection, this was fine, but in the general case,
there was no way to tell the difference between a string that looked
like a name or indirect object reference from an actual name or
indirect object reference.</p></li>
<li><p>PDF strings were not unambiguously represented in the JSON format.
The way qpdf JSON v1 represented a string was to try to convert the
string to UTF-8. This was done by assuming a string that was not
explicitly marked as Unicode was encoded in PDF doc encoding. The
problem is that there is not a perfect bidirectional mapping between
Unicode and PDF doc encoding, so if a binary string happened to
contain characters that couldn’t be bidirectionally mapped, there
would be no way to get back to the original PDF string. Even when
possible, trying to map from the JSON representation of a binary
string back to the original string required knowledge of the mapping
between PDF doc encoding and Unicode.</p></li>
<li><p>There was no representation of stream data. If you wanted to extract
stream data, you could use <a class="reference internal" href="index.html#option-show-object" title="option-show-object"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--show-object</span></code></a>, so this wasn’t
that important for inspection, but it was a blocker for being able
to go from JSON back to PDF. qpdf JSON version 2 allows stream data
to be included inline as base64-encoded data. There is also an
option to write all stream data to external files, which makes it
possible to work with very large PDF files in JSON format even with
tools that try to read the entire JSON structure into memory.</p></li>
<li><p>The PDF version from PDF header was not represented in qpdf JSON v1.</p></li>
</ul>
</section>
</section>
</section>
<span id="document-contributing"></span><section id="contributing-to-qpdf">
<span id="contributing"></span><h2>Contributing to qpdf<a class="headerlink" href="#contributing-to-qpdf" title="Permalink to this heading"></a></h2>
<section id="source-repository">
<span id="id1"></span><h3>Source Repository<a class="headerlink" href="#source-repository" title="Permalink to this heading"></a></h3>
<p>The qpdf source code lives at <a class="reference external" href="https://github.com/qpdf/qpdf">https://github.com/qpdf/qpdf</a>.</p>
<p>Create issues (bug reports, feature requests) at
<a class="reference external" href="https://github.com/qpdf/qpdf/issues">https://github.com/qpdf/qpdf/issues</a>. If you have a general question or
topic for discussion, you can create a discussion at
<a class="reference external" href="https://github.com/qpdf/qpdf/discussions">https://github.com/qpdf/qpdf/discussions</a>.</p>
</section>
<section id="code-formatting">
<span id="id2"></span><h3>Code Formatting<a class="headerlink" href="#code-formatting" title="Permalink to this heading"></a></h3>
<p>The qpdf source code is formatting using clang-format ≥ version 15
with a <code class="file docutils literal notranslate"><span class="pre">.clang-format</span></code> file at the top of the source tree. The
<code class="file docutils literal notranslate"><span class="pre">format-code</span></code> script reformats all the source code in the
repository. You must have <code class="docutils literal notranslate"><span class="pre">clang-format</span></code> in your path, and it must be
at least version 15.</p>
<p>For emacs users, the <code class="file docutils literal notranslate"><span class="pre">.dir-locals.el</span></code> file configures emacs
<code class="docutils literal notranslate"><span class="pre">cc-mode</span></code> for an indentation style that is similar to but not
exactly like what <code class="docutils literal notranslate"><span class="pre">clang-format</span></code> produces. When there are
differences, <code class="docutils literal notranslate"><span class="pre">clang-format</span></code> is authoritative. It is not possible to
make <code class="docutils literal notranslate"><span class="pre">cc-mode</span></code> and <code class="docutils literal notranslate"><span class="pre">clang-format</span></code> exactly match since the syntax
parser in emacs is not as sophisticated.</p>
<p>Blocks of code that should not be formatted can be surrounded by the
comments <code class="docutils literal notranslate"><span class="pre">//</span> <span class="pre">clang-format</span> <span class="pre">off</span></code> and <code class="docutils literal notranslate"><span class="pre">//</span> <span class="pre">clang-format</span> <span class="pre">on</span></code>. Sometimes
clang-format tries to combine lines in ways that are undesirable. In
this case, we follow a convention of adding a comment <code class="docutils literal notranslate"><span class="pre">//</span>
<span class="pre">line-break</span></code> on its own line.</p>
<p>For exact details, consult <code class="file docutils literal notranslate"><span class="pre">.clang-format</span></code>. Here is a broad,
partial summary of the formatting rules:</p>
<ul class="simple">
<li><p>Use spaces, not tabs.</p></li>
<li><p>Keep lines to 80 columns when possible.</p></li>
<li><p>Braces are on their own lines after classes and functions (and
similar top-level constructs) and are compact otherwise.</p></li>
<li><p>Closing parentheses are attached to the previous material, not not
their own lines.</p></li>
</ul>
<p>The <code class="file docutils literal notranslate"><span class="pre">README-maintainer</span></code> file has a few additional notes that are
probably not important to anyone who is not making deep changes to
qpdf.</p>
</section>
<section id="automated-tests">
<span id="automated-testing"></span><h3>Automated Tests<a class="headerlink" href="#automated-tests" title="Permalink to this heading"></a></h3>
<p>The testing style of qpdf has evolved over time. More recent tests
call <code class="docutils literal notranslate"><span class="pre">assert()</span></code>. Older tests print stuff to standard output and
compare the output against reference files. Many tests are a mixture
of these techniques.</p>
<p>The <a class="reference external" href="https://qtest.sourceforge.io">qtest</a> style of testing is to
test everything through the application. So effectively most testing
is “integration testing” or “end-to-end testing”.</p>
<p>For details about <code class="docutils literal notranslate"><span class="pre">qtest</span></code>, consult the <a class="reference external" href="https://qtest.sourceforge.io/doc/qtest-manual.html">QTest Manual</a>. As you read
it, keep in mind that, in spite of the recent date on the file, the
vast majority of that documentation is from before 2007 and predates
many test frameworks and approaches that are in use today.</p>
<p>Notes on testing:</p>
<ul class="simple">
<li><p>In most cases, things in the code are tested through integration
tests, though the test suite is very thorough. Many tests are driven
through the <code class="docutils literal notranslate"><span class="pre">qpdf</span></code> CLI. Others are driven through other files in
the <code class="docutils literal notranslate"><span class="pre">qpdf</span></code> directory, especially <code class="docutils literal notranslate"><span class="pre">test_driver.cc</span></code> and
<code class="docutils literal notranslate"><span class="pre">qpdf-ctest.c</span></code>. These programs only use the public API.</p></li>
<li><p>In some cases, there are true “unit tests”, but they are exercised
through various stand-alone programs that exercise the library in
particular ways, including some that have access to library
internals. These are in the <code class="docutils literal notranslate"><span class="pre">libtests</span></code> directory.</p></li>
</ul>
<section id="coverage">
<h4>Coverage<a class="headerlink" href="#coverage" title="Permalink to this heading"></a></h4>
<p>You wil see calls to <code class="docutils literal notranslate"><span class="pre">QTC::TC</span></code> throughout the code. This is a
“manual coverage” system described in depth in the qtest documentation
linked above. It works by ensuring that <code class="docutils literal notranslate"><span class="pre">QTC::TC</span></code> is called sometime
during the test in each configured way. In brief:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">QTC::TC</span></code> takes two mandatory options and an optional one:</p>
<ul>
<li><p>The first two arguments must be <em>string literals</em>. This is because
<code class="docutils literal notranslate"><span class="pre">qtest</span></code> finds coverage cases lexically.</p></li>
<li><p>The first argument is the scope name, usually <code class="docutils literal notranslate"><span class="pre">qpdf</span></code>. This means
there is a <code class="docutils literal notranslate"><span class="pre">qpdf.testcov</span></code> file in the source directory.</p></li>
<li><p>The second argument is a case name. Each case name appears in
<code class="docutils literal notranslate"><span class="pre">qpdf.testcov</span></code> with a number after it, usually <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p></li>
<li><p>If the third argument is present, it is a number. <code class="docutils literal notranslate"><span class="pre">qtest</span></code>
ensures that the <code class="docutils literal notranslate"><span class="pre">QTC::TC</span></code> is called for that scope and case at
least once with the third argument set to every value from <code class="docutils literal notranslate"><span class="pre">0</span></code>
to <code class="docutils literal notranslate"><span class="pre">n</span></code> inclusive, where <code class="docutils literal notranslate"><span class="pre">n</span></code> is the number after the coverage
call.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">QTC::TC</span></code> does nothing unless certain environment variables are
set. Therefore, <code class="docutils literal notranslate"><span class="pre">QTC:TC</span></code> calls should have no side effects. (In
some languages, they may be disabled at compile-time, though qpdf
does not actually do this.)</p></li>
</ul>
<p>So, for example, if you have this code:</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="n">QTC</span><span class="o">::</span><span class="n">TC</span><span class="p">(</span><span class="s">&quot;qpdf&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;QPDF eof skipping spaces before xref&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">skipped_space</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<p>and this line in <cite>qpdf.testcov</cite>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>QPDF eof skipping spaces before xref 1
</pre></div>
</div>
<p>the test suite will only pass if that line of code was called at least
once with <code class="docutils literal notranslate"><span class="pre">skipped_space</span> <span class="pre">==</span> <span class="pre">0</span></code> and at least once with <code class="docutils literal notranslate"><span class="pre">skipped_space</span>
<span class="pre">==</span> <span class="pre">1</span></code>.</p>
<p>The manual coverage approach ensures the reader that certain
conditions were covered in testing. Use of <code class="docutils literal notranslate"><span class="pre">QTC::TC</span></code> is only part of
the overall strategy.</p>
<p>I do not require testing on pull requests, but they are appreciated,
and I will not merge any code that is not tested. Often someone will
submit a pull request that is not adequately tested but is a good
contribution. In those cases, I will often take the code, add it with
tests, and accept the changes that way rather than merging the pull
request as submitted.</p>
</section>
</section>
<section id="personal-comments">
<h3>Personal Comments<a class="headerlink" href="#personal-comments" title="Permalink to this heading"></a></h3>
<p>QPDF started as a work project in 2002. The first open source release
was in 2008. While there have been a handful of contributors, the vast
majority of the code was written by one person over many years as a
side project.</p>
<p>I maintain a very strong commitment to backward compatibility. As
such, there are many aspects of the code that are showing their age.
While I believe the codebase to have high quality, there are things
that I would do differently if I were doing them from scratch today.
Sometimes people will suggest changes that I like but can’t accept for
backward compatibility reasons.</p>
<p>While I welcome contributions and am eager to collaborate with
contributors, I have a high bar. I only accept things I’m willing to
maintain over the long haul, and I am happy to help people get
submissions into that state.</p>
</section>
</section>
<span id="document-design"></span><section id="design-and-library-notes">
<span id="design"></span><h2>Design and Library Notes<a class="headerlink" href="#design-and-library-notes" title="Permalink to this heading"></a></h2>
<section id="introduction">
<span id="design-intro"></span><h3>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h3>
<p>This section was written prior to the implementation of the qpdf
library and was subsequently modified to reflect the implementation.
In some cases, for purposes of explanation, it may differ slightly
from the actual implementation. As always, the source code and test
suite are authoritative. Even if there are some errors, this document
should serve as a road map to understanding how this code works.</p>
<p>In general, one should adhere strictly to a specification when writing
but be liberal in reading. This way, the product of our software will
be accepted by the widest range of other programs, and we will accept
the widest range of input files. This library attempts to conform to
that philosophy whenever possible but also aims to provide strict
checking for people who want to validate PDF files. If you don’t want
to see warnings and are trying to write something that is tolerant,
you can call <code class="docutils literal notranslate"><span class="pre">setSuppressWarnings(true)</span></code>. If you want to fail on the
first error, you can call <code class="docutils literal notranslate"><span class="pre">setAttemptRecovery(false)</span></code>. The default
behavior is to generating warnings for recoverable problems. Note that
recovery will not always produce the desired results even if it is
able to get through the file. Unlike most other PDF files that produce
generic warnings such as “This file is damaged,” qpdf generally issues
a detailed error message that would be most useful to a PDF developer.
This is by design as there seems to be a shortage of PDF validation
tools out there. This was, in fact, one of the major motivations
behind the initial creation of qpdf. That said, qpdf is not a strict
PDF checker. There are many ways in which a PDF file can be out of
conformance to the spec that qpdf doesn’t notice or report.</p>
</section>
<section id="design-goals">
<span id="id1"></span><h3>Design Goals<a class="headerlink" href="#design-goals" title="Permalink to this heading"></a></h3>
<p>The qpdf library includes support for reading and rewriting PDF files.
It aims to hide from the user details involving object locations,
modified (appended) PDF files, use of object streams, and stream
filters including encryption. It does not aim to hide knowledge of the
object hierarchy or content stream contents. Put another way, a user
of the qpdf library is expected to have knowledge about how PDF files
work, but is not expected to have to keep track of bookkeeping details
such as file positions.</p>
<p>When accessing objects, a user of the library never has to care
whether an object is direct or indirect as all access to objects deals
with this transparently. All memory management details are also
handled by the library. When modifying objects, it is possible to
determine whether an object is indirect and to make copies of the
object if needed.</p>
<p>Memory is managed mostly with <code class="docutils literal notranslate"><span class="pre">std::shared_ptr</span></code> object to minimize
explicit memory handling. This library also makes use of a technique
for giving fine-grained access to methods in one class to other
classes by using public subclasses with friends and only private
members that in turn call private methods of the containing class. See
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::Factory</span></code> as an example.</p>
<p>The top-level qpdf class is <code class="docutils literal notranslate"><span class="pre">QPDF</span></code>. A <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object represents a PDF
file. The library provides methods for both accessing and mutating PDF
files.</p>
<p>The primary class for interacting with PDF objects is
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>. Instances of this class can be passed around by
value, copied, stored in containers, etc. with very low overhead. The
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> object contains an internal shared pointer to the
underlying object. Instances of <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> created by
reading from a file will always contain a reference back to the
<code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object from which they were created. A <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>
may be direct or indirect. If indirect, object is initially
<em>unresolved</em>. In this case, the first attempt to access the underlying
object will result in the object being resolved via a call to the
referenced <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> instance. This makes it essentially impossible to
make coding errors in which certain things will work for some PDF
files and not for others based on which objects are direct and which
objects are indirect. In cases where it is necessary to know whether
an object is indirect or not, this information can be obtained from
the <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>. It is also possible to convert direct
objects to indirect objects and vice versa.</p>
<p>Instances of <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> can be directly created and modified
using static factory methods in the <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> class. There
are factory methods for each type of object as well as a convenience
method <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::parse</span></code> that creates an object from a
string representation of the object. The <code class="docutils literal notranslate"><span class="pre">_qpdf</span></code> user-defined string
literal is also available, making it possible to create instances of
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> with <code class="docutils literal notranslate"><span class="pre">&quot;(pdf-syntax)&quot;_qpdf</span></code>. Existing instances
of <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> can also be modified in several ways. See
comments in <code class="file docutils literal notranslate"><span class="pre">QPDFObjectHandle.hh</span></code> for details.</p>
<p>An instance of <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> is constructed by using the class’s default
constructor or with <code class="docutils literal notranslate"><span class="pre">QPDF::create()</span></code>. If desired, the <code class="docutils literal notranslate"><span class="pre">QPDF</span></code>
object may be configured with various methods that change its default
behavior. Then the <code class="docutils literal notranslate"><span class="pre">QPDF::processFile</span></code> method is passed the name of
a PDF file, which permanently associates the file with that <code class="docutils literal notranslate"><span class="pre">QPDF</span></code>
object. A password may also be given for access to password-protected
files. <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> does not enforce encryption parameters and will treat
user and owner passwords equivalently. Either password may be used to
access an encrypted file. <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> will allow recovery of a user
password given an owner password. The input PDF file must be seekable.
Output files written by <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> need not be seekable, even when
creating linearized files. During construction, <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> validates the
PDF file’s header, and then reads the cross reference tables and
trailer dictionaries. The <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> class keeps only the first trailer
dictionary though it does read all of them so it can check the
<code class="docutils literal notranslate"><span class="pre">/Prev</span></code> key. <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> class users may request the root object and
the trailer dictionary specifically. The cross reference table is kept
private. Objects may then be requested by number or by walking the
object tree.</p>
<p>When a PDF file has a cross-reference stream instead of a
cross-reference table and trailer, requesting the document’s trailer
dictionary returns the stream dictionary from the cross-reference stream
instead.</p>
<p>There are some convenience routines for very common operations such as
walking the page tree and returning a vector of all page objects. For
full details, please see the header files
<code class="file docutils literal notranslate"><span class="pre">QPDF.hh</span></code> and
<code class="file docutils literal notranslate"><span class="pre">QPDFObjectHandle.hh</span></code>. There are also some
additional helper classes that provide higher level API functions for
certain document constructions. These are discussed in <a class="reference internal" href="#helper-classes"><span class="std std-ref">Helper Classes</span></a>.</p>
</section>
<section id="helper-classes">
<span id="id2"></span><h3>Helper Classes<a class="headerlink" href="#helper-classes" title="Permalink to this heading"></a></h3>
<p>QPDF version 8.1 introduced the concept of helper classes. Helper
classes are intended to contain higher level APIs that allow developers
to work with certain document constructs at an abstraction level above
that of <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> while staying true to qpdf’s philosophy of
not hiding document structure from the developer. As with qpdf in
general, the goal is to take away some of the more tedious bookkeeping
aspects of working with PDF files, not to remove the need for the
developer to understand how the PDF construction in question works. The
driving factor behind the creation of helper classes was to allow the
evolution of higher level interfaces in qpdf without polluting the
interfaces of the main top-level classes <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>.</p>
<p>There are two kinds of helper classes: <em>document</em> helpers and <em>object</em>
helpers. Document helpers are constructed with a reference to a <code class="docutils literal notranslate"><span class="pre">QPDF</span></code>
object and provide methods for working with structures that are at the
document level. Object helpers are constructed with an instance of a
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> and provide methods for working with specific types
of objects.</p>
<p>Examples of document helpers include <code class="docutils literal notranslate"><span class="pre">QPDFPageDocumentHelper</span></code>, which
contains methods for operating on the document’s page trees, such as
enumerating all pages of a document and adding and removing pages; and
<code class="docutils literal notranslate"><span class="pre">QPDFAcroFormDocumentHelper</span></code>, which contains document-level methods
related to interactive forms, such as enumerating form fields and
creating mappings between form fields and annotations.</p>
<p>Examples of object helpers include <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper</span></code> for
performing operations on pages such as page rotation and some operations
on content streams, <code class="docutils literal notranslate"><span class="pre">QPDFFormFieldObjectHelper</span></code> for performing
operations related to interactive form fields, and
<code class="docutils literal notranslate"><span class="pre">QPDFAnnotationObjectHelper</span></code> for working with annotations.</p>
<p>It is always possible to retrieve the underlying <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> reference from
a document helper and the underlying <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> reference from
an object helper. Helpers are designed to be helpers, not wrappers. The
intention is that, in general, it is safe to freely intermix operations
that use helpers with operations that use the underlying objects.
Document and object helpers do not attempt to provide a complete
interface for working with the things they are helping with, nor do they
attempt to encapsulate underlying structures. They just provide a few
methods to help with error-prone, repetitive, or complex tasks. In some
cases, a helper object may cache some information that is expensive to
gather. In such cases, the helper classes are implemented so that their
own methods keep the cache consistent, and the header file will provide
a method to invalidate the cache and a description of what kinds of
operations would make the cache invalid. If in doubt, you can always
discard a helper class and create a new one with the same underlying
objects, which will ensure that you have discarded any stale
information.</p>
<p>By Convention, document helpers are called
<code class="docutils literal notranslate"><span class="pre">QPDFSomethingDocumentHelper</span></code> and are derived from
<code class="docutils literal notranslate"><span class="pre">QPDFDocumentHelper</span></code>, and object helpers are called
<code class="docutils literal notranslate"><span class="pre">QPDFSomethingObjectHelper</span></code> and are derived from <code class="docutils literal notranslate"><span class="pre">QPDFObjectHelper</span></code>.
For details on specific helpers, please see their header files. You can
find them by looking at
<code class="file docutils literal notranslate"><span class="pre">include/qpdf/QPDF*DocumentHelper.hh</span></code> and
<code class="file docutils literal notranslate"><span class="pre">include/qpdf/QPDF*ObjectHelper.hh</span></code>.</p>
<p>In order to avoid creation of circular dependencies, the following
general guidelines are followed with helper classes:</p>
<ul class="simple">
<li><p>Core class interfaces do not know about helper classes. For example,
no methods of <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> or <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> will include helper
classes in their interfaces.</p></li>
<li><p>Interfaces of object helpers will usually not use document helpers in
their interfaces. This is because it is much more useful for document
helpers to have methods that return object helpers. Most operations
in PDF files start at the document level and go from there to the
object level rather than the other way around. It can sometimes be
useful to map back from object-level structures to document-level
structures. If there is a desire to do this, it will generally be
provided by a method in the document helper class.</p></li>
<li><p>Most of the time, object helpers don’t know about other object
helpers. However, in some cases, one type of object may be a
container for another type of object, in which case it may make sense
for the outer object to know about the inner object. For example,
there are methods in the <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper</span></code> that know
<code class="docutils literal notranslate"><span class="pre">QPDFAnnotationObjectHelper</span></code> because references to annotations are
contained in page dictionaries.</p></li>
<li><p>Any helper or core library class may use helpers in their
implementations.</p></li>
</ul>
<p>Prior to qpdf version 8.1, higher level interfaces were added as
“convenience functions” in either <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> or <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>. For
compatibility, older convenience functions for operating with pages will
remain in those classes even as alternatives are provided in helper
classes. Going forward, new higher level interfaces will be provided
using helper classes.</p>
</section>
<section id="implementation-notes">
<span id="id3"></span><h3>Implementation Notes<a class="headerlink" href="#implementation-notes" title="Permalink to this heading"></a></h3>
<p>This section contains a few notes about QPDF’s internal implementation,
particularly around what it does when it first processes a file. This
section is a bit of a simplification of what it actually does, but it
could serve as a starting point to someone trying to understand the
implementation. There is nothing in this section that you need to know
to use the qpdf library.</p>
<p>In a PDF file, objects may be direct or indirect. Direct objects are
objects whose representations appear directly in PDF syntax. Indirect
objects are references to objects by their ID. The qpdf library uses
the <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> type to hold onto objects and to abstract
away in most cases whether the object is direct or indirect.</p>
<p>Internally, <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> holds onto a shared pointer to the
underlying object value. When a direct object is created
programmatically by client code (rather than being read from the
file), the <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> that holds it is not associated with a
<code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object. When an indirect object reference is created, it
starts off in an <em>unresolved</em> state and must be associated with a
<code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object, which is considered its <em>owner</em>. To access the actual
value of the object, the object must be <em>resolved</em>. This happens
automatically when the the object is accessed in any way.</p>
<p>To resolve an object, qpdf checks its object cache. If not found in
the cache, it attempts to read the object from the input source
associated with the <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object. If it is not found, a <code class="docutils literal notranslate"><span class="pre">null</span></code>
object is returned. A <code class="docutils literal notranslate"><span class="pre">null</span></code> object is an object type, just like
boolean, string, number, etc. It is not a null pointer. The PDF
specification states that an indirect reference to an object that
doesn’t exist is to be treated as a <code class="docutils literal notranslate"><span class="pre">null</span></code>. The resulting object,
whether a <code class="docutils literal notranslate"><span class="pre">null</span></code> or the actual object that was read, is stored in
the cache. If the object is later replaced or swapped, the underlying
object remains the same, but its value is replaced. This way, if you
have a <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> to an indirect object and the object by
that number is replaced (by calling <code class="docutils literal notranslate"><span class="pre">QPDF::replaceObject</span></code> or
<code class="docutils literal notranslate"><span class="pre">QPDF::swapObjects</span></code>), your <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> will reflect the new
value of the object. This is consistent with what would happen to PDF
objects if you were to replace the definition of an object in the
file.</p>
<p>When reading an object from the input source, if the requested object
is inside of an object stream, the object stream itself is first read
into memory. Then the tokenizer reads objects from the memory stream
based on the offset information stored in the stream. Those individual
objects are cached, after which the temporary buffer holding the
object stream contents is discarded. In this way, the first time an
object in an object stream is requested, all objects in the stream are
cached.</p>
<p>The following example should clarify how <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> processes a simple
file.</p>
<ul class="simple">
<li><p>Client constructs <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> <code class="docutils literal notranslate"><span class="pre">pdf</span></code> and calls
<code class="docutils literal notranslate"><span class="pre">pdf.processFile(&quot;a.pdf&quot;);</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> class checks the beginning of
<code class="file docutils literal notranslate"><span class="pre">a.pdf</span></code> for a PDF header. It then reads the
cross reference table mentioned at the end of the file, ensuring that
it is looking before the last <code class="docutils literal notranslate"><span class="pre">%%EOF</span></code>. After getting to <code class="docutils literal notranslate"><span class="pre">trailer</span></code>
keyword, it invokes the parser.</p></li>
<li><p>The parser sees <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code>, so it changes state and starts accumulating
the keys and values of the dictionary.</p></li>
<li><p>In dictionary creation mode, the parser keeps accumulating objects
until it encounters <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code>. Each object that is read is pushed onto
a stack. If <code class="docutils literal notranslate"><span class="pre">R</span></code> is read, the last two objects on the stack are
inspected. If they are integers, they are popped off the stack and
their values are used to obtain an indirect object handle from the
<code class="docutils literal notranslate"><span class="pre">QPDF</span></code> class. The <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> class consults its cache, and if
necessary, inserts a new unresolved object, and returns an object
handle pointing to the cache entry, which is then pushed onto the
stack. When <code class="docutils literal notranslate"><span class="pre">&gt;&gt;</span></code> is finally read, the stack is converted into a
<code class="docutils literal notranslate"><span class="pre">QPDF_Dictionary</span></code> (not directly accessible through the API) which
is placed in a <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> and returned.</p></li>
<li><p>The resulting dictionary is saved as the trailer dictionary.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">/Prev</span></code> key is searched. If present, <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> seeks to that
point and repeats except that the new trailer dictionary is not
saved. If <code class="docutils literal notranslate"><span class="pre">/Prev</span></code> is not present, the initial parsing process is
complete.</p></li>
<li><p>If there is an encryption dictionary, the document’s encryption
parameters are initialized.</p></li>
<li><p>The client requests the root object by getting the value of the
<code class="docutils literal notranslate"><span class="pre">/Root</span></code> key from trailer dictionary and returns it. It is an
unresolved indirect <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>.</p></li>
<li><p>The client requests the <code class="docutils literal notranslate"><span class="pre">/Pages</span></code> key from root
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>. The <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> notices that it is an
unresolved indirect object, so it asks <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> to resolve it.
<code class="docutils literal notranslate"><span class="pre">QPDF</span></code> checks the cross reference table, gets the offset, and
reads the object present at that offset. The object cache entry’s
<code class="docutils literal notranslate"><span class="pre">unresolved</span></code> value is replaced by the actual value, which causes
any previously unresolved <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> objects that pointed
there to now have a shared copy of the actual object. Modifications
through any such <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> will be reflected in all of
them. As the client continues to request objects, the same process
is followed for each new requested object.</p></li>
</ul>
</section>
<section id="qpdf-object-internals">
<span id="object-internals"></span><h3>QPDF Object Internals<a class="headerlink" href="#qpdf-object-internals" title="Permalink to this heading"></a></h3>
<p>The internals of <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> and how qpdf stores objects were
significantly rewritten for QPDF 11. Here are some additional details.</p>
<section id="id4">
<h4>Object Internals<a class="headerlink" href="#id4" title="Permalink to this heading"></a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object has an object cache which contains a shared
pointer to each object that was read from the file or added as an
indirect object. Changes can be made to any of those objects through
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> methods. Any such changes are visible to all
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> instances that point to the same object. When a
<code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object is written by <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> or serialized to JSON,
any changes are reflected.</p>
</section>
<section id="objects-in-qpdf-11-and-newer">
<h4>Objects in qpdf 11 and Newer<a class="headerlink" href="#objects-in-qpdf-11-and-newer" title="Permalink to this heading"></a></h4>
<p>The object cache in <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> contains a shared pointer to
<code class="docutils literal notranslate"><span class="pre">QPDFObject</span></code>. Any <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> resolved from an indirect
reference to that object has a copy of that shared pointer. Each
<code class="docutils literal notranslate"><span class="pre">QPDFObject</span></code> object contains a shared pointer to an object of type
<code class="docutils literal notranslate"><span class="pre">QPDFValue</span></code>. The <code class="docutils literal notranslate"><span class="pre">QPDFValue</span></code> type is an abstract base class. There
is an implementation for each of the basic object types (array,
dictionary, null, boolean, string, number, etc.) as well as a few
special ones including <code class="docutils literal notranslate"><span class="pre">uninitialized</span></code>, <code class="docutils literal notranslate"><span class="pre">unresolved</span></code>,
<code class="docutils literal notranslate"><span class="pre">reserved</span></code>, and <code class="docutils literal notranslate"><span class="pre">destroyed</span></code>. When an object is first created,
its underlying <code class="docutils literal notranslate"><span class="pre">QPDFValue</span></code> has type <code class="docutils literal notranslate"><span class="pre">unresolved</span></code>. When the object
is first accessed, the <code class="docutils literal notranslate"><span class="pre">QPDFObject</span></code> in the cache has its internal
<code class="docutils literal notranslate"><span class="pre">QPDFValue</span></code> replaced with the object as read from the file. Since it
is the <code class="docutils literal notranslate"><span class="pre">QPDFObject</span></code> object that is shared by all referencing
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> objects as well as by the owning <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object,
this ensures that any future changes to the object, including
replacing the object with a completely different one by calling
<code class="docutils literal notranslate"><span class="pre">QPDF::replaceObject</span></code> or <code class="docutils literal notranslate"><span class="pre">QPDF::swapObjects</span></code>, will be
reflected across all <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> objects that reference it.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">QPDFValue</span></code> that originated from a PDF input source maintains a
pointer to the <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object that read it (its <em>owner</em>). When that
<code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object is destroyed, it disconnects all objects reachable
from it by clearing their owner. For indirect objects (all objects in
the object cache), it also replaces the object’s value with an object
of type <code class="docutils literal notranslate"><span class="pre">destroyed</span></code>. This means that, if there are still any
referencing <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> objects floating around, requesting
their owning <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> will return a null pointer rather than a pointer
to a <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object that is either invalid or points to something
else, and any attempt to access an indirect object that is associated
with a destroyed <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object will throw an exception. This
operation also has the effect of breaking any circular references
(which are common and, in some cases, required by the PDF
specification), thus preventing memory leaks when <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> objects are
destroyed.</p>
</section>
<section id="objects-prior-to-qpdf-11">
<h4>Objects prior to qpdf 11<a class="headerlink" href="#objects-prior-to-qpdf-11" title="Permalink to this heading"></a></h4>
<p>Prior to qpdf 11, the functionality of the <code class="docutils literal notranslate"><span class="pre">QPDFValue</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFObject</span></code> classes were contained in a single <code class="docutils literal notranslate"><span class="pre">QPDFObject</span></code>
class, which served the dual purpose of being the cache entry for
<code class="docutils literal notranslate"><span class="pre">QPDF</span></code> and being the abstract base class for all the different PDF
object types. The behavior was nearly the same, but there were some
problems:</p>
<ul class="simple">
<li><p>While changes to a <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> through mutation were
visible across all referencing <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> objects,
<em>replacing</em> an object with <code class="docutils literal notranslate"><span class="pre">QPDF::replaceObject</span></code> or
<code class="docutils literal notranslate"><span class="pre">QPDF::swapObjects</span></code> would leave <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> with no way of notifying
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> objects that pointed to the old <code class="docutils literal notranslate"><span class="pre">QPDFObject</span></code>.
To work around this, every attempt to access the underlying object
that a <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> pointed to had to ask the owning
<code class="docutils literal notranslate"><span class="pre">QPDF</span></code> whether the object had changed, and if so, it had to
replace its internal <code class="docutils literal notranslate"><span class="pre">QPDFObject</span></code> pointer. This added overhead to
every indirect object access even if no objects were ever changed.</p></li>
<li><p>When a <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object was destroyed, any <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>
objects that referenced it would maintain a potentially invalid
pointer as the owning <code class="docutils literal notranslate"><span class="pre">QPDF</span></code>. In practice, this wasn’t usually a
problem since generally people would have no need to maintain copies
of a <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> from a destroyed <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object, but
in cases where this was possible, it was necessary for other
software to do its own bookkeeping to ensure that an object’s owner
was still valid.</p></li>
</ul>
<p>These problems were solved by splitting <code class="docutils literal notranslate"><span class="pre">QPDFObject</span></code> into
<code class="docutils literal notranslate"><span class="pre">QPDFObject</span></code> and <code class="docutils literal notranslate"><span class="pre">QPDFValue</span></code>.</p>
</section>
</section>
<section id="casting-policy">
<span id="casting"></span><h3>Casting Policy<a class="headerlink" href="#casting-policy" title="Permalink to this heading"></a></h3>
<p>This section describes the casting policy followed by qpdf’s
implementation. This is no concern to qpdf’s end users and largely of no
concern to people writing code that uses qpdf, but it could be of
interest to people who are porting qpdf to a new platform or who are
making modifications to the code.</p>
<p>The C++ code in qpdf is free of old-style casts except where unavoidable
(e.g. where the old-style cast is in a macro provided by a third-party
header file). When there is a need for a cast, it is handled, in order
of preference, by rewriting the code to avoid the need for a cast,
calling <code class="docutils literal notranslate"><span class="pre">const_cast</span></code>, calling <code class="docutils literal notranslate"><span class="pre">static_cast</span></code>, calling
<code class="docutils literal notranslate"><span class="pre">reinterpret_cast</span></code>, or calling some combination of the above. As a
last resort, a compiler-specific <code class="docutils literal notranslate"><span class="pre">#pragma</span></code> may be used to suppress a
warning that we don’t want to fix. Examples may include suppressing
warnings about the use of old-style casts in code that is shared between
C and C++ code.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">QIntC</span></code> namespace, provided by
<code class="file docutils literal notranslate"><span class="pre">include/qpdf/QIntC.hh</span></code>, implements safe
functions for converting between integer types. These functions do range
checking and throw a <code class="docutils literal notranslate"><span class="pre">std::range_error</span></code>, which is subclass of
<code class="docutils literal notranslate"><span class="pre">std::runtime_error</span></code>, if conversion from one integer type to another
results in loss of information. There are many cases in which we have to
move between different integer types because of incompatible integer
types used in interoperable interfaces. Some are unavoidable, such as
moving between sizes and offsets, and others are there because of old
code that is too in entrenched to be fixable without breaking source
compatibility and causing pain for users. QPDF is compiled with extra
warnings to detect conversions with potential data loss, and all such
cases should be fixed by either using a function from <code class="docutils literal notranslate"><span class="pre">QIntC</span></code> or a
<code class="docutils literal notranslate"><span class="pre">static_cast</span></code>.</p>
<p>When the intention is just to switch the type because of exchanging data
between incompatible interfaces, use <code class="docutils literal notranslate"><span class="pre">QIntC</span></code>. This is the usual case.
However, there are some cases in which we are explicitly intending to
use the exact same bit pattern with a different type. This is most
common when switching between signed and unsigned characters. A lot of
qpdf’s code uses unsigned characters internally, but <code class="docutils literal notranslate"><span class="pre">std::string</span></code> and
<code class="docutils literal notranslate"><span class="pre">char</span></code> are signed. Using <code class="docutils literal notranslate"><span class="pre">QIntC::to_char</span></code> would be wrong for
converting from unsigned to signed characters because a negative
<code class="docutils literal notranslate"><span class="pre">char</span></code> value and the corresponding <code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span></code> value greater
than 127 <em>mean the same thing</em>. There are also
cases in which we use <code class="docutils literal notranslate"><span class="pre">static_cast</span></code> when working with bit fields where
we are not representing a numerical value but rather a bunch of bits
packed together in some integer type. Also note that <code class="docutils literal notranslate"><span class="pre">size_t</span></code> and
<code class="docutils literal notranslate"><span class="pre">long</span></code> both typically differ between 32-bit and 64-bit environments,
so sometimes an explicit cast may not be needed to avoid warnings on one
platform but may be needed on another. A conversion with <code class="docutils literal notranslate"><span class="pre">QIntC</span></code>
should always be used when the types are different even if the
underlying size is the same. QPDF’s automatic build builds on 32-bit
and 64-bit platforms, and the test suite is very thorough, so it is
hard to make any of the potential errors here without being caught in
build or test.</p>
</section>
<section id="encryption">
<span id="id5"></span><h3>Encryption<a class="headerlink" href="#encryption" title="Permalink to this heading"></a></h3>
<p>Encryption is supported transparently by qpdf. When opening a PDF file,
if an encryption dictionary exists, the <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object processes this
dictionary using the password (if any) provided. The primary decryption
key is computed and cached. No further access is made to the encryption
dictionary after that time. When an object is read from a file, the
object ID and generation of the object in which it is contained is
always known. Using this information along with the stored encryption
key, all stream and string objects are transparently decrypted. Raw
encrypted objects are never stored in memory. This way, nothing in the
library ever has to know or care whether it is reading an encrypted
file.</p>
<p>An interface is also provided for writing encrypted streams and strings
given an encryption key. This is used by <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> when it rewrites
encrypted files.</p>
<p>When copying encrypted files, unless otherwise directed, qpdf will
preserve any encryption in effect in the original file. qpdf can do
this with either the user or the owner password. There is no
difference in capability based on which password is used. When 40 or
128 bit encryption keys are used, the user password can be recovered
with the owner password. With 256 keys, the user and owner passwords
are used independently to encrypt the actual encryption key, so while
either can be used, the owner password can no longer be used to
recover the user password.</p>
<p>Starting with version 4.0.0, qpdf can read files that are not encrypted
but that contain encrypted attachments, but it cannot write such files.
qpdf also requires the password to be specified in order to open the
file, not just to extract attachments, since once the file is open, all
decryption is handled transparently. When copying files like this while
preserving encryption, qpdf will apply the file’s encryption to
everything in the file, not just to the attachments. When decrypting the
file, qpdf will decrypt the attachments. In general, when copying PDF
files with multiple encryption formats, qpdf will choose the newest
format. The only exception to this is that clear-text metadata will be
preserved as clear-text if it is that way in the original file.</p>
<p>One point of confusion some people have about encrypted PDF files is
that encryption is not the same as password protection.
Password-protected files are always encrypted, but it is also possible
to create encrypted files that do not have passwords. Internally, such
files use the empty string as a password, and most readers try the
empty string first to see if it works and prompt for a password only
if the empty string doesn’t work. Normally such files have an empty
user password and a non-empty owner password. In that way, if the file
is opened by an ordinary reader without specification of password, the
restrictions specified in the encryption dictionary can be enforced.
Most users wouldn’t even realize such a file was encrypted. Since qpdf
always ignores the restrictions (except for the purpose of reporting
what they are), qpdf doesn’t care which password you use. QPDF will
allow you to create PDF files with non-empty user passwords and empty
owner passwords. Some readers will require a password when you open
these files, and others will open the files without a password and not
enforce restrictions. Having a non-empty user password and an empty
owner password doesn’t really make sense because it would mean that
opening the file with the user password would be more restrictive than
not supplying a password at all. QPDF also allows you to create PDF
files with the same password as both the user and owner password. Some
readers will not ever allow such files to be accessed without
restrictions because they never try the password as the owner password
if it works as the user password. Nonetheless, one of the powerful
aspects of qpdf is that it allows you to finely specify the way
encrypted files are created, even if the results are not useful to
some readers. One use case for this would be for testing a PDF reader
to ensure that it handles odd configurations of input files. If you
attempt to create an encrypted file that is not secure, qpdf will warn
you and require you to explicitly state your intention to create an
insecure file. So while qpdf can create insecure files, it won’t let
you do it by mistake.</p>
</section>
<section id="random-number-generation">
<span id="random-numbers"></span><h3>Random Number Generation<a class="headerlink" href="#random-number-generation" title="Permalink to this heading"></a></h3>
<p>QPDF generates random numbers to support generation of encrypted data.
Starting in qpdf 10.0.0, qpdf uses the crypto provider as its source of
random numbers. Older versions used the OS-provided source of secure
random numbers or, if allowed at build time, insecure random numbers
from stdlib. Starting with version 5.1.0, you can disable use of
OS-provided secure random numbers at build time. This is especially
useful on Windows if you want to avoid a dependency on Microsoft’s
cryptography API. You can also supply your own random data provider. For
details on how to do this, please refer to the top-level README.md file
in the source distribution and to comments in
<code class="file docutils literal notranslate"><span class="pre">QUtil.hh</span></code>.</p>
</section>
<section id="adding-and-removing-pages">
<span id="adding-and-remove-pages"></span><h3>Adding and Removing Pages<a class="headerlink" href="#adding-and-removing-pages" title="Permalink to this heading"></a></h3>
<p>While qpdf’s API has supported adding and modifying objects for some
time, version 3.0 introduces specific methods for adding and removing
pages. These are largely convenience routines that handle two tricky
issues: pushing inheritable resources from the <code class="docutils literal notranslate"><span class="pre">/Pages</span></code> tree down to
individual pages and manipulation of the <code class="docutils literal notranslate"><span class="pre">/Pages</span></code> tree itself. For
details, see <code class="docutils literal notranslate"><span class="pre">addPage</span></code> and surrounding methods in
<code class="file docutils literal notranslate"><span class="pre">QPDF.hh</span></code>.</p>
</section>
<section id="reserving-object-numbers">
<span id="reserved-objects"></span><h3>Reserving Object Numbers<a class="headerlink" href="#reserving-object-numbers" title="Permalink to this heading"></a></h3>
<p>Version 3.0 of qpdf introduced the concept of reserved objects. These
are seldom needed for ordinary operations, but there are cases in which
you may want to add a series of indirect objects with references to each
other to a <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object. This causes a problem because you can’t
determine the object ID that a new indirect object will have until you
add it to the <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object with <code class="docutils literal notranslate"><span class="pre">QPDF::makeIndirectObject</span></code>. The
only way to add two mutually referential objects to a <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object
prior to version 3.0 would be to add the new objects first and then make
them refer to each other after adding them. Now it is possible to create
a <em>reserved object</em> using
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::newReserved</span></code>. This is an indirect object that stays
“unresolved” even if it is queried for its type. So now, if you want to
create a set of mutually referential objects, you can create
reservations for each one of them and use those reservations to
construct the references. When finished, you can call
<code class="docutils literal notranslate"><span class="pre">QPDF::replaceReserved</span></code> to replace the reserved objects with the real
ones. This functionality will never be needed by most applications, but
it is used internally by QPDF when copying objects from other PDF files,
as discussed in <a class="reference internal" href="#foreign-objects"><span class="std std-ref">Copying Objects From Other PDF Files</span></a>. For an example of how to use reserved
objects, search for <code class="docutils literal notranslate"><span class="pre">newReserved</span></code> in
<code class="file docutils literal notranslate"><span class="pre">test_driver.cc</span></code> in qpdf’s sources.</p>
</section>
<section id="copying-objects-from-other-pdf-files">
<span id="foreign-objects"></span><h3>Copying Objects From Other PDF Files<a class="headerlink" href="#copying-objects-from-other-pdf-files" title="Permalink to this heading"></a></h3>
<p>Version 3.0 of qpdf introduced the ability to copy objects into a
<code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object from a different <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object, which we refer to as
<em>foreign objects</em>. This allows arbitrary merging of PDF files. The
<strong class="command">qpdf</strong> command-line tool provides limited support for basic
page selection, including merging in pages from other files, but the
library’s API makes it possible to implement arbitrarily complex
merging operations. The main method for copying foreign objects is
<code class="docutils literal notranslate"><span class="pre">QPDF::copyForeignObject</span></code>. This takes an indirect object from
another <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> and copies it recursively into this object while
preserving all object structure, including circular references. This
means you can add a direct object that you create from scratch to a
<code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object with <code class="docutils literal notranslate"><span class="pre">QPDF::makeIndirectObject</span></code>, and you can add an
indirect object from another file with <code class="docutils literal notranslate"><span class="pre">QPDF::copyForeignObject</span></code>.
The fact that <code class="docutils literal notranslate"><span class="pre">QPDF::makeIndirectObject</span></code> does not automatically
detect a foreign object and copy it is an explicit design decision.
Copying a foreign object seems like a sufficiently significant thing
to do that it should be done explicitly.</p>
<p>The other way to copy foreign objects is by passing a page from one
<code class="docutils literal notranslate"><span class="pre">QPDF</span></code> to another by calling <code class="docutils literal notranslate"><span class="pre">QPDF::addPage</span></code>. In contrast to
<code class="docutils literal notranslate"><span class="pre">QPDF::makeIndirectObject</span></code>, this method automatically distinguishes
between indirect objects in the current file, foreign objects, and
direct objects.</p>
<p>When you copy objects from one <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> to another, the input source
of the original file remain valid until you have finished with the
destination object. This is because the input source is still used
to retrieve any referenced stream data from the copied object. If
needed, there are methods to force the data to be copied. See comments
near the declaration of <code class="docutils literal notranslate"><span class="pre">copyForeignObject</span></code> in
<code class="file docutils literal notranslate"><span class="pre">include/qpdf/QPDF.hh</span></code> for details.</p>
</section>
<section id="writing-pdf-files">
<span id="rewriting"></span><h3>Writing PDF Files<a class="headerlink" href="#writing-pdf-files" title="Permalink to this heading"></a></h3>
<p>The qpdf library supports file writing of <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> objects to PDF
files through the <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> class. The <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> class has
two writing modes: one for non-linearized files, and one for
linearized files. See <a class="reference internal" href="index.html#linearization"><span class="std std-ref">Linearization</span></a> for a description of
linearization is implemented. This section describes how we write
non-linearized files including the creation of QDF files (see
<a class="reference internal" href="index.html#qdf"><span class="std std-ref">QDF Mode</span></a>).</p>
<p>This outline was written prior to implementation and is not exactly
accurate, but it portrays the essence of how writing works. Look at
the code in <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> for exact details.</p>
<ul>
<li><p>Initialize state:</p>
<ul class="simple">
<li><p>next object number = 1</p></li>
<li><p>object queue = empty</p></li>
<li><p>renumber table: old object id/generation to new id/0 = empty</p></li>
<li><p>xref table: new id -&gt; offset = empty</p></li>
</ul>
</li>
<li><p>Create a <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object from a file.</p></li>
<li><p>Write header for new PDF file.</p></li>
<li><p>Request the trailer dictionary.</p></li>
<li><p>For each value that is an indirect object, grab the next object
number (via an operation that returns and increments the number). Map
object to new number in renumber table. Push object onto queue.</p></li>
<li><p>While there are more objects on the queue:</p>
<ul>
<li><p>Pop queue.</p></li>
<li><p>Look up object’s new number <em>n</em> in the renumbering table.</p></li>
<li><p>Store current offset into xref table.</p></li>
<li><p>Write <code class="docutils literal notranslate"><span class="pre">:samp:`{n}`</span> <span class="pre">0</span> <span class="pre">obj</span></code>.</p></li>
<li><p>If object is null, whether direct or indirect, write out null,
thus eliminating unresolvable indirect object references.</p></li>
<li><p>If the object is a stream stream, write stream contents, piped
through any filters as required, to a memory buffer. Use this
buffer to determine the stream length.</p></li>
<li><p>If object is not a stream, array, or dictionary, write out its
contents.</p></li>
<li><p>If object is an array or dictionary (including stream), traverse
its elements (for array) or values (for dictionaries), handling
recursive dictionaries and arrays, looking for indirect objects.
When an indirect object is found, if it is not resolvable, ignore.
(This case is handled when writing it out.) Otherwise, look it up
in the renumbering table. If not found, grab the next available
object number, assign to the referenced object in the renumbering
table, and push the referenced object onto the queue. As a special
case, when writing out a stream dictionary, replace length,
filters, and decode parameters as required.</p>
<p>Write out dictionary or array, replacing any unresolvable indirect
object references with null (pdf spec says reference to
non-existent object is legal and resolves to null) and any
resolvable ones with references to the renumbered objects.</p>
</li>
<li><p>If the object is a stream, write <code class="docutils literal notranslate"><span class="pre">stream\n</span></code>, the stream contents
(from the memory buffer), and <code class="docutils literal notranslate"><span class="pre">\nendstream\n</span></code>.</p></li>
<li><p>When done, write <code class="docutils literal notranslate"><span class="pre">endobj</span></code>.</p></li>
</ul>
</li>
</ul>
<p>Once we have finished the queue, all referenced objects will have been
written out and all deleted objects or unreferenced objects will have
been skipped. The new cross-reference table will contain an offset for
every new object number from 1 up to the number of objects written. This
can be used to write out a new xref table. Finally we can write out the
trailer dictionary with appropriately computed /ID (see spec, 8.3, File
Identifiers), the cross reference table offset, and <code class="docutils literal notranslate"><span class="pre">%%EOF</span></code>.</p>
</section>
<section id="filtered-streams">
<span id="id6"></span><h3>Filtered Streams<a class="headerlink" href="#filtered-streams" title="Permalink to this heading"></a></h3>
<p>Support for streams is implemented through the <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> interface
which was designed for this library.</p>
<p>When reading streams, create a series of <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> objects. The
<code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> abstract base requires implementation <code class="docutils literal notranslate"><span class="pre">write()</span></code> and
<code class="docutils literal notranslate"><span class="pre">finish()</span></code> and provides an implementation of <code class="docutils literal notranslate"><span class="pre">getNext()</span></code>. Each
pipeline object, upon receiving data, does whatever it is going to do
and then writes the data (possibly modified) to its successor.
Alternatively, a pipeline may be an end-of-the-line pipeline that does
something like store its output to a file or a memory buffer ignoring a
successor. For additional details, look at
<code class="file docutils literal notranslate"><span class="pre">Pipeline.hh</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">QPDF</span></code> can read raw or filtered streams. When reading a filtered
stream, the <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> class creates a <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> object for one of each
appropriate filter object and chains them together. The last filter
should write to whatever type of output is required. The <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> class
has an interface to write raw or filtered stream contents to a given
pipeline.</p>
</section>
<section id="object-accessor-methods">
<span id="object-accessors"></span><h3>Object Accessor Methods<a class="headerlink" href="#object-accessor-methods" title="Permalink to this heading"></a></h3>
<p>For general information about how to access instances of
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>, please see the comments in
<code class="file docutils literal notranslate"><span class="pre">QPDFObjectHandle.hh</span></code>. Search for “Accessor
methods”. This section provides a more in-depth discussion of the
behavior and the rationale for the behavior.</p>
<p><em>Why were type errors made into warnings?</em> When type checks were
introduced into qpdf in the early days, it was expected that type errors
would only occur as a result of programmer error. However, in practice,
type errors would occur with malformed PDF files because of assumptions
made in code, including code within the qpdf library and code written by
library users. The most common case would be chaining calls to
<code class="docutils literal notranslate"><span class="pre">getKey()</span></code> to access keys deep within a dictionary. In many cases,
qpdf would be able to recover from these situations, but the old
behavior often resulted in crashes rather than graceful recovery. For
this reason, the errors were changed to warnings.</p>
<p><em>Why even warn about type errors when the user can’t usually do anything
about them?</em> Type warnings are extremely valuable during development.
Since it’s impossible to catch at compile time things like typos in
dictionary key names or logic errors around what the structure of a PDF
file might be, the presence of type warnings can save lots of developer
time. They have also proven useful in exposing issues in qpdf itself
that would have otherwise gone undetected.</p>
<p><em>Can there be a type-safe</em> <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>? At the time of the
release of qpdf 11, there is active work being done toward the goal of
creating a way to work with PDF objects that is more type-safe and
closer in feel to the current C++ standard library. It is hoped that
this work will make it easier to write bindings to qpdf in modern
languages like <a class="reference external" href="https://www.rust-lang.org/">Rust</a>. If this happens,
it will likely be by providing an alternative to <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>
that provides a separate path to the underlying object. Details are
still being worked out. Fundamentally, PDF objects are not strongly
typed. They are similar to <code class="docutils literal notranslate"><span class="pre">JSON</span></code> objects or to objects in dynamic
languages like <a class="reference external" href="https://python.org/">Python</a>: there are certain
things you can only do to objects of a given type, but you can replace
an object of one type with an object of another. Because of this,
there will always be some checks that will happen at runtime.</p>
<p><em>Why does the behavior of a type exception differ between the C and C++
API?</em> There is no way to throw and catch exceptions in C short of
something like <code class="docutils literal notranslate"><span class="pre">setjmp</span></code> and <code class="docutils literal notranslate"><span class="pre">longjmp</span></code>, and that approach is not
portable across language barriers. Since the C API is often used from
other languages, it’s important to keep things as simple as possible.
Starting in qpdf 10.5, exceptions that used to crash code using the C
API will be written to stderr by default, and it is possible to register
an error handler. There’s no reason that the error handler can’t
simulate exception handling in some way, such as by using <code class="docutils literal notranslate"><span class="pre">setjmp</span></code> and
<code class="docutils literal notranslate"><span class="pre">longjmp</span></code> or by setting some variable that can be checked after
library calls are made. In retrospect, it might have been better if the
C API object handle methods returned error codes like the other methods
and set return values in passed-in pointers, but this would complicate
both the implementation and the use of the library for a case that is
actually quite rare and largely avoidable.</p>
<p><em>How can I avoid type warnings altogether?</em> For each
<code class="docutils literal notranslate"><span class="pre">getSomethingValue</span></code> accessor that returns a value of the requested
type and issues a warning for objects of the wrong type, there is also
a <code class="docutils literal notranslate"><span class="pre">getValueAsSomething</span></code> method (since qpdf 10.6) that returns false
for objects of the wrong type and otherwise returns true and
initializes a reference. These methods never generate type warnings
and provide an alternative to explicitly checking the type of an
object before calling an accessor method.</p>
</section>
<section id="smart-pointers">
<span id="id7"></span><h3>Smart Pointers<a class="headerlink" href="#smart-pointers" title="Permalink to this heading"></a></h3>
<p>This section describes changes to the use of smart pointers that were
made in qpdf 10.6.0 and 11.0.0.</p>
<p>In qpdf 11.0.0, <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> was replaced with
<code class="docutils literal notranslate"><span class="pre">std::shared_ptr</span></code> in qpdf’s public API. A backward-compatible
<code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> class has been provided that makes it possible for
most code to remain unchanged. <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> may eventually be
removed from qpdf entirely, but this will not happen for a while to
make it easier for people who need to support multiple versions of
qpdf.</p>
<p>In 10.6.0, some enhancements were made to <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> to ease
the transition. These intermediate steps are relevant only for
versions 10.6.0 through 10.6.3 but can still help with incremental
modification of code.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">POINTERHOLDER_TRANSITION</span></code> preprocessor symbol was introduced in
qpdf 10.6.0 to help people transition from <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> to
<code class="docutils literal notranslate"><span class="pre">std::shared_ptr</span></code>. If you don’t define this, you will get a compiler
warning. Defining it to any value will suppress the warning. An
explanation appears below of the different possible values for this
symbol and what they mean.</p>
<p>Starting in qpdf 11.0.0, including <code class="docutils literal notranslate"><span class="pre">&lt;qpdf/PointerHolder.hh&gt;</span></code> defines
the symbol <code class="docutils literal notranslate"><span class="pre">POINTERHOLDER_IS_SHARED_POINTER</span></code>. This can be used with
conditional compilation to make it possible to support different
versions of qpdf.</p>
<p>The rest of this section provides the details.</p>
<section id="transitional-enhancements-to-pointerholder">
<h4>Transitional Enhancements to PointerHolder<a class="headerlink" href="#transitional-enhancements-to-pointerholder" title="Permalink to this heading"></a></h4>
<p>In qpdf 10.6.0, some changes were to <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> to make it
easier to prepare for the transition to <code class="docutils literal notranslate"><span class="pre">std::shared_ptr</span></code>. These
enhancements also make it easier to incrementally upgrade your code.
The following changes were made to <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> to make its
behavior closer to that of <code class="docutils literal notranslate"><span class="pre">std::shared_ptr</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">get()</span></code> was added as an alternative to <code class="docutils literal notranslate"><span class="pre">getPointer()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">use_count()</span></code> was added as an alternative to <code class="docutils literal notranslate"><span class="pre">getRefcount()</span></code></p></li>
<li><p>A new global helper function <code class="docutils literal notranslate"><span class="pre">make_pointer_holder</span></code> behaves
similarly to <code class="docutils literal notranslate"><span class="pre">std::make_shared</span></code>, so you can use
<code class="docutils literal notranslate"><span class="pre">make_pointer_holder&lt;T&gt;(args...)</span></code> to create a <code class="docutils literal notranslate"><span class="pre">PointerHolder&lt;T&gt;</span></code>
with <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">T(args...)</span></code> as the pointer.</p></li>
<li><p>A new global helper function <code class="docutils literal notranslate"><span class="pre">make_array_pointer_holder</span></code> takes a
size and creates a <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> to an array. It is a
counterpart to the newly added <code class="docutils literal notranslate"><span class="pre">QUtil::make_shared_array</span></code> method,
which does the same thing with a <code class="docutils literal notranslate"><span class="pre">std::shared_ptr</span></code>.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> had a long-standing bug: a <code class="docutils literal notranslate"><span class="pre">const</span>
<span class="pre">PointerHolder&lt;T&gt;</span></code> would only provide a <code class="docutils literal notranslate"><span class="pre">T</span> <span class="pre">const*</span></code> with its
<code class="docutils literal notranslate"><span class="pre">getPointer</span></code> method. This is incorrect and is not how standard
library C++ smart pointers or regular pointers behave. The correct
semantics would be that a <code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">PointerHolder&lt;T&gt;</span></code> would not accept
a new pointer after being created (<code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> has always
behaved correctly in this way) but would still allow you to modify the
item being pointed to. If you don’t want to mutate the thing it points
to, use <code class="docutils literal notranslate"><span class="pre">PointerHolder&lt;T</span> <span class="pre">const&gt;</span></code> instead. The new <code class="docutils literal notranslate"><span class="pre">get()</span></code> method
behaves correctly. It is therefore not exactly the same as
<code class="docutils literal notranslate"><span class="pre">getPointer()</span></code>, but it does behave the way <code class="docutils literal notranslate"><span class="pre">get()</span></code> behaves with
<code class="docutils literal notranslate"><span class="pre">std::shared_ptr</span></code>. This shouldn’t make any difference to any
correctly written code.</p>
</section>
<section id="differences-between-pointerholder-and-std-shared-ptr">
<h4>Differences between <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> and <code class="docutils literal notranslate"><span class="pre">std::shared_ptr</span></code><a class="headerlink" href="#differences-between-pointerholder-and-std-shared-ptr" title="Permalink to this heading"></a></h4>
<p>Here is a list of things you need to think about when migrating from
<code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> to <code class="docutils literal notranslate"><span class="pre">std::shared_ptr</span></code>. After the list, we will
discuss how to address each one using the <code class="docutils literal notranslate"><span class="pre">POINTERHOLDER_TRANSITION</span></code>
preprocessor symbol or other C++ coding techniques.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">PointerHolder&lt;T&gt;</span></code> has an <em>implicit</em> constructor that takes a
<code class="docutils literal notranslate"><span class="pre">T*</span></code>, which means you can assign a <code class="docutils literal notranslate"><span class="pre">T*</span></code> directly to a
<code class="docutils literal notranslate"><span class="pre">PointerHolder&lt;T&gt;</span></code> or pass a <code class="docutils literal notranslate"><span class="pre">T*</span></code> to a function that expects a
<code class="docutils literal notranslate"><span class="pre">PointerHolder&lt;T&gt;</span></code> as a parameter. <code class="docutils literal notranslate"><span class="pre">std::shared_ptr&lt;T&gt;</span></code> does not
have this behavior, though you can still assign <code class="docutils literal notranslate"><span class="pre">nullptr</span></code> to a
<code class="docutils literal notranslate"><span class="pre">std::shared_ptr&lt;T&gt;</span></code> and compare <code class="docutils literal notranslate"><span class="pre">nullptr</span></code> with a
<code class="docutils literal notranslate"><span class="pre">std::shared_ptr&lt;T&gt;</span></code>. Here are some examples of how you might need
to change your code:</p>
<dl>
<dt>Old code:</dt><dd><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">PointerHolder</span><span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;</span><span class="w"> </span><span class="n">x_p</span><span class="p">;</span><span class="w"></span>
<span class="n">X</span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">X</span><span class="p">();</span><span class="w"></span>
<span class="n">x_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</dd>
<dt>New code:</dt><dd><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="w"> </span><span class="n">x_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;</span><span class="p">();</span><span class="w"></span>
<span class="n">X</span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x_p</span><span class="p">.</span><span class="n">get</span><span class="p">();</span><span class="w"></span>
<span class="c1">// or, less safe, but closer:</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;</span><span class="w"> </span><span class="n">x_p</span><span class="p">;</span><span class="w"></span>
<span class="n">X</span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">X</span><span class="p">();</span><span class="w"></span>
<span class="n">x_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</dd>
<dt>Old code:</dt><dd><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">PointerHolder</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&gt;</span><span class="w"> </span><span class="n">base_p</span><span class="p">;</span><span class="w"></span>
<span class="n">Derived</span><span class="o">*</span><span class="w"> </span><span class="n">derived</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Derived</span><span class="p">();</span><span class="w"></span>
<span class="n">base_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">derived</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</dd>
<dt>New code:</dt><dd><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&gt;</span><span class="w"> </span><span class="n">base_p</span><span class="p">;</span><span class="w"></span>
<span class="n">Derived</span><span class="o">*</span><span class="w"> </span><span class="n">derived</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Derived</span><span class="p">();</span><span class="w"></span>
<span class="n">base_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&gt;</span><span class="p">(</span><span class="n">derived</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">PointerHolder&lt;T&gt;</span></code> has <code class="docutils literal notranslate"><span class="pre">getPointer()</span></code> to get the underlying
pointer. It also has the seldom-used <code class="docutils literal notranslate"><span class="pre">getRefcount()</span></code> method to get
the reference count. <code class="docutils literal notranslate"><span class="pre">std::shared_ptr&lt;T&gt;</span></code> has <code class="docutils literal notranslate"><span class="pre">get()</span></code> and
<code class="docutils literal notranslate"><span class="pre">use_count()</span></code>. In qpdf 10.6, <code class="docutils literal notranslate"><span class="pre">PointerHolder&lt;T&gt;</span></code> also has
<code class="docutils literal notranslate"><span class="pre">get()</span></code> and <code class="docutils literal notranslate"><span class="pre">use_count()</span></code>.</p></li>
</ul>
</section>
<section id="addressing-the-differences">
<h4>Addressing the Differences<a class="headerlink" href="#addressing-the-differences" title="Permalink to this heading"></a></h4>
<p>If you are not ready to take action yet, you can <code class="docutils literal notranslate"><span class="pre">#define</span>
<span class="pre">POINTERHOLDER_TRANSITION</span> <span class="pre">0</span></code> before including any qpdf header file or
add the definition of that symbol to your build. This will provide the
backward-compatible <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> API without any deprecation
warnings. This should be a temporary measure as <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> may
disappear in the future. If you need to be able to support newer and
older versions of qpdf, there are other options, explained below.</p>
<p>Note that, even with <code class="docutils literal notranslate"><span class="pre">0</span></code>, you should rebuild and test your code.
There may be compiler errors if you have containers of
<code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code>, but most code should compile without any changes.
There are no uses of containers of <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> in qpdf’s API.</p>
<p>There are two significant things you can do to minimize the impact of
switching from <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> to <code class="docutils literal notranslate"><span class="pre">std::shared_ptr</span></code>:</p>
<ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">auto</span></code> and <code class="docutils literal notranslate"><span class="pre">decltype</span></code> whenever possible when working with
<code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> variables that are exchanged with the qpdf API.</p></li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">POINTERHOLDER_TRANSITION</span></code> preprocessor symbol to identify
and resolve the differences described above.</p></li>
</ul>
<p>To use <code class="docutils literal notranslate"><span class="pre">POINTERHOLDER_TRANSITION</span></code>, you will need to <code class="docutils literal notranslate"><span class="pre">#define</span></code> it
before including any qpdf header files or specify its value as part of
your build. The table below describes the values of
<code class="docutils literal notranslate"><span class="pre">POINTERHOLDER_TRANSITION</span></code>. This information is also summarized in
<code class="file docutils literal notranslate"><span class="pre">include/qpdf/PointerHolder.hh</span></code>, so you will have it handy
without consulting this manual.</p>
<table class="docutils align-default" id="id8">
<caption><span class="caption-text">POINTERHOLDER_TRANSITION values</span><a class="headerlink" href="#id8" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 5.9%" />
<col style="width: 94.1%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>value</p></th>
<th class="head"><p>meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>undefined</p></td>
<td><p>Same as <code class="docutils literal notranslate"><span class="pre">0</span></code> but issues a warning</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">0</span></code></p></td>
<td><p>Provide a backward compatible <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> and suppress
all deprecation warnings; supports all prior qpdf versions</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">1</span></code></p></td>
<td><p>Make the <code class="docutils literal notranslate"><span class="pre">PointerHolder&lt;T&gt;(T*)</span></code> constructor explicit;
resulting code supports all prior qpdf versions</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">2</span></code></p></td>
<td><p>Deprecate <code class="docutils literal notranslate"><span class="pre">getPointer()</span></code> and <code class="docutils literal notranslate"><span class="pre">getRefcount()</span></code>; requires
qpdf 10.6.0 or later.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">3</span></code></p></td>
<td><p>Deprecate all uses of <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code>; requires qpdf 11.0.0
or later</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">4</span></code></p></td>
<td><p>Disable all functionality from <code class="docutils literal notranslate"><span class="pre">qpdf/PointerHolder.hh</span></code> so
that <code class="docutils literal notranslate"><span class="pre">#include</span></code>-ing it has no effect other than defining
<code class="docutils literal notranslate"><span class="pre">POINTERHOLDER_IS_SHARED_POINTER</span></code>; requires qpdf 11.0.0 or
later.</p></td>
</tr>
</tbody>
</table>
<p>Based on the above, here is a procedure for preparing your code. This
is the procedure that was used for the qpdf code itself.</p>
<p>You can do these steps without breaking support for qpdf versions
before 10.6.0:</p>
<ul>
<li><p>Find all occurrences of <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> in the code. See whether
any of them can just be outright replaced with <code class="docutils literal notranslate"><span class="pre">std::shared_ptr</span></code>
or <code class="docutils literal notranslate"><span class="pre">std::unique_ptr</span></code>. If you have been using qpdf prior to
adopting C++11 and were using <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> as a general-purpose
smart pointer, you may have cases that can be replaced in this way.</p>
<p>For example:</p>
<ul>
<li><p>Simple <code class="docutils literal notranslate"><span class="pre">PointerHolder&lt;T&gt;</span></code> construction can be replaced with
either the equivalent <code class="docutils literal notranslate"><span class="pre">std::shared_ptr&lt;T&gt;</span></code> construction or, if
the constructor is public, with <code class="docutils literal notranslate"><span class="pre">std::make_shared&lt;T&gt;(args...)</span></code>.
If you are creating a smart pointer that is never copied, you may
be able to use <code class="docutils literal notranslate"><span class="pre">std::unique_ptr&lt;T&gt;</span></code> instead.</p></li>
<li><p>Array allocations will have to be rewritten.</p>
<p>Allocating a <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> to an array looked like this:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">PointerHolder</span><span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">X</span><span class="p">[</span><span class="n">n</span><span class="p">]);</span><span class="w"></span>
</pre></div>
</div>
<p>To allocate a <code class="docutils literal notranslate"><span class="pre">std::shared_ptr</span></code> to an array:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">X</span><span class="p">[</span><span class="n">n</span><span class="p">],</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">default_delete</span><span class="o">&lt;</span><span class="n">X</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">());</span><span class="w"></span>
<span class="c1">// If you don&#39;t mind using QUtil, there&#39;s QUtil::make_shared_array&lt;X&gt;(n).</span>
<span class="c1">// If you are using c++20, you can use std::make_shared&lt;X[]&gt;(n)</span>
<span class="c1">// to get a std::shared_ptr&lt;X[]&gt; instead of a std::shared_ptr&lt;X&gt;.</span>
</pre></div>
</div>
<p>To allocate a <code class="docutils literal notranslate"><span class="pre">std::unique_ptr</span></code> to an array:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">X</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span><span class="n">n</span><span class="p">);</span><span class="w"></span>
<span class="c1">// or, if X has a private constructor:</span>
<span class="k">auto</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">X</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">X</span><span class="p">[</span><span class="n">n</span><span class="p">]);</span><span class="w"></span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>If a <code class="docutils literal notranslate"><span class="pre">PointerHolder&lt;T&gt;</span></code> can’t be replaced with a standard library
smart pointer because it is used with an older qpdf API call,
perhaps it can be declared using <code class="docutils literal notranslate"><span class="pre">auto</span></code> or <code class="docutils literal notranslate"><span class="pre">decltype</span></code> so that,
when building with a newer qpdf API changes, your code will just
need to be recompiled.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">POINTERHOLDER_TRANSITION</span> <span class="pre">1</span></code> to enable deprecation
warnings for all implicit constructions of <code class="docutils literal notranslate"><span class="pre">PointerHolder&lt;T&gt;</span></code> from
a plain <code class="docutils literal notranslate"><span class="pre">T*</span></code>. When you find one, explicitly construct the
<code class="docutils literal notranslate"><span class="pre">PointerHolder&lt;T&gt;</span></code>.</p>
<ul>
<li><p>Old code:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">PointerHolder</span><span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">X</span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
</li>
<li><p>New code:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PointerHolder</span><span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">X</span><span class="p">(...));</span><span class="w"> </span><span class="c1">// all versions of qpdf</span>
<span class="c1">// or, if X(...) is public:</span>
<span class="k">auto</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">make_pointer_holder</span><span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;</span><span class="p">(...);</span><span class="w"> </span><span class="c1">// only 10.6 and above</span>
</pre></div>
</div>
<p>Other examples appear above.</p>
</li>
</ul>
</li>
</ul>
<p>If you need to support older versions of qpdf than 10.6, this is as
far as you can go without conditional compilation.</p>
<p>Starting in qpdf 11.0.0, including <code class="docutils literal notranslate"><span class="pre">&lt;qpdf/PointerHolder.hh&gt;</span></code> defines
the symbol <code class="docutils literal notranslate"><span class="pre">POINTERHOLDER_IS_SHARED_POINTER</span></code>. If you want to support
older versions of qpdf and still transition so that the
backward-compatible <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> is not in use, you can separate
old code and new code by testing with the
<code class="docutils literal notranslate"><span class="pre">POINTERHOLDER_IS_SHARED_POINTER</span></code> preprocessor symbol, as in</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;qpdf/PointerHolder.hh&gt;</span><span class="cp"></span>
<span class="cp">#ifdef POINTERHOLDER_IS_SHARED_POINTER</span>
<span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="cp">#else</span>
<span class="n">PointerHolder</span><span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"></span>
<span class="cp">#endif </span><span class="c1">// POINTERHOLDER_IS_SHARED_POINTER</span>
<span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">decltype</span><span class="p">(</span><span class="n">x</span><span class="p">)(</span><span class="k">new</span><span class="w"> </span><span class="n">X</span><span class="p">())</span><span class="w"></span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;qpdf/PointerHolder.hh&gt;</span><span class="cp"></span>
<span class="cp">#ifdef POINTERHOLDER_IS_SHARED_POINTER</span>
<span class="k">auto</span><span class="w"> </span><span class="n">x_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;</span><span class="p">();</span><span class="w"></span>
<span class="n">X</span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x_p</span><span class="p">.</span><span class="n">get</span><span class="p">();</span><span class="w"></span>
<span class="cp">#else</span>
<span class="k">auto</span><span class="w"> </span><span class="n">x_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PointerHolder</span><span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">X</span><span class="p">());</span><span class="w"></span>
<span class="n">X</span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x_p</span><span class="p">.</span><span class="n">getPointer</span><span class="p">();</span><span class="w"></span>
<span class="cp">#endif </span><span class="c1">// POINTERHOLDER_IS_SHARED_POINTER</span>
<span class="n">x_p</span><span class="o">-&gt;</span><span class="n">doSomething</span><span class="p">();</span><span class="w"></span>
<span class="n">x</span><span class="o">-&gt;</span><span class="n">doSomethingElse</span><span class="p">();</span><span class="w"></span>
</pre></div>
</div>
<p>If you don’t need to support older versions of qpdf, you can proceed
with these steps without protecting changes with the preprocessor
symbol. Here are the remaining changes.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">POINTERHOLDER_TRANSITION</span> <span class="pre">2</span></code> to enable deprecation of
<code class="docutils literal notranslate"><span class="pre">getPointer()</span></code> and <code class="docutils literal notranslate"><span class="pre">getRefcount()</span></code></p></li>
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">getPointer()</span></code> with <code class="docutils literal notranslate"><span class="pre">get()</span></code> and <code class="docutils literal notranslate"><span class="pre">getRefcount()</span></code> with
<code class="docutils literal notranslate"><span class="pre">use_count()</span></code>. These methods were not present prior to 10.6.0.</p></li>
</ul>
<p>When you have gotten your code to compile cleanly with
<code class="docutils literal notranslate"><span class="pre">POINTERHOLDER_TRANSITION=2</span></code>, you are well on your way to being
ready for eliminating <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> entirely. The code at this
point will not work with any qpdf version prior to 10.6.0.</p>
<p>To support qpdf 11.0.0 and newer and remove <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> from
your code, continue with the following steps:</p>
<ul class="simple">
<li><p>Replace all occurrences of <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> with
<code class="docutils literal notranslate"><span class="pre">std::shared_ptr</span></code> except in the literal statement <code class="docutils literal notranslate"><span class="pre">#include</span>
<span class="pre">&lt;qpdf/PointerHolder.hh&gt;</span></code></p></li>
<li><p>Replace all occurrences of <code class="docutils literal notranslate"><span class="pre">make_pointer_holder</span></code> with
<code class="docutils literal notranslate"><span class="pre">std::make_shared</span></code></p></li>
<li><p>Replace all occurrences of <code class="docutils literal notranslate"><span class="pre">make_array_pointer_holder</span></code> with
<code class="docutils literal notranslate"><span class="pre">QUtil::make_shared_array</span></code>. You will need to include
<code class="docutils literal notranslate"><span class="pre">&lt;qpdf/QUtil.hh&gt;</span></code> if you haven’t already done so.</p></li>
<li><p>Make sure <code class="docutils literal notranslate"><span class="pre">&lt;memory&gt;</span></code> is included wherever you were including
<code class="docutils literal notranslate"><span class="pre">&lt;qpdf/PointerHolder.hh&gt;</span></code>.</p></li>
<li><p>If you were using any array <code class="docutils literal notranslate"><span class="pre">PointerHolder&lt;T&gt;</span></code> objects, replace
them as above. You can let the compiler find these for you.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">POINTERHOLDER_TRANSITION</span> <span class="pre">3</span></code> to enable deprecation of
all <code class="docutils literal notranslate"><span class="pre">PointerHolder&lt;T&gt;</span></code> construction.</p></li>
<li><p>Build and test. Fix any remaining issues.</p></li>
<li><p>If not supporting older versions of qpdf, remove all references to
<code class="docutils literal notranslate"><span class="pre">&lt;qpdf/PointerHolder.hh&gt;</span></code>. Otherwise, you will still need to
include it but can <code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">POINTERHOLDER_TRANSITION</span> <span class="pre">4</span></code> to prevent
<code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> from being defined. The
<code class="docutils literal notranslate"><span class="pre">POINTERHOLDER_IS_SHARED_POINTER</span></code> symbol will still be defined.</p></li>
</ul>
</section>
<section id="historical-background">
<h4>Historical Background<a class="headerlink" href="#historical-background" title="Permalink to this heading"></a></h4>
<p>Since its inception, the qpdf library used its own smart pointer
class, <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code>. The <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> class was originally
created long before <code class="docutils literal notranslate"><span class="pre">std::shared_ptr</span></code> existed, and qpdf itself
didn’t start requiring a C++11 compiler until version 9.1.0 released in
late 2019. With current C++ versions, it is no longer desirable for qpdf
to have its own smart pointer class.</p>
</section>
</section>
</section>
<span id="document-qpdf-job"></span><section id="qpdfjob-a-job-based-interface">
<span id="qpdf-job"></span><h2>QPDFJob: a Job-Based Interface<a class="headerlink" href="#qpdfjob-a-job-based-interface" title="Permalink to this heading"></a></h2>
<p>All of the functionality from the <strong class="command">qpdf</strong> command-line
executable is available from inside the C++ library using the
<code class="docutils literal notranslate"><span class="pre">QPDFJob</span></code> class. There are several ways to access this functionality:</p>
<ul class="simple">
<li><p>Command-line options</p>
<ul>
<li><p>Run the <strong class="command">qpdf</strong> command line</p></li>
<li><p>Use from the C++ API with <code class="docutils literal notranslate"><span class="pre">QPDFJob::initializeFromArgv</span></code></p></li>
<li><p>Use from the C API with <code class="docutils literal notranslate"><span class="pre">qpdfjob_run_from_argv</span></code> from
<code class="file docutils literal notranslate"><span class="pre">qpdfjob-c.h</span></code>. If you are calling from a Windows-style main
and have an argv array of <code class="docutils literal notranslate"><span class="pre">wchar_t</span></code>, you can use
<code class="docutils literal notranslate"><span class="pre">qpdfjob_run_from_wide_argv</span></code>.</p></li>
</ul>
</li>
<li><p>The job JSON file format</p>
<ul>
<li><p>Use from the CLI with the <a class="reference internal" href="index.html#option-job-json-file" title="option-job-json-file"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--job-json-file</span></code></a> parameter</p></li>
<li><p>Use from the C++ API with <code class="docutils literal notranslate"><span class="pre">QPDFJob::initializeFromJson</span></code></p></li>
<li><p>Use from the C API with <code class="docutils literal notranslate"><span class="pre">qpdfjob_run_from_json</span></code> from <code class="file docutils literal notranslate"><span class="pre">qpdfjob-c.h</span></code></p></li>
<li><p>Note: this is unrelated to <a class="reference internal" href="index.html#option-json" title="option-json"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json</span></code></a> but can be combined
with it. For more information on qpdf JSON (vs. QPDFJob JSON), see
<a class="reference internal" href="index.html#json"><span class="std std-ref">qpdf JSON</span></a>.</p></li>
</ul>
</li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">QPDFJob</span></code> C++ API</p></li>
</ul>
<p>If you can understand how to use the <strong class="command">qpdf</strong> CLI, you can
understand the <code class="docutils literal notranslate"><span class="pre">QPDFJob</span></code> class and the JSON file. qpdf guarantees
that all of the above methods are in sync. Here’s how it works:</p>
<table class="docutils align-default" id="id2">
<caption><span class="caption-text">QPDFJob Interfaces</span><a class="headerlink" href="#id2" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 33.3%" />
<col style="width: 33.3%" />
<col style="width: 33.3%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>CLI</p></th>
<th class="head"><p>JSON</p></th>
<th class="head"><p>C++</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">--some-option</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;someOption&quot;:</span> <span class="pre">&quot;&quot;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">config()-&gt;someOption()</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">--some-option=value</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;someOption&quot;:</span> <span class="pre">&quot;value&quot;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">config()-&gt;someOption(&quot;value&quot;)</span></code></p></td>
</tr>
<tr class="row-even"><td><p>positional argument</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">&quot;otherOption&quot;:</span> <span class="pre">&quot;value&quot;</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">config()-&gt;otherOption(&quot;value&quot;)</span></code></p></td>
</tr>
</tbody>
</table>
<p>In the JSON file, the JSON structure is an object (dictionary) whose
keys are command-line flags converted to camelCase. Positional
arguments have some corresponding key, which you can find by running
<code class="docutils literal notranslate"><span class="pre">qpdf</span></code> with the <a class="reference internal" href="index.html#option-job-json-help" title="option-job-json-help"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--job-json-help</span></code></a> flag. For example, input
and output files are named by positional arguments on the CLI. In the
JSON, they appear in the <code class="docutils literal notranslate"><span class="pre">&quot;inputFile&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;outputFile&quot;</span></code> keys.
The following are equivalent:</p>
<dl>
<dt>CLI:</dt><dd><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>qpdf infile.pdf outfile.pdf \
   --pages . other.pdf --password=x 1-5 -- \
   --encrypt user owner 256 --print=low -- \
   --object-streams=generate
</pre></div>
</div>
</dd>
<dt>Job JSON:</dt><dd><div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;inputFile&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;infile.pdf&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;outputFile&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;outfile.pdf&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;pages&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;.&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;file&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;other.pdf&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;password&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;range&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1-5&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">],</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;encrypt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;userPassword&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;ownerPassword&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;owner&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;256bit&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="nt">&quot;print&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;low&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;objectStreams&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;generate&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</dd>
<dt>C++ code:</dt><dd><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;qpdf/QPDFJob.hh&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;qpdf/QPDFUsage.hh&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">try</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">QPDFJob</span><span class="w"> </span><span class="n">j</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">j</span><span class="p">.</span><span class="n">config</span><span class="p">()</span><span class="w"></span>
<span class="w">            </span><span class="o">-&gt;</span><span class="n">inputFile</span><span class="p">(</span><span class="s">&quot;infile.pdf&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="o">-&gt;</span><span class="n">outputFile</span><span class="p">(</span><span class="s">&quot;outfile.pdf&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="o">-&gt;</span><span class="n">pages</span><span class="p">()</span><span class="w"></span>
<span class="w">            </span><span class="o">-&gt;</span><span class="n">pageSpec</span><span class="p">(</span><span class="s">&quot;.&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1-z&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="o">-&gt;</span><span class="n">pageSpec</span><span class="p">(</span><span class="s">&quot;other.pdf&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;1-5&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;x&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="o">-&gt;</span><span class="n">endPages</span><span class="p">()</span><span class="w"></span>
<span class="w">            </span><span class="o">-&gt;</span><span class="n">encrypt</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;user&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;owner&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="o">-&gt;</span><span class="n">print</span><span class="p">(</span><span class="s">&quot;low&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="o">-&gt;</span><span class="n">endEncrypt</span><span class="p">()</span><span class="w"></span>
<span class="w">            </span><span class="o">-&gt;</span><span class="n">objectStreams</span><span class="p">(</span><span class="s">&quot;generate&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="o">-&gt;</span><span class="n">checkConfiguration</span><span class="p">();</span><span class="w"></span>
<span class="w">        </span><span class="n">j</span><span class="p">.</span><span class="n">run</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">QPDFUsage</span><span class="o">&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;configuration error: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="o">&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;other error: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</dd>
</dl>
<p>Note the <code class="docutils literal notranslate"><span class="pre">QPDFUsage</span></code> exception above. This is thrown whenever a
configuration error occurs. These exactly correspond to usage messages
issued by the <strong class="command">qpdf</strong> CLI for things like omitting an output
file, specifying <cite>–pages</cite> multiple times, or other invalid
combinations of options. <code class="docutils literal notranslate"><span class="pre">QPDFUsage</span></code> is thrown by the argv and JSON
interfaces as well as the native <code class="docutils literal notranslate"><span class="pre">QPDFJob</span></code> interface.</p>
<p>It is also possible to mix and match command-line options and JSON
from the CLI. For example, you could create a file called
<code class="file docutils literal notranslate"><span class="pre">my-options.json</span></code> containing the following:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;encrypt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;userPassword&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;ownerPassword&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;owner&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;256bit&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">},</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;objectStreams&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;generate&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>and use it with other options to create 256-bit encrypted (but
unrestricted) files with object streams while specifying other
parameters on the command line, such as</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>qpdf infile.pdf outfile.pdf --job-json-file=my-options.json
</pre></div>
</div>
<p id="qpdfjob-design">See also <code class="file docutils literal notranslate"><span class="pre">examples/qpdf-job.cc</span></code> in the source distribution as
well as comments in <code class="docutils literal notranslate"><span class="pre">QPDFJob.hh</span></code>.</p>
<section id="id1">
<h3>QPDFJob Design<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h3>
<p>This section describes some of the design rationale and history behind
<code class="docutils literal notranslate"><span class="pre">QPDFJob</span></code>.</p>
<p>Documentation of <code class="docutils literal notranslate"><span class="pre">QPDFJob</span></code> is divided among three places:</p>
<ul class="simple">
<li><p>“HOW TO ADD A COMMAND-LINE ARGUMENT” in <code class="file docutils literal notranslate"><span class="pre">README-maintainer</span></code>
provides a quick reminder of how to add a command-line argument.</p></li>
<li><p>The source file <code class="file docutils literal notranslate"><span class="pre">generate_auto_job</span></code> has a detailed explanation
about how <code class="docutils literal notranslate"><span class="pre">QPDFJob</span></code> and <code class="docutils literal notranslate"><span class="pre">generate_auto_job</span></code> work together.</p></li>
<li><p>This chapter of the manual has other details.</p></li>
</ul>
<p>Prior to qpdf version 10.6.0, the qpdf CLI executable had a lot of
functionality built into it that was not callable from the library as
such. This created a number of problems:</p>
<ul class="simple">
<li><p>Some of the logic in <code class="file docutils literal notranslate"><span class="pre">qpdf.cc</span></code> was pretty complex, such as
image optimization, generating JSON output, and many of the page
manipulations. While those things could all be coded using the C++
API, there would be a lot of duplicated code.</p></li>
<li><p>Page splitting and merging will get more complicated over time as
qpdf supports a wider range of document-level options. It would be
nice to be able to expose this to library users instead of baking it
all into the CLI.</p></li>
<li><p>Users of other languages who just wanted an interface to do things
that the CLI could do didn’t have a good way to do it, such as just
handing a library call a set of command-line options or an
equivalent JSON object that could be passed in as a string.</p></li>
<li><p>The qpdf CLI itself was almost 8,000 lines of code. It needed to be
refactored, cleaned up, and split.</p></li>
<li><p>Exposing a new feature via the command-line required making lots of
small edits to lots of small bits of code, and it was easy to forget
something. Adding a code generator, while complex in some ways,
greatly reduces the chances of error when extending qpdf.</p></li>
</ul>
<p>Here are a few notes on some design decisions about QPDFJob and its
various interfaces.</p>
<ul class="simple">
<li><p>Bare command-line options (flags with no parameter) map to config
functions that take no options and to JSON keys whose values are
required to be the empty string. The rationale is that we can later
change these bare options to options that take an optional parameter
without breaking backward compatibility in the CLI or the JSON.
Options that take optional parameters generate two config functions:
one has no arguments, and one that has a <code class="docutils literal notranslate"><span class="pre">char const*</span></code> argument.
This means that adding an optional parameter to a previously bare
option also doesn’t break binary compatibility.</p></li>
<li><p>Adding a new argument to <code class="file docutils literal notranslate"><span class="pre">job.yml</span></code> automatically triggers
almost everything by declaring and referencing things that you have
to implement. This way, once you get the code to compile and link,
you know you haven’t forgotten anything. There are two tricky cases:</p>
<ul>
<li><p>If an argument handler has to do something special, like call a
nested config method or select an option table, you have to
implement it manually. This is discussed in
<code class="file docutils literal notranslate"><span class="pre">generate_auto_job</span></code>.</p></li>
<li><p>When you add an option that has optional parameters or choices,
both of the handlers described above are declared, but only the
one that takes an argument is referenced. You have to remember to
implement the one that doesn’t take an argument or else people
will get a linker error if they try to call it. The assumption is
that things with optional parameters started out as bare, so the
argument-less version is already there.</p></li>
</ul>
</li>
<li><p>If you have to add a new option that requires its own option table,
you will have to do some extra work including adding a new nested
Config class, adding a config member variable to <code class="docutils literal notranslate"><span class="pre">ArgParser</span></code> in
<code class="file docutils literal notranslate"><span class="pre">QPDFJob_argv.cc</span></code> and <code class="docutils literal notranslate"><span class="pre">Handlers</span></code> in <code class="file docutils literal notranslate"><span class="pre">QPDFJob_json.cc</span></code>,
and make sure that manually implemented handlers are consistent with
each other. It is best to add explicit test cases for all the
various ways to get to the option.</p></li>
</ul>
</section>
</section>
<span id="document-linearization"></span><section id="linearization">
<span id="id1"></span><h2>Linearization<a class="headerlink" href="#linearization" title="Permalink to this heading"></a></h2>
<p>This chapter describes how <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> and <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> implement
creation and processing of linearized PDFS.</p>
<section id="basic-strategy-for-linearization">
<span id="linearization-strategy"></span><h3>Basic Strategy for Linearization<a class="headerlink" href="#basic-strategy-for-linearization" title="Permalink to this heading"></a></h3>
<p>To avoid the incestuous problem of having the qpdf library validate its
own linearized files, we have a special linearized file checking mode
which can be invoked via <strong class="command">qpdf
--check-linearization</strong> (or <strong class="command">qpdf
--check</strong>). This mode reads the linearization parameter
dictionary and the hint streams and validates that object ordering,
parameters, and hint stream contents are correct. The validation code
was first tested against linearized files created by external tools
(Acrobat and pdlin) and then used to validate files created by
<code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> itself.</p>
</section>
<section id="preparing-for-linearization">
<span id="linearized-preparation"></span><h3>Preparing For Linearization<a class="headerlink" href="#preparing-for-linearization" title="Permalink to this heading"></a></h3>
<p>Before creating a linearized PDF file from any other PDF file, the PDF
file must be altered such that all page attributes are propagated down
to the page level (and not inherited from parents in the <code class="docutils literal notranslate"><span class="pre">/Pages</span></code>
tree). We also have to know which objects refer to which other objects,
being concerned with page boundaries and a few other cases. We refer to
this part of preparing the PDF file as
<em>optimization</em>, discussed in
<a class="reference internal" href="#optimization"><span class="std std-ref">Optimization</span></a>. Note the, in this context, the
term <em>optimization</em> is a qpdf term, and the
term <em>linearization</em> is a term from the PDF
specification. Do not be confused by the fact that many applications
refer to linearization as optimization or web optimization.</p>
<p>When creating linearized PDF files from optimized PDF files, there are
really only a few issues that need to be dealt with:</p>
<ul class="simple">
<li><p>Creation of hints tables</p></li>
<li><p>Placing objects in the correct order</p></li>
<li><p>Filling in offsets and byte sizes</p></li>
</ul>
</section>
<section id="optimization">
<span id="id2"></span><h3>Optimization<a class="headerlink" href="#optimization" title="Permalink to this heading"></a></h3>
<p>In order to perform various operations such as linearization and
splitting files into pages, it is necessary to know which objects are
referenced by which pages, page thumbnails, and root and trailer
dictionary keys. It is also necessary to ensure that all page-level
attributes appear directly at the page level and are not inherited from
parents in the pages tree.</p>
<p>We refer to the process of enforcing these constraints as
<em>optimization</em>. As mentioned above, note
that some applications refer to linearization as optimization. Although
this optimization was initially motivated by the need to create
linearized files, we are using these terms separately.</p>
<p>PDF file optimization is implemented in the
<code class="file docutils literal notranslate"><span class="pre">QPDF_optimization.cc</span></code> source file. That file
is richly commented and serves as the primary reference for the
optimization process.</p>
<p>After optimization has been completed, the private member variables
<code class="docutils literal notranslate"><span class="pre">obj_user_to_objects</span></code> and <code class="docutils literal notranslate"><span class="pre">object_to_obj_users</span></code> in <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> have
been populated. Any object that has more than one value in the
<code class="docutils literal notranslate"><span class="pre">object_to_obj_users</span></code> table is shared. Any object that has exactly one
value in the <code class="docutils literal notranslate"><span class="pre">object_to_obj_users</span></code> table is private. To find all the
private objects in a page or a trailer or root dictionary key, one
merely has make this determination for each element in the
<code class="docutils literal notranslate"><span class="pre">obj_user_to_objects</span></code> table for the given page or key.</p>
<p>Note that pages and thumbnails have different object user types, so the
above test on a page will not include objects referenced by the page’s
thumbnail dictionary and nothing else.</p>
</section>
<section id="writing-linearized-files">
<span id="linearization-writing"></span><h3>Writing Linearized Files<a class="headerlink" href="#writing-linearized-files" title="Permalink to this heading"></a></h3>
<p>We will create files with only primary hint streams. We will never write
overflow hint streams. (As of PDF version 1.4, Acrobat doesn’t either,
and they are never necessary.) The hint streams contain offset
information to objects that point to where they would be if the hint
stream were not present. This means that we have to calculate all object
positions before we can generate and write the hint table. This means
that we have to generate the file in two passes. To make this reliable,
<code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> in linearization mode invokes exactly the same code twice
to write the file to a pipeline.</p>
<p>In the first pass, the target pipeline is a count pipeline chained to a
discard pipeline. The count pipeline simply passes its data through to
the next pipeline in the chain but can return the number of bytes passed
through it at any intermediate point. The discard pipeline is an end of
line pipeline that just throws its data away. The hint stream is not
written and dummy values with adequate padding are stored in the first
cross reference table, linearization parameter dictionary, and /Prev key
of the first trailer dictionary. All the offset, length, object
renumbering information, and anything else we need for the second pass
is stored.</p>
<p>At the end of the first pass, this information is passed to the <code class="docutils literal notranslate"><span class="pre">QPDF</span></code>
class which constructs a compressed hint stream in a memory buffer and
returns it. <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> uses this information to write a complete
hint stream object into a memory buffer. At this point, the length of
the hint stream is known.</p>
<p>In the second pass, the end of the pipeline chain is a regular file
instead of a discard pipeline, and we have known values for all the
offsets and lengths that we didn’t have in the first pass. We have to
adjust offsets that appear after the start of the hint stream by the
length of the hint stream, which is known. Anything that is of variable
length is padded, with the padding code surrounding any writing code
that differs in the two passes. This ensures that changes to the way
things are represented never results in offsets that were gathered
during the first pass becoming incorrect for the second pass.</p>
<p>Using this strategy, we can write linearized files to a non-seekable
output stream with only a single pass to disk or wherever the output is
going.</p>
</section>
<section id="calculating-linearization-data">
<span id="linearization-data"></span><h3>Calculating Linearization Data<a class="headerlink" href="#calculating-linearization-data" title="Permalink to this heading"></a></h3>
<p>Once a file is optimized, we have information about which objects access
which other objects. We can then process these tables to decide which
part (as described in “Linearized PDF Document Structure” in the PDF
specification) each object is contained within. This tells us the exact
order in which objects are written. The <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> class asks for
this information and enqueues objects for writing in the proper order.
It also turns on a check that causes an exception to be thrown if an
object is encountered that has not already been queued. (This could
happen only if there were a bug in the traversal code used to calculate
the linearization data.)</p>
</section>
<section id="known-issues-with-linearization">
<span id="linearization-issues"></span><h3>Known Issues with Linearization<a class="headerlink" href="#known-issues-with-linearization" title="Permalink to this heading"></a></h3>
<p>There are a handful of known issues with this linearization code. These
issues do not appear to impact the behavior of linearized files which
still work as intended: it is possible for a web browser to begin to
display them before they are fully downloaded. In fact, it seems that
various other programs that create linearized files have many of these
same issues. These items make reference to terminology used in the
linearization appendix of the PDF specification.</p>
<ul class="simple">
<li><p>Thread Dictionary information keys appear in part 4 with the rest of
Threads instead of in part 9. Objects in part 9 are not grouped
together functionally.</p></li>
<li><p>We are not calculating numerators for shared object positions within
content streams or interleaving them within content streams.</p></li>
<li><p>We generate only page offset, shared object, and outline hint tables.
It would be relatively easy to add some additional tables. We gather
most of the information needed to create thumbnail hint tables. There
are comments in the code about this.</p></li>
</ul>
</section>
<section id="debugging-note">
<span id="linearization-debugging"></span><h3>Debugging Note<a class="headerlink" href="#debugging-note" title="Permalink to this heading"></a></h3>
<p>The <strong class="command">qpdf --show-linearization</strong> command can show
the complete contents of linearization hint streams. To look at the raw
data, you can extract the filtered contents of the linearization hint
tables using <strong class="command">qpdf --show-object=n
--filtered-stream-data</strong>. Then, to convert this into a bit
stream (since linearization tables are bit streams written without
regard to byte boundaries), you can pipe the resulting data through the
following perl code:</p>
<div class="highlight-perl notranslate"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nn">bytes</span><span class="p">;</span>
<span class="nb">binmode</span> <span class="bp">STDIN</span><span class="p">;</span>
<span class="nb">undef</span> <span class="vg">$/</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="sr">&lt;STDIN&gt;</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">@ch</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="sr">//</span><span class="p">,</span> <span class="nv">$a</span><span class="p">);</span>
<span class="nb">map</span> <span class="p">{</span> <span class="nb">printf</span><span class="p">(</span><span class="s">&quot;%08b&quot;</span><span class="p">,</span> <span class="nb">ord</span><span class="p">(</span><span class="nv">$_</span><span class="p">))</span> <span class="p">}</span> <span class="nv">@ch</span><span class="p">;</span>
<span class="k">print</span> <span class="s">&quot;\n&quot;</span><span class="p">;</span>
</pre></div>
</div>
</section>
</section>
<span id="document-object-streams"></span><section id="object-and-cross-reference-streams">
<span id="object-and-xref-streams"></span><h2>Object and Cross-Reference Streams<a class="headerlink" href="#object-and-cross-reference-streams" title="Permalink to this heading"></a></h2>
<p>This chapter provides information about the implementation of object
stream and cross-reference stream support in qpdf.</p>
<section id="object-streams">
<span id="id1"></span><h3>Object Streams<a class="headerlink" href="#object-streams" title="Permalink to this heading"></a></h3>
<p>Object streams can contain any regular object except the following:</p>
<ul class="simple">
<li><p>stream objects</p></li>
<li><p>objects with generation &gt; 0</p></li>
<li><p>the encryption dictionary</p></li>
<li><p>objects containing the /Length of another stream</p></li>
</ul>
<p>In addition, Adobe reader (at least as of version 8.0.0) appears to not
be able to handle having the document catalog appear in an object stream
if the file is encrypted, though this is not specifically disallowed by
the specification.</p>
<p>There are additional restrictions for linearized files. See
<a class="reference internal" href="#object-streams-linearization"><span class="std std-ref">Implications for Linearized Files</span></a> for details.</p>
<p>The PDF specification refers to objects in object streams as “compressed
objects” regardless of whether the object stream is compressed.</p>
<p>The generation number of every object in an object stream must be zero.
It is possible to delete and replace an object in an object stream with
a regular object.</p>
<p>The object stream dictionary has the following keys:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/N</span></code>: number of objects</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/First</span></code>: byte offset of first object</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/Extends</span></code>: indirect reference to stream that this extends</p></li>
</ul>
<p>Stream collections are formed with <code class="docutils literal notranslate"><span class="pre">/Extends</span></code>. They must form a
directed acyclic graph. These can be used for semantic information and
are not meaningful to the PDF document’s syntactic structure. Although
qpdf preserves stream collections, it never generates them and doesn’t
make use of this information in any way.</p>
<p>The specification recommends limiting the number of objects in object
stream for efficiency in reading and decoding. Acrobat 6 uses no more
than 100 objects per object stream for linearized files and no more 200
objects per stream for non-linearized files. <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code>, in object
stream generation mode, never puts more than 100 objects in an object
stream.</p>
<p>Object stream contents consists of <em>N</em> pairs of integers, each of which
is the object number and the byte offset of the object relative to the
first object in the stream, followed by the objects themselves,
concatenated.</p>
</section>
<section id="cross-reference-streams">
<span id="xref-streams"></span><h3>Cross-Reference Streams<a class="headerlink" href="#cross-reference-streams" title="Permalink to this heading"></a></h3>
<p>For non-hybrid files, the value following <code class="docutils literal notranslate"><span class="pre">startxref</span></code> is the byte
offset to the xref stream rather than the word <code class="docutils literal notranslate"><span class="pre">xref</span></code>.</p>
<p>For hybrid files (files containing both xref tables and cross-reference
streams), the xref table’s trailer dictionary contains the key
<code class="docutils literal notranslate"><span class="pre">/XRefStm</span></code> whose value is the byte offset to a cross-reference stream
that supplements the xref table. A PDF 1.5-compliant application should
read the xref table first. Then it should replace any object that it has
already seen with any defined in the xref stream. Then it should follow
any <code class="docutils literal notranslate"><span class="pre">/Prev</span></code> pointer in the original xref table’s trailer dictionary.
The specification is not clear about what should be done, if anything,
with a <code class="docutils literal notranslate"><span class="pre">/Prev</span></code> pointer in the xref stream referenced by an xref table.
The <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> class ignores it, which is probably reasonable since, if
this case were to appear for any sensible PDF file, the previous xref
table would probably have a corresponding <code class="docutils literal notranslate"><span class="pre">/XRefStm</span></code> pointer of its
own. For example, if a hybrid file were appended, the appended section
would have its own xref table and <code class="docutils literal notranslate"><span class="pre">/XRefStm</span></code>. The appended xref table
would point to the previous xref table which would point the
<code class="docutils literal notranslate"><span class="pre">/XRefStm</span></code>, meaning that the new <code class="docutils literal notranslate"><span class="pre">/XRefStm</span></code> doesn’t have to point to
it.</p>
<p>Since xref streams must be read very early, they may not be encrypted,
and the may not contain indirect objects for keys required to read them,
which are these:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/Type</span></code>: value <code class="docutils literal notranslate"><span class="pre">/XRef</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/Size</span></code>: value <em>n+1</em>: where <em>n</em> is highest object number (same as
<code class="docutils literal notranslate"><span class="pre">/Size</span></code> in the trailer dictionary)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/Index</span></code> (optional): value
<code class="docutils literal notranslate"><span class="pre">[:samp:`{n</span> <span class="pre">count}`</span> <span class="pre">...]</span></code> used to determine
which objects’ information is stored in this stream. The default is
<code class="docutils literal notranslate"><span class="pre">[0</span> <span class="pre">/Size]</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/Prev</span></code>: value <code class="samp docutils literal notranslate"><em><span class="pre">offset</span></em></code>: byte
offset of previous xref stream (same as <code class="docutils literal notranslate"><span class="pre">/Prev</span></code> in the trailer
dictionary)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/W</span> <span class="pre">[...]</span></code>: sizes of each field in the xref table</p></li>
</ul>
<p>The other fields in the xref stream, which may be indirect if desired,
are the union of those from the xref table’s trailer dictionary.</p>
<section id="cross-reference-stream-data">
<span id="xref-stream-data"></span><h4>Cross-Reference Stream Data<a class="headerlink" href="#cross-reference-stream-data" title="Permalink to this heading"></a></h4>
<p>The stream data is binary and encoded in big-endian byte order. Entries
are concatenated, and each entry has a length equal to the total of the
entries in <code class="docutils literal notranslate"><span class="pre">/W</span></code> above. Each entry consists of one or more fields, the
first of which is the type of the field. The number of bytes for each
field is given by <code class="docutils literal notranslate"><span class="pre">/W</span></code> above. A 0 in <code class="docutils literal notranslate"><span class="pre">/W</span></code> indicates that the field
is omitted and has the default value. The default value for the field
type is <code class="docutils literal notranslate"><span class="pre">1</span></code>. All other default values are <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
<p>PDF 1.5 has three field types:</p>
<ul class="simple">
<li><p>0: for free objects. Format: <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">obj</span> <span class="pre">next-generation</span></code>, same as the
free table in a traditional cross-reference table</p></li>
<li><p>1: regular non-compressed object. Format: <code class="docutils literal notranslate"><span class="pre">1</span> <span class="pre">offset</span> <span class="pre">generation</span></code></p></li>
<li><p>2: for objects in object streams. Format: <code class="docutils literal notranslate"><span class="pre">2</span> <span class="pre">object-stream-number</span>
<span class="pre">index</span></code>, the number of object stream containing the object and the
index within the object stream of the object.</p></li>
</ul>
<p>It seems standard to have the first entry in the table be <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">0</span> <span class="pre">0</span></code>
instead of <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">0</span> <span class="pre">ffff</span></code> if there are no deleted objects.</p>
</section>
</section>
<section id="implications-for-linearized-files">
<span id="object-streams-linearization"></span><h3>Implications for Linearized Files<a class="headerlink" href="#implications-for-linearized-files" title="Permalink to this heading"></a></h3>
<p>For linearized files, the linearization dictionary, document catalog,
and page objects may not be contained in object streams.</p>
<p>Objects stored within object streams are given the highest range of
object numbers within the main and first-page cross-reference sections.</p>
<p>It is okay to use cross-reference streams in place of regular xref
tables. There are on special considerations.</p>
<p>Hint data refers to object streams themselves, not the objects in the
streams. Shared object references should also be made to the object
streams. There are no reference in any hint tables to the object numbers
of compressed objects (objects within object streams).</p>
<p>When numbering objects, all shared objects within both the first and
second halves of the linearized files must be numbered consecutively
after all normal uncompressed objects in that half.</p>
</section>
<section id="implementation-notes">
<span id="object-stream-implementation"></span><h3>Implementation Notes<a class="headerlink" href="#implementation-notes" title="Permalink to this heading"></a></h3>
<p>There are three modes for writing object streams:
<code class="samp docutils literal notranslate"><span class="pre">disable</span></code>, <code class="samp docutils literal notranslate"><span class="pre">preserve</span></code>, and
<code class="samp docutils literal notranslate"><span class="pre">generate</span></code>. In disable mode, we do not generate
any object streams, and we also generate an xref table rather than xref
streams. This can be used to generate PDF files that are viewable with
older readers. In preserve mode, we write object streams such that
written object streams contain the same objects and <code class="docutils literal notranslate"><span class="pre">/Extends</span></code>
relationships as in the original file. This is equal to disable if the
file has no object streams. In generate, we create object streams
ourselves by grouping objects that are allowed in object streams
together in sets of no more than 100 objects. We also ensure that the
PDF version is at least 1.5 in generate mode, but we preserve the
version header in the other modes. The default is
<code class="samp docutils literal notranslate"><span class="pre">preserve</span></code>.</p>
<p>We do not support creation of hybrid files. When we write files, even in
preserve mode, we will lose any xref tables and merge any appended
sections.</p>
</section>
</section>
<span id="document-encryption"></span><section id="pdf-encryption">
<span id="id1"></span><h2>PDF Encryption<a class="headerlink" href="#pdf-encryption" title="Permalink to this heading"></a></h2>
<p>This chapter discusses PDF encryption in a general way with an angle
toward how it works in <strong class="command">qpdf</strong>. This chapter is not intended
to replace the PDF specification. Please consult the spec for full
details.</p>
<section id="pdf-encryption-concepts">
<h3>PDF Encryption Concepts<a class="headerlink" href="#pdf-encryption-concepts" title="Permalink to this heading"></a></h3>
<dl>
<dt>Encryption</dt><dd><p>Encryption is the replacement of <em>clear text</em> with encrypted text,
also known as <em>ciphertext</em>. The clear text may be retrieved from the
ciphertext if the encryption key is known.</p>
<p>PDF files consist of an object structure. PDF objects may be of a
variety of types including (among others) numbers, boolean values,
names, arrays, dictionaries, strings, and streams. In a PDF file,
only strings and streams are encrypted.</p>
</dd>
<dt>Security Handler</dt><dd><p>Since the inception of PDF, there have been several modifications to
the way files are encrypted. Encryption is handled by a <em>security
handler</em>. The <em>standard security handler</em> is password-based. This is
the only security handler implemented by qpdf, and this material is
all focused on the standard security handler. There are various
flags that control the specific details of encryption with the
standard security handler. These are discussed below.</p>
</dd>
<dt>Encryption Key</dt><dd><p>This refers to the actual key used by the encryption and decryption
algorithms. It is distinct from the password. The main encryption
key is generated at random and stored encrypted in the PDF file. The
passwords used to protect a PDF file, if any, are used to protect
the encryption key. This design makes it possible to use different
passwords (e.g., user and owner passwords) to retrieve the
encryption key or even to change the password on a file without
changing the encryption key. qpdf can expose the encryption key when
run with the <a class="reference internal" href="index.html#option-show-encryption-key" title="option-show-encryption-key"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--show-encryption-key</span></code></a> option and can accept
a hex-encoded encryption key in place of a password when run with
the <a class="reference internal" href="index.html#option-password-is-hex-key" title="option-password-is-hex-key"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--password-is-hex-key</span></code></a> option.</p>
</dd>
<dt>Password Protection</dt><dd><p>Password protection is distinct from encryption. This point is often
misunderstood. A PDF file can be encrypted without being
password-protected. The intent of PDF encryption was that there
would be two passwords: a <em>user password</em> and an <em>owner password</em>.
Either password can be used to retrieve the encryption key. A
conforming reader is supposed to obey the security restrictions
if the file is opened using the user password but not if the file is
opened with the owner password. <strong class="command">qpdf</strong> makes no distinction
between which password is used to open the file. The distinction
made by conforming readers between the user and owner password is
what makes it common to create encrypted files with no password
protection. This is done by using the empty string as the user
password and some secret string as the owner password. When a user
opens the PDF file, the empty string is used to retrieve the
encryption key, making the file usable, but a conforming reader
restricts certain operations from the user.</p>
</dd>
</dl>
<p>What does all this mean? Here are a few things to realize.</p>
<ul class="simple">
<li><p>Since the user password and the owner password are both used to
recover the single encryption key, there is <em>fundamentally no way</em>
to prevent an application from disregarding the security
restrictions on a file. Any software that can read the encrypted
file at all has the encryption key. Therefore, the security of the
restrictions placed on PDF files is solely enforced by the software.
Any open source PDF reader could be trivially modified to ignore the
security restrictions on a file. The PDF specification is clear
about this point. This means that PDF restrictions on
non-password-protected files only restrict users who don’t know how
to circumvent them.</p></li>
<li><p>If a file is password-protected, you have to know at least one of
the user or owner password to retrieve the encryption key. However,
in the case of 40-bit encryption, the actual encryption key is only
5 bytes long and can be easily brute-forced. As such, files
encrypted with 40-bit encryption are not secure regardless of how
strong the password is. With 128-bit encryption, the default
security handler uses RC4 encryption, which is also known to be
insecure. As such, the only way to securely encrypt a PDF file using
the standard security handler (as of the last review of this chapter
in 2022) is to use AES encryption. This is the only supported
algorithm with 256-bit encryption, and it can be selected to be used
with 128-bit encryption as well. However there is no reason to use
128-bit encryption with AES. If you are going to use AES, just use
256-bit encryption instead. The security of a 256-bit AES-encrypted
PDF file with a strong password is comparable to using a
general-purpose encryption tool like <strong class="command">gpg</strong> or
<strong class="command">openssl</strong> to encrypt the PDF file with the same password,
but the advantage of using PDF encryption is that no software is
required beyond a regular PDF viewer.</p></li>
</ul>
</section>
<section id="pdf-encryption-details">
<h3>PDF Encryption Details<a class="headerlink" href="#pdf-encryption-details" title="Permalink to this heading"></a></h3>
<p>This section describes a few details about PDF encryption. It does not
describe all the details. For that, read the PDF specification. The
details presented here, however, should go a long way toward helping a
casual user/developer understand what’s going on with encrypted PDF
files.</p>
<p>Here are more concepts to understand.</p>
<dl>
<dt>Algorithm parameters <code class="docutils literal notranslate"><span class="pre">V</span></code> and <code class="docutils literal notranslate"><span class="pre">R</span></code></dt><dd><p>There are two parameters that control the details of encryption
using the standard security handler: <code class="docutils literal notranslate"><span class="pre">V</span></code> and <code class="docutils literal notranslate"><span class="pre">R</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">V</span></code> is a code specifying the algorithms that are used for
encrypting the file, handling keys, etc. It may have any of the
following values:</p>
<table class="docutils align-default" id="id2">
<caption><span class="caption-text">Encryption Algorithms: <code class="docutils literal notranslate"><span class="pre">V</span></code></span><a class="headerlink" href="#id2" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 11.1%" />
<col style="width: 88.9%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>V</p></th>
<th class="head"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>The original algorithm, which encrypted files using 40-bit keys.</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>An extension of the original algorithm allowing longer keys.
Introduced in PDF 1.4.</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>An unpublished algorithm that permits file encryption key
lengths ranging from 40 to 128 bits. Introduced in PDF 1.4.
qpdf is believed to be able to read files with <code class="docutils literal notranslate"><span class="pre">V</span></code> = 3 but
does not write such files.</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>An extension of the algorithm that allows it to be
parameterized by additional rules for handling strings and
streams. Introduced in PDF 1.5.</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>An algorithm that allows specification of separate security
handlers for strings and streams as well as embedded files,
and which supports 256-bit keys. Introduced in PDF 1.7
extension level 3 and later extended in extension level 8.
This is the encryption system in the PDF 2.0 specification,
ISO-32000.</p></td>
</tr>
</tbody>
</table>
<p><code class="docutils literal notranslate"><span class="pre">R</span></code> is a code specifying the revision of the standard handler. It
is tightly coupled with the value of <code class="docutils literal notranslate"><span class="pre">V</span></code>. <code class="docutils literal notranslate"><span class="pre">R</span></code> may have any of
the following values:</p>
<table class="docutils align-default" id="id3">
<caption><span class="caption-text">Relationship between <code class="docutils literal notranslate"><span class="pre">R</span></code> and <code class="docutils literal notranslate"><span class="pre">V</span></code></span><a class="headerlink" href="#id3" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 11.1%" />
<col style="width: 88.9%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>R</p></th>
<th class="head"><p>Expected V</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>2</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">V</span></code> must be 1</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">V</span></code> must be 2 or 3</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">V</span></code> must be 4</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">V</span></code> must be 5; this extension was never fully specified and
existed for a short time in some versions of Acrobat.
<strong class="command">qpdf</strong> is able to read and write this format, but it
should not be used for any purpose other than testing
compatibility with the format.</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">V</span></code> must be 5. This is the only value that is not
deprecated in the PDF 2.0 specification, ISO-32000.</p></td>
</tr>
</tbody>
</table>
</dd>
<dt>Encryption Dictionary</dt><dd><p>Encrypted PDF files have an encryption dictionary. There are several
fields, but these are the important ones for our purposes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">V</span></code> and <code class="docutils literal notranslate"><span class="pre">R</span></code> as described above</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">O</span></code>, <code class="docutils literal notranslate"><span class="pre">U</span></code>, <code class="docutils literal notranslate"><span class="pre">OE</span></code>, <code class="docutils literal notranslate"><span class="pre">UE</span></code>: values used by the algorithms that
recover the encryption key from the user and owner password. Which
of these are defined and how they are used vary based on the value
of <code class="docutils literal notranslate"><span class="pre">R</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">P</span></code>: a bit field that describes which restrictions are in place.
This is discussed below in <a class="reference internal" href="#security-restrictions"><span class="std std-ref">PDF Security Restrictions</span></a></p></li>
</ul>
</dd>
<dt>Encryption Algorithms</dt><dd><p>PDF files may be encrypted with the obsolete, insecure RC4 algorithm
or the more secure AES algorithm. See also <a class="reference internal" href="index.html#weak-crypto"><span class="std std-ref">Weak Cryptography</span></a> for a
discussion. 40-bit encryption always uses RC4. 128-bit can use
either RC4 (the default for compatibility reasons) or, starting with
PDF 1.6, AES. 256-bit encryption always uses AES.</p>
</dd>
</dl>
</section>
<section id="pdf-security-restrictions">
<span id="security-restrictions"></span><h3>PDF Security Restrictions<a class="headerlink" href="#pdf-security-restrictions" title="Permalink to this heading"></a></h3>
<p>PDF security restrictions are described by a bit field whose value is
stored in the <code class="docutils literal notranslate"><span class="pre">P</span></code> field in the encryption dictionary. The value of
<code class="docutils literal notranslate"><span class="pre">P</span></code> is used by the algorithms to recover the encryption key given
the password, which makes the value of <code class="docutils literal notranslate"><span class="pre">P</span></code> tamper-resistent.</p>
<p><code class="docutils literal notranslate"><span class="pre">P</span></code> is a 32-bit integer, treated as a signed twos-complement number.
A 1 in any bit position means the permission is granted. The PDF
specification numbers the bits from 1 (least significant bit) to 32
(most significant bit) rather than the more customary 0 to 31. For
consistency with the spec, the remainder of this section uses the
1-based numbering.</p>
<p>Only bits 3, 4, 5, 6, 9, 10, 11, and 12 are used. All other bits are
set to 1. Since bit 32 is always set to 1, the value of <code class="docutils literal notranslate"><span class="pre">P</span></code> is
always a negative number. (<strong class="command">qpdf</strong> recognizes a positive
number on behalf of buggy writers that treat <code class="docutils literal notranslate"><span class="pre">P</span></code> as unsigned. Such
files have been seen in the wild.)</p>
<p>Here are the meanings of the bit positions. All bits not listed must
have the value 1 except bits 1 and 2, which must have the value 0.
However, the values of bits other than those in the table are ignored,
so having incorrect values probably doesn’t break anything in most
cases. A value of 1 indicates that the permission is granted.</p>
<table class="docutils align-default" id="id4">
<caption><span class="caption-text"><code class="docutils literal notranslate"><span class="pre">P</span></code> Bit Values</span><a class="headerlink" href="#id4" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 11.1%" />
<col style="width: 88.9%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Bit</p></th>
<th class="head"><p>Meaning</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>3</p></td>
<td><p>for <code class="docutils literal notranslate"><span class="pre">R</span></code> = 2 printing; for <code class="docutils literal notranslate"><span class="pre">R</span></code> ≥ 3, printing at low
resolution</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>modifying the document except as controlled by bits 6,
9, and 11</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>extracting text and graphics for purposes other than
accessibility to visually impaired users</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>add or modify annotations, fill in interactive form fields;
if bit 4 is also set, create or modify interactive form fields</p></td>
</tr>
<tr class="row-even"><td><p>9</p></td>
<td><p>for <code class="docutils literal notranslate"><span class="pre">R</span></code> ≥ 3, fill in interactive form fields even if bit 6 is
clear</p></td>
</tr>
<tr class="row-odd"><td><p>10</p></td>
<td><p>not used; formerly granted permission to extract material for
accessibility, but the specification now disallows restriction of
accessibility, and conforming readers are to treat this bit as if
it is set regardless of its value</p></td>
</tr>
<tr class="row-even"><td><p>11</p></td>
<td><p>for <code class="docutils literal notranslate"><span class="pre">R</span></code> ≥ 3, assemble document including inserting, rotating,
or deleting pages or creating document outlines or thumbnail
images</p></td>
</tr>
<tr class="row-odd"><td><p>12</p></td>
<td><p>for <code class="docutils literal notranslate"><span class="pre">R</span></code> ≥ 3, allow printing at full resolution</p></td>
</tr>
</tbody>
</table>
</section>
<section id="how-qpdf-handles-security-restrictions">
<span id="qpdf-p"></span><h3>How qpdf handles security restrictions<a class="headerlink" href="#how-qpdf-handles-security-restrictions" title="Permalink to this heading"></a></h3>
<p>The section describes exactly what the qpdf library does with regard
to <code class="docutils literal notranslate"><span class="pre">P</span></code> based on the various settings of different security options.</p>
<ul>
<li><p>Start with all bits set except bits 1 and 2, which are cleared</p></li>
<li><p>Clear bits and described in the table below:</p>
<table class="docutils align-default" id="id5">
<caption><span class="caption-text">Command-line Arguments and <code class="docutils literal notranslate"><span class="pre">P</span></code> Bit Values</span><a class="headerlink" href="#id5" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 22.2%" />
<col style="width: 27.8%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>R</p></th>
<th class="head"><p>Argument</p></th>
<th class="head"><p>Bits Cleared</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>R = 2</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--print=n</span></code></p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p>R = 2</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--modify=n</span></code></p></td>
<td><p>4</p></td>
</tr>
<tr class="row-even"><td><p>R = 2</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--extract=n</span></code></p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p>R = 2</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--annotate=n</span></code></p></td>
<td><p>6</p></td>
</tr>
<tr class="row-even"><td><p>R = 3</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--accessibility=n</span></code></p></td>
<td><p>10</p></td>
</tr>
<tr class="row-odd"><td><p>R ≥ 4</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--accessibility=n</span></code></p></td>
<td><p>ignored</p></td>
</tr>
<tr class="row-even"><td><p>R ≥ 3</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--extract=n</span></code></p></td>
<td><p>5</p></td>
</tr>
<tr class="row-odd"><td><p>R ≥ 3</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--print=none</span></code></p></td>
<td><p>3, 12</p></td>
</tr>
<tr class="row-even"><td><p>R ≥ 3</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--print=low</span></code></p></td>
<td><p>12</p></td>
</tr>
<tr class="row-odd"><td><p>R ≥ 3</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--modify=none</span></code></p></td>
<td><p>4, 6, 9, 11</p></td>
</tr>
<tr class="row-even"><td><p>R ≥ 3</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--modify=assembly</span></code></p></td>
<td><p>4, 6, 9</p></td>
</tr>
<tr class="row-odd"><td><p>R ≥ 3</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--modify=form</span></code></p></td>
<td><p>4, 6</p></td>
</tr>
<tr class="row-even"><td><p>R ≥ 3</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--modify=annotate</span></code></p></td>
<td><p>4</p></td>
</tr>
<tr class="row-odd"><td><p>R ≥ 3</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--assemble=n</span></code></p></td>
<td><p>11</p></td>
</tr>
<tr class="row-even"><td><p>R ≥ 3</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--annotate=n</span></code></p></td>
<td><p>6</p></td>
</tr>
<tr class="row-odd"><td><p>R ≥ 3</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--form=n</span></code></p></td>
<td><p>9</p></td>
</tr>
<tr class="row-even"><td><p>R ≥ 3</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--modify-other=n</span></code></p></td>
<td><p>4</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
<p>Options to <strong class="command">qpdf</strong>, both at the CLI and library level, allow
more granular clearing of permission bits than do most tools,
including Adobe Acrobat. As such, PDF viewers may respond in
surprising ways based on options passed to qpdf. If you observe this,
it is probably not because of a bug in qpdf.</p>
</section>
<section id="user-and-owner-passwords">
<span id="pdf-passwords"></span><h3>User and Owner Passwords<a class="headerlink" href="#user-and-owner-passwords" title="Permalink to this heading"></a></h3>
<p>When you use qpdf to show encryption parameters and you open a file
with the owner password, sometimes qpdf reveals the user password, and
sometimes it doesn’t. Here’s why.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">V</span></code> &lt; 5, the user password is actually stored in the PDF file
encrypted with a key that is derived from the owner password, and the
main encryption key is encrypted using a key derived from the user
password. When you open a PDF file, the reader first tries to treat
the given password as the user password, using it to recover the
encryption key. If that works, you’re in with restrictions (assuming
the reader chooses to enforce them). If it doesn’t work, then the
reader treats the password as the owner password, using it to recover
the user password, and then uses the user password to retrieve the
encryption key. This is why creating a file with the same user
password and owner password with <code class="docutils literal notranslate"><span class="pre">V</span></code> &lt; 5 results in a file that some
readers will never allow you to open as the owner. When an empty owner
password is given at file creation, the user password is used as both
the user and owner password. Typically when a reader encounters a file
with <code class="docutils literal notranslate"><span class="pre">V</span></code> &lt; 5, it will first attempt to treat the empty string as a
user password. If that works, the file is encrypted but not
password-protected. If it doesn’t work, then a password prompt is
given.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">V</span></code> ≥ 5, the main encryption key is independently encrypted
using the user password and the owner password. There is no way to
recover the user password from the owner password. Restrictions are
imposed or not depending on which password was used. In this case, the
password supplied, if any, is tried both as the user password and the
owner password, and whichever works is used. Typically the password is
tried as the owner password first. (This is what the PDF specification
says to do.) As such, specifying a user password and leaving the owner
password blank results in a file that is opened as owner with no
password, effectively rendering the security restrictions useless.
This is why <strong class="command">qpdf</strong> requires you to pass
<a class="reference internal" href="index.html#option-allow-insecure" title="option-allow-insecure"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--allow-insecure</span></code></a> to create a file with an empty owner
password when 256-bit encryption is in use.</p>
</section>
</section>
<span id="document-release-notes"></span><section id="release-notes">
<span id="id1"></span><h2>Release Notes<a class="headerlink" href="#release-notes" title="Permalink to this heading"></a></h2>
<p>For a detailed list of changes, please see the file
<code class="file docutils literal notranslate"><span class="pre">ChangeLog</span></code> in the source distribution.</p>
<dl>
<dt>11.1.1: October 1, 2022</dt><dd><ul class="simple">
<li><p>Bug fixes</p>
<ul>
<li><p>Fix edge case with character encoding for strings whose initial
characters happen to coincide with Unicode markers.</p></li>
<li><p>Fix issue with AppImage discarding the first command-line
argument when invoked as the name of one of the embedded
executables. Also, fix-qdf, for unknown reasons, had the wrong
runpath and would use a qpdf library that was installed on the
system.</p></li>
</ul>
</li>
<li><p>Test improvements</p>
<ul>
<li><p>Exercise the case of <code class="docutils literal notranslate"><span class="pre">char</span></code> being <code class="docutils literal notranslate"><span class="pre">unsigned</span></code> by default in
automated tests.</p></li>
<li><p>Add AppImage-specific tests to CI to ensure that the AppImage
works in the various ways it is intended to be invoked.</p></li>
</ul>
</li>
<li><p>Other changes</p>
<ul>
<li><p>Include more code tidying and performance improvements from M.
Holger.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>11.1.0: September 14, 2022</dt><dd><ul class="simple">
<li><p>Build fixes</p>
<ul>
<li><p>Remove <code class="docutils literal notranslate"><span class="pre">LL_FMT</span></code> tests, which were broken for cross
compilation. The code just uses <code class="docutils literal notranslate"><span class="pre">%lld</span></code> now.</p></li>
<li><p>Some symbols were not properly exported for the Windows DLL
build.</p></li>
<li><p>Force project-specific header files to precede all others in the
build so that a previous qpdf installation won’t break building
qpdf from source.</p></li>
</ul>
</li>
<li><p>Packaging note omitted from 11.0.0 release notes:</p>
<ul>
<li><p>On GitHub, the release tags are now <code class="docutils literal notranslate"><span class="pre">vX.Y.Z</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">release-qpdf-X.Y.Z</span></code> to be more consistent with current
practice.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>11.0.0: September 10, 2022</dt><dd><ul class="simple">
<li><p>Replacement of <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> with <code class="docutils literal notranslate"><span class="pre">std::shared_ptr</span></code></p>
<ul>
<li><p>The qpdf-specific <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> smart pointer implementation
has now been completely replaced with <code class="docutils literal notranslate"><span class="pre">std::shared_ptr</span></code>
through the qpdf API. Please see <a class="reference internal" href="index.html#smart-pointers"><span class="std std-ref">Smart Pointers</span></a> for
details about this change and a comprehensive migration plan.
Note that a backward-compatible <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> class is
provided and is enabled by default. A warning is issued, but
this can be turned off by following the migration steps outlined
in the manual.</p></li>
</ul>
</li>
<li><p>qpdf JSON version 2</p>
<ul>
<li><p>qpdf’s JSON output mode is now at version 2. This fixes several
flaws with version 1. Version 2 JSON output is unambiguous and
complete, and bidirectional conversion between JSON and PDF is
supported. Command-line options and library API are available
for creating JSON from PDF, creating PDF from JSON and updating
existing PDF at the object level from JSON.</p></li>
<li><p>New command-line arguments: <a class="reference internal" href="index.html#option-json-output" title="option-json-output"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-output</span></code></a>,
<a class="reference internal" href="index.html#option-json-input" title="option-json-input"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-input</span></code></a>, <a class="reference internal" href="index.html#option-update-from-json" title="option-update-from-json"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--update-from-json</span></code></a></p></li>
<li><p>New C++ API calls: <code class="docutils literal notranslate"><span class="pre">QPDF::writeJSON</span></code>,
<code class="docutils literal notranslate"><span class="pre">QPDF::createFromJSON</span></code>, <code class="docutils literal notranslate"><span class="pre">QPDF::updateFromJSON</span></code></p></li>
<li><p>New C API calls: <code class="docutils literal notranslate"><span class="pre">qpdf_create_from_json_file</span></code>,
<code class="docutils literal notranslate"><span class="pre">qpdf_create_from_json_data</span></code>, <code class="docutils literal notranslate"><span class="pre">qpdf_update_from_json_file</span></code>,
<code class="docutils literal notranslate"><span class="pre">qpdf_update_from_json_data</span></code>, and <code class="docutils literal notranslate"><span class="pre">qpdf_write_json</span></code>.</p></li>
<li><p>Complete documentation can be found at <a class="reference internal" href="index.html#json"><span class="std std-ref">qpdf JSON</span></a>. A
comprehensive list of changes from version 1 to version 2 can be
found at <a class="reference internal" href="index.html#json-v2-changes"><span class="std std-ref">Changes from JSON v1 to v2</span></a>.</p></li>
</ul>
</li>
<li><p>Build replaced with cmake</p>
<ul>
<li><p>The old autoconf-based build has been replaced with CMake. CMake
version 3.16 or newer is required. For details, please read
<a class="reference internal" href="index.html#installing"><span class="std std-ref">Building and Installing QPDF</span></a> and, if you package qpdf for a distribution,
<a class="reference internal" href="index.html#packaging"><span class="std std-ref">Notes for Packagers</span></a>.</p></li>
<li><p>For the most part, other than being familiar with generally how to
build things with cmake, what you need to know to convert your
build over is described in <a class="reference internal" href="index.html#autoconf-to-cmake"><span class="std std-ref">Converting From autoconf to cmake</span></a>. Here are a
few changes in behavior to be aware of:</p>
<ul>
<li><p>Example sources are installed by default in the documentation
directory.</p></li>
<li><p>The configure options to enable image comparison and large file
tests have been replaced by environment variables. The old
options set environment variables behind the scenes. Before, to
skip image tests, you had to set
<code class="docutils literal notranslate"><span class="pre">QPDF_SKIP_TEST_COMPARE_IMAGES=1</span></code>, which was done by default.
Now these are off by default, and you have to set
<code class="docutils literal notranslate"><span class="pre">QPDF_TEST_COMPARE_IMAGES=1</span></code> to enable them.</p></li>
<li><p>In the default configuration, the native crypto provider is only
selected when explicitly requested or when there are no other
options. See <a class="reference internal" href="index.html#crypto-build"><span class="std std-ref">Build-time Crypto Selection</span></a> for a detailed discussion.</p></li>
<li><p>Windows external libraries are detected by default if the
<code class="file docutils literal notranslate"><span class="pre">external-libraries</span></code> directory is found. Static libraries
for zlib, libjpeg, and openssl are provided as described in
<code class="file docutils literal notranslate"><span class="pre">README-windows.md</span></code>. They are only compatible with
non-debug builds.</p></li>
<li><p>A new directory called <code class="docutils literal notranslate"><span class="pre">pkg-tests</span></code> has been added which
contains short shell scripts that can be used to smoke test an
installed qpdf package. These are used by the debian
<code class="docutils literal notranslate"><span class="pre">autopkgtest</span></code> framework but can be used by others. See
<code class="file docutils literal notranslate"><span class="pre">pkg-test/README.md</span></code> for details.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Performance improvements</p>
<ul>
<li><p>Many performance enhancements have been added. In developer
performance benchmarks, gains on the order of 20% have been
observed. Most of that work, including major optimization of
qpdf’s lexical and parsing layers, was done by M. Holger.</p></li>
</ul>
</li>
<li><p>CLI: breaking changes</p>
<ul>
<li><p>The <a class="reference internal" href="index.html#option-show-encryption" title="option-show-encryption"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--show-encryption</span></code></a> flag now provides encryption
information even if a correct password is not supplied. If you
were relying on its not working in this case, see
<a class="reference internal" href="index.html#option-requires-password" title="option-requires-password"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--requires-password</span></code></a> for a reliable test.</p></li>
<li><p>The default json output version when <a class="reference internal" href="index.html#option-json" title="option-json"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json</span></code></a> is
specified has been changed from <code class="docutils literal notranslate"><span class="pre">1</span></code> to <code class="docutils literal notranslate"><span class="pre">latest</span></code>, which is
now <code class="docutils literal notranslate"><span class="pre">2</span></code>.</p></li>
<li><p>The <a class="reference internal" href="index.html#option-allow-weak-crypto" title="option-allow-weak-crypto"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--allow-weak-crypto</span></code></a> flag is now mandatory when
explicitly creating files with weak cryptographic algorithms.
See <a class="reference internal" href="index.html#weak-crypto"><span class="std std-ref">Weak Cryptography</span></a> for a discussion.</p></li>
</ul>
</li>
<li><p>API: breaking changes</p>
<ul>
<li><p>Deprecate <code class="docutils literal notranslate"><span class="pre">QPDFObject.hh</span></code> for removal in qpdf 12. The only use
case for including <code class="docutils literal notranslate"><span class="pre">qpdf/QPDFObject.hh</span></code> was to get
<code class="docutils literal notranslate"><span class="pre">QPDFObject::object_type_e</span></code>. Since 10.5.0, this has been an
alias to <code class="docutils literal notranslate"><span class="pre">qpdf_object_type_e</span></code>, defined in
<code class="docutils literal notranslate"><span class="pre">qpdf/Constants.h</span></code>. To fix your code, replace any includes of
<code class="docutils literal notranslate"><span class="pre">qpdf/QPDFObject.hh</span></code> with <code class="docutils literal notranslate"><span class="pre">qpdf/Constants.h</span></code>, and replace
all occurrences of <code class="docutils literal notranslate"><span class="pre">QPDFObject::ot_</span></code> with <code class="docutils literal notranslate"><span class="pre">::ot_</span></code>. If you
need your code to be backward compatible to qpdf versions prior
to 10.5.0, you can check that the preprocessor symbol
<code class="docutils literal notranslate"><span class="pre">QPDF_MAJOR_VERSION</span></code> is defined and <code class="docutils literal notranslate"><span class="pre">&gt;=</span> <span class="pre">11</span></code>. As a stop-gap,
you can <code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">QPDF_OBJECT_NOWARN</span></code> to suppress the warning.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Pipeline::write</span></code> now takes <code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">const*</span></code> instead
of <code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char*</span></code>. Callers don’t need to change anything,
but you no longer have to pass writable pointers to pipelines.
If you’ve implemented your own pipeline classes, you will need
to update them.</p></li>
<li><p>Remove deprecated
<code class="docutils literal notranslate"><span class="pre">QPDFAcroFormDocumentHelper::copyFieldsFromForeignPage</span></code>. This
method never worked and only did something in qpdf version
10.2.x.</p></li>
<li><p>Remove deprecated <code class="docutils literal notranslate"><span class="pre">QPDFNameTreeObjectHelper</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFNumberTreeObjectHelper</span></code> constructors that don’t take a
<code class="docutils literal notranslate"><span class="pre">QPDF&amp;</span></code> argument.</p></li>
<li><p>The function passed to and called by <code class="docutils literal notranslate"><span class="pre">QPDFJob::doIfVerbose</span></code>
now takes a <code class="docutils literal notranslate"><span class="pre">Pipeline&amp;</span></code> argument instead of a
<code class="docutils literal notranslate"><span class="pre">std::ostream&amp;</span></code> argument.</p></li>
<li><p>Intentionally break API to call attention to operations that
write files with insecure encryption:</p>
<ul>
<li><p>Remove pre qpdf-8.4.0 encryption API methods from <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code>
and their corresponding C API functions</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">Insecure</span></code> to the names of some <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> methods
and <code class="docutils literal notranslate"><span class="pre">_insecure</span></code> to the names of some C API functions without
otherwise changing their behavior</p></li>
<li><p>See <a class="reference internal" href="index.html#breaking-crypto-api"><span class="std std-ref">API-Breaking Changes in qpdf 11.0</span></a> for specific details, and see
<a class="reference internal" href="index.html#weak-crypto"><span class="std std-ref">Weak Cryptography</span></a> for a general discussion.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::warnIfPossible</span></code> no longer takes an optional
argument to throw an exception if there is no description. If
there is no description, it writes to the default
<code class="docutils literal notranslate"><span class="pre">QPDFLogger</span></code>’s error stream. (<code class="docutils literal notranslate"><span class="pre">QPDFLogger</span></code> is new in qpdf
11—see below.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDF</span></code> objects can no longer be copied or assigned to. It has
never been safe to do this because of assumptions made by
library code. Now it is prevented by the API. If you run into
trouble, use <code class="docutils literal notranslate"><span class="pre">QPDF::create()</span></code> to create <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> shared
pointers (or create them in some other way if you need backward
compatibility with older qpdf versions).</p></li>
</ul>
</li>
<li><p>CLI Enhancements</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">qpdf</span> <span class="pre">--list-attachments</span> <span class="pre">--verbose</span></code> includes some additional
information about attachments. Additional information about
attachments is also included in the <code class="docutils literal notranslate"><span class="pre">attachments</span></code> JSON key
with <code class="docutils literal notranslate"><span class="pre">--json</span></code>.</p></li>
<li><p>For encrypted files, <code class="docutils literal notranslate"><span class="pre">qpdf</span> <span class="pre">--json</span></code> reveals the user password
when the specified password did not match the user password and
the owner password was used to recover the user password. The
user password is not recoverable from the owner password when
256-bit keys are in use.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--verbose</span></code> and <code class="docutils literal notranslate"><span class="pre">--progress</span></code> may be now used when writing
the output PDF to standard output. In that case, the verbose and
progress messages are written to standard error.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>A new object <code class="docutils literal notranslate"><span class="pre">QPDFLogger</span></code> has been added. Details are in
<code class="file docutils literal notranslate"><span class="pre">include/qpdf/QPDFLogger.hh</span></code>.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDF</span></code> and <code class="docutils literal notranslate"><span class="pre">QPDFJob</span></code> both use the default logger by
default but can have their loggers overridden. The
<code class="docutils literal notranslate"><span class="pre">setOutputStreams</span></code> method is deprecated in both classes.</p></li>
<li><p>A few things from <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> that used to be
exceptions now write errors with the default logger.</p></li>
<li><p>By configuring the default logger, it is possible to capture
output and errors that slipped through the cracks with
<code class="docutils literal notranslate"><span class="pre">setOutputStreams</span></code>.</p></li>
<li><p>A C API is available in <code class="file docutils literal notranslate"><span class="pre">include/qpdf/qpdflogger-c.h</span></code>.</p></li>
<li><p>See examples <code class="file docutils literal notranslate"><span class="pre">examples/qpdfjob-save-attachment.cc</span></code> and
<code class="file docutils literal notranslate"><span class="pre">examples/qpdfjob-c-save-attachment.cc</span></code>.</p></li>
</ul>
</li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>, new methods <code class="docutils literal notranslate"><span class="pre">insertItemAndGetNew</span></code>,
<code class="docutils literal notranslate"><span class="pre">appendItemAndGetNew</span></code>, and <code class="docutils literal notranslate"><span class="pre">replaceKeyAndGetNew</span></code> return the
newly added item. New methods <code class="docutils literal notranslate"><span class="pre">eraseItemAndGetOld</span></code>,
<code class="docutils literal notranslate"><span class="pre">replaceKeyAndGetOld</span></code>, and <code class="docutils literal notranslate"><span class="pre">removeKeyAndGetOld</span></code> return the
item that was just removed or, in the case of
<code class="docutils literal notranslate"><span class="pre">replaceKeyAndGetOld</span></code>, a <code class="docutils literal notranslate"><span class="pre">null</span></code> object if the object was not
previously there.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::isDestroyed</span></code> method can be used to
detect when an indirect object <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> belongs to a
<code class="docutils literal notranslate"><span class="pre">QPDF</span></code> that has been destroyed. Any attempt to unparse this
type of <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> will throw a logic error.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getOwningQPDF</span></code> method now returns a
null pointer rather than an invalid pointer when the owning
<code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object has been destroyed. Indirect objects whose
owning <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> has been destroyed become invalid. Direct
objects just lose their owning <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> but continue to be
valid.</p></li>
<li><p>The method <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getQPDF</span></code> is an alternative to
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getOwningQPDF</span></code>. It returns a <code class="docutils literal notranslate"><span class="pre">QPDF&amp;</span></code>
rather than a <code class="docutils literal notranslate"><span class="pre">QPDF*</span></code> and can be used when the object is known
to have an owning <code class="docutils literal notranslate"><span class="pre">QPDF</span></code>. It throws an exception if the object
does not have an owning <code class="docutils literal notranslate"><span class="pre">QPDF</span></code>. Only indirect objects are
guaranteed to have an owning <code class="docutils literal notranslate"><span class="pre">QPDF</span></code>. Direct objects may have
one if they were initially read from a PDF input source that is
still valid, but it’s also possible to have direct objects that
don’t have an owning <code class="docutils literal notranslate"><span class="pre">QPDF</span></code>.</p></li>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::isSameObjectAs</span></code> for testing
whether two <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> objects point to the same
underlying object, meaning changes to one will be reflected in
the other. Note that this method does not compare the contents
of the objects, so two distinct but structurally identical
objects will not be considered the same object.</p></li>
<li><p>New factory method <code class="docutils literal notranslate"><span class="pre">QPDF::create()</span></code> returns a
<code class="docutils literal notranslate"><span class="pre">std::shared_ptr&lt;QPDF&gt;</span></code>.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> methods have been added to reduce the amount of
casting that is needed:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">write</span></code>: overloaded version that takes <code class="docutils literal notranslate"><span class="pre">char</span> <span class="pre">const*</span></code> in
addition to the one that takes <code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">const*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">writeCstr</span></code>: writes a null-terminated C string</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">writeString</span></code>: writes a std::string</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">operator</span> <span class="pre">&lt;&lt;</span></code>: for null-terminated C strings, std::strings,
and integer types</p></li>
</ul>
</li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> type <code class="docutils literal notranslate"><span class="pre">Pl_OStream</span></code> writes to a
<code class="docutils literal notranslate"><span class="pre">std::ostream</span></code>.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> type <code class="docutils literal notranslate"><span class="pre">Pl_String</span></code> appends to a
<code class="docutils literal notranslate"><span class="pre">std::string</span></code>.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> type <code class="docutils literal notranslate"><span class="pre">Pl_Function</span></code> can be used to call an
arbitrary function on write. It supports <code class="docutils literal notranslate"><span class="pre">std::function</span></code> for
C++ code and can also accept C-style functions that indicate
success using a return value and take an extra parameter for
passing user data.</p></li>
<li><p>Methods have been added to <code class="docutils literal notranslate"><span class="pre">QUtil</span></code> for converting PDF
timestamps and <code class="docutils literal notranslate"><span class="pre">QPDFTime</span></code> objects to ISO-8601 timestamps.</p></li>
<li><p>Enhance JSON class to better support incrementally reading and
writing large amounts of data without having to keep everything
in memory.</p></li>
<li><p>Add new functions to the C API for <code class="docutils literal notranslate"><span class="pre">qpdfjob</span></code> that use a
<code class="docutils literal notranslate"><span class="pre">qpdfjob_handle</span></code>. Like with the regular C API for qpdf, you
have to call <code class="docutils literal notranslate"><span class="pre">qpdfjob_init</span></code> first, pass the handle to the
functions, and call <code class="docutils literal notranslate"><span class="pre">qpdfjob_cleanup</span></code> at the end. This
interface offers more flexibility than the old interface, which
remains available.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">QPDFJob::registerProgressReporter</span></code> and
<code class="docutils literal notranslate"><span class="pre">qpdfjob_register_progress_reporter</span></code> to allow a custom
progress reporter to be used with <code class="docutils literal notranslate"><span class="pre">QPDFJob</span></code>. The <code class="docutils literal notranslate"><span class="pre">QPDFJob</span></code>
object must be configured to report progress (via command-line
argument or otherwise) for this to be used.</p></li>
<li><p>Add new overloads to
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::StreamDataProvider::provideStreamData</span></code> that
take <code class="docutils literal notranslate"><span class="pre">QPDFObjGen</span> <span class="pre">const&amp;</span></code> instead of separate object ID and
generation parameters. The old versions will continue to be
supported and are not deprecated.</p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper</span></code>, add a <code class="docutils literal notranslate"><span class="pre">copy_if_fallback</span></code>
parameter to most of the page bounding box methods, and clarify
in the comments about the difference between <code class="docutils literal notranslate"><span class="pre">copy_if_shared</span></code>
and <code class="docutils literal notranslate"><span class="pre">copy_if_fallback</span></code>.</p></li>
<li><p>Add a move constructor to the <code class="docutils literal notranslate"><span class="pre">Buffer</span></code> class.</p></li>
</ul>
</li>
<li><p>Other changes</p>
<ul>
<li><p>On GitHub, the release tags are now <cite>vX.Y.Z</cite> instead of
<cite>release-qpdf-X.Y.Z</cite> to be more consistent with current practice.</p></li>
<li><p>In JSON v1 mode, the <code class="docutils literal notranslate"><span class="pre">&quot;objects&quot;</span></code> key now reflects the repaired
pages tree if <code class="docutils literal notranslate"><span class="pre">&quot;pages&quot;</span></code> (or any other key that has the side
effect of repairing the page tree) is specified. To see the
original objects with any unrepaired page tree errors, specify
<code class="docutils literal notranslate"><span class="pre">&quot;objects&quot;</span></code> and/or <code class="docutils literal notranslate"><span class="pre">&quot;objectinfo&quot;</span></code> by themselves. This is
consistent with how JSON v2 behaves.</p></li>
<li><p>A new chapter on contributing to qpdf has been added to the
documentation. See <a class="reference internal" href="index.html#contributing"><span class="std std-ref">Contributing to qpdf</span></a>.</p></li>
<li><p>The qpdf source code is now formatted automatically with
<code class="docutils literal notranslate"><span class="pre">clang-format</span></code>. See <a class="reference internal" href="index.html#code-formatting"><span class="std std-ref">Code Formatting</span></a> for information.</p></li>
<li><p>Test coverage with <code class="docutils literal notranslate"><span class="pre">QTC</span></code> is enabled during development but
compiled out of distributed qpdf binaries by default. This
results in a significant performance improvement, especially on
Windows. <code class="docutils literal notranslate"><span class="pre">QTC::TC</span></code> is still available in the library and is
still usable by end user code even though calls to it made
internally by the library are turned off. Internally, there is
some additional caching to reduce the overhead of repeatedly
reading environment variables at runtime.</p></li>
<li><p>The test files used by the <code class="docutils literal notranslate"><span class="pre">performance_check</span></code> script at the
top of the repository are now available in the
<a class="reference external" href="https://github.com/qpdf/performance-test-files">qpdf/performance-test-files github repository</a>. In addition
to running time, memory usage is also included in performance
test results when available. The <code class="docutils literal notranslate"><span class="pre">performance_check</span></code> tool has
only been tested on Linux.</p></li>
<li><p>Lots of code cleanup and refactoring work was contributed in
multiple pull requests by M. Holger. This includes the work
required to enable detection of <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> objects
that belong to destroyed <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> objects.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.6.3: March 8, 2022</dt><dd><ul class="simple">
<li><p>Announcement of upcoming change:</p>
<ul>
<li><p>qpdf 11 will be built with cmake. The qpdf 11 documentation will
include detailed migration instructions.</p></li>
</ul>
</li>
<li><p>Bug fixes:</p>
<ul>
<li><p>Recognize strings explicitly encoded as UTF-8 as allowed by the
PDF 2.0 spec.</p></li>
<li><p>Fix edge cases with appearance stream generation for form fields
whose <code class="docutils literal notranslate"><span class="pre">/DA</span></code> field lacks proper font size specification or that
specifies auto sizing. At this time, qpdf does not support auto
sizing.</p></li>
<li><p>Minor, non-functional changes to build and documentation to
accommodate a wider range of compilation environments in
preparation for migration to cmake.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.6.2: February 16, 2022</dt><dd><ul class="simple">
<li><p>Bug fixes:</p>
<ul>
<li><p>Recognize strings encoded as UTF-16LE as Unicode. The PDF spec
only allows UTF-16BE, but most readers accept UTF16-LE as well.</p></li>
<li><p>Fix a regression in command-line argument parsing to restore a
previously undocumented behavior that some people were relying
on.</p></li>
<li><p>Fix one more problem with mapping Unicode to PDF doc encoding</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.6.1: February 11, 2022</dt><dd><ul class="simple">
<li><p>Fix compilation errors on some platforms</p></li>
</ul>
</dd>
<dt>10.6.0: February 9, 2022</dt><dd><ul>
<li><p>Preparation for replacement of <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code></p>
<p>The next major release of qpdf will replace <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> with
<code class="docutils literal notranslate"><span class="pre">std::shared_ptr</span></code> across all of qpdf’s public API. No action is
required at this time, but if you’d like to prepare, read the
comments in <code class="file docutils literal notranslate"><span class="pre">include/qpdf/PointerHolder.hh</span></code> and see
<a class="reference internal" href="index.html#smart-pointers"><span class="std std-ref">Smart Pointers</span></a> for details on what you can do now to create
code that will continue to work with older versions of qpdf and be
easier to switch over to qpdf 11 when it comes out.</p>
</li>
<li><p>Preparation for a new JSON output version</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="index.html#option-json" title="option-json"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json</span></code></a> option takes an optional parameter
indicating the version of the JSON output. At present, there is
only one JSON version (<code class="docutils literal notranslate"><span class="pre">1</span></code>), but there are plans for an
updated version in a coming release. Until the release of qpdf
11, the default value of <code class="docutils literal notranslate"><span class="pre">--json</span></code> is <code class="docutils literal notranslate"><span class="pre">1</span></code> for compatibility.
Once qpdf 11 is out, the default version will be <code class="docutils literal notranslate"><span class="pre">latest</span></code>. If
you are depending on the exact format of <code class="docutils literal notranslate"><span class="pre">--json</span></code> for code,
you should start using <code class="docutils literal notranslate"><span class="pre">--json=1</span></code> in preparation.</p></li>
</ul>
</li>
<li><p>New QPDFJob API exposes CLI functionality</p>
<p>Prior to qpdf 10.6, a lot of the functionality implemented by the
qpdf CLI executable was built into the executable itself and not
available from the library. qpdf 10.6 introduces a new object,
<code class="docutils literal notranslate"><span class="pre">QPDFJob</span></code>, that exposes all of the command-line functionality.
This includes a native <code class="docutils literal notranslate"><span class="pre">QPDFJob</span></code> API with fluent interfaces that
mirror the command-line syntax, a JSON syntax for specifying the
equivalent of a command-line invocation, and the ability to run a
qpdf “job” by passing a null-terminated array of qpdf command-line
options. The command-line argument array and JSON methods of
invoking <code class="docutils literal notranslate"><span class="pre">QPDFJob</span></code> are also exposed to the C API. For details,
see <a class="reference internal" href="index.html#qpdf-job"><span class="std std-ref">QPDFJob: a Job-Based Interface</span></a>.</p>
</li>
<li><p>Other Library Enhancements</p>
<ul>
<li><p>New <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> literal syntax using C++’s user-defined
literal syntax. You can use</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="w"> </span><span class="n">oh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&lt;&lt;/Some (valid) /PDF (object)&gt;&gt;&quot;</span><span class="n">_qpdf</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>to create a QPDFObjectHandle. It is a shorthand for
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::parse</span></code>.</p>
</li>
<li><p>Preprocessor symbols <code class="docutils literal notranslate"><span class="pre">QPDF_MAJOR_VERSION</span></code>,
<code class="docutils literal notranslate"><span class="pre">QPDF_MINOR_VERSION</span></code>, and <code class="docutils literal notranslate"><span class="pre">QPDF_PATCH_VERSION</span></code> are now
available and can be used to make it easier to write code that
supports multiple versions of qpdf. You don’t have to include
any new header files to get these, which makes it possible to
write code like this:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#if !defined(QPDF_MAJOR_VERSION) || QPDF_MAJOR_VERSION &lt; 11</span>
<span class="w">    </span><span class="c1">// do something using qpdf 10 or older API</span>
<span class="cp">#else</span>
<span class="w">    </span><span class="c1">// do something using qpdf 11 or newer API</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>Since this was introduced only in qpdf version 10.6.0, testing
for an undefined value of <code class="docutils literal notranslate"><span class="pre">QPDF_MAJOR_VERSION</span></code> is equivalent
to detecting a version prior to 10.6.0.</p>
<p>The symbol <code class="docutils literal notranslate"><span class="pre">QPDF_VERSION</span></code> is also defined as a string
containing the same version number that is returned by
<code class="docutils literal notranslate"><span class="pre">QPDF::QPDFVersion</span></code>. Note that <code class="docutils literal notranslate"><span class="pre">QPDF_VERSION</span></code> may differ
from <code class="docutils literal notranslate"><span class="pre">QPDF::QPDFVersion()</span></code> if your header files and library
are out of sync with each other.</p>
</li>
<li><p>The method <code class="docutils literal notranslate"><span class="pre">QPDF::QPDFVersion</span></code> and corresponding C API call
<code class="docutils literal notranslate"><span class="pre">qpdf_get_qpdf_version</span></code> are now both guaranteed to return a
reference (or pointer) to a static string, so you don’t have to
copy these if you are using them in your software. They have
always returned static values. Now the fact that they return
static values is part of the API contract and can be safely
relied upon.</p></li>
<li><p>New accessor methods for <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>. In addition to
the traditional ones, such as <code class="docutils literal notranslate"><span class="pre">getIntValue</span></code>, <code class="docutils literal notranslate"><span class="pre">getName</span></code>,
etc., there are a family of new accessors whose names are of the
form <code class="docutils literal notranslate"><span class="pre">getValueAsX</span></code>. The difference in behavior is as follows:</p>
<ul class="simple">
<li><p>The older accessor methods, which will continue to be
supported, return the value of the object if it is the
expected type. Otherwise, they return a fallback value and
issue a warning.</p></li>
<li><p>The newer accessor methods return a boolean indicating whether
or not the object is of the expected type. If it is, a
reference to a variable of the correct type is initialized.</p></li>
</ul>
<p>In many cases, the new interfaces will enable more compact code
and will also never generate type warnings. Thanks to M. Holger
for contributing these accessors. Search for <code class="docutils literal notranslate"><span class="pre">getValueAs</span></code> in
<code class="file docutils literal notranslate"><span class="pre">include/qpdf/QPDFObjectHandle.hh</span></code> for a complete list.</p>
<p>These are also exposed in the C API in functions whose names
start with <code class="docutils literal notranslate"><span class="pre">qpdf_oh_get_value_as</span></code>.</p>
</li>
<li><p>New convenience methods in <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>:
<code class="docutils literal notranslate"><span class="pre">isDictionaryOfType</span></code>, <code class="docutils literal notranslate"><span class="pre">isStreamOfType</span></code>, and
<code class="docutils literal notranslate"><span class="pre">isNameAndEquals</span></code> allow more compact querying of dictionaries.
Also added to the C API: <code class="docutils literal notranslate"><span class="pre">qpdf_oh_is_dictionary_of_type</span></code> and
<code class="docutils literal notranslate"><span class="pre">qpdf_oh_is_name_and_equals</span></code>. Thanks to M. Holger for the
contribution.</p></li>
<li><p>New convenience method in <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>: <code class="docutils literal notranslate"><span class="pre">getKeyIfDict</span></code>
returns null when called on null and otherwise calls <code class="docutils literal notranslate"><span class="pre">getKey</span></code>.
This makes it easier to access optional, lower-level
dictionaries. It is exposed in the C API
<code class="docutils literal notranslate"><span class="pre">qpdf_oh_get_key_if_dict</span></code>. Thanks to M. Holger for the
contribution.</p></li>
<li><p>New functions added to <code class="docutils literal notranslate"><span class="pre">QUtil</span></code>: <code class="docutils literal notranslate"><span class="pre">make_shared_cstr</span></code> and
<code class="docutils literal notranslate"><span class="pre">make_unique_cstr</span></code> copy <code class="docutils literal notranslate"><span class="pre">std::string</span></code> to
<code class="docutils literal notranslate"><span class="pre">std::shared_ptr&lt;char&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">std::unique_ptr&lt;char[]&gt;</span></code>. These
are alternatives to the existing <code class="docutils literal notranslate"><span class="pre">QUtil::copy_string</span></code> function
which offer other ways to get a C string with safer memory
management.</p></li>
<li><p>New function <code class="docutils literal notranslate"><span class="pre">QUtil::file_can_be_opened</span></code> tests to see whether
a file can actually be opened by attempting to open it and close
it again.</p></li>
<li><p>There is a new version of <code class="docutils literal notranslate"><span class="pre">QUtil::call_main_from_wmain</span></code> that
takes a <code class="docutils literal notranslate"><span class="pre">const</span></code> argv array and calls a main that takes a
<code class="docutils literal notranslate"><span class="pre">const</span></code> argv array.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDF::emptyPDF</span></code> has been exposed to the C API as
<code class="docutils literal notranslate"><span class="pre">qpdf_empty_pdf</span></code>. This makes it possible to create a PDF from
scratch with the C API.</p></li>
<li><p>New C API functions <code class="docutils literal notranslate"><span class="pre">qpdf_oh_get_binary_utf8_value</span></code> and
<code class="docutils literal notranslate"><span class="pre">qpdf_oh_new_binary_unicode_string</span></code> take length parameters,
which makes it possible to handle UTF-8-encoded C strings with
embedded NUL characters. Thanks to M. Holger for the
contribution.</p></li>
<li><p>There is a new <code class="docutils literal notranslate"><span class="pre">PDFVersion</span></code> class for representing a PDF
version number with the ability to compare and order PDF
versions. Methods <code class="docutils literal notranslate"><span class="pre">QPDF::getVersionAsPDFVersion</span></code> and a new
version of <code class="docutils literal notranslate"><span class="pre">QPDFWriter::setMinimumPDFVersion</span></code> use it. This
makes it easier to create an output file whose PDF version is
the maximum of the versions across all the input files that
contributed to it.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">JSON</span></code> object in the qpdf library has been enhanced to
include a parser and the ability to get values out of the
<code class="docutils literal notranslate"><span class="pre">JSON</span></code> object. Previously it was a write-only interface. Even
so, qpdf’s <code class="docutils literal notranslate"><span class="pre">JSON</span></code> object is not intended to be a
general-purpose JSON implementation as discussed in
<code class="file docutils literal notranslate"><span class="pre">include/qpdf/JSON.hh</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">JSON</span></code> object’s “schema” checking functionality now allows
for optional keys. Note that this “schema” functionality doesn’t
conform to any type of standard. It’s just there to help with
error reporting with qpdf’s own JSON support.</p></li>
</ul>
</li>
<li><p>Documentation Enhancements</p>
<ul class="simple">
<li><p>Documentation for the command-line tool has been completely
rewritten. This includes a top-to-bottom rewrite of <a class="reference internal" href="index.html#using"><span class="std std-ref">Running qpdf</span></a>
in the manual. Command-line arguments are now indexed, and
internal links can appear to them within the documentation.</p></li>
<li><p>The output of <code class="docutils literal notranslate"><span class="pre">qpdf</span> <span class="pre">--help</span></code> is generated from the manual and
is divided into help topics that parallel the sections of the
manual. When you run <code class="docutils literal notranslate"><span class="pre">qpdf</span> <span class="pre">--help</span></code>, instead of getting a Great
Wall of Text, you are given basic usage information and a list
of help topics. It is possible to request help for any
individual topic or any specific command-line option, or you can
get a dump of all available help text. The manual continues to
contain a greater level of detail and more examples.</p></li>
</ul>
</li>
<li><p>Bug Fixes</p>
<ul class="simple">
<li><p>Some characters were not correctly translated from PDF doc
encoding to Unicode.</p></li>
<li><p>When splitting or combining pages, ensure that all output files
have a PDF version greater than or equal to the maximum version
of all the input files.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.5.0: December 21, 2021</dt><dd><ul class="simple">
<li><p>Packaging changes</p>
<ul>
<li><p>Pre-built documentation is no longer distributed with the source
distribution. The AppImage and Windows binary distributions
still contain embedded documentation, and a separate <code class="docutils literal notranslate"><span class="pre">doc</span></code>
distribution file is available from the qpdf release site.
Documentation is now available at <a class="reference external" href="https://qpdf.readthedocs.io">https://qpdf.readthedocs.io</a> for every major/minor version
starting with version 10.5. Please see <a class="reference internal" href="index.html#packaging-doc"><span class="std std-ref">Packaging Documentation</span></a> for
details on how packagers should handle documentation.</p></li>
<li><p>The documentation sources have been switched from docbook to
reStructuredText processed with <a class="reference external" href="https://www.sphinx-doc.org">Sphinx</a>. This will break previous
documentation links. A redirect is in place on the main website.
A top-to-bottom review of the documentation is planned for an
upcoming release.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>Since qpdf version 8, using object accessor methods on an
instance of <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> may create warnings if the
object is not of the expected type. These warnings now have an
error code of <code class="docutils literal notranslate"><span class="pre">qpdf_e_object</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">qpdf_e_damaged_pdf</span></code>. Also, comments have been added to
<code class="file docutils literal notranslate"><span class="pre">QPDFObjectHandle.hh</span></code> to explain in more detail what the
behavior is. See <a class="reference internal" href="index.html#object-accessors"><span class="std std-ref">Object Accessor Methods</span></a> for a more in-depth
discussion.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">Pl_Buffer::getMallocBuffer()</span></code> to initialize a buffer
allocated with <code class="docutils literal notranslate"><span class="pre">malloc()</span></code> for better cross-language
interoperability.</p></li>
</ul>
</li>
<li><p>C API Enhancements</p>
<ul>
<li><p>Many thanks to M. Holger whose contributions have heavily
influenced these C API enhancements. His several suggestions,
pull requests, questions, and critical reading of documentation
and comments have resulted in significant usability improvements
to the C API.</p></li>
<li><p>Overhaul error handling for the object handle functions C API.
Some rare error conditions that would previously have caused a
crash are now trapped and reported, and the functions that
generate them return fallback values. See comments in the
<code class="docutils literal notranslate"><span class="pre">ERROR</span> <span class="pre">HANDLING</span></code> section of <code class="file docutils literal notranslate"><span class="pre">include/qpdf/qpdf-c.h</span></code> for
details. In particular, exceptions thrown by the underlying C++
code when calling object accessors are caught and converted into
errors. The errors can be checked by calling <code class="docutils literal notranslate"><span class="pre">qpdf_has_error</span></code>.
Use <code class="docutils literal notranslate"><span class="pre">qpdf_silence_errors</span></code> to prevent the error from being
written to stderr.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">qpdf_get_last_string_length</span></code> to the C API to get the
length of the last string that was returned. This is needed to
handle strings that contain embedded null characters.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">qpdf_oh_is_initialized</span></code> and
<code class="docutils literal notranslate"><span class="pre">qpdf_oh_new_uninitialized</span></code> to the C API to make it possible
to work with uninitialized objects.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">qpdf_oh_new_object</span></code> to the C API. This allows you to
clone an object handle.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">qpdf_get_object_by_id</span></code>, <code class="docutils literal notranslate"><span class="pre">qpdf_make_indirect_object</span></code>,
and <code class="docutils literal notranslate"><span class="pre">qpdf_replace_object</span></code>, exposing the corresponding methods
in <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> and <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>.</p></li>
<li><p>Add several functions for working with pages. See <code class="docutils literal notranslate"><span class="pre">PAGE</span>
<span class="pre">FUNCTIONS</span></code> in <code class="docutils literal notranslate"><span class="pre">include/qpdf/qpdf-c.h</span></code> for details.</p></li>
<li><p>Add several functions for working with streams. See <code class="docutils literal notranslate"><span class="pre">STREAM</span>
<span class="pre">FUNCTIONS</span></code> in <code class="docutils literal notranslate"><span class="pre">include/qpdf/qpdf-c.h</span></code> for details.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">qpdf_oh_get_type_code</span></code> and <code class="docutils literal notranslate"><span class="pre">qpdf_oh_get_type_name</span></code>.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">qpdf_oh_get_binary_string_value</span></code> and
<code class="docutils literal notranslate"><span class="pre">qpdf_oh_new_binary_string</span></code> for making it easier to deal with
strings that contain embedded null characters.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.4.0: November 16, 2021</dt><dd><ul class="simple">
<li><p>Handling of Weak Cryptography Algorithms</p>
<ul>
<li><p>From the qpdf CLI, the
<a class="reference internal" href="index.html#option-allow-weak-crypto" title="option-allow-weak-crypto"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--allow-weak-crypto</span></code></a> is now required to
suppress a warning when explicitly creating PDF files using RC4
encryption. While qpdf will always retain the ability to read
and write such files, doing so will require explicit
acknowledgment moving forward. For qpdf 10.4, this change only
affects the command-line tool. Starting in qpdf 11, there will
be small API changes to require explicit acknowledgment in
those cases as well. For additional information, see <a class="reference internal" href="index.html#weak-crypto"><span class="std std-ref">Weak Cryptography</span></a>.</p></li>
</ul>
</li>
<li><p>Bug Fixes</p>
<ul>
<li><p>Fix potential bounds error when handling shell completion that
could occur when given bogus input.</p></li>
<li><p>Properly handle overlay/underlay on completely empty pages
(with no resource dictionary).</p></li>
<li><p>Fix crash that could occur under certain conditions when using
<a class="reference internal" href="index.html#option-pages" title="option-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--pages</span></code></a> with files that had form
fields.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>Make <code class="docutils literal notranslate"><span class="pre">QPDF::findPage</span></code> functions public.</p></li>
<li><p>Add methods to <code class="docutils literal notranslate"><span class="pre">Pl_Flate</span></code> to be able to receive warnings on
certain recoverable conditions.</p></li>
<li><p>Add an extra check to the library to detect when foreign
objects are inserted directly (instead of using
<code class="docutils literal notranslate"><span class="pre">QPDF::copyForeignObject</span></code>) at the time of insertion rather
than when the file is written. Catching the error sooner makes
it much easier to locate the incorrect code.</p></li>
</ul>
</li>
<li><p>CLI Enhancements</p>
<ul>
<li><p>Improve diagnostics around parsing
<a class="reference internal" href="index.html#option-pages" title="option-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--pages</span></code></a> command-line options</p></li>
</ul>
</li>
<li><p>Packaging Changes</p>
<ul>
<li><p>The Windows binary distribution is now built with crypto
provided by OpenSSL 3.0.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.3.2: May 8, 2021</dt><dd><ul class="simple">
<li><p>Bug Fixes</p>
<ul>
<li><p>When generating a file while preserving object streams,
unreferenced objects are correctly removed unless
<a class="reference internal" href="index.html#option-preserve-unreferenced" title="option-preserve-unreferenced"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--preserve-unreferenced</span></code></a> is specified.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>When adding a page that already exists, make a shallow copy
instead of throwing an exception. This makes the library
behavior consistent with the CLI behavior. See
<code class="file docutils literal notranslate"><span class="pre">ChangeLog</span></code> for additional notes.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.3.1: March 11, 2021</dt><dd><ul class="simple">
<li><p>Bug Fixes</p>
<ul>
<li><p>Form field copying failed on files where /DR was a direct
object in the document-level form dictionary.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.3.0: March 4, 2021</dt><dd><ul class="simple">
<li><p>Bug Fixes</p>
<ul>
<li><p>The code for handling form fields when copying pages from
10.2.0 was not quite right and didn’t work in a number of
situations, such as when the same page was copied multiple
times or when there were conflicting resource or field names
across multiple copies. The 10.3.0 code has been much more
thoroughly tested with more complex cases and with a multitude
of readers and should be much closer to correct. The 10.2.0
code worked well enough for page splitting or for copying pages
with form fields into documents that didn’t already have them
but was still not quite correct in handling of field-level
resources.</p></li>
<li><p>When <code class="docutils literal notranslate"><span class="pre">QPDF::replaceObject</span></code> or <code class="docutils literal notranslate"><span class="pre">QPDF::swapObjects</span></code> is
called, existing <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> instances no longer point
to the old objects. The next time they are accessed, they
automatically notice the change to the underlying object and
update themselves. This resolves a very longstanding source of
confusion, albeit in a very rarely used method call.</p></li>
<li><p>Fix form field handling code to look for default appearances,
quadding, and default resources in the right places. The code
was not looking for things in the document-level interactive
form dictionary that it was supposed to be finding there. This
required adding a few new methods to
<code class="docutils literal notranslate"><span class="pre">QPDFFormFieldObjectHelper</span></code>.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>Reworked the code that handles copying annotations and form
fields during page operations. There were additional methods
added to the public API from 10.2.0 and a one deprecation of a
method added in 10.2.0. The majority of the API changes are in
methods most people would never call and that will hopefully be
superseded by higher-level interfaces for handling page copies.
Please see the <code class="file docutils literal notranslate"><span class="pre">ChangeLog</span></code> file for
details.</p></li>
<li><p>The method <code class="docutils literal notranslate"><span class="pre">QPDF::numWarnings</span></code> was added so that you can tell
whether any warnings happened during a specific block of code.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.2.0: February 23, 2021</dt><dd><ul class="simple">
<li><p>CLI Behavior Changes</p>
<ul>
<li><p>Operations that work on combining pages are much better about
protecting form fields. In particular,
<a class="reference internal" href="index.html#option-split-pages" title="option-split-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--split-pages</span></code></a> and
<a class="reference internal" href="index.html#option-pages" title="option-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--pages</span></code></a> now preserve interaction form
functionality by copying the relevant form field information
from the original files. Additionally, if you use
<a class="reference internal" href="index.html#option-pages" title="option-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--pages</span></code></a> to select only some pages from
the original input file, unused form fields are removed, which
prevents lots of unused annotations from being retained.</p></li>
<li><p>By default, <strong class="command">qpdf</strong> no longer allows
creation of encrypted PDF files whose user password is
non-empty and owner password is empty when a 256-bit key is in
use. The <a class="reference internal" href="index.html#option-allow-insecure" title="option-allow-insecure"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--allow-insecure</span></code></a> option,
specified inside the <a class="reference internal" href="index.html#option-encrypt" title="option-encrypt"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--encrypt</span></code></a> options,
allows creation of such files. Behavior changes in the CLI are
avoided when possible, but an exception was made here because
this is security-related. qpdf must always allow creation of
weird files for testing purposes, but it should not default to
letting users unknowingly create insecure files.</p></li>
</ul>
</li>
<li><p>Library Behavior Changes</p>
<ul>
<li><p>Note: the changes in this section cause differences in output
in some cases. These differences change the syntax of the PDF
but do not change the semantics (meaning). I make a strong
effort to avoid gratuitous changes in qpdf’s output so that
qpdf changes don’t break people’s tests. In this case, the
changes significantly improve the readability of the generated
PDF and don’t affect any output that’s generated by simple
transformation. If you are annoyed by having to update test
files, please rest assured that changes like this have been and
will continue to be rare events.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::newUnicodeString</span></code> now uses whichever of
ASCII, PDFDocEncoding, of UTF-16 is sufficient to encode all
the characters in the string. This reduces needless encoding in
UTF-16 of strings that can be encoded in ASCII. This change may
cause qpdf to generate different output than before when form
field values are set using <code class="docutils literal notranslate"><span class="pre">QPDFFormFieldObjectHelper</span></code> but
does not change the meaning of the output.</p></li>
<li><p>The code that places form XObjects and also the code that
flattens rotations trim trailing zeroes from real numbers that
they calculate. This causes slight (but semantically
equivalent) differences in generated appearance streams and
form XObject invocations in overlay/underlay code or in user
code that calls the methods that place form XObjects on a page.</p></li>
</ul>
</li>
<li><p>CLI Enhancements</p>
<ul>
<li><p>Add new command line options for listing, saving, adding,
removing, and and copying file attachments. See <a class="reference internal" href="index.html#attachments"><span class="std std-ref">Embedded Files/Attachments</span></a> for details.</p></li>
<li><p>Page splitting and merging operations, as well as
<a class="reference internal" href="index.html#option-flatten-rotation" title="option-flatten-rotation"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--flatten-rotation</span></code></a>, are better behaved
with respect to annotations and interactive form fields. In
most cases, interactive form field functionality and proper
formatting and functionality of annotations is preserved by
these operations. There are still some cases that aren’t
perfect, such as when functionality of annotations depends on
document-level data that qpdf doesn’t yet understand or when
there are problems with referential integrity among form fields
and annotations (e.g., when a single form field object or its
associated annotations are shared across multiple pages, a case
that is out of spec but that works in most viewers anyway).</p></li>
<li><p>The option
<code class="samp docutils literal notranslate"><span class="pre">--password-file=</span><em><span class="pre">filename</span></em></code>
can now be used to read the decryption password from a file.
You can use <code class="docutils literal notranslate"><span class="pre">-</span></code> as the file name to read the password from
standard input. This is an easier/more obvious way to read
passwords from files or standard input than using
<code class="samp docutils literal notranslate"><span class="pre">&#64;file</span></code> for this purpose.</p></li>
<li><p>Add some information about attachments to the JSON output, and
added <code class="docutils literal notranslate"><span class="pre">attachments</span></code> as an additional JSON key. The
information included here is limited to the preferred name and
content stream and a reference to the file spec object. This is
enough detail for clients to avoid the hassle of navigating a
name tree and provides what is needed for basic enumeration and
extraction of attachments. More detailed information can be
obtained by following the reference to the file spec object.</p></li>
<li><p>Add numeric option to <a class="reference internal" href="index.html#option-collate" title="option-collate"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--collate</span></code></a>. If
<code class="samp docutils literal notranslate"><span class="pre">--collate=</span><em><span class="pre">n</span></em></code>
is given, take pages in groups of
<code class="samp docutils literal notranslate"><em><span class="pre">n</span></em></code> from the given files.</p></li>
<li><p>It is now valid to provide <code class="samp docutils literal notranslate"><span class="pre">--rotate=0</span></code>
to clear rotation from a page.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>This release includes numerous additions to the API. Not all
changes are listed here. Please see the
<code class="file docutils literal notranslate"><span class="pre">ChangeLog</span></code> file in the source
distribution for a comprehensive list. Highlights appear below.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::ditems()</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::aitems()</span></code> that enable C++-style iteration,
including range-for iteration, over dictionary and array
QPDFObjectHandles. See comments in
<code class="file docutils literal notranslate"><span class="pre">include/qpdf/QPDFObjectHandle.hh</span></code>
and
<code class="file docutils literal notranslate"><span class="pre">examples/pdf-name-number-tree.cc</span></code>
for details.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::copyStream</span></code> for making a copy of a
stream within the same <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> instance.</p></li>
<li><p>Add new helper classes for supporting file attachments, also
known as embedded files. New classes are
<code class="docutils literal notranslate"><span class="pre">QPDFEmbeddedFileDocumentHelper</span></code>,
<code class="docutils literal notranslate"><span class="pre">QPDFFileSpecObjectHelper</span></code>, and <code class="docutils literal notranslate"><span class="pre">QPDFEFStreamObjectHelper</span></code>.
See their respective headers for details and
<code class="file docutils literal notranslate"><span class="pre">examples/pdf-attach-file.cc</span></code> for an
example.</p></li>
<li><p>Add a version of <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::parse</span></code> that takes a
<code class="docutils literal notranslate"><span class="pre">QPDF</span></code> pointer as context so that it can parse strings
containing indirect object references. This is illustrated in
<code class="file docutils literal notranslate"><span class="pre">examples/pdf-attach-file.cc</span></code>.</p></li>
<li><p>Re-implement <code class="docutils literal notranslate"><span class="pre">QPDFNameTreeObjectHelper</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFNumberTreeObjectHelper</span></code> to be more efficient, add an
iterator-based API, give them the capability to repair broken
trees, and create methods for modifying the trees. With this
change, qpdf has a robust read/write implementation of name and
number trees.</p></li>
<li><p>Add new versions of <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::replaceStreamData</span></code>
that take <code class="docutils literal notranslate"><span class="pre">std::function</span></code> objects for cases when you need
something between a static string and a full-fledged
StreamDataProvider. Using this with <code class="docutils literal notranslate"><span class="pre">QUtil::file_provider</span></code> is
a very easy way to create a stream from the contents of a file.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">QPDFMatrix</span></code> class, formerly a private, internal class,
has been added to the public API. See
<code class="file docutils literal notranslate"><span class="pre">include/qpdf/QPDFMatrix.hh</span></code> for
details. This class is for working with transformation
matrices. Some methods in <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper</span></code> make use of
this to make information about transformation matrices
available. For an example, see
<code class="file docutils literal notranslate"><span class="pre">examples/pdf-overlay-page.cc</span></code>.</p></li>
<li><p>Several new methods were added to
<code class="docutils literal notranslate"><span class="pre">QPDFAcroFormDocumentHelper</span></code> for adding, removing, getting
information about, and enumerating form fields.</p></li>
<li><p>Add method
<code class="docutils literal notranslate"><span class="pre">QPDFAcroFormDocumentHelper::transformAnnotations</span></code>, which
applies a transformation to each annotation on a page.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper::copyAnnotations</span></code>, which copies
annotations and, if applicable, associated form fields, from
one page to another, possibly transforming the rectangles.</p></li>
</ul>
</li>
<li><p>Build Changes</p>
<ul>
<li><p>A C++-14 compiler is now required to build qpdf. There is no
intention to require anything newer than that for a while.
C++-14 includes modest enhancements to C++-11 and appears to be
supported about as widely as C++-11.</p></li>
</ul>
</li>
<li><p>Bug Fixes</p>
<ul>
<li><p>The <a class="reference internal" href="index.html#option-flatten-rotation" title="option-flatten-rotation"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--flatten-rotation</span></code></a> option applies
transformations to any annotations that may be on the page.</p></li>
<li><p>If a form XObject lacks a resources dictionary, consider any
names in that form XObject to be referenced from the containing
page. This is compliant with older PDF versions. Also detect if
any form XObjects have any unresolved names and, if so, don’t
remove unreferenced resources from them or from the page that
contains them. Unfortunately this has the side effect of
preventing removal of unreferenced resources in some cases
where names appear that don’t refer to resources, such as with
tagged PDF. This is a bit of a corner case that is not likely
to cause a significant problem in practice, but the only side
effect would be lack of removal of shared resources. A future
version of qpdf may be more sophisticated in its detection of
names that refer to resources.</p></li>
<li><p>Properly handle strings if they appear in inline image
dictionaries while externalizing inline images.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.1.0: January 5, 2021</dt><dd><ul class="simple">
<li><p>CLI Enhancements</p>
<ul>
<li><p>Add <a class="reference internal" href="index.html#option-flatten-rotation" title="option-flatten-rotation"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--flatten-rotation</span></code></a> command-line
option, which causes all pages that are rotated using
parameters in the page’s dictionary to instead be identically
rotated in the page’s contents. The change is not user-visible
for compliant PDF readers but can be used to work around broken
PDF applications that don’t properly handle page rotation.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>Support for user-provided (pluggable, modular) stream filters.
It is now possible to derive a class from <code class="docutils literal notranslate"><span class="pre">QPDFStreamFilter</span></code>
and register it with <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> so that regular library methods,
including those used by <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code>, can decode streams with
filters not directly supported by the library. The example
<code class="file docutils literal notranslate"><span class="pre">examples/pdf-custom-filter.cc</span></code>
illustrates how to use this capability.</p></li>
<li><p>Add methods to <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper</span></code> to iterate through
XObjects on a page or form XObjects, possibly recursing into
nested form XObjects: <code class="docutils literal notranslate"><span class="pre">forEachXObject</span></code>, <code class="docutils literal notranslate"><span class="pre">ForEachImage</span></code>,
<code class="docutils literal notranslate"><span class="pre">forEachFormXObject</span></code>.</p></li>
<li><p>Enhance several methods in <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper</span></code> to work
with form XObjects as well as pages, as noted in comments. See
<code class="file docutils literal notranslate"><span class="pre">ChangeLog</span></code> for a full list.</p></li>
<li><p>Rename some functions in <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper</span></code>, while
keeping old names for compatibility:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">getPageImages</span></code> to <code class="docutils literal notranslate"><span class="pre">getImages</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">filterPageContents</span></code> to <code class="docutils literal notranslate"><span class="pre">filterContents</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pipePageContents</span></code> to <code class="docutils literal notranslate"><span class="pre">pipeContents</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">parsePageContents</span></code> to <code class="docutils literal notranslate"><span class="pre">parseContents</span></code></p></li>
</ul>
</li>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper::getFormXObjects</span></code> to return
a map of form XObjects directly on a page or form XObject</p></li>
<li><p>Add new helper methods to <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>:
<code class="docutils literal notranslate"><span class="pre">isFormXObject</span></code>, <code class="docutils literal notranslate"><span class="pre">isImage</span></code></p></li>
<li><p>Add the optional <code class="docutils literal notranslate"><span class="pre">allow_streams</span></code> parameter
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::makeDirect</span></code>. When
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::makeDirect</span></code> is called in this way, it
preserves references to streams rather than throwing an
exception.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::setFilterOnWrite</span></code> method. Calling this
on a stream prevents <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> from attempting to
uncompress, recompress, or otherwise filter a stream even if it
could. Developers can use this to protect streams that are
optimized should be protected from <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code>’s default
behavior for any other reason.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">ostream</span></code> <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> operator for <code class="docutils literal notranslate"><span class="pre">QPDFObjGen</span></code>. This is
useful to have for debugging.</p></li>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper::flattenRotation</span></code>, which
replaces a page’s <code class="docutils literal notranslate"><span class="pre">/Rotate</span></code> keyword by rotating the page
within the content stream and altering the page’s bounding
boxes so the rendering is the same. This can be used to work
around buggy PDF readers that can’t properly handle page
rotation.</p></li>
</ul>
</li>
<li><p>C API Enhancements</p>
<ul>
<li><p>Add several new functions to the C API for working with
objects. These are wrappers around many of the methods in
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>. Their inclusion adds considerable new
capability to the C API.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">qpdf_register_progress_reporter</span></code> to the C API,
corresponding to <code class="docutils literal notranslate"><span class="pre">QPDFWriter::registerProgressReporter</span></code>.</p></li>
</ul>
</li>
<li><p>Performance Enhancements</p>
<ul>
<li><p>Improve steps <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> takes to prepare a <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object
for writing, resulting in about an 8% improvement in write
performance while allowing indirect objects to appear in
<code class="docutils literal notranslate"><span class="pre">/DecodeParms</span></code>.</p></li>
<li><p>When extracting pages, the <strong class="command">qpdf</strong> CLI
only removes unreferenced resources from the pages that are
being kept, resulting in a significant performance improvement
when extracting small numbers of pages from large, complex
documents.</p></li>
</ul>
</li>
<li><p>Bug Fixes</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper::externalizeInlineImages</span></code> was not
externalizing images referenced from form XObjects that
appeared on the page.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::filterPageContents</span></code> was broken for pages
with multiple content streams.</p></li>
<li><p>Tweak zsh completion code to behave a little better with
respect to path completion.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.0.4: November 21, 2020</dt><dd><ul class="simple">
<li><p>Bug Fixes</p>
<ul>
<li><p>Fix a handful of integer overflows. This includes cases found
by fuzzing as well as having qpdf not do range checking on
unused values in the xref stream.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.0.3: October 31, 2020</dt><dd><ul class="simple">
<li><p>Bug Fixes</p>
<ul>
<li><p>The fix to the bug involving copying streams with indirect
filters was incorrect and introduced a new, more serious bug.
The original bug has been fixed correctly, as has the bug
introduced in 10.0.2.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.0.2: October 27, 2020</dt><dd><ul class="simple">
<li><p>Bug Fixes</p>
<ul>
<li><p>When concatenating content streams, as with
<a class="reference internal" href="index.html#option-coalesce-contents" title="option-coalesce-contents"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--coalesce-contents</span></code></a>, there were cases
in which qpdf would merge two lexical tokens together, creating
invalid results. A newline is now inserted between merged
content streams if one is not already present.</p></li>
<li><p>Fix an internal error that could occur when copying foreign
streams whose stream data had been replaced using a stream data
provider if those streams had indirect filters or decode
parameters. This is a rare corner case.</p></li>
<li><p>Ensure that the caller’s locale settings do not change the
results of numeric conversions performed internally by the qpdf
library. Note that the problem here could only be caused when
the qpdf library was used programmatically. Using the qpdf CLI
already ignored the user’s locale for numeric conversion.</p></li>
<li><p>Fix several instances in which warnings were not suppressed in
spite of <a class="reference internal" href="index.html#option-no-warn" title="option-no-warn"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--no-warn</span></code></a> and/or errors or
warnings were written to standard output rather than standard
error.</p></li>
<li><p>Fixed a memory leak that could occur under specific
circumstances when
<code class="samp docutils literal notranslate"><span class="pre">--object-streams=generate</span></code> was used.</p></li>
<li><p>Fix various integer overflows and similar conditions found by
the OSS-Fuzz project.</p></li>
</ul>
</li>
<li><p>Enhancements</p>
<ul>
<li><p>New option <a class="reference internal" href="index.html#option-warning-exit-0" title="option-warning-exit-0"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--warning-exit-0</span></code></a> causes qpdf
to exit with a status of <code class="docutils literal notranslate"><span class="pre">0</span></code> rather than <code class="docutils literal notranslate"><span class="pre">3</span></code> if there are
warnings but no errors. Combine with
<a class="reference internal" href="index.html#option-no-warn" title="option-no-warn"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--no-warn</span></code></a> to completely ignore
warnings.</p></li>
<li><p>Performance improvements have been made to
<code class="docutils literal notranslate"><span class="pre">QPDF::processMemoryFile</span></code>.</p></li>
<li><p>The OpenSSL crypto provider produces more detailed error
messages.</p></li>
</ul>
</li>
<li><p>Build Changes</p>
<ul>
<li><p>The option <code class="samp docutils literal notranslate"><span class="pre">--disable-rpath</span></code> is now
supported by qpdf’s <strong class="command">./configure</strong>
script. Some distributions’ packaging standards recommended the
use of this option.</p></li>
<li><p>Selection of a printf format string for <code class="docutils literal notranslate"><span class="pre">long</span> <span class="pre">long</span></code> has
been moved from <code class="docutils literal notranslate"><span class="pre">ifdefs</span></code> to an autoconf
test. If you are using your own build system, you will need to
provide a value for <code class="docutils literal notranslate"><span class="pre">LL_FMT</span></code> in
<code class="file docutils literal notranslate"><span class="pre">libqpdf/qpdf/qpdf-config.h</span></code>, which
would typically be <code class="docutils literal notranslate"><span class="pre">&quot;%lld&quot;</span></code> or, for some Windows compilers,
<code class="docutils literal notranslate"><span class="pre">&quot;%I64d&quot;</span></code>.</p></li>
<li><p>Several improvements were made to build-time configuration of
the OpenSSL crypto provider.</p></li>
<li><p>A nearly stand-alone Linux binary zip file is now included with
the qpdf release. This is built on an older (but supported)
Ubuntu LTS release, but would work on most reasonably recent
Linux distributions. It contains only the executables and
required shared libraries that would not be present on a
minimal system. It can be used for including qpdf in a minimal
environment, such as a docker container. The zip file is also
known to work as a layer in AWS Lambda.</p></li>
<li><p>QPDF’s automated build has been migrated from Azure Pipelines
to GitHub Actions.</p></li>
</ul>
</li>
<li><p>Windows-specific Changes</p>
<ul>
<li><p>The Windows executables distributed with qpdf releases now use
the OpenSSL crypto provider by default. The native crypto
provider is also compiled in and can be selected at runtime
with the <code class="docutils literal notranslate"><span class="pre">QPDF_CRYPTO_PROVIDER</span></code> environment variable.</p></li>
<li><p>Improvements have been made to how a cryptographic provider is
obtained in the native Windows crypto implementation. However
mostly this is shadowed by OpenSSL being used by default.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.0.1: April 9, 2020</dt><dd><ul class="simple">
<li><p>Bug Fixes</p>
<ul>
<li><p>10.0.0 introduced a bug in which calling
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getStreamData</span></code> on a stream that can’t be
filtered was returning the raw data instead of throwing an
exception. This is now fixed.</p></li>
<li><p>Fix a bug that was preventing qpdf from linking with some
versions of clang on some platforms.</p></li>
</ul>
</li>
<li><p>Enhancements</p>
<ul>
<li><p>Improve the <code class="file docutils literal notranslate"><span class="pre">pdf-invert-images</span></code>
example to avoid having to load all the images into RAM at the
same time.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.0.0: April 6, 2020</dt><dd><ul class="simple">
<li><p>Performance Enhancements</p>
<ul>
<li><p>The qpdf library and executable should run much faster in this
version than in the last several releases. Several internal
library optimizations have been made, and there has been
improved behavior on page splitting as well. This version of
qpdf should outperform any of the 8.x or 9.x versions.</p></li>
</ul>
</li>
<li><p>Incompatible API (source-level) Changes (minor)</p>
<ul>
<li><p>The <code class="docutils literal notranslate"><span class="pre">QUtil::srandom</span></code> method was removed. It didn’t do
anything unless insecure random numbers were compiled in, and
they have been off by default for a long time. If you were
calling it, just remove the call since it wasn’t doing anything
anyway.</p></li>
</ul>
</li>
<li><p>Build/Packaging Changes</p>
<ul>
<li><p>Add a <code class="docutils literal notranslate"><span class="pre">openssl</span></code> crypto provider, which is implemented with
OpenSSL and also works with BoringSSL. Thanks to Dean Scarff
for this contribution. If you maintain qpdf for a distribution,
pay special attention to make sure that you are including
support for the crypto providers you want. Package maintainers
will have to weigh the advantages of allowing users to pick a
crypto provider at runtime against the disadvantages of adding
more dependencies to qpdf.</p></li>
<li><p>Allow qpdf to built on stripped down systems whose C/C++
libraries lack the <code class="docutils literal notranslate"><span class="pre">wchar_t</span></code> type. Search for <code class="docutils literal notranslate"><span class="pre">wchar_t</span></code> in
qpdf’s README.md for details. This should be very rare, but it
is known to be helpful in some embedded environments.</p></li>
</ul>
</li>
<li><p>CLI Enhancements</p>
<ul>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">objectinfo</span></code> key to the JSON output. This will be a place
to put computed metadata or other information about PDF objects
that are not immediately evident in other ways or that seem
useful for some other reason. In this version, information is
provided about each object indicating whether it is a stream
and, if so, what its length and filters are. Without this, it
was not possible to tell conclusively from the JSON output
alone whether or not an object was a stream. Run
<strong class="command">qpdf --json-help</strong> for details.</p></li>
<li><p>Add new option
<a class="reference internal" href="index.html#option-remove-unreferenced-resources" title="option-remove-unreferenced-resources"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--remove-unreferenced-resources</span></code></a> which
takes <code class="docutils literal notranslate"><span class="pre">auto</span></code>, <code class="docutils literal notranslate"><span class="pre">yes</span></code>, or <code class="docutils literal notranslate"><span class="pre">no</span></code> as arguments. The new
<code class="docutils literal notranslate"><span class="pre">auto</span></code> mode, which is the default, performs a fast heuristic
over a PDF file when splitting pages to determine whether the
expensive process of finding and removing unreferenced
resources is likely to be of benefit. For most files, this new
default will result in a significant performance improvement
for splitting pages.</p></li>
<li><p>The <a class="reference internal" href="index.html#option-preserve-unreferenced-resources" title="option-preserve-unreferenced-resources"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--preserve-unreferenced-resources</span></code></a>
is now just a synonym for
<code class="samp docutils literal notranslate"><span class="pre">--remove-unreferenced-resources=no</span></code>.</p></li>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">QPDF_EXECUTABLE</span></code> environment variable is set when
invoking <strong class="command">qpdf --bash-completion</strong> or
<strong class="command">qpdf --zsh-completion</strong>, the completion
command that it outputs will refer to qpdf using the value of
that variable rather than what <strong class="command">qpdf</strong>
determines its executable path to be. This can be useful when
wrapping <strong class="command">qpdf</strong> with a script, working
with a version in the source tree, using an AppImage, or other
situations where there is some indirection.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>Random number generation is now delegated to the crypto
provider. The old behavior is still used by the native crypto
provider. It is still possible to provide your own random
number generator.</p></li>
<li><p>Add a new version of
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::StreamDataProvider::provideStreamData</span></code>
that accepts the <code class="docutils literal notranslate"><span class="pre">suppress_warnings</span></code> and <code class="docutils literal notranslate"><span class="pre">will_retry</span></code>
options and allows a success code to be returned. This makes it
possible to implement a <code class="docutils literal notranslate"><span class="pre">StreamDataProvider</span></code> that calls
<code class="docutils literal notranslate"><span class="pre">pipeStreamData</span></code> on another stream and to pass the response
back to the caller, which enables better error handling on
those proxied streams.</p></li>
<li><p>Update <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::pipeStreamData</span></code> to return an
overall success code that goes beyond whether or not filtered
data was written successfully. This allows better error
handling of cases that were not filtering errors. You have to
call this explicitly. Methods in previously existing APIs have
the same semantics as before.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper::placeFormXObject</span></code> method now
allows separate control over whether it should be willing to
shrink or expand objects to fit them better into the
destination rectangle. The previous behavior was that shrinking
was allowed but expansion was not. The previous behavior is
still the default.</p></li>
<li><p>When calling the C API, any non-zero value passed to a boolean
parameter is treated as <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>. Previously only the value
<code class="docutils literal notranslate"><span class="pre">1</span></code> was accepted. This makes the C API behave more like most
C interfaces and is known to improve compatibility with some
Windows environments that dynamically load the DLL and call
functions from it.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::unsafeShallowCopy</span></code> for copying only
top-level dictionary keys or array items. This is unsafe
because it creates a situation in which changing a lower-level
item in one object may also change it in another object, but
for cases in which you <em>know</em> you are only inserting or
replacing top-level items, it is much faster than
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::shallowCopy</span></code>.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::filterAsContents</span></code>, which filter’s a
stream’s data as a content stream. This is useful for parsing
the contents for form XObjects in the same way as parsing page
content streams.</p></li>
</ul>
</li>
<li><p>Bug Fixes</p>
<ul>
<li><p>When detecting and removing unreferenced resources during page
splitting, traverse into form XObjects and handle their
resources dictionaries as well.</p></li>
<li><p>The same error recovery is applied to streams in other than the
primary input file when merging or splitting pages.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>9.1.1: January 26, 2020</dt><dd><ul class="simple">
<li><p>Build/Packaging Changes</p>
<ul>
<li><p>The fix-qdf program was converted from perl to C++. As such,
qpdf no longer has a runtime dependency on perl.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>Added new helper routine <code class="docutils literal notranslate"><span class="pre">QUtil::call_main_from_wmain</span></code> which
converts <code class="docutils literal notranslate"><span class="pre">wchar_t</span></code> arguments to UTF-8 encoded strings. This
is useful for qpdf because library methods expect file names to
be UTF-8 encoded, even on Windows</p></li>
<li><p>Added new <code class="docutils literal notranslate"><span class="pre">QUtil::read_lines_from_file</span></code> methods that take
<code class="docutils literal notranslate"><span class="pre">FILE*</span></code> arguments and that allow preservation of end-of-line
characters. This also fixes a bug where
<code class="docutils literal notranslate"><span class="pre">QUtil::read_lines_from_file</span></code> wouldn’t work properly with
Unicode filenames.</p></li>
</ul>
</li>
<li><p>CLI Enhancements</p>
<ul>
<li><p>Added options <a class="reference internal" href="index.html#option-is-encrypted" title="option-is-encrypted"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--is-encrypted</span></code></a> and
<a class="reference internal" href="index.html#option-requires-password" title="option-requires-password"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--requires-password</span></code></a> for testing whether
a file is encrypted or requires a password other than the
supplied (or empty) password. These communicate via exit
status, making them useful for shell scripts. They also work on
encrypted files with unknown passwords.</p></li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">encrypt</span></code> key to JSON options. With the exception of
the reconstructed user password for older encryption formats,
this provides the same information as
<a class="reference internal" href="index.html#option-show-encryption" title="option-show-encryption"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--show-encryption</span></code></a> but in a consistent,
parseable format. See output of <strong class="command">qpdf
--json-help</strong> for details.</p></li>
</ul>
</li>
<li><p>Bug Fixes</p>
<ul>
<li><p>In QDF mode, be sure not to write more than one XRef stream to
a file, even when
<a class="reference internal" href="index.html#option-preserve-unreferenced" title="option-preserve-unreferenced"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--preserve-unreferenced</span></code></a> is used.
<strong class="command">fix-qdf</strong> assumes that there is only
one XRef stream, and that it appears at the end of the file.</p></li>
<li><p>When externalizing inline images, properly handle images whose
color space is a reference to an object in the page’s resource
dictionary.</p></li>
<li><p>Windows-specific fix for acquiring crypt context with a new
keyset.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>9.1.0: November 17, 2019</dt><dd><ul class="simple">
<li><p>Build Changes</p>
<ul>
<li><p>A C++-11 compiler is now required to build qpdf.</p></li>
<li><p>A new crypto provider that uses gnutls for crypto functions is
now available and can be enabled at build time. See <a class="reference internal" href="index.html#crypto"><span class="std std-ref">Crypto Providers</span></a> for more information about crypto
providers and <a class="reference internal" href="index.html#crypto-build"><span class="std std-ref">Build-time Crypto Selection</span></a> for specific information about
the build.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>Incorporate contribution from Masamichi Hosoda to properly
handle signature dictionaries by not including them in object
streams, formatting the <code class="docutils literal notranslate"><span class="pre">Contents</span></code> key has a hexadecimal
string, and excluding the <code class="docutils literal notranslate"><span class="pre">/Contents</span></code> key from encryption and
decryption.</p></li>
<li><p>Incorporate contribution from Masamichi Hosoda to provide new
API calls for getting file-level information about input and
output files, enabling certain operations on the files at the
file level rather than the object level. New methods include
<code class="docutils literal notranslate"><span class="pre">QPDF::getXRefTable()</span></code>,
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getParsedOffset()</span></code>,
<code class="docutils literal notranslate"><span class="pre">QPDFWriter::getRenumberedObjGen(QPDFObjGen)</span></code>, and
<code class="docutils literal notranslate"><span class="pre">QPDFWriter::getWrittenXRefTable()</span></code>.</p></li>
<li><p>Support build-time and runtime selectable crypto providers.
This includes the addition of new classes
<code class="docutils literal notranslate"><span class="pre">QPDFCryptoProvider</span></code> and <code class="docutils literal notranslate"><span class="pre">QPDFCryptoImpl</span></code> and the
recognition of the <code class="docutils literal notranslate"><span class="pre">QPDF_CRYPTO_PROVIDER</span></code> environment
variable. Crypto providers are described in depth in <a class="reference internal" href="index.html#crypto"><span class="std std-ref">Crypto Providers</span></a>.</p></li>
</ul>
</li>
<li><p>CLI Enhancements</p>
<ul>
<li><p>Addition of the <a class="reference internal" href="index.html#option-show-crypto" title="option-show-crypto"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--show-crypto</span></code></a> option in
support of selectable crypto providers, as described in <a class="reference internal" href="index.html#crypto"><span class="std std-ref">Crypto Providers</span></a>.</p></li>
<li><p>Allow <code class="docutils literal notranslate"><span class="pre">:even</span></code> or <code class="docutils literal notranslate"><span class="pre">:odd</span></code> to be appended to numeric ranges
for specification of the even or odd pages from among the pages
specified in the range.</p></li>
<li><p>Fix shell wildcard expansion behavior (<code class="docutils literal notranslate"><span class="pre">*</span></code> and <code class="docutils literal notranslate"><span class="pre">?</span></code>) of the
<strong class="command">qpdf.exe</strong> as built my MSVC.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>9.0.2: October 12, 2019</dt><dd><ul class="simple">
<li><p>Bug Fix</p>
<ul>
<li><p>Fix the name of the temporary file used by
<a class="reference internal" href="index.html#option-replace-input" title="option-replace-input"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--replace-input</span></code></a> so that it doesn’t
require path splitting and works with paths include
directories.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>9.0.1: September 20, 2019</dt><dd><ul class="simple">
<li><p>Bug Fixes/Enhancements</p>
<ul>
<li><p>Fix some build and test issues on big-endian systems and
compilers with characters that are unsigned by default. The
problems were in build and test only. There were no actual bugs
in the qpdf library itself relating to endianness or unsigned
characters.</p></li>
<li><p>When a dictionary has a duplicated key, report this with a
warning. The behavior of the library in this case is unchanged,
but the error condition is no longer silently ignored.</p></li>
<li><p>When a form field’s display rectangle is erroneously specified
with inverted coordinates, detect and correct this situation.
This avoids some form fields from being flipped when flattening
annotations on files with this condition.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>9.0.0: August 31, 2019</dt><dd><ul class="simple">
<li><p>Incompatible API (source-level) Changes (minor)</p>
<ul>
<li><p>The method <code class="docutils literal notranslate"><span class="pre">QUtil::strcasecmp</span></code> has been renamed to
<code class="docutils literal notranslate"><span class="pre">QUtil::str_compare_nocase</span></code>. This incompatible change is
necessary to enable qpdf to build on platforms that define
<code class="docutils literal notranslate"><span class="pre">strcasecmp</span></code> as a macro.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">QPDF::copyForeignObject</span></code> method had an overloaded
version that took a boolean parameter that was not used. If you
were using this version, just omit the extra parameter.</p></li>
<li><p>There was a version <code class="docutils literal notranslate"><span class="pre">QPDFTokenizer::expectInlineImage</span></code> that
took no arguments. This version has been removed since it
caused the tokenizer to return incorrect inline images. A new
version was added some time ago that produces correct output.
This is a very low level method that doesn’t make sense to call
outside of qpdf’s lexical engine. There are higher level
methods for tokenizing content streams.</p></li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">QPDFOutlineDocumentHelper::getTopLevelOutlines</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFOutlineObjectHelper::getKids</span></code> to return a
<code class="docutils literal notranslate"><span class="pre">std::vector</span></code> instead of a <code class="docutils literal notranslate"><span class="pre">std::list</span></code> of
<code class="docutils literal notranslate"><span class="pre">QPDFOutlineObjectHelper</span></code> objects.</p></li>
<li><p>Remove method <code class="docutils literal notranslate"><span class="pre">QPDFTokenizer::allowPoundAnywhereInName</span></code>. This
function would allow creation of name tokens whose value would
change when unparsed, which is never the correct behavior.</p></li>
</ul>
</li>
<li><p>CLI Enhancements</p>
<ul>
<li><p>The <a class="reference internal" href="index.html#option-replace-input" title="option-replace-input"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--replace-input</span></code></a> option may be given
in place of an output file name. This causes qpdf to overwrite
the input file with the output. See the description of
<a class="reference internal" href="index.html#option-replace-input" title="option-replace-input"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--replace-input</span></code></a> for more details.</p></li>
<li><p>The <a class="reference internal" href="index.html#option-recompress-flate" title="option-recompress-flate"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--recompress-flate</span></code></a> instructs
<strong class="command">qpdf</strong> to recompress streams that are
already compressed with <code class="docutils literal notranslate"><span class="pre">/FlateDecode</span></code>. Useful with
<a class="reference internal" href="index.html#option-compression-level" title="option-compression-level"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--compression-level</span></code></a>.</p></li>
<li><p>The
<code class="samp docutils literal notranslate"><span class="pre">--compression-level=</span><em><span class="pre">level</span></em></code>
sets the zlib compression level used for any streams compressed
by <code class="docutils literal notranslate"><span class="pre">/FlateDecode</span></code>. Most effective when combined with
<a class="reference internal" href="index.html#option-recompress-flate" title="option-recompress-flate"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--recompress-flate</span></code></a>.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>A new namespace <code class="docutils literal notranslate"><span class="pre">QIntC</span></code>, provided by
<code class="file docutils literal notranslate"><span class="pre">qpdf/QIntC.hh</span></code>, provides safe
conversion methods between different integer types. These
conversion methods do range checking to ensure that the cast
can be performed with no loss of information. Every use of
<code class="docutils literal notranslate"><span class="pre">static_cast</span></code> in the library was inspected to see if it could
use one of these safe converters instead. See <a class="reference internal" href="index.html#casting"><span class="std std-ref">Casting Policy</span></a> for additional details.</p></li>
<li><p>Method <code class="docutils literal notranslate"><span class="pre">QPDF::anyWarnings</span></code> tells whether there have been any
warnings without clearing the list of warnings.</p></li>
<li><p>Method <code class="docutils literal notranslate"><span class="pre">QPDF::closeInputSource</span></code> closes or otherwise releases
the input source. This enables the input file to be deleted or
renamed.</p></li>
<li><p>New methods have been added to <code class="docutils literal notranslate"><span class="pre">QUtil</span></code> for converting back
and forth between strings and unsigned integers:
<code class="docutils literal notranslate"><span class="pre">uint_to_string</span></code>, <code class="docutils literal notranslate"><span class="pre">uint_to_string_base</span></code>,
<code class="docutils literal notranslate"><span class="pre">string_to_uint</span></code>, and <code class="docutils literal notranslate"><span class="pre">string_to_ull</span></code>.</p></li>
<li><p>New methods have been added to <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> that return
the value of <code class="docutils literal notranslate"><span class="pre">Integer</span></code> objects as <code class="docutils literal notranslate"><span class="pre">int</span></code> or <code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span></code>
with range checking and sensible fallback values, and a new
method was added to return an unsigned value. This makes it
easier to write code that is safe from unintentional data loss.
Functions: <code class="docutils literal notranslate"><span class="pre">getUIntValue</span></code>, <code class="docutils literal notranslate"><span class="pre">getIntValueAsInt</span></code>,
<code class="docutils literal notranslate"><span class="pre">getUIntValueAsUInt</span></code>.</p></li>
<li><p>When parsing content streams with
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::ParserCallbacks</span></code>, in place of the method
<code class="docutils literal notranslate"><span class="pre">handleObject(QPDFObjectHandle)</span></code>, the developer may override
<code class="docutils literal notranslate"><span class="pre">handleObject(QPDFObjectHandle,</span> <span class="pre">size_t</span> <span class="pre">offset,</span> <span class="pre">size_t</span>
<span class="pre">length)</span></code>. If this method is defined, it will
be invoked with the object along with its offset and length
within the overall contents being parsed. Intervening spaces
and comments are not included in offset and length.
Additionally, a new method <code class="docutils literal notranslate"><span class="pre">contentSize(size_t)</span></code> may be
implemented. If present, it will be called prior to the first
call to <code class="docutils literal notranslate"><span class="pre">handleObject</span></code> with the total size in bytes of the
combined contents.</p></li>
<li><p>New methods <code class="docutils literal notranslate"><span class="pre">QPDF::userPasswordMatched</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDF::ownerPasswordMatched</span></code> have been added to enable a
caller to determine whether the supplied password was the user
password, the owner password, or both. This information is also
displayed by <strong class="command">qpdf --show-encryption</strong>
and <strong class="command">qpdf --check</strong>.</p></li>
<li><p>Static method <code class="docutils literal notranslate"><span class="pre">Pl_Flate::setCompressionLevel</span></code> can be called
to set the zlib compression level globally used by all
instances of Pl_Flate in deflate mode.</p></li>
<li><p>The method <code class="docutils literal notranslate"><span class="pre">QPDFWriter::setRecompressFlate</span></code> can be called to
tell <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> to uncompress and recompress streams
already compressed with <code class="docutils literal notranslate"><span class="pre">/FlateDecode</span></code>.</p></li>
<li><p>The underlying implementation of QPDF arrays has been enhanced
to be much more memory efficient when dealing with arrays with
lots of nulls. This enables qpdf to use drastically less memory
for certain types of files.</p></li>
<li><p>When traversing the pages tree, if nodes are encountered with
invalid types, the types are fixed, and a warning is issued.</p></li>
<li><p>A new helper method <code class="docutils literal notranslate"><span class="pre">QUtil::read_file_into_memory</span></code> was added.</p></li>
<li><p>All conditions previously reported by
<code class="docutils literal notranslate"><span class="pre">QPDF::checkLinearization()</span></code> as errors are now presented as
warnings.</p></li>
<li><p>Name tokens containing the <code class="docutils literal notranslate"><span class="pre">#</span></code> character not preceded by two
hexadecimal digits, which is invalid in PDF 1.2 and above, are
properly handled by the library: a warning is generated, and
the name token is properly preserved, even if invalid, in the
output. See <code class="file docutils literal notranslate"><span class="pre">ChangeLog</span></code> for a more
complete description of this change.</p></li>
</ul>
</li>
<li><p>Bug Fixes</p>
<ul>
<li><p>A small handful of memory issues, assertion failures, and
unhandled exceptions that could occur on badly mangled input
files have been fixed. Most of these problems were found by
Google’s OSS-Fuzz project.</p></li>
<li><p>When <strong class="command">qpdf --check</strong> or
<strong class="command">qpdf --check-linearization</strong> encounters
a file with linearization warnings but not errors, it now
properly exits with exit code 3 instead of 2.</p></li>
<li><p>The <a class="reference internal" href="index.html#option-completion-bash" title="option-completion-bash"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--completion-bash</span></code></a> and
<a class="reference internal" href="index.html#option-completion-zsh" title="option-completion-zsh"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--completion-zsh</span></code></a> options now work
properly when qpdf is invoked as an AppImage.</p></li>
<li><p>Calling <code class="docutils literal notranslate"><span class="pre">QPDFWriter::set*EncryptionParameters</span></code> on a
<code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> object whose output filename has not yet been
set no longer produces a segmentation fault.</p></li>
<li><p>When reading encrypted files, follow the spec more closely
regarding encryption key length. This allows qpdf to open
encrypted files in most cases when they have invalid or missing
/Length keys in the encryption dictionary.</p></li>
</ul>
</li>
<li><p>Build Changes</p>
<ul>
<li><p>On platforms that support it, qpdf now builds with
<code class="samp docutils literal notranslate"><span class="pre">-fvisibility=hidden</span></code>. If you build qpdf
with your own build system, this is now safe to use. This
prevents methods that are not part of the public API from being
exported by the shared library, and makes qpdf’s ELF shared
libraries (used on Linux, MacOS, and most other UNIX flavors)
behave more like the Windows DLL. Since the DLL already behaves
in much this way, it is unlikely that there are any methods
that were accidentally not exported. However, with ELF shared
libraries, typeinfo for some classes has to be explicitly
exported. If there are problems in dynamically linked code
catching exceptions or subclassing, this could be the reason.
If you see this, please report a bug at
<a class="reference external" href="https://github.com/qpdf/qpdf/issues/">https://github.com/qpdf/qpdf/issues/</a>.</p></li>
<li><p>QPDF is now compiled with integer conversion and sign
conversion warnings enabled. Numerous changes were made to the
library to make this safe.</p></li>
<li><p>QPDF’s <strong class="command">make install</strong> target explicitly
specifies the mode to use when installing files instead of
relying the user’s umask. It was previously doing this for some
files but not others.</p></li>
<li><p>If <strong class="command">pkg-config</strong> is available, use it to
locate <code class="file docutils literal notranslate"><span class="pre">libjpeg</span></code> and
<code class="file docutils literal notranslate"><span class="pre">zlib</span></code> dependencies, falling back on
old behavior if unsuccessful.</p></li>
</ul>
</li>
<li><p>Other Notes</p>
<ul>
<li><p>QPDF has been fully integrated into <a class="reference external" href="https://github.com/google/oss-fuzz">Google’s OSS-Fuzz
project</a>. This project
exercises code with randomly mutated inputs and is great for
discovering hidden security crashes and security issues.
Several bugs found by oss-fuzz have already been fixed in qpdf.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>8.4.2: May 18, 2019</dt><dd><p>This release has just one change: correction of a buffer overrun in
the Windows code used to open files. Windows users should take this
update. There are no code changes that affect non-Windows releases.</p>
</dd>
<dt>8.4.1: April 27, 2019</dt><dd><ul class="simple">
<li><p>Enhancements</p>
<ul>
<li><p>When <strong class="command">qpdf --version</strong> is run, it will
detect if the qpdf CLI was built with a different version of
qpdf than the library, which may indicate a problem with the
installation.</p></li>
<li><p>New option <a class="reference internal" href="index.html#option-remove-page-labels" title="option-remove-page-labels"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--remove-page-labels</span></code></a> will
remove page labels before generating output. This used to
happen if you ran <strong class="command">qpdf --empty --pages ..
--</strong>, but the behavior changed in qpdf 8.3.0. This
option enables people who were relying on the old behavior to
get it again.</p></li>
<li><p>New option
<code class="samp docutils literal notranslate"><span class="pre">--keep-files-open-threshold=</span><em><span class="pre">count</span></em></code>
can be used to override number of files that qpdf will use to
trigger the behavior of not keeping all files open when merging
files. This may be necessary if your system allows fewer than
the default value of 200 files to be open at the same time.</p></li>
</ul>
</li>
<li><p>Bug Fixes</p>
<ul>
<li><p>Handle Unicode characters in filenames on Windows. The changes
to support Unicode on the CLI in Windows broke Unicode
filenames for Windows.</p></li>
<li><p>Slightly tighten logic that determines whether an object is a
page. This should resolve problems in some rare files where
some non-page objects were passing qpdf’s test for whether
something was a page, thus causing them to be erroneously lost
during page splitting operations.</p></li>
<li><p>Revert change that included preservation of outlines
(bookmarks) in <a class="reference internal" href="index.html#option-split-pages" title="option-split-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--split-pages</span></code></a>. The way
it was implemented in 8.3.0 and 8.4.0 caused a very significant
degradation of performance for splitting certain files. A
future release of qpdf may re-introduce the behavior in a more
performant and also more correct fashion.</p></li>
<li><p>In JSON mode, add missing leading 0 to decimal values between
-1 and 1 even if not present in the input. The JSON
specification requires the leading 0. The PDF specification
does not.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>8.4.0: February 1, 2019</dt><dd><ul class="simple">
<li><p>Command-line Enhancements</p>
<ul>
<li><p><em>Non-compatible CLI change:</em> The qpdf command-line tool
interprets passwords given at the command-line differently from
previous releases when the passwords contain non-ASCII
characters. In some cases, the behavior differs from previous
releases. For a discussion of the current behavior, please see
<a class="reference internal" href="index.html#unicode-passwords"><span class="std std-ref">Unicode Passwords</span></a>. The
incompatibilities are as follows:</p>
<ul>
<li><p>On Windows, qpdf now receives all command-line options as
Unicode strings if it can figure out the appropriate
compile/link options. This is enabled at least for MSVC and
mingw builds. That means that if non-ASCII strings are
passed to the qpdf CLI in Windows, qpdf will now correctly
receive them. In the past, they would have either been
encoded as Windows code page 1252 (also known as “Windows
ANSI” or as something unintelligible. In almost all cases,
qpdf is able to properly interpret Unicode arguments now,
whereas in the past, it would almost never interpret them
properly. The result is that non-ASCII passwords given to
the qpdf CLI on Windows now have a much greater chance of
creating PDF files that can be opened by a variety of
readers. In the past, usually files encrypted from the
Windows CLI using non-ASCII passwords would not be readable
by most viewers. Note that the current version of qpdf is
able to decrypt files that it previously created using the
previously supplied password.</p></li>
<li><p>The PDF specification requires passwords to be encoded as
UTF-8 for 256-bit encryption and with PDF Doc encoding for
40-bit or 128-bit encryption. Older versions of qpdf left it
up to the user to provide passwords with the correct
encoding. The qpdf CLI now detects when a password is given
with UTF-8 encoding and automatically transcodes it to what
the PDF spec requires. While this is almost always the
correct behavior, it is possible to override the behavior if
there is some reason to do so. This is discussed in more
depth in <a class="reference internal" href="index.html#unicode-passwords"><span class="std std-ref">Unicode Passwords</span></a>.</p></li>
</ul>
</li>
<li><p>New options
<a class="reference internal" href="index.html#option-externalize-inline-images" title="option-externalize-inline-images"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--externalize-inline-images</span></code></a>,
<a class="reference internal" href="index.html#option-ii-min-bytes" title="option-ii-min-bytes"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--ii-min-bytes</span></code></a>, and
<a class="reference internal" href="index.html#option-keep-inline-images" title="option-keep-inline-images"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--keep-inline-images</span></code></a> control qpdf’s
handling of inline images and possible conversion of them to
regular images. By default,
<a class="reference internal" href="index.html#option-optimize-images" title="option-optimize-images"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--optimize-images</span></code></a> now also applies to
inline images.</p></li>
<li><p>Add options <a class="reference internal" href="index.html#option-overlay" title="option-overlay"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--overlay</span></code></a> and
<a class="reference internal" href="index.html#option-underlay" title="option-underlay"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--underlay</span></code></a> for overlaying or
underlaying pages of other files onto output pages. See
<a class="reference internal" href="index.html#overlay-underlay"><span class="std std-ref">Overlay and Underlay</span></a> for
details.</p></li>
<li><p>When opening an encrypted file with a password, if the
specified password doesn’t work and the password contains any
non-ASCII characters, qpdf will try a number of alternative
passwords to try to compensate for possible character encoding
errors. This behavior can be suppressed with the
<a class="reference internal" href="index.html#option-suppress-password-recovery" title="option-suppress-password-recovery"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--suppress-password-recovery</span></code></a> option.
See <a class="reference internal" href="index.html#unicode-passwords"><span class="std std-ref">Unicode Passwords</span></a> for a full
discussion.</p></li>
<li><p>Add the <a class="reference internal" href="index.html#option-password-mode" title="option-password-mode"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--password-mode</span></code></a> option to
fine-tune how qpdf interprets password arguments, especially
when they contain non-ASCII characters. See <a class="reference internal" href="index.html#unicode-passwords"><span class="std std-ref">Unicode Passwords</span></a> for more information.</p></li>
<li><p>In the <a class="reference internal" href="index.html#option-pages" title="option-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--pages</span></code></a> option, it is now
possible to copy the same page more than once from the same
file without using the previous workaround of specifying two
different paths to the same file.</p></li>
<li><p>In the <a class="reference internal" href="index.html#option-pages" title="option-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--pages</span></code></a> option, allow use of “.”
as a shortcut for the primary input file. That way, you can do
<strong class="command">qpdf in.pdf --pages . 1-2 -- out.pdf</strong>
instead of having to repeat <code class="file docutils literal notranslate"><span class="pre">in.pdf</span></code>
in the command.</p></li>
<li><p>When encrypting with 128-bit and 256-bit encryption, new
encryption options <a class="reference internal" href="index.html#option-assemble" title="option-assemble"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--assemble</span></code></a>,
<a class="reference internal" href="index.html#option-annotate" title="option-annotate"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--annotate</span></code></a>,
<a class="reference internal" href="index.html#option-form" title="option-form"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--form</span></code></a>, and
<a class="reference internal" href="index.html#option-modify-other" title="option-modify-other"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--modify-other</span></code></a> allow more fine-grained
granularity in configuring options. Before, the
<a class="reference internal" href="index.html#option-modify" title="option-modify"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--modify</span></code></a> option only configured certain
predefined groups of permissions.</p></li>
</ul>
</li>
<li><p>Bug Fixes and Enhancements</p>
<ul>
<li><p><em>Potential data-loss bug:</em> Versions of qpdf between 8.1.0 and
8.3.0 had a bug that could cause page splitting and merging
operations to drop some font or image resources if the PDF
file’s internal structure shared these resource lists across
pages and if some but not all of the pages in the output did
not reference all the fonts and images. Using the
<a class="reference internal" href="index.html#option-preserve-unreferenced-resources" title="option-preserve-unreferenced-resources"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--preserve-unreferenced-resources</span></code></a>
option would work around the incorrect behavior. This bug was
the result of a typo in the code and a deficiency in the test
suite. The case that triggered the error was known, just not
handled properly. This case is now exercised in qpdf’s test
suite and properly handled.</p></li>
<li><p>When optimizing images, detect and refuse to optimize images
that can’t be converted to JPEG because of bit depth or color
space.</p></li>
<li><p>Linearization and page manipulation APIs now detect and recover
from files that have duplicate Page objects in the pages tree.</p></li>
<li><p>Using older option
<code class="samp docutils literal notranslate"><span class="pre">--stream-data=compress</span></code> with object
streams, object streams and xref streams were not compressed.</p></li>
<li><p>When the tokenizer returns inline image tokens, delimiters
following <code class="docutils literal notranslate"><span class="pre">ID</span></code> and <code class="docutils literal notranslate"><span class="pre">EI</span></code> operators are no longer excluded.
This makes it possible to reliably extract the actual image
data.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper::externalizeInlineImages</span></code> to
convert inline images to regular images.</p></li>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QUtil::possible_repaired_encodings()</span></code> to generate
a list of strings that represent other ways the given string
could have been encoded. This is the method the QPDF CLI uses
to generate the strings it tries when recovering incorrectly
encoded Unicode passwords.</p></li>
<li><p>Add new versions of
<code class="docutils literal notranslate"><span class="pre">QPDFWriter::setR{3,4,5,6}EncryptionParameters</span></code> that allow
more granular setting of permissions bits. See
<code class="file docutils literal notranslate"><span class="pre">QPDFWriter.hh</span></code> for details.</p></li>
<li><p>Add new versions of the transcoders from UTF-8 to single-byte
coding systems in <code class="docutils literal notranslate"><span class="pre">QUtil</span></code> that report success or failure
rather than just substituting a specified unknown character.</p></li>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QUtil::analyze_encoding()</span></code> to determine whether a
string has high-bit characters and is appears to be UTF-16 or
valid UTF-8 encoding.</p></li>
<li><p>Add new method <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper::shallowCopyPage()</span></code> to
copy a new page that is a “shallow copy” of a page. The
resulting object is an indirect object ready to be passed to
<code class="docutils literal notranslate"><span class="pre">QPDFPageDocumentHelper::addPage()</span></code> for either the original
<code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object or a different one. This is what the
<strong class="command">qpdf</strong> command-line tool uses to copy
the same page multiple times from the same file during
splitting and merging operations.</p></li>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QPDF::getUniqueId()</span></code>, which returns a unique
identifier for the given QPDF object. The identifier will be
unique across the life of the application. The returned value
can be safely used as a map key.</p></li>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QPDF::setImmediateCopyFrom</span></code>. This further
enhances qpdf’s ability to allow a <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object from which
objects are being copied to go out of scope before the
destination object is written. If you call this method on a
<code class="docutils literal notranslate"><span class="pre">QPDF</span></code> instances, objects copied <em>from</em> this instance will be
copied immediately instead of lazily. This option uses more
memory but allows the source object to go out of scope before
the destination object is written in all cases. See comments in
<code class="file docutils literal notranslate"><span class="pre">QPDF.hh</span></code> for details.</p></li>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper::getAttribute</span></code> for
retrieving an attribute from the page dictionary taking
inheritance into consideration, and optionally making a copy if
your intention is to modify the attribute.</p></li>
<li><p>Fix long-standing limitation of
<code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper::getPageImages</span></code> so that it now properly
reports images from inherited resources dictionaries,
eliminating the need to call
<code class="docutils literal notranslate"><span class="pre">QPDFPageDocumentHelper::pushInheritedAttributesToPage</span></code> in
this case.</p></li>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getUniqueResourceName</span></code> for
finding an unused name in a resource dictionary.</p></li>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper::getFormXObjectForPage</span></code> for
generating a form XObject equivalent to a page. The resulting
object can be used in the same file or copied to another file
with <code class="docutils literal notranslate"><span class="pre">copyForeignObject</span></code>. This can be useful for implementing
underlay, overlay, n-up, thumbnails, or any other functionality
requiring replication of pages in other contexts.</p></li>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper::placeFormXObject</span></code> for
generating content stream text that places a given form XObject
on a page, centered and fit within a specified rectangle. This
method takes care of computing the proper transformation matrix
and may optionally compensate for rotation or scaling of the
destination page.</p></li>
<li><p>Exit codes returned by <code class="docutils literal notranslate"><span class="pre">QPDFJob::run()</span></code> and the C API wrappers
are now defined in <code class="file docutils literal notranslate"><span class="pre">qpdf/Constants.h</span></code> in the
<code class="docutils literal notranslate"><span class="pre">qpdf_exit_code_e</span></code> type so that they are accessible from the C
API. They were previously only defined as constants in
<code class="file docutils literal notranslate"><span class="pre">qpdf/QPDFJob.hh</span></code>.</p></li>
</ul>
</li>
<li><p>Build Improvements</p>
<ul>
<li><p>Add new configure option
<code class="samp docutils literal notranslate"><span class="pre">--enable-avoid-windows-handle</span></code>, which
causes the preprocessor symbol <code class="docutils literal notranslate"><span class="pre">AVOID_WINDOWS_HANDLE</span></code> to be
defined. When defined, qpdf will avoid referencing the Windows
<code class="docutils literal notranslate"><span class="pre">HANDLE</span></code> type, which is disallowed with certain versions of
the Windows SDK.</p></li>
<li><p>For Windows builds, attempt to determine what options, if any,
have to be passed to the compiler and linker to enable use of
<code class="docutils literal notranslate"><span class="pre">wmain</span></code>. This causes the preprocessor symbol
<code class="docutils literal notranslate"><span class="pre">WINDOWS_WMAIN</span></code> to be defined. If you do your own builds with
other compilers, you can define this symbol to cause <code class="docutils literal notranslate"><span class="pre">wmain</span></code>
to be used. This is needed to allow the Windows
<strong class="command">qpdf</strong> command to receive Unicode
command-line options.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>8.3.0: January 7, 2019</dt><dd><ul class="simple">
<li><p>Command-line Enhancements</p>
<ul>
<li><p>Shell completion: you can now use eval <strong class="command">$(qpdf
--completion-bash)</strong> and eval <strong class="command">$(qpdf
--completion-zsh)</strong> to enable shell completion for
bash and zsh.</p></li>
<li><p>Page numbers (also known as page labels) are now preserved when
merging and splitting files with the
<a class="reference internal" href="index.html#option-pages" title="option-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--pages</span></code></a> and
<a class="reference internal" href="index.html#option-split-pages" title="option-split-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--split-pages</span></code></a> options.</p></li>
<li><p>Bookmarks are partially preserved when splitting pages with the
<a class="reference internal" href="index.html#option-split-pages" title="option-split-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--split-pages</span></code></a> option. Specifically, the
outlines dictionary and some supporting metadata are copied
into the split files. The result is that all bookmarks from the
original file appear, those that point to pages that are
preserved work, and those that point to pages that are not
preserved don’t do anything. This is an interim step toward
proper support for bookmarks in splitting and merging
operations.</p></li>
<li><p>Page collation: add new option
<a class="reference internal" href="index.html#option-collate" title="option-collate"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--collate</span></code></a>. When specified, the
semantics of <a class="reference internal" href="index.html#option-pages" title="option-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--pages</span></code></a> change from
concatenation to collation. See <a class="reference internal" href="index.html#page-selection"><span class="std std-ref">Page Selection</span></a> for examples and discussion.</p></li>
<li><p>Generation of information in JSON format, primarily to
facilitate use of qpdf from languages other than C++. Add new
options <a class="reference internal" href="index.html#option-json" title="option-json"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json</span></code></a>,
<a class="reference internal" href="index.html#option-json-key" title="option-json-key"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-key</span></code></a>, and
<a class="reference internal" href="index.html#option-json-object" title="option-json-object"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-object</span></code></a> to generate a JSON
representation of the PDF file. Run <strong class="command">qpdf
--json-help</strong> to get a description of the JSON
format. For more information, see <a class="reference internal" href="index.html#json"><span class="std std-ref">qpdf JSON</span></a>.</p></li>
<li><p>The <a class="reference internal" href="index.html#option-generate-appearances" title="option-generate-appearances"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--generate-appearances</span></code></a> flag will
cause qpdf to generate appearances for form fields if the PDF
file indicates that form field appearances are out of date.
This can happen when PDF forms are filled in by a program that
doesn’t know how to regenerate the appearances of the filled-in
fields.</p></li>
<li><p>The <a class="reference internal" href="index.html#option-flatten-annotations" title="option-flatten-annotations"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--flatten-annotations</span></code></a> flag can be
used to <em>flatten</em> annotations, including form fields.
Ordinarily, annotations are drawn separately from the page.
Flattening annotations is the process of combining their
appearances into the page’s contents. You might want to do this
if you are going to rotate or combine pages using a tool that
doesn’t understand about annotations. You may also want to use
<a class="reference internal" href="index.html#option-generate-appearances" title="option-generate-appearances"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--generate-appearances</span></code></a> when using this
flag since annotations for outdated form fields are not
flattened as that would cause loss of information.</p></li>
<li><p>The <a class="reference internal" href="index.html#option-optimize-images" title="option-optimize-images"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--optimize-images</span></code></a> flag tells qpdf
to recompresses every image using DCT (JPEG) compression as
long as the image is not already compressed with lossy
compression and recompressing the image reduces its size. The
additional options <a class="reference internal" href="index.html#option-oi-min-width" title="option-oi-min-width"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--oi-min-width</span></code></a>,
<a class="reference internal" href="index.html#option-oi-min-height" title="option-oi-min-height"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--oi-min-height</span></code></a>, and
<a class="reference internal" href="index.html#option-oi-min-area" title="option-oi-min-area"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--oi-min-area</span></code></a> prevent recompression of
images whose width, height, or pixel area (width × height) are
below a specified threshold.</p></li>
<li><p>The <a class="reference internal" href="index.html#option-show-object" title="option-show-object"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--show-object</span></code></a> option can now be
given as <code class="samp docutils literal notranslate"><span class="pre">--show-object=trailer</span></code> to show
the trailer dictionary.</p></li>
</ul>
</li>
<li><p>Bug Fixes and Enhancements</p>
<ul>
<li><p>QPDF now automatically detects and recovers from dangling
references. If a PDF file contained an indirect reference to a
non-existent object, which is valid, when adding a new object
to the file, it was possible for the new object to take the
object ID of the dangling reference, thereby causing the
dangling reference to point to the new object. This case is now
prevented.</p></li>
<li><p>Fixes to form field setting code: strings are always written in
UTF-16 format, and checkboxes and radio buttons are handled
properly with respect to synchronization of values and
appearance states.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">QPDF::checkLinearization()</span></code> no longer causes the program
to crash when it detects problems with linearization data.
Instead, it issues a normal warning or error.</p></li>
<li><p>Ordinarily qpdf treats an argument of the form
<code class="samp docutils literal notranslate"><span class="pre">&#64;file</span></code> to mean that command-line options
should be read from <code class="file docutils literal notranslate"><span class="pre">file</span></code>. Now, if
<code class="file docutils literal notranslate"><span class="pre">file</span></code> does not exist but
<code class="file docutils literal notranslate"><span class="pre">&#64;file</span></code> does, qpdf will treat
<code class="file docutils literal notranslate"><span class="pre">&#64;file</span></code> as a regular option. This
makes it possible to work more easily with PDF files whose
names happen to start with the <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> character.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>Remove the restriction in most cases that the source QPDF
object used in a <code class="docutils literal notranslate"><span class="pre">QPDF::copyForeignObject</span></code> call has to stick
around until the destination QPDF is written. The exceptional
case is when the source stream gets is data using a
QPDFObjectHandle::StreamDataProvider. For a more in-depth
discussion, see comments around <code class="docutils literal notranslate"><span class="pre">copyForeignObject</span></code> in
<code class="file docutils literal notranslate"><span class="pre">QPDF.hh</span></code>.</p></li>
<li><p>Add new method <code class="docutils literal notranslate"><span class="pre">QPDFWriter::getFinalVersion()</span></code>, which returns
the PDF version that will ultimately be written to the final
file. See comments in <code class="file docutils literal notranslate"><span class="pre">QPDFWriter.hh</span></code>
for some restrictions on its use.</p></li>
<li><p>Add several methods for transcoding strings to some of the
character sets used in PDF files: <code class="docutils literal notranslate"><span class="pre">QUtil::utf8_to_ascii</span></code>,
<code class="docutils literal notranslate"><span class="pre">QUtil::utf8_to_win_ansi</span></code>, <code class="docutils literal notranslate"><span class="pre">QUtil::utf8_to_mac_roman</span></code>, and
<code class="docutils literal notranslate"><span class="pre">QUtil::utf8_to_utf16</span></code>. For the single-byte encodings that
support only a limited character sets, these methods replace
unsupported characters with a specified substitute.</p></li>
<li><p>Add new methods to <code class="docutils literal notranslate"><span class="pre">QPDFAnnotationObjectHelper</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFFormFieldObjectHelper</span></code> for querying flags and
interpretation of different field types. Define constants in
<code class="file docutils literal notranslate"><span class="pre">qpdf/Constants.h</span></code> to help with
interpretation of flag values.</p></li>
<li><p>Add new methods
<code class="docutils literal notranslate"><span class="pre">QPDFAcroFormDocumentHelper::generateAppearancesIfNeeded</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFFormFieldObjectHelper::generateAppearance</span></code> for
generating appearance streams. See discussion in
<code class="file docutils literal notranslate"><span class="pre">QPDFFormFieldObjectHelper.hh</span></code> for
limitations.</p></li>
<li><p>Add two new helper functions for dealing with resource
dictionaries: <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getResourceNames()</span></code> returns
a list of all second-level keys, which correspond to the names
of resources, and <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::mergeResources()</span></code> merges
two resources dictionaries as long as they have non-conflicting
keys. These methods are useful for certain types of objects
that resolve resources from multiple places, such as form
fields.</p></li>
<li><p>Add methods <code class="docutils literal notranslate"><span class="pre">QPDFPageDocumentHelper::flattenAnnotations()</span></code>
and
<code class="docutils literal notranslate"><span class="pre">QPDFAnnotationObjectHelper::getPageContentForAppearance()</span></code>
for handling low-level details of annotation flattening.</p></li>
<li><p>Add new helper classes: <code class="docutils literal notranslate"><span class="pre">QPDFOutlineDocumentHelper</span></code>,
<code class="docutils literal notranslate"><span class="pre">QPDFOutlineObjectHelper</span></code>, <code class="docutils literal notranslate"><span class="pre">QPDFPageLabelDocumentHelper</span></code>,
<code class="docutils literal notranslate"><span class="pre">QPDFNameTreeObjectHelper</span></code>, and
<code class="docutils literal notranslate"><span class="pre">QPDFNumberTreeObjectHelper</span></code>.</p></li>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getJSON()</span></code> that returns a JSON
representation of the object. Call <code class="docutils literal notranslate"><span class="pre">serialize()</span></code> on the
result to convert it to a string.</p></li>
<li><p>Add a simple JSON serializer. This is not a complete or
general-purpose JSON library. It allows assembly and
serialization of JSON structures with some restrictions, which
are described in the header file. This is the serializer used
by qpdf’s new JSON representation.</p></li>
<li><p>Add new <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::Matrix</span></code> class along with a few
convenience methods for dealing with six-element numerical
arrays as matrices.</p></li>
<li><p>Add new method <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::wrapInArray</span></code>, which returns
the object itself if it is an array, or an array containing the
object otherwise. This is a common construct in PDF. This
method prevents you from having to explicitly test whether
something is a single element or an array.</p></li>
</ul>
</li>
<li><p>Build Improvements</p>
<ul>
<li><p>It is no longer necessary to run
<strong class="command">autogen.sh</strong> to build from a pristine
checkout. Automatically generated files are now committed so
that it is possible to build on platforms without autoconf
directly from a clean checkout of the repository. The
<strong class="command">configure</strong> script detects if the files
are out of date when it also determines that the tools are
present to regenerate them.</p></li>
<li><p>Pull requests and the master branch are now built automatically
in <a class="reference external" href="https://dev.azure.com/qpdf/qpdf/_build">Azure
Pipelines</a>, which is
free for open source projects. The build includes Linux, mac,
Windows 32-bit and 64-bit with mingw and MSVC, and an AppImage
build. Official qpdf releases are now built with Azure
Pipelines.</p></li>
</ul>
</li>
<li><p>Notes for Packagers</p>
<ul>
<li><p>A new section has been added to the documentation with notes
for packagers. Please see <a class="reference internal" href="index.html#packaging"><span class="std std-ref">Notes for Packagers</span></a>.</p></li>
<li><p>The qpdf detects out-of-date automatically generated files. If
your packaging system automatically refreshes libtool or
autoconf files, it could cause this check to fail. To avoid
this problem, pass
<code class="samp docutils literal notranslate"><span class="pre">--disable-check-autofiles</span></code> to
<strong class="command">configure</strong>.</p></li>
<li><p>If you would like to have qpdf completion enabled
automatically, you can install completion files in the
distribution’s default location. You can find sample completion
files to install in the <code class="file docutils literal notranslate"><span class="pre">completions</span></code>
directory.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>8.2.1: August 18, 2018</dt><dd><ul class="simple">
<li><p>Command-line Enhancements</p>
<ul>
<li><p>Add
<code class="samp docutils literal notranslate"><span class="pre">--keep-files-open=</span><em><span class="pre">[yn]</span></em></code>
to override default determination of whether to keep files open
when merging. Please see the discussion of
<a class="reference internal" href="index.html#option-keep-files-open" title="option-keep-files-open"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--keep-files-open</span></code></a> for additional details.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>8.2.0: August 16, 2018</dt><dd><ul class="simple">
<li><p>Command-line Enhancements</p>
<ul>
<li><p>Add <a class="reference internal" href="index.html#option-no-warn" title="option-no-warn"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--no-warn</span></code></a> option to suppress
issuing warning messages. If there are any conditions that
would have caused warnings to be issued, the exit status is
still 3.</p></li>
</ul>
</li>
<li><p>Bug Fixes and Optimizations</p>
<ul>
<li><p>Performance fix: optimize page merging operation to avoid
unnecessary open/close calls on files being merged. This solves
a dramatic slow-down that was observed when merging certain
types of files.</p></li>
<li><p>Optimize how memory was used for the TIFF predictor,
drastically improving performance and memory usage for files
containing high-resolution images compressed with Flate using
the TIFF predictor.</p></li>
<li><p>Bug fix: end of line characters were not properly handled
inside strings in some cases.</p></li>
<li><p>Bug fix: using <a class="reference internal" href="index.html#option-progress" title="option-progress"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--progress</span></code></a> on very small
files could cause an infinite loop.</p></li>
</ul>
</li>
<li><p>API enhancements</p>
<ul>
<li><p>Add new class <code class="docutils literal notranslate"><span class="pre">QPDFSystemError</span></code>, derived from
<code class="docutils literal notranslate"><span class="pre">std::runtime_error</span></code>, which is now thrown by
<code class="docutils literal notranslate"><span class="pre">QUtil::throw_system_error</span></code>. This enables the triggering
<code class="docutils literal notranslate"><span class="pre">errno</span></code> value to be retrieved.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">ClosedFileInputSource::stayOpen</span></code> method, enabling a
<code class="docutils literal notranslate"><span class="pre">ClosedFileInputSource</span></code> to stay open during manually
indicated periods of high activity, thus reducing the overhead
of frequent open/close operations.</p></li>
</ul>
</li>
<li><p>Build Changes</p>
<ul>
<li><p>For the mingw builds, change the name of the DLL import library
from <code class="file docutils literal notranslate"><span class="pre">libqpdf.a</span></code> to
<code class="file docutils literal notranslate"><span class="pre">libqpdf.dll.a</span></code> to more accurately
reflect that it is an import library rather than a static
library. This potentially clears the way for supporting a
static library in the future, though presently, the qpdf
Windows build only builds the DLL and executables.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>8.1.0: June 23, 2018</dt><dd><ul class="simple">
<li><p>Usability Improvements</p>
<ul>
<li><p>When splitting files, qpdf detects fonts and images that the
document metadata claims are referenced from a page but are not
actually referenced and omits them from the output file. This
change can cause a significant reduction in the size of split
PDF files for files created by some software packages. In some
cases, it can also make page splitting slower. Prior versions
of qpdf would believe the document metadata and sometimes
include all the images from all the other pages even though the
pages were no longer present. In the unlikely event that the
old behavior should be desired, or if you have a case where
page splitting is very slow, the old behavior (and speed) can
be enabled by specifying
<a class="reference internal" href="index.html#option-preserve-unreferenced-resources" title="option-preserve-unreferenced-resources"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--preserve-unreferenced-resources</span></code></a>.</p></li>
<li><p>When merging multiple PDF files, qpdf no longer leaves all the
files open. This makes it possible to merge numbers of files
that may exceed the operating system’s limit for the maximum
number of open files.</p></li>
<li><p>The <a class="reference internal" href="index.html#option-rotate" title="option-rotate"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--rotate</span></code></a> option’s syntax has been
extended to make the page range optional. If you specify
<code class="samp docutils literal notranslate"><span class="pre">--rotate=</span><em><span class="pre">angle</span></em></code>
without specifying a page range, the rotation will be applied
to all pages. This can be especially useful for adjusting a PDF
created from a multi-page document that was scanned upside
down.</p></li>
<li><p>When merging multiple files, the
<a class="reference internal" href="index.html#option-verbose" title="option-verbose"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--verbose</span></code></a> option now prints information
about each file as it operates on that file.</p></li>
<li><p>When the <a class="reference internal" href="index.html#option-progress" title="option-progress"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--progress</span></code></a> option is
specified, qpdf will print a running indicator of its best
guess at how far through the writing process it is. Note that,
as with all progress meters, it’s an approximation. This option
is implemented in a way that makes it useful for software that
uses the qpdf library; see API Enhancements below.</p></li>
</ul>
</li>
<li><p>Bug Fixes</p>
<ul>
<li><p>Properly decrypt files that use revision 3 of the standard
security handler but use 40 bit keys (even though revision 3
supports 128-bit keys).</p></li>
<li><p>Limit depth of nested data structures to prevent crashes from
certain types of malformed (malicious) PDFs.</p></li>
<li><p>In “newline before endstream” mode, insert the required extra
newline before the <code class="docutils literal notranslate"><span class="pre">endstream</span></code> at the end of object streams.
This one case was previously omitted.</p></li>
</ul>
</li>
<li><p>API Enhancements</p>
<ul>
<li><p>The first round of higher level “helper” interfaces has been
introduced. These are designed to provide a more convenient way
of interacting with certain document features than using
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> directly. For details on helpers, see
<a class="reference internal" href="index.html#helper-classes"><span class="std std-ref">Helper Classes</span></a>. Specific additional
interfaces are described below.</p></li>
<li><p>Add two new document helper classes: <code class="docutils literal notranslate"><span class="pre">QPDFPageDocumentHelper</span></code>
for working with pages, and <code class="docutils literal notranslate"><span class="pre">QPDFAcroFormDocumentHelper</span></code> for
working with interactive forms. No old methods have been
removed, but <code class="docutils literal notranslate"><span class="pre">QPDFPageDocumentHelper</span></code> is now the preferred
way to perform operations on pages rather than calling the old
methods in <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> and <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> directly. Comments
in the header files direct you to the new interfaces. Please
see the header files and <code class="file docutils literal notranslate"><span class="pre">ChangeLog</span></code>
for additional details.</p></li>
<li><p>Add three new object helper class: <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper</span></code> for
pages, <code class="docutils literal notranslate"><span class="pre">QPDFFormFieldObjectHelper</span></code> for interactive form
fields, and <code class="docutils literal notranslate"><span class="pre">QPDFAnnotationObjectHelper</span></code> for annotations. All
three classes are fairly sparse at the moment, but they have
some useful, basic functionality.</p></li>
<li><p>A new example program
<code class="file docutils literal notranslate"><span class="pre">examples/pdf-set-form-values.cc</span></code> has
been added that illustrates use of the new document and object
helpers.</p></li>
<li><p>The method <code class="docutils literal notranslate"><span class="pre">QPDFWriter::registerProgressReporter</span></code> has been
added. This method allows you to register a function that is
called by <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> to update your idea of the percentage
it thinks it is through writing its output. Client programs can
use this to implement reasonably accurate progress meters. The
<strong class="command">qpdf</strong> command line tool uses this to
implement its <a class="reference internal" href="index.html#option-progress" title="option-progress"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--progress</span></code></a> option.</p></li>
<li><p>New methods <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::newUnicodeString</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFObject::unparseBinary</span></code> have been added to allow for more
convenient creation of strings that are explicitly encoded
using big-endian UTF-16. This is useful for creating strings
that appear outside of content streams, such as labels, form
fields, outlines, document metadata, etc.</p></li>
<li><p>A new class <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::Rectangle</span></code> has been added to
ease working with PDF rectangles, which are just arrays of four
numeric values.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>8.0.2: March 6, 2018</dt><dd><ul class="simple">
<li><p>When a loop is detected while following cross reference streams or
tables, treat this as damage instead of silently ignoring the
previous table. This prevents loss of otherwise recoverable data
in some damaged files.</p></li>
<li><p>Properly handle pages with no contents.</p></li>
</ul>
</dd>
<dt>8.0.1: March 4, 2018</dt><dd><ul class="simple">
<li><p>Disregard data check errors when uncompressing <code class="docutils literal notranslate"><span class="pre">/FlateDecode</span></code>
streams. This is consistent with most other PDF readers and allows
qpdf to recover data from another class of malformed PDF files.</p></li>
<li><p>On the command line when specifying page ranges, support preceding
a page number by “r” to indicate that it should be counted from
the end. For example, the range <code class="docutils literal notranslate"><span class="pre">r3-r1</span></code> would indicate the last
three pages of a document.</p></li>
</ul>
</dd>
<dt>8.0.0: February 25, 2018</dt><dd><ul class="simple">
<li><p>Packaging and Distribution Changes</p>
<ul>
<li><p>QPDF is now distributed as an
<a class="reference external" href="https://appimage.org/">AppImage</a> in addition to all the
other ways it is distributed. The AppImage can be found in the
download area with the other packages. Thanks to Kurt Pfeifle
and Simon Peter for their contributions.</p></li>
</ul>
</li>
<li><p>Bug Fixes</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getUTF8Val</span></code> now properly treats
non-Unicode strings as encoded with PDF Doc Encoding.</p></li>
<li><p>Improvements to handling of objects in PDF files that are not
of the expected type. In most cases, qpdf will be able to warn
for such cases rather than fail with an exception. Previous
versions of qpdf would sometimes fail with errors such as
“operation for dictionary object attempted on object of wrong
type”. This situation should be mostly or entirely eliminated
now.</p></li>
</ul>
</li>
<li><p>Enhancements to the <strong class="command">qpdf</strong> Command-line
Tool. All new options listed here are documented in more detail in
<a class="reference internal" href="index.html#using"><span class="std std-ref">Running qpdf</span></a>.</p>
<ul>
<li><p>The option
<code class="samp docutils literal notranslate"><span class="pre">--linearize-pass1=</span><em><span class="pre">file</span></em></code>
has been added for debugging qpdf’s linearization code.</p></li>
<li><p>The option <a class="reference internal" href="index.html#option-coalesce-contents" title="option-coalesce-contents"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--coalesce-contents</span></code></a> can be
used to combine content streams of a page whose contents are an
array of streams into a single stream.</p></li>
</ul>
</li>
<li><p>API Enhancements. All new API calls are documented in their
respective classes’ header files. There are no non-compatible
changes to the API.</p>
<ul>
<li><p>Add function <code class="docutils literal notranslate"><span class="pre">qpdf_check_pdf</span></code> to the C API. This function
does basic checking that is a subset of what <strong class="command">qpdf
--check</strong> performs.</p></li>
<li><p>Major enhancements to the lexical layer of qpdf. For a complete
list of enhancements, please refer to the
<code class="file docutils literal notranslate"><span class="pre">ChangeLog</span></code> file. Most of the changes
result in improvements to qpdf’s ability handle erroneous
files. It is also possible for programs to handle whitespace,
comments, and inline images as tokens.</p></li>
<li><p>New API for working with PDF content streams at a lexical
level. The new class <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::TokenFilter</span></code> allows
the developer to provide token handlers. Token filters can be
used with several different methods in <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> as
well as with a lower-level interface. See comments in
<code class="file docutils literal notranslate"><span class="pre">QPDFObjectHandle.hh</span></code> as well as the
new examples
<code class="file docutils literal notranslate"><span class="pre">examples/pdf-filter-tokens.cc</span></code> and
<code class="file docutils literal notranslate"><span class="pre">examples/pdf-count-strings.cc</span></code> for
details.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>7.1.1: February 4, 2018</dt><dd><ul class="simple">
<li><p>Bug fix: files whose /ID fields were other than 16 bytes long can
now be properly linearized</p></li>
<li><p>A few compile and link issues have been corrected for some
platforms.</p></li>
</ul>
</dd>
<dt>7.1.0: January 14, 2018</dt><dd><ul class="simple">
<li><p>PDF files contain streams that may be compressed with various
compression algorithms which, in some cases, may be enhanced by
various predictor functions. Previously only the PNG up predictor
was supported. In this version, all the PNG predictors as well as
the TIFF predictor are supported. This increases the range of
files that qpdf is able to handle.</p></li>
<li><p>QPDF now allows a raw encryption key to be specified in place of a
password when opening encrypted files, and will optionally display
the encryption key used by a file. This is a non-standard
operation, but it can be useful in certain situations. Please see
the discussion of <a class="reference internal" href="index.html#option-password-is-hex-key" title="option-password-is-hex-key"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--password-is-hex-key</span></code></a> or the comments around
<code class="docutils literal notranslate"><span class="pre">QPDF::setPasswordIsHexKey</span></code> in
<code class="file docutils literal notranslate"><span class="pre">QPDF.hh</span></code> for additional details.</p></li>
<li><p>Bug fix: numbers ending with a trailing decimal point are now
properly recognized as numbers.</p></li>
<li><p>Bug fix: when building qpdf from source on some platforms
(especially MacOS), the build could get confused by older versions
of qpdf installed on the system. This has been corrected.</p></li>
</ul>
</dd>
<dt>7.0.0: September 15, 2017</dt><dd><ul class="simple">
<li><p>Packaging and Distribution Changes</p>
<ul>
<li><p>QPDF’s primary license is now <a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0">version 2.0 of the Apache
License</a> rather
than version 2.0 of the Artistic License. You may still, at
your option, consider qpdf to be licensed with version 2.0 of
the Artistic license.</p></li>
<li><p>QPDF no longer has a dependency on the PCRE (Perl-Compatible
Regular Expression) library. QPDF now has an added dependency
on the JPEG library.</p></li>
</ul>
</li>
<li><p>Bug Fixes</p>
<ul>
<li><p>This release contains many bug fixes for various infinite
loops, memory leaks, and other memory errors that could be
encountered with specially crafted or otherwise erroneous PDF
files.</p></li>
</ul>
</li>
<li><p>New Features</p>
<ul>
<li><p>QPDF now supports reading and writing streams encoded with JPEG
or RunLength encoding. Library API enhancements and
command-line options have been added to control this behavior.
See command-line options
<a class="reference internal" href="index.html#option-compress-streams" title="option-compress-streams"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--compress-streams</span></code></a> and
<a class="reference internal" href="index.html#option-decode-level" title="option-decode-level"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--decode-level</span></code></a> and methods
<code class="docutils literal notranslate"><span class="pre">QPDFWriter::setCompressStreams</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFWriter::setDecodeLevel</span></code>.</p></li>
<li><p>QPDF is much better at recovering from broken files. In most
cases, qpdf will skip invalid objects and will preserve broken
stream data by not attempting to filter broken streams. QPDF is
now able to recover or at least not crash on dozens of broken
test files I have received over the past few years.</p></li>
<li><p>Page rotation is now supported and accessible from both the
library and the command line.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> supports writing files in a way that preserves
PCLm compliance in support of driverless printing. This is very
specialized and is only useful to applications that already
know how to create PCLm files.</p></li>
</ul>
</li>
<li><p>Enhancements to the <strong class="command">qpdf</strong> Command-line
Tool. All new options listed here are documented in more detail in
<a class="reference internal" href="index.html#using"><span class="std std-ref">Running qpdf</span></a>.</p>
<ul>
<li><p>Command-line arguments can now be read from files or standard
input using <code class="docutils literal notranslate"><span class="pre">&#64;file</span></code> or <code class="docutils literal notranslate"><span class="pre">&#64;-</span></code> syntax. Please see <a class="reference internal" href="index.html#invocation"><span class="std std-ref">Basic Invocation</span></a>.</p></li>
<li><p><a class="reference internal" href="index.html#option-rotate" title="option-rotate"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--rotate</span></code></a>: request page rotation</p></li>
<li><p><a class="reference internal" href="index.html#option-newline-before-endstream" title="option-newline-before-endstream"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--newline-before-endstream</span></code></a>: ensure that
a newline appears before every <code class="docutils literal notranslate"><span class="pre">endstream</span></code> keyword in the
file; used to prevent qpdf from breaking PDF/A compliance on
already compliant files.</p></li>
<li><p><a class="reference internal" href="index.html#option-preserve-unreferenced" title="option-preserve-unreferenced"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--preserve-unreferenced</span></code></a>: preserve
unreferenced objects in the input PDF</p></li>
<li><p><a class="reference internal" href="index.html#option-split-pages" title="option-split-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--split-pages</span></code></a>: break output into chunks
with fixed numbers of pages</p></li>
<li><p><a class="reference internal" href="index.html#option-verbose" title="option-verbose"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--verbose</span></code></a>: print the name of each
output file that is created</p></li>
<li><p><a class="reference internal" href="index.html#option-compress-streams" title="option-compress-streams"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--compress-streams</span></code></a> and
<a class="reference internal" href="index.html#option-decode-level" title="option-decode-level"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--decode-level</span></code></a> replace
<a class="reference internal" href="index.html#option-stream-data" title="option-stream-data"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--stream-data</span></code></a> for improving granularity
of controlling compression and decompression of stream data.
The <a class="reference internal" href="index.html#option-stream-data" title="option-stream-data"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--stream-data</span></code></a> option will remain
available.</p></li>
<li><p>When running <strong class="command">qpdf --check</strong> with other
options, checks are always run first. This enables qpdf to
perform its full recovery logic before outputting other
information. This can be especially useful when manually
recovering broken files, looking at qpdf’s regenerated cross
reference table, or other similar operations.</p></li>
<li><p>Process <strong class="command">--pages</strong> earlier so that other
options like <a class="reference internal" href="index.html#option-show-pages" title="option-show-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--show-pages</span></code></a> or
<a class="reference internal" href="index.html#option-split-pages" title="option-split-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--split-pages</span></code></a> can operate on the file
after page splitting/merging has occurred.</p></li>
</ul>
</li>
<li><p>API Changes. All new API calls are documented in their respective
classes’ header files.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::rotatePage</span></code>: apply rotation to a page
object</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDFWriter::setNewlineBeforeEndstream</span></code>: force newline to
appear before <code class="docutils literal notranslate"><span class="pre">endstream</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDFWriter::setPreserveUnreferencedObjects</span></code>: preserve
unreferenced objects that appear in the input PDF. The default
behavior is to discard them.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> types <code class="docutils literal notranslate"><span class="pre">Pl_RunLength</span></code> and <code class="docutils literal notranslate"><span class="pre">Pl_DCT</span></code> are
available for developers who wish to produce or consume
RunLength or DCT stream data directly. The
<code class="file docutils literal notranslate"><span class="pre">examples/pdf-create.cc</span></code> example
illustrates their use.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDFWriter::setCompressStreams</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFWriter::setDecodeLevel</span></code> methods control handling of
different types of stream compression.</p></li>
<li><p>Add new C API functions <code class="docutils literal notranslate"><span class="pre">qpdf_set_compress_streams</span></code>,
<code class="docutils literal notranslate"><span class="pre">qpdf_set_decode_level</span></code>,
<code class="docutils literal notranslate"><span class="pre">qpdf_set_preserve_unreferenced_objects</span></code>, and
<code class="docutils literal notranslate"><span class="pre">qpdf_set_newline_before_endstream</span></code> corresponding to the new
<code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> methods.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>6.0.0: November 10, 2015</dt><dd><ul class="simple">
<li><p>Implement <a class="reference internal" href="index.html#option-deterministic-id" title="option-deterministic-id"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--deterministic-id</span></code></a> command-line
option and <code class="docutils literal notranslate"><span class="pre">QPDFWriter::setDeterministicID</span></code> as well as C API
function <code class="docutils literal notranslate"><span class="pre">qpdf_set_deterministic_ID</span></code> for generating a
deterministic ID for non-encrypted files. When this option is
selected, the ID of the file depends on the contents of the output
file, and not on transient items such as the timestamp or output
file name.</p></li>
<li><p>Make qpdf more tolerant of files whose xref table entries are not
the correct length.</p></li>
</ul>
</dd>
<dt>5.1.3: May 24, 2015</dt><dd><ul class="simple">
<li><p>Bug fix: fix-qdf was not properly handling files that contained
object streams with more than 255 objects in them.</p></li>
<li><p>Bug fix: qpdf was not properly initializing Microsoft’s secure
crypto provider on fresh Windows installations that had not had
any keys created yet.</p></li>
<li><p>Fix a few errors found by Gynvael Coldwind and Mateusz Jurczyk of
the Google Security Team. Please see the ChangeLog for details.</p></li>
<li><p>Properly handle pages that have no contents at all. There were
many cases in which qpdf handled this fine, but a few methods
blindly obtained page contents with handling the possibility that
there were no contents.</p></li>
<li><p>Make qpdf more robust for a few more kinds of problems that may
occur in invalid PDF files.</p></li>
</ul>
</dd>
<dt>5.1.2: June 7, 2014</dt><dd><ul class="simple">
<li><p>Bug fix: linearizing files could create a corrupted output file
under extremely unlikely file size circumstances. See ChangeLog
for details. The odds of getting hit by this are very low, though
one person did.</p></li>
<li><p>Bug fix: qpdf would fail to write files that had streams with
decode parameters referencing other streams.</p></li>
<li><p>New example program: <strong class="command">pdf-split-pages</strong>:
efficiently split PDF files into individual pages. The example
program does this more efficiently than using <strong class="command">qpdf
--pages</strong> to do it.</p></li>
<li><p>Packaging fix: Visual C++ binaries did not support Windows XP.
This has been rectified by updating the compilers used to generate
the release binaries.</p></li>
</ul>
</dd>
<dt>5.1.1: January 14, 2014</dt><dd><ul class="simple">
<li><p>Performance fix: copying foreign objects could be very slow with
certain types of files. This was most likely to be visible during
page splitting and was due to traversing the same objects multiple
times in some cases.</p></li>
</ul>
</dd>
<dt>5.1.0: December 17, 2013</dt><dd><ul class="simple">
<li><p>Added runtime option (<code class="docutils literal notranslate"><span class="pre">QUtil::setRandomDataProvider</span></code>) to supply
your own random data provider. You can use this if you want to
avoid using the OS-provided secure random number generation
facility or stdlib’s less secure version. See comments in
include/qpdf/QUtil.hh for details.</p></li>
<li><p>Fixed image comparison tests to not create 12-bit-per-pixel images
since some versions of tiffcmp have bugs in comparing them in some
cases. This increases the disk space required by the image
comparison tests, which are off by default anyway.</p></li>
<li><p>Introduce a number of small fixes for compilation on the latest
clang in MacOS and the latest Visual C++ in Windows.</p></li>
<li><p>Be able to handle broken files that end the xref table header with
a space instead of a newline.</p></li>
</ul>
</dd>
<dt>5.0.1: October 18, 2013</dt><dd><ul class="simple">
<li><p>Thanks to a detailed review by Florian Weimer and the Red Hat
Product Security Team, this release includes a number of
non-user-visible security hardening changes. Please see the
ChangeLog file in the source distribution for the complete list.</p></li>
<li><p>When available, operating system-specific secure random number
generation is used for generating initialization vectors and other
random values used during encryption or file creation. For the
Windows build, this results in an added dependency on Microsoft’s
cryptography API. To disable the OS-specific cryptography and use
the old version, pass the
<code class="samp docutils literal notranslate"><span class="pre">--enable-insecure-random</span></code> option to
<strong class="command">./configure</strong>.</p></li>
<li><p>The <strong class="command">qpdf</strong> command-line tool now issues a
warning when <code class="samp docutils literal notranslate"><span class="pre">-accessibility=n</span></code> is specified
for newer encryption versions stating that the option is ignored.
qpdf, per the spec, has always ignored this flag, but it
previously did so silently. This warning is issued only by the
command-line tool, not by the library. The library’s handling of
this flag is unchanged.</p></li>
</ul>
</dd>
<dt>5.0.0: July 10, 2013</dt><dd><ul class="simple">
<li><p>Bug fix: previous versions of qpdf would lose objects with
generation != 0 when generating object streams. Fixing this
required changes to the public API.</p></li>
<li><p>Removed methods from public API that were only supposed to be
called by QPDFWriter and couldn’t realistically be called anywhere
else. See ChangeLog for details.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">QPDFObjGen</span></code> class added to represent an object
ID/generation pair. <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getObjGen()</span></code> is now
preferred over <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getObjectID()</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getGeneration()</span></code> as it makes it less likely
for people to accidentally write code that ignores the generation
number. See <code class="file docutils literal notranslate"><span class="pre">QPDF.hh</span></code> and
<code class="file docutils literal notranslate"><span class="pre">QPDFObjectHandle.hh</span></code> for additional
notes.</p></li>
<li><p>Add <a class="reference internal" href="index.html#option-show-npages" title="option-show-npages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--show-npages</span></code></a> command-line option to
the <strong class="command">qpdf</strong> command to show the number of
pages in a file.</p></li>
<li><p>Allow omission of the page range within
<a class="reference internal" href="index.html#option-pages" title="option-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--pages</span></code></a> for the
<strong class="command">qpdf</strong> command. When omitted, the page
range is implicitly taken to be all the pages in the file.</p></li>
<li><p>Various enhancements were made to support different types of
broken files or broken readers. Details can be found in
<code class="file docutils literal notranslate"><span class="pre">ChangeLog</span></code>.</p></li>
</ul>
</dd>
<dt>4.1.0: April 14, 2013</dt><dd><ul class="simple">
<li><p>Note to people including qpdf in distributions: the
<code class="file docutils literal notranslate"><span class="pre">.la</span></code> files generated by libtool are now
installed by qpdf’s <strong class="command">make install</strong> target.
Before, they were not installed. This means that if your
distribution does not want to include
<code class="file docutils literal notranslate"><span class="pre">.la</span></code> files, you must remove them as
part of your packaging process.</p></li>
<li><p>Major enhancement: API enhancements have been made to support
parsing of content streams. This enhancement includes the
following changes:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::parseContentStream</span></code> method parses objects
in a content stream and calls handlers in a callback class. The
example
<code class="file docutils literal notranslate"><span class="pre">examples/pdf-parse-content.cc</span></code>
illustrates how this may be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> can now represent operators and inline
images, object types that may only appear in content streams.</p></li>
<li><p>Method <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getTypeCode()</span></code> returns an
enumerated type value representing the underlying object type.
Method <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getTypeName()</span></code> returns a text
string describing the name of the type of a
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> object. These methods can be used for more
efficient parsing and debugging/diagnostic messages.</p></li>
</ul>
</li>
<li><p><strong class="command">qpdf --check</strong> now parses all pages’
content streams in addition to doing other checks. While there are
still many types of errors that cannot be detected, syntactic
errors in content streams will now be reported.</p></li>
<li><p>Minor compilation enhancements have been made to facilitate easier
for support for a broader range of compilers and compiler
versions.</p>
<ul>
<li><p>Warning flags have been moved into a separate variable in
<code class="file docutils literal notranslate"><span class="pre">autoconf.mk</span></code></p></li>
<li><p>The configure flag <code class="samp docutils literal notranslate"><span class="pre">--enable-werror</span></code> work
for Microsoft compilers</p></li>
<li><p>All MSVC CRT security warnings have been resolved.</p></li>
<li><p>All C-style casts in C++ Code have been replaced by C++ casts,
and many casts that had been included to suppress higher
warning levels for some compilers have been removed, primarily
for clarity. Places where integer type coercion occurs have
been scrutinized. A new casting policy has been documented in
the manual. This is of concern mainly to people porting qpdf to
new platforms or compilers. It is not visible to programmers
writing code that uses the library</p></li>
<li><p>Some internal limits have been removed in code that converts
numbers to strings. This is largely invisible to users, but it
does trigger a bug in some older versions of mingw-w64’s C++
library. See <code class="file docutils literal notranslate"><span class="pre">README-windows.md</span></code> in
the source distribution if you think this may affect you. The
copy of the DLL distributed with qpdf’s binary distribution is
not affected by this problem.</p></li>
</ul>
</li>
<li><p>The RPM spec file previously included with qpdf has been removed.
This is because virtually all Linux distributions include qpdf now
that it is a dependency of CUPS filters.</p></li>
<li><p>A few bug fixes are included:</p>
<ul>
<li><p>Overridden compressed objects are properly handled. Before,
there were certain constructs that could cause qpdf to see old
versions of some objects. The most usual manifestation of this
was loss of filled in form values for certain files.</p></li>
<li><p>Installation no longer uses GNU/Linux-specific versions of some
commands, so <strong class="command">make install</strong> works on
Solaris with native tools.</p></li>
<li><p>The 64-bit mingw Windows binary package no longer includes a
32-bit DLL.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>4.0.1: January 17, 2013</dt><dd><ul class="simple">
<li><p>Fix detection of binary attachments in test suite to avoid false
test failures on some platforms.</p></li>
<li><p>Add clarifying comment in <code class="file docutils literal notranslate"><span class="pre">QPDF.hh</span></code> to
methods that return the user password explaining that it is no
longer possible with newer encryption formats to recover the user
password knowing the owner password. In earlier encryption
formats, the user password was encrypted in the file using the
owner password. In newer encryption formats, a separate encryption
key is used on the file, and that key is independently encrypted
using both the user password and the owner password.</p></li>
</ul>
</dd>
<dt>4.0.0: December 31, 2012</dt><dd><ul class="simple">
<li><p>Major enhancement: support has been added for newer encryption
schemes supported by version X of Adobe Acrobat. This includes use
of 127-character passwords, 256-bit encryption keys, and the
encryption scheme specified in ISO 32000-2, the PDF 2.0
specification. This scheme can be chosen from the command line by
specifying use of 256-bit keys. qpdf also supports the deprecated
encryption method used by Acrobat IX. This encryption style has
known security weaknesses and should not be used in practice.
However, such files exist “in the wild,” so support for this
scheme is still useful. New methods
<code class="docutils literal notranslate"><span class="pre">QPDFWriter::setR6EncryptionParameters</span></code> (for the PDF 2.0 scheme)
and <code class="docutils literal notranslate"><span class="pre">QPDFWriter::setR5EncryptionParameters</span></code> (for the deprecated
scheme) have been added to enable these new encryption schemes.
Corresponding functions have been added to the C API as well.</p></li>
<li><p>Full support for Adobe extension levels in PDF version
information. Starting with PDF version 1.7, corresponding to ISO
32000, Adobe adds new functionality by increasing the extension
level rather than increasing the version. This support includes
addition of the <code class="docutils literal notranslate"><span class="pre">QPDF::getExtensionLevel</span></code> method for retrieving
the document’s extension level, addition of versions of
<code class="docutils literal notranslate"><span class="pre">QPDFWriter::setMinimumPDFVersion</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFWriter::forcePDFVersion</span></code> that accept an extension level,
and extended syntax for specifying forced and minimum versions on
the command line as described in <a class="reference internal" href="index.html#option-force-version" title="option-force-version"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--force-version</span></code></a> and
<a class="reference internal" href="index.html#option-min-version" title="option-min-version"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--min-version</span></code></a>. Corresponding functions have been added
to the C API as well.</p></li>
<li><p>Minor fixes to prevent qpdf from referencing objects in the file
that are not referenced in the file’s overall structure. Most
files don’t have any such objects, but some files have contain
unreferenced objects with errors, so these fixes prevent qpdf from
needlessly rejecting or complaining about such objects.</p></li>
<li><p>Add new generalized methods for reading and writing files from/to
programmer-defined sources. The method
<code class="docutils literal notranslate"><span class="pre">QPDF::processInputSource</span></code> allows the programmer to use any
input source for the input file, and
<code class="docutils literal notranslate"><span class="pre">QPDFWriter::setOutputPipeline</span></code> allows the programmer to write
the output file through any pipeline. These methods would make it
possible to perform any number of specialized operations, such as
accessing external storage systems, creating bindings for qpdf in
other programming languages that have their own I/O systems, etc.</p></li>
<li><p>Add new method <code class="docutils literal notranslate"><span class="pre">QPDF::getEncryptionKey</span></code> for retrieving the
underlying encryption key used in the file.</p></li>
<li><p>This release includes a small handful of non-compatible API
changes. While effort is made to avoid such changes, all the
non-compatible API changes in this version were to parts of the
API that would likely never be used outside the library itself. In
all cases, the altered methods or structures were parts of the
<code class="docutils literal notranslate"><span class="pre">QPDF</span></code> that were public to enable them to be called from either
<code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> or were part of validation code that was
over-zealous in reporting problems in parts of the file that would
not ordinarily be referenced. In no case did any of the removed
methods do anything worse that falsely report error conditions in
files that were broken in ways that didn’t matter. The following
public parts of the <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> class were changed in a
non-compatible way:</p>
<ul>
<li><p>Updated nested <code class="docutils literal notranslate"><span class="pre">QPDF::EncryptionData</span></code> class to add fields
needed by the newer encryption formats, member variables
changed to private so that future changes will not require
breaking backward compatibility.</p></li>
<li><p>Added additional parameters to <code class="docutils literal notranslate"><span class="pre">compute_data_key</span></code>, which is
used by <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> to compute the encryption key used to
encrypt a specific object.</p></li>
<li><p>Removed the method <code class="docutils literal notranslate"><span class="pre">flattenScalarReferences</span></code>. This method was
previously used prior to writing a new PDF file, but it has the
undesired side effect of causing qpdf to read objects in the
file that were not referenced. Some otherwise files have
unreferenced objects with errors in them, so this could cause
qpdf to reject files that would be accepted by virtually all
other PDF readers. In fact, qpdf relied on only a very small
part of what flattenScalarReferences did, so only this part has
been preserved, and it is now done directly inside
<code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code>.</p></li>
<li><p>Removed the method <code class="docutils literal notranslate"><span class="pre">decodeStreams</span></code>. This method was used by
the <a class="reference internal" href="index.html#option-check" title="option-check"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--check</span></code></a> option of the
<strong class="command">qpdf</strong> command-line tool to force all
streams in the file to be decoded, but it also suffered from
the problem of opening otherwise unreferenced streams and thus
could report false positive. The
<a class="reference internal" href="index.html#option-check" title="option-check"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--check</span></code></a> option now causes qpdf to go
through all the motions of writing a new file based on the
original one, so it will always reference and check exactly
those parts of a file that any ordinary viewer would check.</p></li>
<li><p>Removed the method <code class="docutils literal notranslate"><span class="pre">trimTrailerForWrite</span></code>. This method was
used by <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> to modify the original QPDF object by
removing fields from the trailer dictionary that wouldn’t apply
to the newly written file. This functionality, though generally
harmless, was a poor implementation and has been replaced by
having QPDFWriter filter these out when copying the trailer
rather than modifying the original QPDF object. (Note that qpdf
never modifies the original file itself.)</p></li>
</ul>
</li>
<li><p>Allow the PDF header to appear anywhere in the first 1024 bytes of
the file. This is consistent with what other readers do.</p></li>
<li><p>Fix the <strong class="command">pkg-config</strong> files to list zlib
and pcre in <code class="docutils literal notranslate"><span class="pre">Requires.private</span></code> to better support static linking
using <strong class="command">pkg-config</strong>.</p></li>
</ul>
</dd>
<dt>3.0.2: September 6, 2012</dt><dd><ul class="simple">
<li><p>Bug fix: <code class="docutils literal notranslate"><span class="pre">QPDFWriter::setOutputMemory</span></code> did not work when not
used with <code class="docutils literal notranslate"><span class="pre">QPDFWriter::setStaticID</span></code>, which made it pretty much
useless. This has been fixed.</p></li>
<li><p>New API call <code class="docutils literal notranslate"><span class="pre">QPDFWriter::setExtraHeaderText</span></code> inserts additional
text near the header of the PDF file. The intended use case is to
insert comments that may be consumed by a downstream application,
though other use cases may exist.</p></li>
</ul>
</dd>
<dt>3.0.1: August 11, 2012</dt><dd><ul class="simple">
<li><p>Version 3.0.0 included addition of files for
<strong class="command">pkg-config</strong>, but this was not mentioned
in the release notes. The release notes for 3.0.0 were updated to
mention this.</p></li>
<li><p>Bug fix: if an object stream ended with a scalar object not
followed by space, qpdf would incorrectly report that it
encountered a premature EOF. This bug has been in qpdf since
version 2.0.</p></li>
</ul>
</dd>
<dt>3.0.0: August 2, 2012</dt><dd><ul class="simple">
<li><p>Acknowledgment: I would like to express gratitude for the
contributions of Tobias Hoffmann toward the release of qpdf
version 3.0. He is responsible for most of the implementation and
design of the new API for manipulating pages, and contributed code
and ideas for many of the improvements made in version 3.0.
Without his work, this release would certainly not have happened
as soon as it did, if at all.</p></li>
<li><p><em>Non-compatible API changes:</em></p>
<ul>
<li><p>The method <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::replaceStreamData</span></code> that uses a
<code class="docutils literal notranslate"><span class="pre">StreamDataProvider</span></code> to provide the stream data no longer
takes a <code class="docutils literal notranslate"><span class="pre">length</span></code> parameter. The parameter was removed since
this provides the user an opportunity to simplify the calling
code. This method was introduced in version 2.2. At the time,
the <code class="docutils literal notranslate"><span class="pre">length</span></code> parameter was required in order to ensure that
calls to the stream data provider returned the same length for a
specific stream every time they were invoked. In particular, the
linearization code depends on this. Instead, qpdf 3.0 and newer
check for that constraint explicitly. The first time the stream
data provider is called for a specific stream, the actual length
is saved, and subsequent calls are required to return the same
number of bytes. This means the calling code no longer has to
compute the length in advance, which can be a significant
simplification. If your code fails to compile because of the
extra argument and you don’t want to make other changes to your
code, just omit the argument.</p></li>
<li><p>Many methods take <code class="docutils literal notranslate"><span class="pre">long</span> <span class="pre">long</span></code> instead of other integer types.
Most if not all existing code should compile fine with this
change since such parameters had always previously been smaller
types. This change was required to support files larger than two
gigabytes in size.</p></li>
</ul>
</li>
<li><p>Support has been added for large files. The test suite verifies
support for files larger than 4 gigabytes, and manual testing has
verified support for files larger than 10 gigabytes. Large file
support is available for both 32-bit and 64-bit platforms as long
as the compiler and underlying platforms support it.</p></li>
<li><p>Support for page selection (splitting and merging PDF files) has
been added to the <strong class="command">qpdf</strong> command-line
tool. See <a class="reference internal" href="index.html#page-selection"><span class="std std-ref">Page Selection</span></a>.</p></li>
<li><p>The <a class="reference internal" href="index.html#option-copy-encryption" title="option-copy-encryption"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--copy-encryption</span></code></a> option have been added to the
<strong class="command">qpdf</strong> command-line tool for copying encryption
parameters from another file.</p></li>
<li><p>New methods have been added to the <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object for adding and
removing pages. See <a class="reference internal" href="index.html#adding-and-remove-pages"><span class="std std-ref">Adding and Removing Pages</span></a>.</p></li>
<li><p>New methods have been added to the <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object for copying
objects from other PDF files. See <a class="reference internal" href="index.html#foreign-objects"><span class="std std-ref">Copying Objects From Other PDF Files</span></a></p></li>
<li><p>A new method <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::parse</span></code> has been added for
constructing <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> objects from a string
description.</p></li>
<li><p>Methods have been added to <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> to allow writing to an
already open stdio <code class="docutils literal notranslate"><span class="pre">FILE*</span></code> addition to writing to standard
output or a named file. Methods have been added to <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> to be
able to process a file from an already open stdio <code class="docutils literal notranslate"><span class="pre">FILE*</span></code>. This
makes it possible to read and write PDF from secure temporary
files that have been unlinked prior to being fully read or
written.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">QPDF::emptyPDF</span></code> can be used to allow creation of PDF files
from scratch. The example
<code class="file docutils literal notranslate"><span class="pre">examples/pdf-create.cc</span></code> illustrates how
it can be used.</p></li>
<li><p>Several methods to take <code class="docutils literal notranslate"><span class="pre">PointerHolder&lt;Buffer&gt;</span></code> can now also
accept <code class="docutils literal notranslate"><span class="pre">std::string</span></code> arguments.</p></li>
<li><p>Many new convenience methods have been added to the library, most
in <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>. See <code class="file docutils literal notranslate"><span class="pre">ChangeLog</span></code>
for a full list.</p></li>
<li><p>When building on a platform that supports ELF shared libraries
(such as Linux), symbol versions are enabled by default. They can
be disabled by passing
<code class="samp docutils literal notranslate"><span class="pre">--disable-ld-version-script</span></code> to
<strong class="command">./configure</strong>.</p></li>
<li><p>The file <code class="file docutils literal notranslate"><span class="pre">libqpdf.pc</span></code> is now installed
to support <strong class="command">pkg-config</strong>.</p></li>
<li><p>Image comparison tests are off by default now since they are not
needed to verify a correct build or port of qpdf. They are needed
only when changing the actual PDF output generated by qpdf. You
should enable them if you are making deep changes to qpdf itself.
See <code class="file docutils literal notranslate"><span class="pre">README.md</span></code> for details.</p></li>
<li><p>Large file tests are off by default but can be turned on with
<strong class="command">./configure</strong> or by setting an environment
variable before running the test suite. See
<code class="file docutils literal notranslate"><span class="pre">README.md</span></code> for details.</p></li>
<li><p>When qpdf’s test suite fails, failures are not printed to the
terminal anymore by default. Instead, find them in
<code class="file docutils literal notranslate"><span class="pre">build/qtest.log</span></code>. For packagers who are
building with an autobuilder, you can add the
<code class="samp docutils literal notranslate"><span class="pre">--enable-show-failed-test-output</span></code> option to
<strong class="command">./configure</strong> to restore the old behavior.</p></li>
</ul>
</dd>
<dt>2.3.1: December 28, 2011</dt><dd><ul class="simple">
<li><p>Fix thread-safety problem resulting from non-thread-safe use of
the PCRE library.</p></li>
<li><p>Made a few minor documentation fixes.</p></li>
<li><p>Add workaround for a bug that appears in some versions of
ghostscript to the test suite</p></li>
<li><p>Fix minor build issue for Visual C++ 2010.</p></li>
</ul>
</dd>
<dt>2.3.0: August 11, 2011</dt><dd><ul class="simple">
<li><p>Bug fix: when preserving existing encryption on encrypted files
with cleartext metadata, older qpdf versions would generate
password-protected files with no valid password. This operation
now works. This bug only affected files created by copying
existing encryption parameters; explicit encryption with
specification of cleartext metadata worked before and continues to
work.</p></li>
<li><p>Enhance <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> with a new constructor that allows you to
delay the specification of the output file. When using this
constructor, you may now call <code class="docutils literal notranslate"><span class="pre">QPDFWriter::setOutputFilename</span></code> to
specify the output file, or you may use
<code class="docutils literal notranslate"><span class="pre">QPDFWriter::setOutputMemory</span></code> to cause <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> to write
the resulting PDF file to a memory buffer. You may then use
<code class="docutils literal notranslate"><span class="pre">QPDFWriter::getBuffer</span></code> to retrieve the memory buffer.</p></li>
<li><p>Add new API call <code class="docutils literal notranslate"><span class="pre">QPDF::replaceObject</span></code> for replacing objects by
object ID</p></li>
<li><p>Add new API call <code class="docutils literal notranslate"><span class="pre">QPDF::swapObjects</span></code> for swapping two objects by
object ID</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getDictAsMap</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getArrayAsVector</span></code> to allow retrieval of
dictionary objects as maps and array objects as vectors.</p></li>
<li><p>Add functions <code class="docutils literal notranslate"><span class="pre">qpdf_get_info_key</span></code> and <code class="docutils literal notranslate"><span class="pre">qpdf_set_info_key</span></code> to
the C API for manipulating string fields of the document’s
<code class="docutils literal notranslate"><span class="pre">/Info</span></code> dictionary.</p></li>
<li><p>Add functions <code class="docutils literal notranslate"><span class="pre">qpdf_init_write_memory</span></code>,
<code class="docutils literal notranslate"><span class="pre">qpdf_get_buffer_length</span></code>, and <code class="docutils literal notranslate"><span class="pre">qpdf_get_buffer</span></code> to the C API
for writing PDF files to a memory buffer instead of a file.</p></li>
</ul>
</dd>
<dt>2.2.4: June 25, 2011</dt><dd><ul class="simple">
<li><p>Fix installation and compilation issues; no functionality changes.</p></li>
</ul>
</dd>
<dt>2.2.3: April 30, 2011</dt><dd><ul class="simple">
<li><p>Handle some damaged streams with incorrect characters following
the stream keyword.</p></li>
<li><p>Improve handling of inline images when normalizing content
streams.</p></li>
<li><p>Enhance error recovery to properly handle files that use object 0
as a regular object, which is specifically disallowed by the spec.</p></li>
</ul>
</dd>
<dt>2.2.2: October 4, 2010</dt><dd><ul class="simple">
<li><p>Add new function <code class="docutils literal notranslate"><span class="pre">qpdf_read_memory</span></code> to the C API to call
<code class="docutils literal notranslate"><span class="pre">QPDF::processMemoryFile</span></code>. This was an omission in qpdf 2.2.1.</p></li>
</ul>
</dd>
<dt>2.2.1: October 1, 2010</dt><dd><ul class="simple">
<li><p>Add new method <code class="docutils literal notranslate"><span class="pre">QPDF::setOutputStreams</span></code> to replace <code class="docutils literal notranslate"><span class="pre">std::cout</span></code>
and <code class="docutils literal notranslate"><span class="pre">std::cerr</span></code> with other streams for generation of diagnostic
messages and error messages. This can be useful for GUIs or other
applications that want to capture any output generated by the
library to present to the user in some other way. Note that QPDF
does not write to <code class="docutils literal notranslate"><span class="pre">std::cout</span></code> (or the specified output stream)
except where explicitly mentioned in
<code class="file docutils literal notranslate"><span class="pre">QPDF.hh</span></code>, and that the only use of the
error stream is for warnings. Note also that output of warnings is
suppressed when <code class="docutils literal notranslate"><span class="pre">setSuppressWarnings(true)</span></code> is called.</p></li>
<li><p>Add new method <code class="docutils literal notranslate"><span class="pre">QPDF::processMemoryFile</span></code> for operating on PDF
files that are loaded into memory rather than in a file on disk.</p></li>
<li><p>Give a warning but otherwise ignore empty PDF objects by treating
them as null. Empty object are not permitted by the PDF
specification but have been known to appear in some actual PDF
files.</p></li>
<li><p>Handle inline image filter abbreviations when the appear as stream
filter abbreviations. The PDF specification does not allow use of
stream filter abbreviations in this way, but Adobe Reader and some
other PDF readers accept them since they sometimes appear
incorrectly in actual PDF files.</p></li>
<li><p>Implement miscellaneous enhancements to <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> and
<code class="docutils literal notranslate"><span class="pre">Buffer</span></code> to support other changes.</p></li>
</ul>
</dd>
<dt>2.2.0: August 14, 2010</dt><dd><ul class="simple">
<li><p>Add new methods to <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> (<code class="docutils literal notranslate"><span class="pre">newStream</span></code> and
<code class="docutils literal notranslate"><span class="pre">replaceStreamData</span></code> for creating new streams and replacing
stream data. This makes it possible to perform a wide range of
operations that were not previously possible.</p></li>
<li><p>Add new helper method in <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>
(<code class="docutils literal notranslate"><span class="pre">addPageContents</span></code>) for appending or prepending new content
streams to a page. This method makes it possible to manipulate
content streams without having to be concerned whether a page’s
contents are a single stream or an array of streams.</p></li>
<li><p>Add new method in <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>: <code class="docutils literal notranslate"><span class="pre">replaceOrRemoveKey</span></code>,
which replaces a dictionary key with a given value unless the
value is null, in which case it removes the key instead.</p></li>
<li><p>Add new method in <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>: <code class="docutils literal notranslate"><span class="pre">getRawStreamData</span></code>,
which returns the raw (unfiltered) stream data into a buffer. This
complements the <code class="docutils literal notranslate"><span class="pre">getStreamData</span></code> method, which returns the
filtered (uncompressed) stream data and can only be used when the
stream’s data is filterable.</p></li>
<li><p>Provide two new examples:
<strong class="command">pdf-double-page-size</strong> and
<strong class="command">pdf-invert-images</strong> that illustrate the
newly added interfaces.</p></li>
<li><p>Fix a memory leak that would cause loss of a few bytes for every
object involved in a cycle of object references. Thanks to Jian Ma
for calling my attention to the leak.</p></li>
</ul>
</dd>
<dt>2.1.5: April 25, 2010</dt><dd><ul class="simple">
<li><p>Remove restriction of file identifier strings to 16 bytes. This
unnecessary restriction was preventing qpdf from being able to
encrypt or decrypt files with identifier strings that were not
exactly 16 bytes long. The specification imposes no such
restriction.</p></li>
</ul>
</dd>
<dt>2.1.4: April 18, 2010</dt><dd><ul class="simple">
<li><p>Apply the same padding calculation fix from version 2.1.2 to the
main cross reference stream as well.</p></li>
<li><p>Since <strong class="command">qpdf --check</strong> only performs limited
checks, clarify the output to make it clear that there still may
be errors that qpdf can’t check. This should make it less
surprising to people when another PDF reader is unable to read a
file that qpdf thinks is okay.</p></li>
</ul>
</dd>
<dt>2.1.3: March 27, 2010</dt><dd><ul class="simple">
<li><p>Fix bug that could cause a failure when rewriting PDF files that
contain object streams with unreferenced objects that in turn
reference indirect scalars.</p></li>
<li><p>Don’t complain about (invalid) AES streams that aren’t a multiple
of 16 bytes. Instead, pad them before decrypting.</p></li>
</ul>
</dd>
<dt>2.1.2: January 24, 2010</dt><dd><ul class="simple">
<li><p>Fix bug in padding around first half cross reference stream in
linearized files. The bug could cause an assertion failure when
linearizing certain unlucky files.</p></li>
</ul>
</dd>
<dt>2.1.1: December 14, 2009</dt><dd><ul class="simple">
<li><p>No changes in functionality; insert missing include in an internal
library header file to support gcc 4.4, and update test suite to
ignore broken Adobe Reader installations.</p></li>
</ul>
</dd>
<dt>2.1: October 30, 2009</dt><dd><ul>
<li><p>This is the first version of qpdf to include Windows support. On
Windows, it is possible to build a DLL. Additionally, a partial
C-language API has been introduced, which makes it possible to
call qpdf functions from non-C++ environments. I am very grateful
to Žarko Gajić (<a class="reference external" href="http://zarko-gajic.iz.hr/">http://zarko-gajic.iz.hr/</a>) for tirelessly testing
numerous pre-release versions of this DLL and providing many
excellent suggestions on improving the interface.</p>
<p>For programming to the C interface, please see the header file
<code class="file docutils literal notranslate"><span class="pre">qpdf/qpdf-c.h</span></code> and the example
<code class="file docutils literal notranslate"><span class="pre">examples/pdf-linearize.c</span></code>.</p>
</li>
<li><p>Žarko Gajić has written a Delphi wrapper for qpdf, which can be
downloaded from qpdf’s download side. Žarko’s Delphi wrapper is
released with the same licensing terms as qpdf itself and comes
with this disclaimer: “Delphi wrapper unit
<code class="file docutils literal notranslate"><span class="pre">qpdf.pas</span></code> created by Žarko Gajić
(<a class="reference external" href="http://zarko-gajic.iz.hr/">http://zarko-gajic.iz.hr/</a>). Use at your own risk and for whatever
purpose you want. No support is provided. Sample code is
provided.”</p></li>
<li><p>Support has been added for AES encryption and crypt filters.
Although qpdf does not presently support files that use PKI-based
encryption, with the addition of AES and crypt filters, qpdf is
now be able to open most encrypted files created with newer
versions of Acrobat or other PDF creation software. Note that I
have not been able to get very many files encrypted in this way,
so it’s possible there could still be some cases that qpdf can’t
handle. Please report them if you find them.</p></li>
<li><p>Many error messages have been improved to include more information
in hopes of making qpdf a more useful tool for PDF experts to use
in manually recovering damaged PDF files.</p></li>
<li><p>Attempt to avoid compressing metadata streams if possible. This is
consistent with other PDF creation applications.</p></li>
<li><p>Provide new command-line options for AES encrypt, cleartext
metadata, and setting the minimum and forced PDF versions of
output files.</p></li>
<li><p>Add additional methods to the <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object for querying the
document’s permissions. Although qpdf does not enforce these
permissions, it does make them available so that applications that
use qpdf can enforce permissions.</p></li>
<li><p>The <a class="reference internal" href="index.html#option-check" title="option-check"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--check</span></code></a> option to
<strong class="command">qpdf</strong> has been extended to include some
additional information.</p></li>
<li><p><em>Non-compatible API changes:</em></p>
<ul class="simple">
<li><p>QPDF’s exception handling mechanism now uses
<code class="docutils literal notranslate"><span class="pre">std::logic_error</span></code> for internal errors and
<code class="docutils literal notranslate"><span class="pre">std::runtime_error</span></code> for runtime errors in favor of the now
removed <code class="docutils literal notranslate"><span class="pre">QEXC</span></code> classes used in previous versions. The <code class="docutils literal notranslate"><span class="pre">QEXC</span></code>
exception classes predated the addition of the
<code class="file docutils literal notranslate"><span class="pre">&lt;stdexcept&gt;</span></code> header file to the C++ standard library.
Most of the exceptions thrown by the qpdf library itself are
still of type <code class="docutils literal notranslate"><span class="pre">QPDFExc</span></code> which is now derived from
<code class="docutils literal notranslate"><span class="pre">std::runtime_error</span></code>. Programs that catch an instance of
<code class="docutils literal notranslate"><span class="pre">std::exception</span></code> and displayed it by calling the <code class="docutils literal notranslate"><span class="pre">what()</span></code>
method will not need to be changed.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">QPDFExc</span></code> class now internally represents various fields
of the error condition and provides interfaces for querying
them. Among the fields is a numeric error code that can help
applications act differently on (a small number of) different
error conditions. See <code class="file docutils literal notranslate"><span class="pre">QPDFExc.hh</span></code> for details.</p></li>
<li><p>Warnings can be retrieved from qpdf as instances of <code class="docutils literal notranslate"><span class="pre">QPDFExc</span></code>
instead of strings.</p></li>
<li><p>The nested <code class="docutils literal notranslate"><span class="pre">QPDF::EncryptionData</span></code> class’s constructor takes an
additional argument. This class is primarily intended to be used
by <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code>. There’s not really anything useful an
end-user application could do with it. It probably shouldn’t
really be part of the public interface to begin with. Likewise,
some of the methods for computing internal encryption dictionary
parameters have changed to support <code class="docutils literal notranslate"><span class="pre">/R=4</span></code> encryption.</p></li>
<li><p>The method <code class="docutils literal notranslate"><span class="pre">QPDF::getUserPassword</span></code> has been removed since it
didn’t do what people would think it did. There are now two new
methods: <code class="docutils literal notranslate"><span class="pre">QPDF::getPaddedUserPassword</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDF::getTrimmedUserPassword</span></code>. The first one does what the
old <code class="docutils literal notranslate"><span class="pre">QPDF::getUserPassword</span></code> method used to do, which is to
return the password with possible binary padding as specified by
the PDF specification. The second one returns a human-readable
password string.</p></li>
<li><p>The enumerated types that used to be nested in <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code>
have moved to top-level enumerated types and are now defined in
the file <code class="file docutils literal notranslate"><span class="pre">qpdf/Constants.h</span></code>. This enables them to be
shared by both the C and C++ interfaces.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>2.0.6: May 3, 2009</dt><dd><ul class="simple">
<li><p>Do not attempt to uncompress streams that have decode parameters
we don’t recognize. Earlier versions of qpdf would have rejected
files with such streams.</p></li>
</ul>
</dd>
<dt>2.0.5: March 10, 2009</dt><dd><ul class="simple">
<li><p>Improve error handling in the LZW decoder, and fix a small error
introduced in the previous version with regard to handling full
tables. The LZW decoder has been more strongly verified in this
release.</p></li>
</ul>
</dd>
<dt>2.0.4: February 21, 2009</dt><dd><ul class="simple">
<li><p>Include proper support for LZW streams encoded without the “early
code change” flag. Special thanks to Atom Smasher who reported the
problem and provided an input file compressed in this way, which I
did not previously have.</p></li>
<li><p>Implement some improvements to file recovery logic.</p></li>
</ul>
</dd>
<dt>2.0.3: February 15, 2009</dt><dd><ul class="simple">
<li><p>Compile cleanly with gcc 4.4.</p></li>
<li><p>Handle strings encoded as UTF-16BE properly.</p></li>
</ul>
</dd>
<dt>2.0.2: June 30, 2008</dt><dd><ul class="simple">
<li><p>Update test suite to work properly with a
non-<strong class="command">bash</strong>
<code class="file docutils literal notranslate"><span class="pre">/bin/sh</span></code> and with Perl 5.10. No changes
were made to the actual qpdf source code itself for this release.</p></li>
</ul>
</dd>
<dt>2.0.1: May 6, 2008</dt><dd><ul class="simple">
<li><p>No changes in functionality or interface. This release includes
fixes to the source code so that qpdf compiles properly and passes
its test suite on a broader range of platforms. See
<code class="file docutils literal notranslate"><span class="pre">ChangeLog</span></code> in the source distribution
for details.</p></li>
</ul>
</dd>
<dt>2.0: April 29, 2008</dt><dd><ul class="simple">
<li><p>First public release.</p></li>
</ul>
</dd>
</dl>
</section>
<span id="document-acknowledgement"></span><section id="acknowledgments">
<span id="id1"></span><h2>Acknowledgments<a class="headerlink" href="#acknowledgments" title="Permalink to this heading"></a></h2>
<p>QPDF was originally created in 2001 and modified periodically between
2001 and 2005 during my employment at <a class="reference external" href="https://apexcovantage.com/">Apex CoVantage</a>. Upon my departure from Apex, the
company graciously allowed me to take ownership of the software and
continue maintaining it as an open source project, a decision for which I
am very grateful. I have made considerable enhancements to it since
that time. I feel fortunate to have worked for people who would make
such a decision. This work would not have been possible without their
support.</p>
<p>In 2020, I joined <a class="reference external" href="https://adventhp.com/">Advent Health Partners</a>,
which has sponsored some previous QPDF work and generously allows me
to spend some “company time” maintaining QPDF.</p>
</section>
</div>
</section>
<section id="indices">
<h1>Indices<a class="headerlink" href="#indices" title="Permalink to this heading"></a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="qpdf-options.html"><span class="std std-ref">qpdf Command-line Options</span></a></p></li>
</ul>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2005-2022, Jay Berkenbilt.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>