<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Release Notes &mdash; QPDF 11.1.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/wraptable.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Acknowledgments" href="acknowledgement.html" />
    <link rel="prev" title="PDF Encryption" href="encryption.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> QPDF
            <img src="_static/qpdf.svg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                11.1.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">What is QPDF?</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="download.html">Downloading QPDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Building and Installing QPDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="packaging.html">Notes for Packagers</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Running qpdf</a></li>
<li class="toctree-l1"><a class="reference internal" href="qdf.html">QDF Mode</a></li>
<li class="toctree-l1"><a class="reference internal" href="library.html">Using the QPDF Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="weak-crypto.html">Weak Cryptography</a></li>
<li class="toctree-l1"><a class="reference internal" href="json.html">qpdf JSON</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to qpdf</a></li>
<li class="toctree-l1"><a class="reference internal" href="design.html">Design and Library Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="qpdf-job.html">QPDFJob: a Job-Based Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="linearization.html">Linearization</a></li>
<li class="toctree-l1"><a class="reference internal" href="object-streams.html">Object and Cross-Reference Streams</a></li>
<li class="toctree-l1"><a class="reference internal" href="encryption.html">PDF Encryption</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgement.html">Acknowledgments</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">QPDF</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Release Notes</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/release-notes.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="release-notes">
<span id="id1"></span><h1>Release Notes<a class="headerlink" href="#release-notes" title="Permalink to this heading"></a></h1>
<p>For a detailed list of changes, please see the file
<code class="file docutils literal notranslate"><span class="pre">ChangeLog</span></code> in the source distribution.</p>
<dl>
<dt>11.1.1: October 1, 2022</dt><dd><ul class="simple">
<li><p>Bug fixes</p>
<ul>
<li><p>Fix edge case with character encoding for strings whose initial
characters happen to coincide with Unicode markers.</p></li>
<li><p>Fix issue with AppImage discarding the first command-line
argument when invoked as the name of one of the embedded
executables. Also, fix-qdf, for unknown reasons, had the wrong
runpath and would use a qpdf library that was installed on the
system.</p></li>
</ul>
</li>
<li><p>Test improvements</p>
<ul>
<li><p>Exercise the case of <code class="docutils literal notranslate"><span class="pre">char</span></code> being <code class="docutils literal notranslate"><span class="pre">unsigned</span></code> by default in
automated tests.</p></li>
<li><p>Add AppImage-specific tests to CI to ensure that the AppImage
works in the various ways it is intended to be invoked.</p></li>
</ul>
</li>
<li><p>Other changes</p>
<ul>
<li><p>Include more code tidying and performance improvements from M.
Holger.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>11.1.0: September 14, 2022</dt><dd><ul class="simple">
<li><p>Build fixes</p>
<ul>
<li><p>Remove <code class="docutils literal notranslate"><span class="pre">LL_FMT</span></code> tests, which were broken for cross
compilation. The code just uses <code class="docutils literal notranslate"><span class="pre">%lld</span></code> now.</p></li>
<li><p>Some symbols were not properly exported for the Windows DLL
build.</p></li>
<li><p>Force project-specific header files to precede all others in the
build so that a previous qpdf installation won’t break building
qpdf from source.</p></li>
</ul>
</li>
<li><p>Packaging note omitted from 11.0.0 release notes:</p>
<ul>
<li><p>On GitHub, the release tags are now <code class="docutils literal notranslate"><span class="pre">vX.Y.Z</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">release-qpdf-X.Y.Z</span></code> to be more consistent with current
practice.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>11.0.0: September 10, 2022</dt><dd><ul class="simple">
<li><p>Replacement of <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> with <code class="docutils literal notranslate"><span class="pre">std::shared_ptr</span></code></p>
<ul>
<li><p>The qpdf-specific <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> smart pointer implementation
has now been completely replaced with <code class="docutils literal notranslate"><span class="pre">std::shared_ptr</span></code>
through the qpdf API. Please see <a class="reference internal" href="design.html#smart-pointers"><span class="std std-ref">Smart Pointers</span></a> for
details about this change and a comprehensive migration plan.
Note that a backward-compatible <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> class is
provided and is enabled by default. A warning is issued, but
this can be turned off by following the migration steps outlined
in the manual.</p></li>
</ul>
</li>
<li><p>qpdf JSON version 2</p>
<ul>
<li><p>qpdf’s JSON output mode is now at version 2. This fixes several
flaws with version 1. Version 2 JSON output is unambiguous and
complete, and bidirectional conversion between JSON and PDF is
supported. Command-line options and library API are available
for creating JSON from PDF, creating PDF from JSON and updating
existing PDF at the object level from JSON.</p></li>
<li><p>New command-line arguments: <a class="reference internal" href="cli.html#option-json-output" title="option-json-output"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-output</span></code></a>,
<a class="reference internal" href="cli.html#option-json-input" title="option-json-input"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-input</span></code></a>, <a class="reference internal" href="cli.html#option-update-from-json" title="option-update-from-json"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--update-from-json</span></code></a></p></li>
<li><p>New C++ API calls: <code class="docutils literal notranslate"><span class="pre">QPDF::writeJSON</span></code>,
<code class="docutils literal notranslate"><span class="pre">QPDF::createFromJSON</span></code>, <code class="docutils literal notranslate"><span class="pre">QPDF::updateFromJSON</span></code></p></li>
<li><p>New C API calls: <code class="docutils literal notranslate"><span class="pre">qpdf_create_from_json_file</span></code>,
<code class="docutils literal notranslate"><span class="pre">qpdf_create_from_json_data</span></code>, <code class="docutils literal notranslate"><span class="pre">qpdf_update_from_json_file</span></code>,
<code class="docutils literal notranslate"><span class="pre">qpdf_update_from_json_data</span></code>, and <code class="docutils literal notranslate"><span class="pre">qpdf_write_json</span></code>.</p></li>
<li><p>Complete documentation can be found at <a class="reference internal" href="json.html#json"><span class="std std-ref">qpdf JSON</span></a>. A
comprehensive list of changes from version 1 to version 2 can be
found at <a class="reference internal" href="json.html#json-v2-changes"><span class="std std-ref">Changes from JSON v1 to v2</span></a>.</p></li>
</ul>
</li>
<li><p>Build replaced with cmake</p>
<ul>
<li><p>The old autoconf-based build has been replaced with CMake. CMake
version 3.16 or newer is required. For details, please read
<a class="reference internal" href="installation.html#installing"><span class="std std-ref">Building and Installing QPDF</span></a> and, if you package qpdf for a distribution,
<a class="reference internal" href="packaging.html#packaging"><span class="std std-ref">Notes for Packagers</span></a>.</p></li>
<li><p>For the most part, other than being familiar with generally how to
build things with cmake, what you need to know to convert your
build over is described in <a class="reference internal" href="installation.html#autoconf-to-cmake"><span class="std std-ref">Converting From autoconf to cmake</span></a>. Here are a
few changes in behavior to be aware of:</p>
<ul>
<li><p>Example sources are installed by default in the documentation
directory.</p></li>
<li><p>The configure options to enable image comparison and large file
tests have been replaced by environment variables. The old
options set environment variables behind the scenes. Before, to
skip image tests, you had to set
<code class="docutils literal notranslate"><span class="pre">QPDF_SKIP_TEST_COMPARE_IMAGES=1</span></code>, which was done by default.
Now these are off by default, and you have to set
<code class="docutils literal notranslate"><span class="pre">QPDF_TEST_COMPARE_IMAGES=1</span></code> to enable them.</p></li>
<li><p>In the default configuration, the native crypto provider is only
selected when explicitly requested or when there are no other
options. See <a class="reference internal" href="installation.html#crypto-build"><span class="std std-ref">Build-time Crypto Selection</span></a> for a detailed discussion.</p></li>
<li><p>Windows external libraries are detected by default if the
<code class="file docutils literal notranslate"><span class="pre">external-libraries</span></code> directory is found. Static libraries
for zlib, libjpeg, and openssl are provided as described in
<code class="file docutils literal notranslate"><span class="pre">README-windows.md</span></code>. They are only compatible with
non-debug builds.</p></li>
<li><p>A new directory called <code class="docutils literal notranslate"><span class="pre">pkg-tests</span></code> has been added which
contains short shell scripts that can be used to smoke test an
installed qpdf package. These are used by the debian
<code class="docutils literal notranslate"><span class="pre">autopkgtest</span></code> framework but can be used by others. See
<code class="file docutils literal notranslate"><span class="pre">pkg-test/README.md</span></code> for details.</p></li>
</ul>
</li>
</ul>
</li>
<li><p>Performance improvements</p>
<ul>
<li><p>Many performance enhancements have been added. In developer
performance benchmarks, gains on the order of 20% have been
observed. Most of that work, including major optimization of
qpdf’s lexical and parsing layers, was done by M. Holger.</p></li>
</ul>
</li>
<li><p>CLI: breaking changes</p>
<ul>
<li><p>The <a class="reference internal" href="cli.html#option-show-encryption" title="option-show-encryption"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--show-encryption</span></code></a> flag now provides encryption
information even if a correct password is not supplied. If you
were relying on its not working in this case, see
<a class="reference internal" href="cli.html#option-requires-password" title="option-requires-password"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--requires-password</span></code></a> for a reliable test.</p></li>
<li><p>The default json output version when <a class="reference internal" href="cli.html#option-json" title="option-json"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json</span></code></a> is
specified has been changed from <code class="docutils literal notranslate"><span class="pre">1</span></code> to <code class="docutils literal notranslate"><span class="pre">latest</span></code>, which is
now <code class="docutils literal notranslate"><span class="pre">2</span></code>.</p></li>
<li><p>The <a class="reference internal" href="cli.html#option-allow-weak-crypto" title="option-allow-weak-crypto"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--allow-weak-crypto</span></code></a> flag is now mandatory when
explicitly creating files with weak cryptographic algorithms.
See <a class="reference internal" href="weak-crypto.html#weak-crypto"><span class="std std-ref">Weak Cryptography</span></a> for a discussion.</p></li>
</ul>
</li>
<li><p>API: breaking changes</p>
<ul>
<li><p>Deprecate <code class="docutils literal notranslate"><span class="pre">QPDFObject.hh</span></code> for removal in qpdf 12. The only use
case for including <code class="docutils literal notranslate"><span class="pre">qpdf/QPDFObject.hh</span></code> was to get
<code class="docutils literal notranslate"><span class="pre">QPDFObject::object_type_e</span></code>. Since 10.5.0, this has been an
alias to <code class="docutils literal notranslate"><span class="pre">qpdf_object_type_e</span></code>, defined in
<code class="docutils literal notranslate"><span class="pre">qpdf/Constants.h</span></code>. To fix your code, replace any includes of
<code class="docutils literal notranslate"><span class="pre">qpdf/QPDFObject.hh</span></code> with <code class="docutils literal notranslate"><span class="pre">qpdf/Constants.h</span></code>, and replace
all occurrences of <code class="docutils literal notranslate"><span class="pre">QPDFObject::ot_</span></code> with <code class="docutils literal notranslate"><span class="pre">::ot_</span></code>. If you
need your code to be backward compatible to qpdf versions prior
to 10.5.0, you can check that the preprocessor symbol
<code class="docutils literal notranslate"><span class="pre">QPDF_MAJOR_VERSION</span></code> is defined and <code class="docutils literal notranslate"><span class="pre">&gt;=</span> <span class="pre">11</span></code>. As a stop-gap,
you can <code class="docutils literal notranslate"><span class="pre">#define</span> <span class="pre">QPDF_OBJECT_NOWARN</span></code> to suppress the warning.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Pipeline::write</span></code> now takes <code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">const*</span></code> instead
of <code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char*</span></code>. Callers don’t need to change anything,
but you no longer have to pass writable pointers to pipelines.
If you’ve implemented your own pipeline classes, you will need
to update them.</p></li>
<li><p>Remove deprecated
<code class="docutils literal notranslate"><span class="pre">QPDFAcroFormDocumentHelper::copyFieldsFromForeignPage</span></code>. This
method never worked and only did something in qpdf version
10.2.x.</p></li>
<li><p>Remove deprecated <code class="docutils literal notranslate"><span class="pre">QPDFNameTreeObjectHelper</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFNumberTreeObjectHelper</span></code> constructors that don’t take a
<code class="docutils literal notranslate"><span class="pre">QPDF&amp;</span></code> argument.</p></li>
<li><p>The function passed to and called by <code class="docutils literal notranslate"><span class="pre">QPDFJob::doIfVerbose</span></code>
now takes a <code class="docutils literal notranslate"><span class="pre">Pipeline&amp;</span></code> argument instead of a
<code class="docutils literal notranslate"><span class="pre">std::ostream&amp;</span></code> argument.</p></li>
<li><p>Intentionally break API to call attention to operations that
write files with insecure encryption:</p>
<ul>
<li><p>Remove pre qpdf-8.4.0 encryption API methods from <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code>
and their corresponding C API functions</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">Insecure</span></code> to the names of some <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> methods
and <code class="docutils literal notranslate"><span class="pre">_insecure</span></code> to the names of some C API functions without
otherwise changing their behavior</p></li>
<li><p>See <a class="reference internal" href="weak-crypto.html#breaking-crypto-api"><span class="std std-ref">API-Breaking Changes in qpdf 11.0</span></a> for specific details, and see
<a class="reference internal" href="weak-crypto.html#weak-crypto"><span class="std std-ref">Weak Cryptography</span></a> for a general discussion.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::warnIfPossible</span></code> no longer takes an optional
argument to throw an exception if there is no description. If
there is no description, it writes to the default
<code class="docutils literal notranslate"><span class="pre">QPDFLogger</span></code>’s error stream. (<code class="docutils literal notranslate"><span class="pre">QPDFLogger</span></code> is new in qpdf
11—see below.)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDF</span></code> objects can no longer be copied or assigned to. It has
never been safe to do this because of assumptions made by
library code. Now it is prevented by the API. If you run into
trouble, use <code class="docutils literal notranslate"><span class="pre">QPDF::create()</span></code> to create <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> shared
pointers (or create them in some other way if you need backward
compatibility with older qpdf versions).</p></li>
</ul>
</li>
<li><p>CLI Enhancements</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">qpdf</span> <span class="pre">--list-attachments</span> <span class="pre">--verbose</span></code> includes some additional
information about attachments. Additional information about
attachments is also included in the <code class="docutils literal notranslate"><span class="pre">attachments</span></code> JSON key
with <code class="docutils literal notranslate"><span class="pre">--json</span></code>.</p></li>
<li><p>For encrypted files, <code class="docutils literal notranslate"><span class="pre">qpdf</span> <span class="pre">--json</span></code> reveals the user password
when the specified password did not match the user password and
the owner password was used to recover the user password. The
user password is not recoverable from the owner password when
256-bit keys are in use.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--verbose</span></code> and <code class="docutils literal notranslate"><span class="pre">--progress</span></code> may be now used when writing
the output PDF to standard output. In that case, the verbose and
progress messages are written to standard error.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>A new object <code class="docutils literal notranslate"><span class="pre">QPDFLogger</span></code> has been added. Details are in
<code class="file docutils literal notranslate"><span class="pre">include/qpdf/QPDFLogger.hh</span></code>.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDF</span></code> and <code class="docutils literal notranslate"><span class="pre">QPDFJob</span></code> both use the default logger by
default but can have their loggers overridden. The
<code class="docutils literal notranslate"><span class="pre">setOutputStreams</span></code> method is deprecated in both classes.</p></li>
<li><p>A few things from <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> that used to be
exceptions now write errors with the default logger.</p></li>
<li><p>By configuring the default logger, it is possible to capture
output and errors that slipped through the cracks with
<code class="docutils literal notranslate"><span class="pre">setOutputStreams</span></code>.</p></li>
<li><p>A C API is available in <code class="file docutils literal notranslate"><span class="pre">include/qpdf/qpdflogger-c.h</span></code>.</p></li>
<li><p>See examples <code class="file docutils literal notranslate"><span class="pre">examples/qpdfjob-save-attachment.cc</span></code> and
<code class="file docutils literal notranslate"><span class="pre">examples/qpdfjob-c-save-attachment.cc</span></code>.</p></li>
</ul>
</li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>, new methods <code class="docutils literal notranslate"><span class="pre">insertItemAndGetNew</span></code>,
<code class="docutils literal notranslate"><span class="pre">appendItemAndGetNew</span></code>, and <code class="docutils literal notranslate"><span class="pre">replaceKeyAndGetNew</span></code> return the
newly added item. New methods <code class="docutils literal notranslate"><span class="pre">eraseItemAndGetOld</span></code>,
<code class="docutils literal notranslate"><span class="pre">replaceKeyAndGetOld</span></code>, and <code class="docutils literal notranslate"><span class="pre">removeKeyAndGetOld</span></code> return the
item that was just removed or, in the case of
<code class="docutils literal notranslate"><span class="pre">replaceKeyAndGetOld</span></code>, a <code class="docutils literal notranslate"><span class="pre">null</span></code> object if the object was not
previously there.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::isDestroyed</span></code> method can be used to
detect when an indirect object <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> belongs to a
<code class="docutils literal notranslate"><span class="pre">QPDF</span></code> that has been destroyed. Any attempt to unparse this
type of <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> will throw a logic error.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getOwningQPDF</span></code> method now returns a
null pointer rather than an invalid pointer when the owning
<code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object has been destroyed. Indirect objects whose
owning <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> has been destroyed become invalid. Direct
objects just lose their owning <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> but continue to be
valid.</p></li>
<li><p>The method <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getQPDF</span></code> is an alternative to
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getOwningQPDF</span></code>. It returns a <code class="docutils literal notranslate"><span class="pre">QPDF&amp;</span></code>
rather than a <code class="docutils literal notranslate"><span class="pre">QPDF*</span></code> and can be used when the object is known
to have an owning <code class="docutils literal notranslate"><span class="pre">QPDF</span></code>. It throws an exception if the object
does not have an owning <code class="docutils literal notranslate"><span class="pre">QPDF</span></code>. Only indirect objects are
guaranteed to have an owning <code class="docutils literal notranslate"><span class="pre">QPDF</span></code>. Direct objects may have
one if they were initially read from a PDF input source that is
still valid, but it’s also possible to have direct objects that
don’t have an owning <code class="docutils literal notranslate"><span class="pre">QPDF</span></code>.</p></li>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::isSameObjectAs</span></code> for testing
whether two <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> objects point to the same
underlying object, meaning changes to one will be reflected in
the other. Note that this method does not compare the contents
of the objects, so two distinct but structurally identical
objects will not be considered the same object.</p></li>
<li><p>New factory method <code class="docutils literal notranslate"><span class="pre">QPDF::create()</span></code> returns a
<code class="docutils literal notranslate"><span class="pre">std::shared_ptr&lt;QPDF&gt;</span></code>.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> methods have been added to reduce the amount of
casting that is needed:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">write</span></code>: overloaded version that takes <code class="docutils literal notranslate"><span class="pre">char</span> <span class="pre">const*</span></code> in
addition to the one that takes <code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">char</span> <span class="pre">const*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">writeCstr</span></code>: writes a null-terminated C string</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">writeString</span></code>: writes a std::string</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">operator</span> <span class="pre">&lt;&lt;</span></code>: for null-terminated C strings, std::strings,
and integer types</p></li>
</ul>
</li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> type <code class="docutils literal notranslate"><span class="pre">Pl_OStream</span></code> writes to a
<code class="docutils literal notranslate"><span class="pre">std::ostream</span></code>.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> type <code class="docutils literal notranslate"><span class="pre">Pl_String</span></code> appends to a
<code class="docutils literal notranslate"><span class="pre">std::string</span></code>.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> type <code class="docutils literal notranslate"><span class="pre">Pl_Function</span></code> can be used to call an
arbitrary function on write. It supports <code class="docutils literal notranslate"><span class="pre">std::function</span></code> for
C++ code and can also accept C-style functions that indicate
success using a return value and take an extra parameter for
passing user data.</p></li>
<li><p>Methods have been added to <code class="docutils literal notranslate"><span class="pre">QUtil</span></code> for converting PDF
timestamps and <code class="docutils literal notranslate"><span class="pre">QPDFTime</span></code> objects to ISO-8601 timestamps.</p></li>
<li><p>Enhance JSON class to better support incrementally reading and
writing large amounts of data without having to keep everything
in memory.</p></li>
<li><p>Add new functions to the C API for <code class="docutils literal notranslate"><span class="pre">qpdfjob</span></code> that use a
<code class="docutils literal notranslate"><span class="pre">qpdfjob_handle</span></code>. Like with the regular C API for qpdf, you
have to call <code class="docutils literal notranslate"><span class="pre">qpdfjob_init</span></code> first, pass the handle to the
functions, and call <code class="docutils literal notranslate"><span class="pre">qpdfjob_cleanup</span></code> at the end. This
interface offers more flexibility than the old interface, which
remains available.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">QPDFJob::registerProgressReporter</span></code> and
<code class="docutils literal notranslate"><span class="pre">qpdfjob_register_progress_reporter</span></code> to allow a custom
progress reporter to be used with <code class="docutils literal notranslate"><span class="pre">QPDFJob</span></code>. The <code class="docutils literal notranslate"><span class="pre">QPDFJob</span></code>
object must be configured to report progress (via command-line
argument or otherwise) for this to be used.</p></li>
<li><p>Add new overloads to
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::StreamDataProvider::provideStreamData</span></code> that
take <code class="docutils literal notranslate"><span class="pre">QPDFObjGen</span> <span class="pre">const&amp;</span></code> instead of separate object ID and
generation parameters. The old versions will continue to be
supported and are not deprecated.</p></li>
<li><p>In <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper</span></code>, add a <code class="docutils literal notranslate"><span class="pre">copy_if_fallback</span></code>
parameter to most of the page bounding box methods, and clarify
in the comments about the difference between <code class="docutils literal notranslate"><span class="pre">copy_if_shared</span></code>
and <code class="docutils literal notranslate"><span class="pre">copy_if_fallback</span></code>.</p></li>
<li><p>Add a move constructor to the <code class="docutils literal notranslate"><span class="pre">Buffer</span></code> class.</p></li>
</ul>
</li>
<li><p>Other changes</p>
<ul>
<li><p>On GitHub, the release tags are now <cite>vX.Y.Z</cite> instead of
<cite>release-qpdf-X.Y.Z</cite> to be more consistent with current practice.</p></li>
<li><p>In JSON v1 mode, the <code class="docutils literal notranslate"><span class="pre">&quot;objects&quot;</span></code> key now reflects the repaired
pages tree if <code class="docutils literal notranslate"><span class="pre">&quot;pages&quot;</span></code> (or any other key that has the side
effect of repairing the page tree) is specified. To see the
original objects with any unrepaired page tree errors, specify
<code class="docutils literal notranslate"><span class="pre">&quot;objects&quot;</span></code> and/or <code class="docutils literal notranslate"><span class="pre">&quot;objectinfo&quot;</span></code> by themselves. This is
consistent with how JSON v2 behaves.</p></li>
<li><p>A new chapter on contributing to qpdf has been added to the
documentation. See <a class="reference internal" href="contributing.html#contributing"><span class="std std-ref">Contributing to qpdf</span></a>.</p></li>
<li><p>The qpdf source code is now formatted automatically with
<code class="docutils literal notranslate"><span class="pre">clang-format</span></code>. See <a class="reference internal" href="contributing.html#code-formatting"><span class="std std-ref">Code Formatting</span></a> for information.</p></li>
<li><p>Test coverage with <code class="docutils literal notranslate"><span class="pre">QTC</span></code> is enabled during development but
compiled out of distributed qpdf binaries by default. This
results in a significant performance improvement, especially on
Windows. <code class="docutils literal notranslate"><span class="pre">QTC::TC</span></code> is still available in the library and is
still usable by end user code even though calls to it made
internally by the library are turned off. Internally, there is
some additional caching to reduce the overhead of repeatedly
reading environment variables at runtime.</p></li>
<li><p>The test files used by the <code class="docutils literal notranslate"><span class="pre">performance_check</span></code> script at the
top of the repository are now available in the
<a class="reference external" href="https://github.com/qpdf/performance-test-files">qpdf/performance-test-files github repository</a>. In addition
to running time, memory usage is also included in performance
test results when available. The <code class="docutils literal notranslate"><span class="pre">performance_check</span></code> tool has
only been tested on Linux.</p></li>
<li><p>Lots of code cleanup and refactoring work was contributed in
multiple pull requests by M. Holger. This includes the work
required to enable detection of <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> objects
that belong to destroyed <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> objects.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.6.3: March 8, 2022</dt><dd><ul class="simple">
<li><p>Announcement of upcoming change:</p>
<ul>
<li><p>qpdf 11 will be built with cmake. The qpdf 11 documentation will
include detailed migration instructions.</p></li>
</ul>
</li>
<li><p>Bug fixes:</p>
<ul>
<li><p>Recognize strings explicitly encoded as UTF-8 as allowed by the
PDF 2.0 spec.</p></li>
<li><p>Fix edge cases with appearance stream generation for form fields
whose <code class="docutils literal notranslate"><span class="pre">/DA</span></code> field lacks proper font size specification or that
specifies auto sizing. At this time, qpdf does not support auto
sizing.</p></li>
<li><p>Minor, non-functional changes to build and documentation to
accommodate a wider range of compilation environments in
preparation for migration to cmake.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.6.2: February 16, 2022</dt><dd><ul class="simple">
<li><p>Bug fixes:</p>
<ul>
<li><p>Recognize strings encoded as UTF-16LE as Unicode. The PDF spec
only allows UTF-16BE, but most readers accept UTF16-LE as well.</p></li>
<li><p>Fix a regression in command-line argument parsing to restore a
previously undocumented behavior that some people were relying
on.</p></li>
<li><p>Fix one more problem with mapping Unicode to PDF doc encoding</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.6.1: February 11, 2022</dt><dd><ul class="simple">
<li><p>Fix compilation errors on some platforms</p></li>
</ul>
</dd>
<dt>10.6.0: February 9, 2022</dt><dd><ul>
<li><p>Preparation for replacement of <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code></p>
<p>The next major release of qpdf will replace <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> with
<code class="docutils literal notranslate"><span class="pre">std::shared_ptr</span></code> across all of qpdf’s public API. No action is
required at this time, but if you’d like to prepare, read the
comments in <code class="file docutils literal notranslate"><span class="pre">include/qpdf/PointerHolder.hh</span></code> and see
<a class="reference internal" href="design.html#smart-pointers"><span class="std std-ref">Smart Pointers</span></a> for details on what you can do now to create
code that will continue to work with older versions of qpdf and be
easier to switch over to qpdf 11 when it comes out.</p>
</li>
<li><p>Preparation for a new JSON output version</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="cli.html#option-json" title="option-json"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json</span></code></a> option takes an optional parameter
indicating the version of the JSON output. At present, there is
only one JSON version (<code class="docutils literal notranslate"><span class="pre">1</span></code>), but there are plans for an
updated version in a coming release. Until the release of qpdf
11, the default value of <code class="docutils literal notranslate"><span class="pre">--json</span></code> is <code class="docutils literal notranslate"><span class="pre">1</span></code> for compatibility.
Once qpdf 11 is out, the default version will be <code class="docutils literal notranslate"><span class="pre">latest</span></code>. If
you are depending on the exact format of <code class="docutils literal notranslate"><span class="pre">--json</span></code> for code,
you should start using <code class="docutils literal notranslate"><span class="pre">--json=1</span></code> in preparation.</p></li>
</ul>
</li>
<li><p>New QPDFJob API exposes CLI functionality</p>
<p>Prior to qpdf 10.6, a lot of the functionality implemented by the
qpdf CLI executable was built into the executable itself and not
available from the library. qpdf 10.6 introduces a new object,
<code class="docutils literal notranslate"><span class="pre">QPDFJob</span></code>, that exposes all of the command-line functionality.
This includes a native <code class="docutils literal notranslate"><span class="pre">QPDFJob</span></code> API with fluent interfaces that
mirror the command-line syntax, a JSON syntax for specifying the
equivalent of a command-line invocation, and the ability to run a
qpdf “job” by passing a null-terminated array of qpdf command-line
options. The command-line argument array and JSON methods of
invoking <code class="docutils literal notranslate"><span class="pre">QPDFJob</span></code> are also exposed to the C API. For details,
see <a class="reference internal" href="qpdf-job.html#qpdf-job"><span class="std std-ref">QPDFJob: a Job-Based Interface</span></a>.</p>
</li>
<li><p>Other Library Enhancements</p>
<ul>
<li><p>New <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> literal syntax using C++’s user-defined
literal syntax. You can use</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span><span class="w"> </span><span class="n">oh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&lt;&lt;/Some (valid) /PDF (object)&gt;&gt;&quot;</span><span class="n">_qpdf</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>to create a QPDFObjectHandle. It is a shorthand for
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::parse</span></code>.</p>
</li>
<li><p>Preprocessor symbols <code class="docutils literal notranslate"><span class="pre">QPDF_MAJOR_VERSION</span></code>,
<code class="docutils literal notranslate"><span class="pre">QPDF_MINOR_VERSION</span></code>, and <code class="docutils literal notranslate"><span class="pre">QPDF_PATCH_VERSION</span></code> are now
available and can be used to make it easier to write code that
supports multiple versions of qpdf. You don’t have to include
any new header files to get these, which makes it possible to
write code like this:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#if !defined(QPDF_MAJOR_VERSION) || QPDF_MAJOR_VERSION &lt; 11</span>
<span class="w">    </span><span class="c1">// do something using qpdf 10 or older API</span>
<span class="cp">#else</span>
<span class="w">    </span><span class="c1">// do something using qpdf 11 or newer API</span>
<span class="cp">#endif</span>
</pre></div>
</div>
<p>Since this was introduced only in qpdf version 10.6.0, testing
for an undefined value of <code class="docutils literal notranslate"><span class="pre">QPDF_MAJOR_VERSION</span></code> is equivalent
to detecting a version prior to 10.6.0.</p>
<p>The symbol <code class="docutils literal notranslate"><span class="pre">QPDF_VERSION</span></code> is also defined as a string
containing the same version number that is returned by
<code class="docutils literal notranslate"><span class="pre">QPDF::QPDFVersion</span></code>. Note that <code class="docutils literal notranslate"><span class="pre">QPDF_VERSION</span></code> may differ
from <code class="docutils literal notranslate"><span class="pre">QPDF::QPDFVersion()</span></code> if your header files and library
are out of sync with each other.</p>
</li>
<li><p>The method <code class="docutils literal notranslate"><span class="pre">QPDF::QPDFVersion</span></code> and corresponding C API call
<code class="docutils literal notranslate"><span class="pre">qpdf_get_qpdf_version</span></code> are now both guaranteed to return a
reference (or pointer) to a static string, so you don’t have to
copy these if you are using them in your software. They have
always returned static values. Now the fact that they return
static values is part of the API contract and can be safely
relied upon.</p></li>
<li><p>New accessor methods for <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>. In addition to
the traditional ones, such as <code class="docutils literal notranslate"><span class="pre">getIntValue</span></code>, <code class="docutils literal notranslate"><span class="pre">getName</span></code>,
etc., there are a family of new accessors whose names are of the
form <code class="docutils literal notranslate"><span class="pre">getValueAsX</span></code>. The difference in behavior is as follows:</p>
<ul class="simple">
<li><p>The older accessor methods, which will continue to be
supported, return the value of the object if it is the
expected type. Otherwise, they return a fallback value and
issue a warning.</p></li>
<li><p>The newer accessor methods return a boolean indicating whether
or not the object is of the expected type. If it is, a
reference to a variable of the correct type is initialized.</p></li>
</ul>
<p>In many cases, the new interfaces will enable more compact code
and will also never generate type warnings. Thanks to M. Holger
for contributing these accessors. Search for <code class="docutils literal notranslate"><span class="pre">getValueAs</span></code> in
<code class="file docutils literal notranslate"><span class="pre">include/qpdf/QPDFObjectHandle.hh</span></code> for a complete list.</p>
<p>These are also exposed in the C API in functions whose names
start with <code class="docutils literal notranslate"><span class="pre">qpdf_oh_get_value_as</span></code>.</p>
</li>
<li><p>New convenience methods in <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>:
<code class="docutils literal notranslate"><span class="pre">isDictionaryOfType</span></code>, <code class="docutils literal notranslate"><span class="pre">isStreamOfType</span></code>, and
<code class="docutils literal notranslate"><span class="pre">isNameAndEquals</span></code> allow more compact querying of dictionaries.
Also added to the C API: <code class="docutils literal notranslate"><span class="pre">qpdf_oh_is_dictionary_of_type</span></code> and
<code class="docutils literal notranslate"><span class="pre">qpdf_oh_is_name_and_equals</span></code>. Thanks to M. Holger for the
contribution.</p></li>
<li><p>New convenience method in <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>: <code class="docutils literal notranslate"><span class="pre">getKeyIfDict</span></code>
returns null when called on null and otherwise calls <code class="docutils literal notranslate"><span class="pre">getKey</span></code>.
This makes it easier to access optional, lower-level
dictionaries. It is exposed in the C API
<code class="docutils literal notranslate"><span class="pre">qpdf_oh_get_key_if_dict</span></code>. Thanks to M. Holger for the
contribution.</p></li>
<li><p>New functions added to <code class="docutils literal notranslate"><span class="pre">QUtil</span></code>: <code class="docutils literal notranslate"><span class="pre">make_shared_cstr</span></code> and
<code class="docutils literal notranslate"><span class="pre">make_unique_cstr</span></code> copy <code class="docutils literal notranslate"><span class="pre">std::string</span></code> to
<code class="docutils literal notranslate"><span class="pre">std::shared_ptr&lt;char&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">std::unique_ptr&lt;char[]&gt;</span></code>. These
are alternatives to the existing <code class="docutils literal notranslate"><span class="pre">QUtil::copy_string</span></code> function
which offer other ways to get a C string with safer memory
management.</p></li>
<li><p>New function <code class="docutils literal notranslate"><span class="pre">QUtil::file_can_be_opened</span></code> tests to see whether
a file can actually be opened by attempting to open it and close
it again.</p></li>
<li><p>There is a new version of <code class="docutils literal notranslate"><span class="pre">QUtil::call_main_from_wmain</span></code> that
takes a <code class="docutils literal notranslate"><span class="pre">const</span></code> argv array and calls a main that takes a
<code class="docutils literal notranslate"><span class="pre">const</span></code> argv array.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDF::emptyPDF</span></code> has been exposed to the C API as
<code class="docutils literal notranslate"><span class="pre">qpdf_empty_pdf</span></code>. This makes it possible to create a PDF from
scratch with the C API.</p></li>
<li><p>New C API functions <code class="docutils literal notranslate"><span class="pre">qpdf_oh_get_binary_utf8_value</span></code> and
<code class="docutils literal notranslate"><span class="pre">qpdf_oh_new_binary_unicode_string</span></code> take length parameters,
which makes it possible to handle UTF-8-encoded C strings with
embedded NUL characters. Thanks to M. Holger for the
contribution.</p></li>
<li><p>There is a new <code class="docutils literal notranslate"><span class="pre">PDFVersion</span></code> class for representing a PDF
version number with the ability to compare and order PDF
versions. Methods <code class="docutils literal notranslate"><span class="pre">QPDF::getVersionAsPDFVersion</span></code> and a new
version of <code class="docutils literal notranslate"><span class="pre">QPDFWriter::setMinimumPDFVersion</span></code> use it. This
makes it easier to create an output file whose PDF version is
the maximum of the versions across all the input files that
contributed to it.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">JSON</span></code> object in the qpdf library has been enhanced to
include a parser and the ability to get values out of the
<code class="docutils literal notranslate"><span class="pre">JSON</span></code> object. Previously it was a write-only interface. Even
so, qpdf’s <code class="docutils literal notranslate"><span class="pre">JSON</span></code> object is not intended to be a
general-purpose JSON implementation as discussed in
<code class="file docutils literal notranslate"><span class="pre">include/qpdf/JSON.hh</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">JSON</span></code> object’s “schema” checking functionality now allows
for optional keys. Note that this “schema” functionality doesn’t
conform to any type of standard. It’s just there to help with
error reporting with qpdf’s own JSON support.</p></li>
</ul>
</li>
<li><p>Documentation Enhancements</p>
<ul class="simple">
<li><p>Documentation for the command-line tool has been completely
rewritten. This includes a top-to-bottom rewrite of <a class="reference internal" href="cli.html#using"><span class="std std-ref">Running qpdf</span></a>
in the manual. Command-line arguments are now indexed, and
internal links can appear to them within the documentation.</p></li>
<li><p>The output of <code class="docutils literal notranslate"><span class="pre">qpdf</span> <span class="pre">--help</span></code> is generated from the manual and
is divided into help topics that parallel the sections of the
manual. When you run <code class="docutils literal notranslate"><span class="pre">qpdf</span> <span class="pre">--help</span></code>, instead of getting a Great
Wall of Text, you are given basic usage information and a list
of help topics. It is possible to request help for any
individual topic or any specific command-line option, or you can
get a dump of all available help text. The manual continues to
contain a greater level of detail and more examples.</p></li>
</ul>
</li>
<li><p>Bug Fixes</p>
<ul class="simple">
<li><p>Some characters were not correctly translated from PDF doc
encoding to Unicode.</p></li>
<li><p>When splitting or combining pages, ensure that all output files
have a PDF version greater than or equal to the maximum version
of all the input files.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.5.0: December 21, 2021</dt><dd><ul class="simple">
<li><p>Packaging changes</p>
<ul>
<li><p>Pre-built documentation is no longer distributed with the source
distribution. The AppImage and Windows binary distributions
still contain embedded documentation, and a separate <code class="docutils literal notranslate"><span class="pre">doc</span></code>
distribution file is available from the qpdf release site.
Documentation is now available at <a class="reference external" href="https://qpdf.readthedocs.io">https://qpdf.readthedocs.io</a> for every major/minor version
starting with version 10.5. Please see <a class="reference internal" href="packaging.html#packaging-doc"><span class="std std-ref">Packaging Documentation</span></a> for
details on how packagers should handle documentation.</p></li>
<li><p>The documentation sources have been switched from docbook to
reStructuredText processed with <a class="reference external" href="https://www.sphinx-doc.org">Sphinx</a>. This will break previous
documentation links. A redirect is in place on the main website.
A top-to-bottom review of the documentation is planned for an
upcoming release.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>Since qpdf version 8, using object accessor methods on an
instance of <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> may create warnings if the
object is not of the expected type. These warnings now have an
error code of <code class="docutils literal notranslate"><span class="pre">qpdf_e_object</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">qpdf_e_damaged_pdf</span></code>. Also, comments have been added to
<code class="file docutils literal notranslate"><span class="pre">QPDFObjectHandle.hh</span></code> to explain in more detail what the
behavior is. See <a class="reference internal" href="design.html#object-accessors"><span class="std std-ref">Object Accessor Methods</span></a> for a more in-depth
discussion.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">Pl_Buffer::getMallocBuffer()</span></code> to initialize a buffer
allocated with <code class="docutils literal notranslate"><span class="pre">malloc()</span></code> for better cross-language
interoperability.</p></li>
</ul>
</li>
<li><p>C API Enhancements</p>
<ul>
<li><p>Many thanks to M. Holger whose contributions have heavily
influenced these C API enhancements. His several suggestions,
pull requests, questions, and critical reading of documentation
and comments have resulted in significant usability improvements
to the C API.</p></li>
<li><p>Overhaul error handling for the object handle functions C API.
Some rare error conditions that would previously have caused a
crash are now trapped and reported, and the functions that
generate them return fallback values. See comments in the
<code class="docutils literal notranslate"><span class="pre">ERROR</span> <span class="pre">HANDLING</span></code> section of <code class="file docutils literal notranslate"><span class="pre">include/qpdf/qpdf-c.h</span></code> for
details. In particular, exceptions thrown by the underlying C++
code when calling object accessors are caught and converted into
errors. The errors can be checked by calling <code class="docutils literal notranslate"><span class="pre">qpdf_has_error</span></code>.
Use <code class="docutils literal notranslate"><span class="pre">qpdf_silence_errors</span></code> to prevent the error from being
written to stderr.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">qpdf_get_last_string_length</span></code> to the C API to get the
length of the last string that was returned. This is needed to
handle strings that contain embedded null characters.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">qpdf_oh_is_initialized</span></code> and
<code class="docutils literal notranslate"><span class="pre">qpdf_oh_new_uninitialized</span></code> to the C API to make it possible
to work with uninitialized objects.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">qpdf_oh_new_object</span></code> to the C API. This allows you to
clone an object handle.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">qpdf_get_object_by_id</span></code>, <code class="docutils literal notranslate"><span class="pre">qpdf_make_indirect_object</span></code>,
and <code class="docutils literal notranslate"><span class="pre">qpdf_replace_object</span></code>, exposing the corresponding methods
in <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> and <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>.</p></li>
<li><p>Add several functions for working with pages. See <code class="docutils literal notranslate"><span class="pre">PAGE</span>
<span class="pre">FUNCTIONS</span></code> in <code class="docutils literal notranslate"><span class="pre">include/qpdf/qpdf-c.h</span></code> for details.</p></li>
<li><p>Add several functions for working with streams. See <code class="docutils literal notranslate"><span class="pre">STREAM</span>
<span class="pre">FUNCTIONS</span></code> in <code class="docutils literal notranslate"><span class="pre">include/qpdf/qpdf-c.h</span></code> for details.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">qpdf_oh_get_type_code</span></code> and <code class="docutils literal notranslate"><span class="pre">qpdf_oh_get_type_name</span></code>.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">qpdf_oh_get_binary_string_value</span></code> and
<code class="docutils literal notranslate"><span class="pre">qpdf_oh_new_binary_string</span></code> for making it easier to deal with
strings that contain embedded null characters.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.4.0: November 16, 2021</dt><dd><ul class="simple">
<li><p>Handling of Weak Cryptography Algorithms</p>
<ul>
<li><p>From the qpdf CLI, the
<a class="reference internal" href="cli.html#option-allow-weak-crypto" title="option-allow-weak-crypto"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--allow-weak-crypto</span></code></a> is now required to
suppress a warning when explicitly creating PDF files using RC4
encryption. While qpdf will always retain the ability to read
and write such files, doing so will require explicit
acknowledgment moving forward. For qpdf 10.4, this change only
affects the command-line tool. Starting in qpdf 11, there will
be small API changes to require explicit acknowledgment in
those cases as well. For additional information, see <a class="reference internal" href="weak-crypto.html#weak-crypto"><span class="std std-ref">Weak Cryptography</span></a>.</p></li>
</ul>
</li>
<li><p>Bug Fixes</p>
<ul>
<li><p>Fix potential bounds error when handling shell completion that
could occur when given bogus input.</p></li>
<li><p>Properly handle overlay/underlay on completely empty pages
(with no resource dictionary).</p></li>
<li><p>Fix crash that could occur under certain conditions when using
<a class="reference internal" href="cli.html#option-pages" title="option-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--pages</span></code></a> with files that had form
fields.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>Make <code class="docutils literal notranslate"><span class="pre">QPDF::findPage</span></code> functions public.</p></li>
<li><p>Add methods to <code class="docutils literal notranslate"><span class="pre">Pl_Flate</span></code> to be able to receive warnings on
certain recoverable conditions.</p></li>
<li><p>Add an extra check to the library to detect when foreign
objects are inserted directly (instead of using
<code class="docutils literal notranslate"><span class="pre">QPDF::copyForeignObject</span></code>) at the time of insertion rather
than when the file is written. Catching the error sooner makes
it much easier to locate the incorrect code.</p></li>
</ul>
</li>
<li><p>CLI Enhancements</p>
<ul>
<li><p>Improve diagnostics around parsing
<a class="reference internal" href="cli.html#option-pages" title="option-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--pages</span></code></a> command-line options</p></li>
</ul>
</li>
<li><p>Packaging Changes</p>
<ul>
<li><p>The Windows binary distribution is now built with crypto
provided by OpenSSL 3.0.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.3.2: May 8, 2021</dt><dd><ul class="simple">
<li><p>Bug Fixes</p>
<ul>
<li><p>When generating a file while preserving object streams,
unreferenced objects are correctly removed unless
<a class="reference internal" href="cli.html#option-preserve-unreferenced" title="option-preserve-unreferenced"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--preserve-unreferenced</span></code></a> is specified.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>When adding a page that already exists, make a shallow copy
instead of throwing an exception. This makes the library
behavior consistent with the CLI behavior. See
<code class="file docutils literal notranslate"><span class="pre">ChangeLog</span></code> for additional notes.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.3.1: March 11, 2021</dt><dd><ul class="simple">
<li><p>Bug Fixes</p>
<ul>
<li><p>Form field copying failed on files where /DR was a direct
object in the document-level form dictionary.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.3.0: March 4, 2021</dt><dd><ul class="simple">
<li><p>Bug Fixes</p>
<ul>
<li><p>The code for handling form fields when copying pages from
10.2.0 was not quite right and didn’t work in a number of
situations, such as when the same page was copied multiple
times or when there were conflicting resource or field names
across multiple copies. The 10.3.0 code has been much more
thoroughly tested with more complex cases and with a multitude
of readers and should be much closer to correct. The 10.2.0
code worked well enough for page splitting or for copying pages
with form fields into documents that didn’t already have them
but was still not quite correct in handling of field-level
resources.</p></li>
<li><p>When <code class="docutils literal notranslate"><span class="pre">QPDF::replaceObject</span></code> or <code class="docutils literal notranslate"><span class="pre">QPDF::swapObjects</span></code> is
called, existing <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> instances no longer point
to the old objects. The next time they are accessed, they
automatically notice the change to the underlying object and
update themselves. This resolves a very longstanding source of
confusion, albeit in a very rarely used method call.</p></li>
<li><p>Fix form field handling code to look for default appearances,
quadding, and default resources in the right places. The code
was not looking for things in the document-level interactive
form dictionary that it was supposed to be finding there. This
required adding a few new methods to
<code class="docutils literal notranslate"><span class="pre">QPDFFormFieldObjectHelper</span></code>.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>Reworked the code that handles copying annotations and form
fields during page operations. There were additional methods
added to the public API from 10.2.0 and a one deprecation of a
method added in 10.2.0. The majority of the API changes are in
methods most people would never call and that will hopefully be
superseded by higher-level interfaces for handling page copies.
Please see the <code class="file docutils literal notranslate"><span class="pre">ChangeLog</span></code> file for
details.</p></li>
<li><p>The method <code class="docutils literal notranslate"><span class="pre">QPDF::numWarnings</span></code> was added so that you can tell
whether any warnings happened during a specific block of code.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.2.0: February 23, 2021</dt><dd><ul class="simple">
<li><p>CLI Behavior Changes</p>
<ul>
<li><p>Operations that work on combining pages are much better about
protecting form fields. In particular,
<a class="reference internal" href="cli.html#option-split-pages" title="option-split-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--split-pages</span></code></a> and
<a class="reference internal" href="cli.html#option-pages" title="option-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--pages</span></code></a> now preserve interaction form
functionality by copying the relevant form field information
from the original files. Additionally, if you use
<a class="reference internal" href="cli.html#option-pages" title="option-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--pages</span></code></a> to select only some pages from
the original input file, unused form fields are removed, which
prevents lots of unused annotations from being retained.</p></li>
<li><p>By default, <strong class="command">qpdf</strong> no longer allows
creation of encrypted PDF files whose user password is
non-empty and owner password is empty when a 256-bit key is in
use. The <a class="reference internal" href="cli.html#option-allow-insecure" title="option-allow-insecure"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--allow-insecure</span></code></a> option,
specified inside the <a class="reference internal" href="cli.html#option-encrypt" title="option-encrypt"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--encrypt</span></code></a> options,
allows creation of such files. Behavior changes in the CLI are
avoided when possible, but an exception was made here because
this is security-related. qpdf must always allow creation of
weird files for testing purposes, but it should not default to
letting users unknowingly create insecure files.</p></li>
</ul>
</li>
<li><p>Library Behavior Changes</p>
<ul>
<li><p>Note: the changes in this section cause differences in output
in some cases. These differences change the syntax of the PDF
but do not change the semantics (meaning). I make a strong
effort to avoid gratuitous changes in qpdf’s output so that
qpdf changes don’t break people’s tests. In this case, the
changes significantly improve the readability of the generated
PDF and don’t affect any output that’s generated by simple
transformation. If you are annoyed by having to update test
files, please rest assured that changes like this have been and
will continue to be rare events.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::newUnicodeString</span></code> now uses whichever of
ASCII, PDFDocEncoding, of UTF-16 is sufficient to encode all
the characters in the string. This reduces needless encoding in
UTF-16 of strings that can be encoded in ASCII. This change may
cause qpdf to generate different output than before when form
field values are set using <code class="docutils literal notranslate"><span class="pre">QPDFFormFieldObjectHelper</span></code> but
does not change the meaning of the output.</p></li>
<li><p>The code that places form XObjects and also the code that
flattens rotations trim trailing zeroes from real numbers that
they calculate. This causes slight (but semantically
equivalent) differences in generated appearance streams and
form XObject invocations in overlay/underlay code or in user
code that calls the methods that place form XObjects on a page.</p></li>
</ul>
</li>
<li><p>CLI Enhancements</p>
<ul>
<li><p>Add new command line options for listing, saving, adding,
removing, and and copying file attachments. See <a class="reference internal" href="cli.html#attachments"><span class="std std-ref">Embedded Files/Attachments</span></a> for details.</p></li>
<li><p>Page splitting and merging operations, as well as
<a class="reference internal" href="cli.html#option-flatten-rotation" title="option-flatten-rotation"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--flatten-rotation</span></code></a>, are better behaved
with respect to annotations and interactive form fields. In
most cases, interactive form field functionality and proper
formatting and functionality of annotations is preserved by
these operations. There are still some cases that aren’t
perfect, such as when functionality of annotations depends on
document-level data that qpdf doesn’t yet understand or when
there are problems with referential integrity among form fields
and annotations (e.g., when a single form field object or its
associated annotations are shared across multiple pages, a case
that is out of spec but that works in most viewers anyway).</p></li>
<li><p>The option
<code class="samp docutils literal notranslate"><span class="pre">--password-file=</span><em><span class="pre">filename</span></em></code>
can now be used to read the decryption password from a file.
You can use <code class="docutils literal notranslate"><span class="pre">-</span></code> as the file name to read the password from
standard input. This is an easier/more obvious way to read
passwords from files or standard input than using
<code class="samp docutils literal notranslate"><span class="pre">&#64;file</span></code> for this purpose.</p></li>
<li><p>Add some information about attachments to the JSON output, and
added <code class="docutils literal notranslate"><span class="pre">attachments</span></code> as an additional JSON key. The
information included here is limited to the preferred name and
content stream and a reference to the file spec object. This is
enough detail for clients to avoid the hassle of navigating a
name tree and provides what is needed for basic enumeration and
extraction of attachments. More detailed information can be
obtained by following the reference to the file spec object.</p></li>
<li><p>Add numeric option to <a class="reference internal" href="cli.html#option-collate" title="option-collate"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--collate</span></code></a>. If
<code class="samp docutils literal notranslate"><span class="pre">--collate=</span><em><span class="pre">n</span></em></code>
is given, take pages in groups of
<code class="samp docutils literal notranslate"><em><span class="pre">n</span></em></code> from the given files.</p></li>
<li><p>It is now valid to provide <code class="samp docutils literal notranslate"><span class="pre">--rotate=0</span></code>
to clear rotation from a page.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>This release includes numerous additions to the API. Not all
changes are listed here. Please see the
<code class="file docutils literal notranslate"><span class="pre">ChangeLog</span></code> file in the source
distribution for a comprehensive list. Highlights appear below.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::ditems()</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::aitems()</span></code> that enable C++-style iteration,
including range-for iteration, over dictionary and array
QPDFObjectHandles. See comments in
<code class="file docutils literal notranslate"><span class="pre">include/qpdf/QPDFObjectHandle.hh</span></code>
and
<code class="file docutils literal notranslate"><span class="pre">examples/pdf-name-number-tree.cc</span></code>
for details.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::copyStream</span></code> for making a copy of a
stream within the same <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> instance.</p></li>
<li><p>Add new helper classes for supporting file attachments, also
known as embedded files. New classes are
<code class="docutils literal notranslate"><span class="pre">QPDFEmbeddedFileDocumentHelper</span></code>,
<code class="docutils literal notranslate"><span class="pre">QPDFFileSpecObjectHelper</span></code>, and <code class="docutils literal notranslate"><span class="pre">QPDFEFStreamObjectHelper</span></code>.
See their respective headers for details and
<code class="file docutils literal notranslate"><span class="pre">examples/pdf-attach-file.cc</span></code> for an
example.</p></li>
<li><p>Add a version of <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::parse</span></code> that takes a
<code class="docutils literal notranslate"><span class="pre">QPDF</span></code> pointer as context so that it can parse strings
containing indirect object references. This is illustrated in
<code class="file docutils literal notranslate"><span class="pre">examples/pdf-attach-file.cc</span></code>.</p></li>
<li><p>Re-implement <code class="docutils literal notranslate"><span class="pre">QPDFNameTreeObjectHelper</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFNumberTreeObjectHelper</span></code> to be more efficient, add an
iterator-based API, give them the capability to repair broken
trees, and create methods for modifying the trees. With this
change, qpdf has a robust read/write implementation of name and
number trees.</p></li>
<li><p>Add new versions of <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::replaceStreamData</span></code>
that take <code class="docutils literal notranslate"><span class="pre">std::function</span></code> objects for cases when you need
something between a static string and a full-fledged
StreamDataProvider. Using this with <code class="docutils literal notranslate"><span class="pre">QUtil::file_provider</span></code> is
a very easy way to create a stream from the contents of a file.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">QPDFMatrix</span></code> class, formerly a private, internal class,
has been added to the public API. See
<code class="file docutils literal notranslate"><span class="pre">include/qpdf/QPDFMatrix.hh</span></code> for
details. This class is for working with transformation
matrices. Some methods in <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper</span></code> make use of
this to make information about transformation matrices
available. For an example, see
<code class="file docutils literal notranslate"><span class="pre">examples/pdf-overlay-page.cc</span></code>.</p></li>
<li><p>Several new methods were added to
<code class="docutils literal notranslate"><span class="pre">QPDFAcroFormDocumentHelper</span></code> for adding, removing, getting
information about, and enumerating form fields.</p></li>
<li><p>Add method
<code class="docutils literal notranslate"><span class="pre">QPDFAcroFormDocumentHelper::transformAnnotations</span></code>, which
applies a transformation to each annotation on a page.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper::copyAnnotations</span></code>, which copies
annotations and, if applicable, associated form fields, from
one page to another, possibly transforming the rectangles.</p></li>
</ul>
</li>
<li><p>Build Changes</p>
<ul>
<li><p>A C++-14 compiler is now required to build qpdf. There is no
intention to require anything newer than that for a while.
C++-14 includes modest enhancements to C++-11 and appears to be
supported about as widely as C++-11.</p></li>
</ul>
</li>
<li><p>Bug Fixes</p>
<ul>
<li><p>The <a class="reference internal" href="cli.html#option-flatten-rotation" title="option-flatten-rotation"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--flatten-rotation</span></code></a> option applies
transformations to any annotations that may be on the page.</p></li>
<li><p>If a form XObject lacks a resources dictionary, consider any
names in that form XObject to be referenced from the containing
page. This is compliant with older PDF versions. Also detect if
any form XObjects have any unresolved names and, if so, don’t
remove unreferenced resources from them or from the page that
contains them. Unfortunately this has the side effect of
preventing removal of unreferenced resources in some cases
where names appear that don’t refer to resources, such as with
tagged PDF. This is a bit of a corner case that is not likely
to cause a significant problem in practice, but the only side
effect would be lack of removal of shared resources. A future
version of qpdf may be more sophisticated in its detection of
names that refer to resources.</p></li>
<li><p>Properly handle strings if they appear in inline image
dictionaries while externalizing inline images.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.1.0: January 5, 2021</dt><dd><ul class="simple">
<li><p>CLI Enhancements</p>
<ul>
<li><p>Add <a class="reference internal" href="cli.html#option-flatten-rotation" title="option-flatten-rotation"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--flatten-rotation</span></code></a> command-line
option, which causes all pages that are rotated using
parameters in the page’s dictionary to instead be identically
rotated in the page’s contents. The change is not user-visible
for compliant PDF readers but can be used to work around broken
PDF applications that don’t properly handle page rotation.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>Support for user-provided (pluggable, modular) stream filters.
It is now possible to derive a class from <code class="docutils literal notranslate"><span class="pre">QPDFStreamFilter</span></code>
and register it with <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> so that regular library methods,
including those used by <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code>, can decode streams with
filters not directly supported by the library. The example
<code class="file docutils literal notranslate"><span class="pre">examples/pdf-custom-filter.cc</span></code>
illustrates how to use this capability.</p></li>
<li><p>Add methods to <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper</span></code> to iterate through
XObjects on a page or form XObjects, possibly recursing into
nested form XObjects: <code class="docutils literal notranslate"><span class="pre">forEachXObject</span></code>, <code class="docutils literal notranslate"><span class="pre">ForEachImage</span></code>,
<code class="docutils literal notranslate"><span class="pre">forEachFormXObject</span></code>.</p></li>
<li><p>Enhance several methods in <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper</span></code> to work
with form XObjects as well as pages, as noted in comments. See
<code class="file docutils literal notranslate"><span class="pre">ChangeLog</span></code> for a full list.</p></li>
<li><p>Rename some functions in <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper</span></code>, while
keeping old names for compatibility:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">getPageImages</span></code> to <code class="docutils literal notranslate"><span class="pre">getImages</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">filterPageContents</span></code> to <code class="docutils literal notranslate"><span class="pre">filterContents</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pipePageContents</span></code> to <code class="docutils literal notranslate"><span class="pre">pipeContents</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">parsePageContents</span></code> to <code class="docutils literal notranslate"><span class="pre">parseContents</span></code></p></li>
</ul>
</li>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper::getFormXObjects</span></code> to return
a map of form XObjects directly on a page or form XObject</p></li>
<li><p>Add new helper methods to <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>:
<code class="docutils literal notranslate"><span class="pre">isFormXObject</span></code>, <code class="docutils literal notranslate"><span class="pre">isImage</span></code></p></li>
<li><p>Add the optional <code class="docutils literal notranslate"><span class="pre">allow_streams</span></code> parameter
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::makeDirect</span></code>. When
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::makeDirect</span></code> is called in this way, it
preserves references to streams rather than throwing an
exception.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::setFilterOnWrite</span></code> method. Calling this
on a stream prevents <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> from attempting to
uncompress, recompress, or otherwise filter a stream even if it
could. Developers can use this to protect streams that are
optimized should be protected from <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code>’s default
behavior for any other reason.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">ostream</span></code> <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> operator for <code class="docutils literal notranslate"><span class="pre">QPDFObjGen</span></code>. This is
useful to have for debugging.</p></li>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper::flattenRotation</span></code>, which
replaces a page’s <code class="docutils literal notranslate"><span class="pre">/Rotate</span></code> keyword by rotating the page
within the content stream and altering the page’s bounding
boxes so the rendering is the same. This can be used to work
around buggy PDF readers that can’t properly handle page
rotation.</p></li>
</ul>
</li>
<li><p>C API Enhancements</p>
<ul>
<li><p>Add several new functions to the C API for working with
objects. These are wrappers around many of the methods in
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>. Their inclusion adds considerable new
capability to the C API.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">qpdf_register_progress_reporter</span></code> to the C API,
corresponding to <code class="docutils literal notranslate"><span class="pre">QPDFWriter::registerProgressReporter</span></code>.</p></li>
</ul>
</li>
<li><p>Performance Enhancements</p>
<ul>
<li><p>Improve steps <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> takes to prepare a <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object
for writing, resulting in about an 8% improvement in write
performance while allowing indirect objects to appear in
<code class="docutils literal notranslate"><span class="pre">/DecodeParms</span></code>.</p></li>
<li><p>When extracting pages, the <strong class="command">qpdf</strong> CLI
only removes unreferenced resources from the pages that are
being kept, resulting in a significant performance improvement
when extracting small numbers of pages from large, complex
documents.</p></li>
</ul>
</li>
<li><p>Bug Fixes</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper::externalizeInlineImages</span></code> was not
externalizing images referenced from form XObjects that
appeared on the page.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::filterPageContents</span></code> was broken for pages
with multiple content streams.</p></li>
<li><p>Tweak zsh completion code to behave a little better with
respect to path completion.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.0.4: November 21, 2020</dt><dd><ul class="simple">
<li><p>Bug Fixes</p>
<ul>
<li><p>Fix a handful of integer overflows. This includes cases found
by fuzzing as well as having qpdf not do range checking on
unused values in the xref stream.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.0.3: October 31, 2020</dt><dd><ul class="simple">
<li><p>Bug Fixes</p>
<ul>
<li><p>The fix to the bug involving copying streams with indirect
filters was incorrect and introduced a new, more serious bug.
The original bug has been fixed correctly, as has the bug
introduced in 10.0.2.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.0.2: October 27, 2020</dt><dd><ul class="simple">
<li><p>Bug Fixes</p>
<ul>
<li><p>When concatenating content streams, as with
<a class="reference internal" href="cli.html#option-coalesce-contents" title="option-coalesce-contents"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--coalesce-contents</span></code></a>, there were cases
in which qpdf would merge two lexical tokens together, creating
invalid results. A newline is now inserted between merged
content streams if one is not already present.</p></li>
<li><p>Fix an internal error that could occur when copying foreign
streams whose stream data had been replaced using a stream data
provider if those streams had indirect filters or decode
parameters. This is a rare corner case.</p></li>
<li><p>Ensure that the caller’s locale settings do not change the
results of numeric conversions performed internally by the qpdf
library. Note that the problem here could only be caused when
the qpdf library was used programmatically. Using the qpdf CLI
already ignored the user’s locale for numeric conversion.</p></li>
<li><p>Fix several instances in which warnings were not suppressed in
spite of <a class="reference internal" href="cli.html#option-no-warn" title="option-no-warn"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--no-warn</span></code></a> and/or errors or
warnings were written to standard output rather than standard
error.</p></li>
<li><p>Fixed a memory leak that could occur under specific
circumstances when
<code class="samp docutils literal notranslate"><span class="pre">--object-streams=generate</span></code> was used.</p></li>
<li><p>Fix various integer overflows and similar conditions found by
the OSS-Fuzz project.</p></li>
</ul>
</li>
<li><p>Enhancements</p>
<ul>
<li><p>New option <a class="reference internal" href="cli.html#option-warning-exit-0" title="option-warning-exit-0"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--warning-exit-0</span></code></a> causes qpdf
to exit with a status of <code class="docutils literal notranslate"><span class="pre">0</span></code> rather than <code class="docutils literal notranslate"><span class="pre">3</span></code> if there are
warnings but no errors. Combine with
<a class="reference internal" href="cli.html#option-no-warn" title="option-no-warn"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--no-warn</span></code></a> to completely ignore
warnings.</p></li>
<li><p>Performance improvements have been made to
<code class="docutils literal notranslate"><span class="pre">QPDF::processMemoryFile</span></code>.</p></li>
<li><p>The OpenSSL crypto provider produces more detailed error
messages.</p></li>
</ul>
</li>
<li><p>Build Changes</p>
<ul>
<li><p>The option <code class="samp docutils literal notranslate"><span class="pre">--disable-rpath</span></code> is now
supported by qpdf’s <strong class="command">./configure</strong>
script. Some distributions’ packaging standards recommended the
use of this option.</p></li>
<li><p>Selection of a printf format string for <code class="docutils literal notranslate"><span class="pre">long</span> <span class="pre">long</span></code> has
been moved from <code class="docutils literal notranslate"><span class="pre">ifdefs</span></code> to an autoconf
test. If you are using your own build system, you will need to
provide a value for <code class="docutils literal notranslate"><span class="pre">LL_FMT</span></code> in
<code class="file docutils literal notranslate"><span class="pre">libqpdf/qpdf/qpdf-config.h</span></code>, which
would typically be <code class="docutils literal notranslate"><span class="pre">&quot;%lld&quot;</span></code> or, for some Windows compilers,
<code class="docutils literal notranslate"><span class="pre">&quot;%I64d&quot;</span></code>.</p></li>
<li><p>Several improvements were made to build-time configuration of
the OpenSSL crypto provider.</p></li>
<li><p>A nearly stand-alone Linux binary zip file is now included with
the qpdf release. This is built on an older (but supported)
Ubuntu LTS release, but would work on most reasonably recent
Linux distributions. It contains only the executables and
required shared libraries that would not be present on a
minimal system. It can be used for including qpdf in a minimal
environment, such as a docker container. The zip file is also
known to work as a layer in AWS Lambda.</p></li>
<li><p>QPDF’s automated build has been migrated from Azure Pipelines
to GitHub Actions.</p></li>
</ul>
</li>
<li><p>Windows-specific Changes</p>
<ul>
<li><p>The Windows executables distributed with qpdf releases now use
the OpenSSL crypto provider by default. The native crypto
provider is also compiled in and can be selected at runtime
with the <code class="docutils literal notranslate"><span class="pre">QPDF_CRYPTO_PROVIDER</span></code> environment variable.</p></li>
<li><p>Improvements have been made to how a cryptographic provider is
obtained in the native Windows crypto implementation. However
mostly this is shadowed by OpenSSL being used by default.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.0.1: April 9, 2020</dt><dd><ul class="simple">
<li><p>Bug Fixes</p>
<ul>
<li><p>10.0.0 introduced a bug in which calling
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getStreamData</span></code> on a stream that can’t be
filtered was returning the raw data instead of throwing an
exception. This is now fixed.</p></li>
<li><p>Fix a bug that was preventing qpdf from linking with some
versions of clang on some platforms.</p></li>
</ul>
</li>
<li><p>Enhancements</p>
<ul>
<li><p>Improve the <code class="file docutils literal notranslate"><span class="pre">pdf-invert-images</span></code>
example to avoid having to load all the images into RAM at the
same time.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>10.0.0: April 6, 2020</dt><dd><ul class="simple">
<li><p>Performance Enhancements</p>
<ul>
<li><p>The qpdf library and executable should run much faster in this
version than in the last several releases. Several internal
library optimizations have been made, and there has been
improved behavior on page splitting as well. This version of
qpdf should outperform any of the 8.x or 9.x versions.</p></li>
</ul>
</li>
<li><p>Incompatible API (source-level) Changes (minor)</p>
<ul>
<li><p>The <code class="docutils literal notranslate"><span class="pre">QUtil::srandom</span></code> method was removed. It didn’t do
anything unless insecure random numbers were compiled in, and
they have been off by default for a long time. If you were
calling it, just remove the call since it wasn’t doing anything
anyway.</p></li>
</ul>
</li>
<li><p>Build/Packaging Changes</p>
<ul>
<li><p>Add a <code class="docutils literal notranslate"><span class="pre">openssl</span></code> crypto provider, which is implemented with
OpenSSL and also works with BoringSSL. Thanks to Dean Scarff
for this contribution. If you maintain qpdf for a distribution,
pay special attention to make sure that you are including
support for the crypto providers you want. Package maintainers
will have to weigh the advantages of allowing users to pick a
crypto provider at runtime against the disadvantages of adding
more dependencies to qpdf.</p></li>
<li><p>Allow qpdf to built on stripped down systems whose C/C++
libraries lack the <code class="docutils literal notranslate"><span class="pre">wchar_t</span></code> type. Search for <code class="docutils literal notranslate"><span class="pre">wchar_t</span></code> in
qpdf’s README.md for details. This should be very rare, but it
is known to be helpful in some embedded environments.</p></li>
</ul>
</li>
<li><p>CLI Enhancements</p>
<ul>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">objectinfo</span></code> key to the JSON output. This will be a place
to put computed metadata or other information about PDF objects
that are not immediately evident in other ways or that seem
useful for some other reason. In this version, information is
provided about each object indicating whether it is a stream
and, if so, what its length and filters are. Without this, it
was not possible to tell conclusively from the JSON output
alone whether or not an object was a stream. Run
<strong class="command">qpdf --json-help</strong> for details.</p></li>
<li><p>Add new option
<a class="reference internal" href="cli.html#option-remove-unreferenced-resources" title="option-remove-unreferenced-resources"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--remove-unreferenced-resources</span></code></a> which
takes <code class="docutils literal notranslate"><span class="pre">auto</span></code>, <code class="docutils literal notranslate"><span class="pre">yes</span></code>, or <code class="docutils literal notranslate"><span class="pre">no</span></code> as arguments. The new
<code class="docutils literal notranslate"><span class="pre">auto</span></code> mode, which is the default, performs a fast heuristic
over a PDF file when splitting pages to determine whether the
expensive process of finding and removing unreferenced
resources is likely to be of benefit. For most files, this new
default will result in a significant performance improvement
for splitting pages.</p></li>
<li><p>The <a class="reference internal" href="cli.html#option-preserve-unreferenced-resources" title="option-preserve-unreferenced-resources"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--preserve-unreferenced-resources</span></code></a>
is now just a synonym for
<code class="samp docutils literal notranslate"><span class="pre">--remove-unreferenced-resources=no</span></code>.</p></li>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">QPDF_EXECUTABLE</span></code> environment variable is set when
invoking <strong class="command">qpdf --bash-completion</strong> or
<strong class="command">qpdf --zsh-completion</strong>, the completion
command that it outputs will refer to qpdf using the value of
that variable rather than what <strong class="command">qpdf</strong>
determines its executable path to be. This can be useful when
wrapping <strong class="command">qpdf</strong> with a script, working
with a version in the source tree, using an AppImage, or other
situations where there is some indirection.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>Random number generation is now delegated to the crypto
provider. The old behavior is still used by the native crypto
provider. It is still possible to provide your own random
number generator.</p></li>
<li><p>Add a new version of
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::StreamDataProvider::provideStreamData</span></code>
that accepts the <code class="docutils literal notranslate"><span class="pre">suppress_warnings</span></code> and <code class="docutils literal notranslate"><span class="pre">will_retry</span></code>
options and allows a success code to be returned. This makes it
possible to implement a <code class="docutils literal notranslate"><span class="pre">StreamDataProvider</span></code> that calls
<code class="docutils literal notranslate"><span class="pre">pipeStreamData</span></code> on another stream and to pass the response
back to the caller, which enables better error handling on
those proxied streams.</p></li>
<li><p>Update <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::pipeStreamData</span></code> to return an
overall success code that goes beyond whether or not filtered
data was written successfully. This allows better error
handling of cases that were not filtering errors. You have to
call this explicitly. Methods in previously existing APIs have
the same semantics as before.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper::placeFormXObject</span></code> method now
allows separate control over whether it should be willing to
shrink or expand objects to fit them better into the
destination rectangle. The previous behavior was that shrinking
was allowed but expansion was not. The previous behavior is
still the default.</p></li>
<li><p>When calling the C API, any non-zero value passed to a boolean
parameter is treated as <code class="docutils literal notranslate"><span class="pre">TRUE</span></code>. Previously only the value
<code class="docutils literal notranslate"><span class="pre">1</span></code> was accepted. This makes the C API behave more like most
C interfaces and is known to improve compatibility with some
Windows environments that dynamically load the DLL and call
functions from it.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::unsafeShallowCopy</span></code> for copying only
top-level dictionary keys or array items. This is unsafe
because it creates a situation in which changing a lower-level
item in one object may also change it in another object, but
for cases in which you <em>know</em> you are only inserting or
replacing top-level items, it is much faster than
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::shallowCopy</span></code>.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::filterAsContents</span></code>, which filter’s a
stream’s data as a content stream. This is useful for parsing
the contents for form XObjects in the same way as parsing page
content streams.</p></li>
</ul>
</li>
<li><p>Bug Fixes</p>
<ul>
<li><p>When detecting and removing unreferenced resources during page
splitting, traverse into form XObjects and handle their
resources dictionaries as well.</p></li>
<li><p>The same error recovery is applied to streams in other than the
primary input file when merging or splitting pages.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>9.1.1: January 26, 2020</dt><dd><ul class="simple">
<li><p>Build/Packaging Changes</p>
<ul>
<li><p>The fix-qdf program was converted from perl to C++. As such,
qpdf no longer has a runtime dependency on perl.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>Added new helper routine <code class="docutils literal notranslate"><span class="pre">QUtil::call_main_from_wmain</span></code> which
converts <code class="docutils literal notranslate"><span class="pre">wchar_t</span></code> arguments to UTF-8 encoded strings. This
is useful for qpdf because library methods expect file names to
be UTF-8 encoded, even on Windows</p></li>
<li><p>Added new <code class="docutils literal notranslate"><span class="pre">QUtil::read_lines_from_file</span></code> methods that take
<code class="docutils literal notranslate"><span class="pre">FILE*</span></code> arguments and that allow preservation of end-of-line
characters. This also fixes a bug where
<code class="docutils literal notranslate"><span class="pre">QUtil::read_lines_from_file</span></code> wouldn’t work properly with
Unicode filenames.</p></li>
</ul>
</li>
<li><p>CLI Enhancements</p>
<ul>
<li><p>Added options <a class="reference internal" href="cli.html#option-is-encrypted" title="option-is-encrypted"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--is-encrypted</span></code></a> and
<a class="reference internal" href="cli.html#option-requires-password" title="option-requires-password"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--requires-password</span></code></a> for testing whether
a file is encrypted or requires a password other than the
supplied (or empty) password. These communicate via exit
status, making them useful for shell scripts. They also work on
encrypted files with unknown passwords.</p></li>
<li><p>Added <code class="docutils literal notranslate"><span class="pre">encrypt</span></code> key to JSON options. With the exception of
the reconstructed user password for older encryption formats,
this provides the same information as
<a class="reference internal" href="cli.html#option-show-encryption" title="option-show-encryption"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--show-encryption</span></code></a> but in a consistent,
parseable format. See output of <strong class="command">qpdf
--json-help</strong> for details.</p></li>
</ul>
</li>
<li><p>Bug Fixes</p>
<ul>
<li><p>In QDF mode, be sure not to write more than one XRef stream to
a file, even when
<a class="reference internal" href="cli.html#option-preserve-unreferenced" title="option-preserve-unreferenced"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--preserve-unreferenced</span></code></a> is used.
<strong class="command">fix-qdf</strong> assumes that there is only
one XRef stream, and that it appears at the end of the file.</p></li>
<li><p>When externalizing inline images, properly handle images whose
color space is a reference to an object in the page’s resource
dictionary.</p></li>
<li><p>Windows-specific fix for acquiring crypt context with a new
keyset.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>9.1.0: November 17, 2019</dt><dd><ul class="simple">
<li><p>Build Changes</p>
<ul>
<li><p>A C++-11 compiler is now required to build qpdf.</p></li>
<li><p>A new crypto provider that uses gnutls for crypto functions is
now available and can be enabled at build time. See <a class="reference internal" href="installation.html#crypto"><span class="std std-ref">Crypto Providers</span></a> for more information about crypto
providers and <a class="reference internal" href="installation.html#crypto-build"><span class="std std-ref">Build-time Crypto Selection</span></a> for specific information about
the build.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>Incorporate contribution from Masamichi Hosoda to properly
handle signature dictionaries by not including them in object
streams, formatting the <code class="docutils literal notranslate"><span class="pre">Contents</span></code> key has a hexadecimal
string, and excluding the <code class="docutils literal notranslate"><span class="pre">/Contents</span></code> key from encryption and
decryption.</p></li>
<li><p>Incorporate contribution from Masamichi Hosoda to provide new
API calls for getting file-level information about input and
output files, enabling certain operations on the files at the
file level rather than the object level. New methods include
<code class="docutils literal notranslate"><span class="pre">QPDF::getXRefTable()</span></code>,
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getParsedOffset()</span></code>,
<code class="docutils literal notranslate"><span class="pre">QPDFWriter::getRenumberedObjGen(QPDFObjGen)</span></code>, and
<code class="docutils literal notranslate"><span class="pre">QPDFWriter::getWrittenXRefTable()</span></code>.</p></li>
<li><p>Support build-time and runtime selectable crypto providers.
This includes the addition of new classes
<code class="docutils literal notranslate"><span class="pre">QPDFCryptoProvider</span></code> and <code class="docutils literal notranslate"><span class="pre">QPDFCryptoImpl</span></code> and the
recognition of the <code class="docutils literal notranslate"><span class="pre">QPDF_CRYPTO_PROVIDER</span></code> environment
variable. Crypto providers are described in depth in <a class="reference internal" href="installation.html#crypto"><span class="std std-ref">Crypto Providers</span></a>.</p></li>
</ul>
</li>
<li><p>CLI Enhancements</p>
<ul>
<li><p>Addition of the <a class="reference internal" href="cli.html#option-show-crypto" title="option-show-crypto"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--show-crypto</span></code></a> option in
support of selectable crypto providers, as described in <a class="reference internal" href="installation.html#crypto"><span class="std std-ref">Crypto Providers</span></a>.</p></li>
<li><p>Allow <code class="docutils literal notranslate"><span class="pre">:even</span></code> or <code class="docutils literal notranslate"><span class="pre">:odd</span></code> to be appended to numeric ranges
for specification of the even or odd pages from among the pages
specified in the range.</p></li>
<li><p>Fix shell wildcard expansion behavior (<code class="docutils literal notranslate"><span class="pre">*</span></code> and <code class="docutils literal notranslate"><span class="pre">?</span></code>) of the
<strong class="command">qpdf.exe</strong> as built my MSVC.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>9.0.2: October 12, 2019</dt><dd><ul class="simple">
<li><p>Bug Fix</p>
<ul>
<li><p>Fix the name of the temporary file used by
<a class="reference internal" href="cli.html#option-replace-input" title="option-replace-input"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--replace-input</span></code></a> so that it doesn’t
require path splitting and works with paths include
directories.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>9.0.1: September 20, 2019</dt><dd><ul class="simple">
<li><p>Bug Fixes/Enhancements</p>
<ul>
<li><p>Fix some build and test issues on big-endian systems and
compilers with characters that are unsigned by default. The
problems were in build and test only. There were no actual bugs
in the qpdf library itself relating to endianness or unsigned
characters.</p></li>
<li><p>When a dictionary has a duplicated key, report this with a
warning. The behavior of the library in this case is unchanged,
but the error condition is no longer silently ignored.</p></li>
<li><p>When a form field’s display rectangle is erroneously specified
with inverted coordinates, detect and correct this situation.
This avoids some form fields from being flipped when flattening
annotations on files with this condition.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>9.0.0: August 31, 2019</dt><dd><ul class="simple">
<li><p>Incompatible API (source-level) Changes (minor)</p>
<ul>
<li><p>The method <code class="docutils literal notranslate"><span class="pre">QUtil::strcasecmp</span></code> has been renamed to
<code class="docutils literal notranslate"><span class="pre">QUtil::str_compare_nocase</span></code>. This incompatible change is
necessary to enable qpdf to build on platforms that define
<code class="docutils literal notranslate"><span class="pre">strcasecmp</span></code> as a macro.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">QPDF::copyForeignObject</span></code> method had an overloaded
version that took a boolean parameter that was not used. If you
were using this version, just omit the extra parameter.</p></li>
<li><p>There was a version <code class="docutils literal notranslate"><span class="pre">QPDFTokenizer::expectInlineImage</span></code> that
took no arguments. This version has been removed since it
caused the tokenizer to return incorrect inline images. A new
version was added some time ago that produces correct output.
This is a very low level method that doesn’t make sense to call
outside of qpdf’s lexical engine. There are higher level
methods for tokenizing content streams.</p></li>
<li><p>Change <code class="docutils literal notranslate"><span class="pre">QPDFOutlineDocumentHelper::getTopLevelOutlines</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFOutlineObjectHelper::getKids</span></code> to return a
<code class="docutils literal notranslate"><span class="pre">std::vector</span></code> instead of a <code class="docutils literal notranslate"><span class="pre">std::list</span></code> of
<code class="docutils literal notranslate"><span class="pre">QPDFOutlineObjectHelper</span></code> objects.</p></li>
<li><p>Remove method <code class="docutils literal notranslate"><span class="pre">QPDFTokenizer::allowPoundAnywhereInName</span></code>. This
function would allow creation of name tokens whose value would
change when unparsed, which is never the correct behavior.</p></li>
</ul>
</li>
<li><p>CLI Enhancements</p>
<ul>
<li><p>The <a class="reference internal" href="cli.html#option-replace-input" title="option-replace-input"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--replace-input</span></code></a> option may be given
in place of an output file name. This causes qpdf to overwrite
the input file with the output. See the description of
<a class="reference internal" href="cli.html#option-replace-input" title="option-replace-input"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--replace-input</span></code></a> for more details.</p></li>
<li><p>The <a class="reference internal" href="cli.html#option-recompress-flate" title="option-recompress-flate"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--recompress-flate</span></code></a> instructs
<strong class="command">qpdf</strong> to recompress streams that are
already compressed with <code class="docutils literal notranslate"><span class="pre">/FlateDecode</span></code>. Useful with
<a class="reference internal" href="cli.html#option-compression-level" title="option-compression-level"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--compression-level</span></code></a>.</p></li>
<li><p>The
<code class="samp docutils literal notranslate"><span class="pre">--compression-level=</span><em><span class="pre">level</span></em></code>
sets the zlib compression level used for any streams compressed
by <code class="docutils literal notranslate"><span class="pre">/FlateDecode</span></code>. Most effective when combined with
<a class="reference internal" href="cli.html#option-recompress-flate" title="option-recompress-flate"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--recompress-flate</span></code></a>.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>A new namespace <code class="docutils literal notranslate"><span class="pre">QIntC</span></code>, provided by
<code class="file docutils literal notranslate"><span class="pre">qpdf/QIntC.hh</span></code>, provides safe
conversion methods between different integer types. These
conversion methods do range checking to ensure that the cast
can be performed with no loss of information. Every use of
<code class="docutils literal notranslate"><span class="pre">static_cast</span></code> in the library was inspected to see if it could
use one of these safe converters instead. See <a class="reference internal" href="design.html#casting"><span class="std std-ref">Casting Policy</span></a> for additional details.</p></li>
<li><p>Method <code class="docutils literal notranslate"><span class="pre">QPDF::anyWarnings</span></code> tells whether there have been any
warnings without clearing the list of warnings.</p></li>
<li><p>Method <code class="docutils literal notranslate"><span class="pre">QPDF::closeInputSource</span></code> closes or otherwise releases
the input source. This enables the input file to be deleted or
renamed.</p></li>
<li><p>New methods have been added to <code class="docutils literal notranslate"><span class="pre">QUtil</span></code> for converting back
and forth between strings and unsigned integers:
<code class="docutils literal notranslate"><span class="pre">uint_to_string</span></code>, <code class="docutils literal notranslate"><span class="pre">uint_to_string_base</span></code>,
<code class="docutils literal notranslate"><span class="pre">string_to_uint</span></code>, and <code class="docutils literal notranslate"><span class="pre">string_to_ull</span></code>.</p></li>
<li><p>New methods have been added to <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> that return
the value of <code class="docutils literal notranslate"><span class="pre">Integer</span></code> objects as <code class="docutils literal notranslate"><span class="pre">int</span></code> or <code class="docutils literal notranslate"><span class="pre">unsigned</span> <span class="pre">int</span></code>
with range checking and sensible fallback values, and a new
method was added to return an unsigned value. This makes it
easier to write code that is safe from unintentional data loss.
Functions: <code class="docutils literal notranslate"><span class="pre">getUIntValue</span></code>, <code class="docutils literal notranslate"><span class="pre">getIntValueAsInt</span></code>,
<code class="docutils literal notranslate"><span class="pre">getUIntValueAsUInt</span></code>.</p></li>
<li><p>When parsing content streams with
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::ParserCallbacks</span></code>, in place of the method
<code class="docutils literal notranslate"><span class="pre">handleObject(QPDFObjectHandle)</span></code>, the developer may override
<code class="docutils literal notranslate"><span class="pre">handleObject(QPDFObjectHandle,</span> <span class="pre">size_t</span> <span class="pre">offset,</span> <span class="pre">size_t</span>
<span class="pre">length)</span></code>. If this method is defined, it will
be invoked with the object along with its offset and length
within the overall contents being parsed. Intervening spaces
and comments are not included in offset and length.
Additionally, a new method <code class="docutils literal notranslate"><span class="pre">contentSize(size_t)</span></code> may be
implemented. If present, it will be called prior to the first
call to <code class="docutils literal notranslate"><span class="pre">handleObject</span></code> with the total size in bytes of the
combined contents.</p></li>
<li><p>New methods <code class="docutils literal notranslate"><span class="pre">QPDF::userPasswordMatched</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDF::ownerPasswordMatched</span></code> have been added to enable a
caller to determine whether the supplied password was the user
password, the owner password, or both. This information is also
displayed by <strong class="command">qpdf --show-encryption</strong>
and <strong class="command">qpdf --check</strong>.</p></li>
<li><p>Static method <code class="docutils literal notranslate"><span class="pre">Pl_Flate::setCompressionLevel</span></code> can be called
to set the zlib compression level globally used by all
instances of Pl_Flate in deflate mode.</p></li>
<li><p>The method <code class="docutils literal notranslate"><span class="pre">QPDFWriter::setRecompressFlate</span></code> can be called to
tell <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> to uncompress and recompress streams
already compressed with <code class="docutils literal notranslate"><span class="pre">/FlateDecode</span></code>.</p></li>
<li><p>The underlying implementation of QPDF arrays has been enhanced
to be much more memory efficient when dealing with arrays with
lots of nulls. This enables qpdf to use drastically less memory
for certain types of files.</p></li>
<li><p>When traversing the pages tree, if nodes are encountered with
invalid types, the types are fixed, and a warning is issued.</p></li>
<li><p>A new helper method <code class="docutils literal notranslate"><span class="pre">QUtil::read_file_into_memory</span></code> was added.</p></li>
<li><p>All conditions previously reported by
<code class="docutils literal notranslate"><span class="pre">QPDF::checkLinearization()</span></code> as errors are now presented as
warnings.</p></li>
<li><p>Name tokens containing the <code class="docutils literal notranslate"><span class="pre">#</span></code> character not preceded by two
hexadecimal digits, which is invalid in PDF 1.2 and above, are
properly handled by the library: a warning is generated, and
the name token is properly preserved, even if invalid, in the
output. See <code class="file docutils literal notranslate"><span class="pre">ChangeLog</span></code> for a more
complete description of this change.</p></li>
</ul>
</li>
<li><p>Bug Fixes</p>
<ul>
<li><p>A small handful of memory issues, assertion failures, and
unhandled exceptions that could occur on badly mangled input
files have been fixed. Most of these problems were found by
Google’s OSS-Fuzz project.</p></li>
<li><p>When <strong class="command">qpdf --check</strong> or
<strong class="command">qpdf --check-linearization</strong> encounters
a file with linearization warnings but not errors, it now
properly exits with exit code 3 instead of 2.</p></li>
<li><p>The <a class="reference internal" href="cli.html#option-completion-bash" title="option-completion-bash"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--completion-bash</span></code></a> and
<a class="reference internal" href="cli.html#option-completion-zsh" title="option-completion-zsh"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--completion-zsh</span></code></a> options now work
properly when qpdf is invoked as an AppImage.</p></li>
<li><p>Calling <code class="docutils literal notranslate"><span class="pre">QPDFWriter::set*EncryptionParameters</span></code> on a
<code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> object whose output filename has not yet been
set no longer produces a segmentation fault.</p></li>
<li><p>When reading encrypted files, follow the spec more closely
regarding encryption key length. This allows qpdf to open
encrypted files in most cases when they have invalid or missing
/Length keys in the encryption dictionary.</p></li>
</ul>
</li>
<li><p>Build Changes</p>
<ul>
<li><p>On platforms that support it, qpdf now builds with
<code class="samp docutils literal notranslate"><span class="pre">-fvisibility=hidden</span></code>. If you build qpdf
with your own build system, this is now safe to use. This
prevents methods that are not part of the public API from being
exported by the shared library, and makes qpdf’s ELF shared
libraries (used on Linux, MacOS, and most other UNIX flavors)
behave more like the Windows DLL. Since the DLL already behaves
in much this way, it is unlikely that there are any methods
that were accidentally not exported. However, with ELF shared
libraries, typeinfo for some classes has to be explicitly
exported. If there are problems in dynamically linked code
catching exceptions or subclassing, this could be the reason.
If you see this, please report a bug at
<a class="reference external" href="https://github.com/qpdf/qpdf/issues/">https://github.com/qpdf/qpdf/issues/</a>.</p></li>
<li><p>QPDF is now compiled with integer conversion and sign
conversion warnings enabled. Numerous changes were made to the
library to make this safe.</p></li>
<li><p>QPDF’s <strong class="command">make install</strong> target explicitly
specifies the mode to use when installing files instead of
relying the user’s umask. It was previously doing this for some
files but not others.</p></li>
<li><p>If <strong class="command">pkg-config</strong> is available, use it to
locate <code class="file docutils literal notranslate"><span class="pre">libjpeg</span></code> and
<code class="file docutils literal notranslate"><span class="pre">zlib</span></code> dependencies, falling back on
old behavior if unsuccessful.</p></li>
</ul>
</li>
<li><p>Other Notes</p>
<ul>
<li><p>QPDF has been fully integrated into <a class="reference external" href="https://github.com/google/oss-fuzz">Google’s OSS-Fuzz
project</a>. This project
exercises code with randomly mutated inputs and is great for
discovering hidden security crashes and security issues.
Several bugs found by oss-fuzz have already been fixed in qpdf.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>8.4.2: May 18, 2019</dt><dd><p>This release has just one change: correction of a buffer overrun in
the Windows code used to open files. Windows users should take this
update. There are no code changes that affect non-Windows releases.</p>
</dd>
<dt>8.4.1: April 27, 2019</dt><dd><ul class="simple">
<li><p>Enhancements</p>
<ul>
<li><p>When <strong class="command">qpdf --version</strong> is run, it will
detect if the qpdf CLI was built with a different version of
qpdf than the library, which may indicate a problem with the
installation.</p></li>
<li><p>New option <a class="reference internal" href="cli.html#option-remove-page-labels" title="option-remove-page-labels"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--remove-page-labels</span></code></a> will
remove page labels before generating output. This used to
happen if you ran <strong class="command">qpdf --empty --pages ..
--</strong>, but the behavior changed in qpdf 8.3.0. This
option enables people who were relying on the old behavior to
get it again.</p></li>
<li><p>New option
<code class="samp docutils literal notranslate"><span class="pre">--keep-files-open-threshold=</span><em><span class="pre">count</span></em></code>
can be used to override number of files that qpdf will use to
trigger the behavior of not keeping all files open when merging
files. This may be necessary if your system allows fewer than
the default value of 200 files to be open at the same time.</p></li>
</ul>
</li>
<li><p>Bug Fixes</p>
<ul>
<li><p>Handle Unicode characters in filenames on Windows. The changes
to support Unicode on the CLI in Windows broke Unicode
filenames for Windows.</p></li>
<li><p>Slightly tighten logic that determines whether an object is a
page. This should resolve problems in some rare files where
some non-page objects were passing qpdf’s test for whether
something was a page, thus causing them to be erroneously lost
during page splitting operations.</p></li>
<li><p>Revert change that included preservation of outlines
(bookmarks) in <a class="reference internal" href="cli.html#option-split-pages" title="option-split-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--split-pages</span></code></a>. The way
it was implemented in 8.3.0 and 8.4.0 caused a very significant
degradation of performance for splitting certain files. A
future release of qpdf may re-introduce the behavior in a more
performant and also more correct fashion.</p></li>
<li><p>In JSON mode, add missing leading 0 to decimal values between
-1 and 1 even if not present in the input. The JSON
specification requires the leading 0. The PDF specification
does not.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>8.4.0: February 1, 2019</dt><dd><ul class="simple">
<li><p>Command-line Enhancements</p>
<ul>
<li><p><em>Non-compatible CLI change:</em> The qpdf command-line tool
interprets passwords given at the command-line differently from
previous releases when the passwords contain non-ASCII
characters. In some cases, the behavior differs from previous
releases. For a discussion of the current behavior, please see
<a class="reference internal" href="cli.html#unicode-passwords"><span class="std std-ref">Unicode Passwords</span></a>. The
incompatibilities are as follows:</p>
<ul>
<li><p>On Windows, qpdf now receives all command-line options as
Unicode strings if it can figure out the appropriate
compile/link options. This is enabled at least for MSVC and
mingw builds. That means that if non-ASCII strings are
passed to the qpdf CLI in Windows, qpdf will now correctly
receive them. In the past, they would have either been
encoded as Windows code page 1252 (also known as “Windows
ANSI” or as something unintelligible. In almost all cases,
qpdf is able to properly interpret Unicode arguments now,
whereas in the past, it would almost never interpret them
properly. The result is that non-ASCII passwords given to
the qpdf CLI on Windows now have a much greater chance of
creating PDF files that can be opened by a variety of
readers. In the past, usually files encrypted from the
Windows CLI using non-ASCII passwords would not be readable
by most viewers. Note that the current version of qpdf is
able to decrypt files that it previously created using the
previously supplied password.</p></li>
<li><p>The PDF specification requires passwords to be encoded as
UTF-8 for 256-bit encryption and with PDF Doc encoding for
40-bit or 128-bit encryption. Older versions of qpdf left it
up to the user to provide passwords with the correct
encoding. The qpdf CLI now detects when a password is given
with UTF-8 encoding and automatically transcodes it to what
the PDF spec requires. While this is almost always the
correct behavior, it is possible to override the behavior if
there is some reason to do so. This is discussed in more
depth in <a class="reference internal" href="cli.html#unicode-passwords"><span class="std std-ref">Unicode Passwords</span></a>.</p></li>
</ul>
</li>
<li><p>New options
<a class="reference internal" href="cli.html#option-externalize-inline-images" title="option-externalize-inline-images"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--externalize-inline-images</span></code></a>,
<a class="reference internal" href="cli.html#option-ii-min-bytes" title="option-ii-min-bytes"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--ii-min-bytes</span></code></a>, and
<a class="reference internal" href="cli.html#option-keep-inline-images" title="option-keep-inline-images"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--keep-inline-images</span></code></a> control qpdf’s
handling of inline images and possible conversion of them to
regular images. By default,
<a class="reference internal" href="cli.html#option-optimize-images" title="option-optimize-images"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--optimize-images</span></code></a> now also applies to
inline images.</p></li>
<li><p>Add options <a class="reference internal" href="cli.html#option-overlay" title="option-overlay"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--overlay</span></code></a> and
<a class="reference internal" href="cli.html#option-underlay" title="option-underlay"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--underlay</span></code></a> for overlaying or
underlaying pages of other files onto output pages. See
<a class="reference internal" href="cli.html#overlay-underlay"><span class="std std-ref">Overlay and Underlay</span></a> for
details.</p></li>
<li><p>When opening an encrypted file with a password, if the
specified password doesn’t work and the password contains any
non-ASCII characters, qpdf will try a number of alternative
passwords to try to compensate for possible character encoding
errors. This behavior can be suppressed with the
<a class="reference internal" href="cli.html#option-suppress-password-recovery" title="option-suppress-password-recovery"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--suppress-password-recovery</span></code></a> option.
See <a class="reference internal" href="cli.html#unicode-passwords"><span class="std std-ref">Unicode Passwords</span></a> for a full
discussion.</p></li>
<li><p>Add the <a class="reference internal" href="cli.html#option-password-mode" title="option-password-mode"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--password-mode</span></code></a> option to
fine-tune how qpdf interprets password arguments, especially
when they contain non-ASCII characters. See <a class="reference internal" href="cli.html#unicode-passwords"><span class="std std-ref">Unicode Passwords</span></a> for more information.</p></li>
<li><p>In the <a class="reference internal" href="cli.html#option-pages" title="option-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--pages</span></code></a> option, it is now
possible to copy the same page more than once from the same
file without using the previous workaround of specifying two
different paths to the same file.</p></li>
<li><p>In the <a class="reference internal" href="cli.html#option-pages" title="option-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--pages</span></code></a> option, allow use of “.”
as a shortcut for the primary input file. That way, you can do
<strong class="command">qpdf in.pdf --pages . 1-2 -- out.pdf</strong>
instead of having to repeat <code class="file docutils literal notranslate"><span class="pre">in.pdf</span></code>
in the command.</p></li>
<li><p>When encrypting with 128-bit and 256-bit encryption, new
encryption options <a class="reference internal" href="cli.html#option-assemble" title="option-assemble"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--assemble</span></code></a>,
<a class="reference internal" href="cli.html#option-annotate" title="option-annotate"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--annotate</span></code></a>,
<a class="reference internal" href="cli.html#option-form" title="option-form"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--form</span></code></a>, and
<a class="reference internal" href="cli.html#option-modify-other" title="option-modify-other"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--modify-other</span></code></a> allow more fine-grained
granularity in configuring options. Before, the
<a class="reference internal" href="cli.html#option-modify" title="option-modify"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--modify</span></code></a> option only configured certain
predefined groups of permissions.</p></li>
</ul>
</li>
<li><p>Bug Fixes and Enhancements</p>
<ul>
<li><p><em>Potential data-loss bug:</em> Versions of qpdf between 8.1.0 and
8.3.0 had a bug that could cause page splitting and merging
operations to drop some font or image resources if the PDF
file’s internal structure shared these resource lists across
pages and if some but not all of the pages in the output did
not reference all the fonts and images. Using the
<a class="reference internal" href="cli.html#option-preserve-unreferenced-resources" title="option-preserve-unreferenced-resources"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--preserve-unreferenced-resources</span></code></a>
option would work around the incorrect behavior. This bug was
the result of a typo in the code and a deficiency in the test
suite. The case that triggered the error was known, just not
handled properly. This case is now exercised in qpdf’s test
suite and properly handled.</p></li>
<li><p>When optimizing images, detect and refuse to optimize images
that can’t be converted to JPEG because of bit depth or color
space.</p></li>
<li><p>Linearization and page manipulation APIs now detect and recover
from files that have duplicate Page objects in the pages tree.</p></li>
<li><p>Using older option
<code class="samp docutils literal notranslate"><span class="pre">--stream-data=compress</span></code> with object
streams, object streams and xref streams were not compressed.</p></li>
<li><p>When the tokenizer returns inline image tokens, delimiters
following <code class="docutils literal notranslate"><span class="pre">ID</span></code> and <code class="docutils literal notranslate"><span class="pre">EI</span></code> operators are no longer excluded.
This makes it possible to reliably extract the actual image
data.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper::externalizeInlineImages</span></code> to
convert inline images to regular images.</p></li>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QUtil::possible_repaired_encodings()</span></code> to generate
a list of strings that represent other ways the given string
could have been encoded. This is the method the QPDF CLI uses
to generate the strings it tries when recovering incorrectly
encoded Unicode passwords.</p></li>
<li><p>Add new versions of
<code class="docutils literal notranslate"><span class="pre">QPDFWriter::setR{3,4,5,6}EncryptionParameters</span></code> that allow
more granular setting of permissions bits. See
<code class="file docutils literal notranslate"><span class="pre">QPDFWriter.hh</span></code> for details.</p></li>
<li><p>Add new versions of the transcoders from UTF-8 to single-byte
coding systems in <code class="docutils literal notranslate"><span class="pre">QUtil</span></code> that report success or failure
rather than just substituting a specified unknown character.</p></li>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QUtil::analyze_encoding()</span></code> to determine whether a
string has high-bit characters and is appears to be UTF-16 or
valid UTF-8 encoding.</p></li>
<li><p>Add new method <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper::shallowCopyPage()</span></code> to
copy a new page that is a “shallow copy” of a page. The
resulting object is an indirect object ready to be passed to
<code class="docutils literal notranslate"><span class="pre">QPDFPageDocumentHelper::addPage()</span></code> for either the original
<code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object or a different one. This is what the
<strong class="command">qpdf</strong> command-line tool uses to copy
the same page multiple times from the same file during
splitting and merging operations.</p></li>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QPDF::getUniqueId()</span></code>, which returns a unique
identifier for the given QPDF object. The identifier will be
unique across the life of the application. The returned value
can be safely used as a map key.</p></li>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QPDF::setImmediateCopyFrom</span></code>. This further
enhances qpdf’s ability to allow a <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object from which
objects are being copied to go out of scope before the
destination object is written. If you call this method on a
<code class="docutils literal notranslate"><span class="pre">QPDF</span></code> instances, objects copied <em>from</em> this instance will be
copied immediately instead of lazily. This option uses more
memory but allows the source object to go out of scope before
the destination object is written in all cases. See comments in
<code class="file docutils literal notranslate"><span class="pre">QPDF.hh</span></code> for details.</p></li>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper::getAttribute</span></code> for
retrieving an attribute from the page dictionary taking
inheritance into consideration, and optionally making a copy if
your intention is to modify the attribute.</p></li>
<li><p>Fix long-standing limitation of
<code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper::getPageImages</span></code> so that it now properly
reports images from inherited resources dictionaries,
eliminating the need to call
<code class="docutils literal notranslate"><span class="pre">QPDFPageDocumentHelper::pushInheritedAttributesToPage</span></code> in
this case.</p></li>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getUniqueResourceName</span></code> for
finding an unused name in a resource dictionary.</p></li>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper::getFormXObjectForPage</span></code> for
generating a form XObject equivalent to a page. The resulting
object can be used in the same file or copied to another file
with <code class="docutils literal notranslate"><span class="pre">copyForeignObject</span></code>. This can be useful for implementing
underlay, overlay, n-up, thumbnails, or any other functionality
requiring replication of pages in other contexts.</p></li>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper::placeFormXObject</span></code> for
generating content stream text that places a given form XObject
on a page, centered and fit within a specified rectangle. This
method takes care of computing the proper transformation matrix
and may optionally compensate for rotation or scaling of the
destination page.</p></li>
<li><p>Exit codes returned by <code class="docutils literal notranslate"><span class="pre">QPDFJob::run()</span></code> and the C API wrappers
are now defined in <code class="file docutils literal notranslate"><span class="pre">qpdf/Constants.h</span></code> in the
<code class="docutils literal notranslate"><span class="pre">qpdf_exit_code_e</span></code> type so that they are accessible from the C
API. They were previously only defined as constants in
<code class="file docutils literal notranslate"><span class="pre">qpdf/QPDFJob.hh</span></code>.</p></li>
</ul>
</li>
<li><p>Build Improvements</p>
<ul>
<li><p>Add new configure option
<code class="samp docutils literal notranslate"><span class="pre">--enable-avoid-windows-handle</span></code>, which
causes the preprocessor symbol <code class="docutils literal notranslate"><span class="pre">AVOID_WINDOWS_HANDLE</span></code> to be
defined. When defined, qpdf will avoid referencing the Windows
<code class="docutils literal notranslate"><span class="pre">HANDLE</span></code> type, which is disallowed with certain versions of
the Windows SDK.</p></li>
<li><p>For Windows builds, attempt to determine what options, if any,
have to be passed to the compiler and linker to enable use of
<code class="docutils literal notranslate"><span class="pre">wmain</span></code>. This causes the preprocessor symbol
<code class="docutils literal notranslate"><span class="pre">WINDOWS_WMAIN</span></code> to be defined. If you do your own builds with
other compilers, you can define this symbol to cause <code class="docutils literal notranslate"><span class="pre">wmain</span></code>
to be used. This is needed to allow the Windows
<strong class="command">qpdf</strong> command to receive Unicode
command-line options.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>8.3.0: January 7, 2019</dt><dd><ul class="simple">
<li><p>Command-line Enhancements</p>
<ul>
<li><p>Shell completion: you can now use eval <strong class="command">$(qpdf
--completion-bash)</strong> and eval <strong class="command">$(qpdf
--completion-zsh)</strong> to enable shell completion for
bash and zsh.</p></li>
<li><p>Page numbers (also known as page labels) are now preserved when
merging and splitting files with the
<a class="reference internal" href="cli.html#option-pages" title="option-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--pages</span></code></a> and
<a class="reference internal" href="cli.html#option-split-pages" title="option-split-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--split-pages</span></code></a> options.</p></li>
<li><p>Bookmarks are partially preserved when splitting pages with the
<a class="reference internal" href="cli.html#option-split-pages" title="option-split-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--split-pages</span></code></a> option. Specifically, the
outlines dictionary and some supporting metadata are copied
into the split files. The result is that all bookmarks from the
original file appear, those that point to pages that are
preserved work, and those that point to pages that are not
preserved don’t do anything. This is an interim step toward
proper support for bookmarks in splitting and merging
operations.</p></li>
<li><p>Page collation: add new option
<a class="reference internal" href="cli.html#option-collate" title="option-collate"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--collate</span></code></a>. When specified, the
semantics of <a class="reference internal" href="cli.html#option-pages" title="option-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--pages</span></code></a> change from
concatenation to collation. See <a class="reference internal" href="cli.html#page-selection"><span class="std std-ref">Page Selection</span></a> for examples and discussion.</p></li>
<li><p>Generation of information in JSON format, primarily to
facilitate use of qpdf from languages other than C++. Add new
options <a class="reference internal" href="cli.html#option-json" title="option-json"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json</span></code></a>,
<a class="reference internal" href="cli.html#option-json-key" title="option-json-key"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-key</span></code></a>, and
<a class="reference internal" href="cli.html#option-json-object" title="option-json-object"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--json-object</span></code></a> to generate a JSON
representation of the PDF file. Run <strong class="command">qpdf
--json-help</strong> to get a description of the JSON
format. For more information, see <a class="reference internal" href="json.html#json"><span class="std std-ref">qpdf JSON</span></a>.</p></li>
<li><p>The <a class="reference internal" href="cli.html#option-generate-appearances" title="option-generate-appearances"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--generate-appearances</span></code></a> flag will
cause qpdf to generate appearances for form fields if the PDF
file indicates that form field appearances are out of date.
This can happen when PDF forms are filled in by a program that
doesn’t know how to regenerate the appearances of the filled-in
fields.</p></li>
<li><p>The <a class="reference internal" href="cli.html#option-flatten-annotations" title="option-flatten-annotations"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--flatten-annotations</span></code></a> flag can be
used to <em>flatten</em> annotations, including form fields.
Ordinarily, annotations are drawn separately from the page.
Flattening annotations is the process of combining their
appearances into the page’s contents. You might want to do this
if you are going to rotate or combine pages using a tool that
doesn’t understand about annotations. You may also want to use
<a class="reference internal" href="cli.html#option-generate-appearances" title="option-generate-appearances"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--generate-appearances</span></code></a> when using this
flag since annotations for outdated form fields are not
flattened as that would cause loss of information.</p></li>
<li><p>The <a class="reference internal" href="cli.html#option-optimize-images" title="option-optimize-images"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--optimize-images</span></code></a> flag tells qpdf
to recompresses every image using DCT (JPEG) compression as
long as the image is not already compressed with lossy
compression and recompressing the image reduces its size. The
additional options <a class="reference internal" href="cli.html#option-oi-min-width" title="option-oi-min-width"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--oi-min-width</span></code></a>,
<a class="reference internal" href="cli.html#option-oi-min-height" title="option-oi-min-height"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--oi-min-height</span></code></a>, and
<a class="reference internal" href="cli.html#option-oi-min-area" title="option-oi-min-area"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--oi-min-area</span></code></a> prevent recompression of
images whose width, height, or pixel area (width × height) are
below a specified threshold.</p></li>
<li><p>The <a class="reference internal" href="cli.html#option-show-object" title="option-show-object"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--show-object</span></code></a> option can now be
given as <code class="samp docutils literal notranslate"><span class="pre">--show-object=trailer</span></code> to show
the trailer dictionary.</p></li>
</ul>
</li>
<li><p>Bug Fixes and Enhancements</p>
<ul>
<li><p>QPDF now automatically detects and recovers from dangling
references. If a PDF file contained an indirect reference to a
non-existent object, which is valid, when adding a new object
to the file, it was possible for the new object to take the
object ID of the dangling reference, thereby causing the
dangling reference to point to the new object. This case is now
prevented.</p></li>
<li><p>Fixes to form field setting code: strings are always written in
UTF-16 format, and checkboxes and radio buttons are handled
properly with respect to synchronization of values and
appearance states.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">QPDF::checkLinearization()</span></code> no longer causes the program
to crash when it detects problems with linearization data.
Instead, it issues a normal warning or error.</p></li>
<li><p>Ordinarily qpdf treats an argument of the form
<code class="samp docutils literal notranslate"><span class="pre">&#64;file</span></code> to mean that command-line options
should be read from <code class="file docutils literal notranslate"><span class="pre">file</span></code>. Now, if
<code class="file docutils literal notranslate"><span class="pre">file</span></code> does not exist but
<code class="file docutils literal notranslate"><span class="pre">&#64;file</span></code> does, qpdf will treat
<code class="file docutils literal notranslate"><span class="pre">&#64;file</span></code> as a regular option. This
makes it possible to work more easily with PDF files whose
names happen to start with the <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> character.</p></li>
</ul>
</li>
<li><p>Library Enhancements</p>
<ul>
<li><p>Remove the restriction in most cases that the source QPDF
object used in a <code class="docutils literal notranslate"><span class="pre">QPDF::copyForeignObject</span></code> call has to stick
around until the destination QPDF is written. The exceptional
case is when the source stream gets is data using a
QPDFObjectHandle::StreamDataProvider. For a more in-depth
discussion, see comments around <code class="docutils literal notranslate"><span class="pre">copyForeignObject</span></code> in
<code class="file docutils literal notranslate"><span class="pre">QPDF.hh</span></code>.</p></li>
<li><p>Add new method <code class="docutils literal notranslate"><span class="pre">QPDFWriter::getFinalVersion()</span></code>, which returns
the PDF version that will ultimately be written to the final
file. See comments in <code class="file docutils literal notranslate"><span class="pre">QPDFWriter.hh</span></code>
for some restrictions on its use.</p></li>
<li><p>Add several methods for transcoding strings to some of the
character sets used in PDF files: <code class="docutils literal notranslate"><span class="pre">QUtil::utf8_to_ascii</span></code>,
<code class="docutils literal notranslate"><span class="pre">QUtil::utf8_to_win_ansi</span></code>, <code class="docutils literal notranslate"><span class="pre">QUtil::utf8_to_mac_roman</span></code>, and
<code class="docutils literal notranslate"><span class="pre">QUtil::utf8_to_utf16</span></code>. For the single-byte encodings that
support only a limited character sets, these methods replace
unsupported characters with a specified substitute.</p></li>
<li><p>Add new methods to <code class="docutils literal notranslate"><span class="pre">QPDFAnnotationObjectHelper</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFFormFieldObjectHelper</span></code> for querying flags and
interpretation of different field types. Define constants in
<code class="file docutils literal notranslate"><span class="pre">qpdf/Constants.h</span></code> to help with
interpretation of flag values.</p></li>
<li><p>Add new methods
<code class="docutils literal notranslate"><span class="pre">QPDFAcroFormDocumentHelper::generateAppearancesIfNeeded</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFFormFieldObjectHelper::generateAppearance</span></code> for
generating appearance streams. See discussion in
<code class="file docutils literal notranslate"><span class="pre">QPDFFormFieldObjectHelper.hh</span></code> for
limitations.</p></li>
<li><p>Add two new helper functions for dealing with resource
dictionaries: <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getResourceNames()</span></code> returns
a list of all second-level keys, which correspond to the names
of resources, and <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::mergeResources()</span></code> merges
two resources dictionaries as long as they have non-conflicting
keys. These methods are useful for certain types of objects
that resolve resources from multiple places, such as form
fields.</p></li>
<li><p>Add methods <code class="docutils literal notranslate"><span class="pre">QPDFPageDocumentHelper::flattenAnnotations()</span></code>
and
<code class="docutils literal notranslate"><span class="pre">QPDFAnnotationObjectHelper::getPageContentForAppearance()</span></code>
for handling low-level details of annotation flattening.</p></li>
<li><p>Add new helper classes: <code class="docutils literal notranslate"><span class="pre">QPDFOutlineDocumentHelper</span></code>,
<code class="docutils literal notranslate"><span class="pre">QPDFOutlineObjectHelper</span></code>, <code class="docutils literal notranslate"><span class="pre">QPDFPageLabelDocumentHelper</span></code>,
<code class="docutils literal notranslate"><span class="pre">QPDFNameTreeObjectHelper</span></code>, and
<code class="docutils literal notranslate"><span class="pre">QPDFNumberTreeObjectHelper</span></code>.</p></li>
<li><p>Add method <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getJSON()</span></code> that returns a JSON
representation of the object. Call <code class="docutils literal notranslate"><span class="pre">serialize()</span></code> on the
result to convert it to a string.</p></li>
<li><p>Add a simple JSON serializer. This is not a complete or
general-purpose JSON library. It allows assembly and
serialization of JSON structures with some restrictions, which
are described in the header file. This is the serializer used
by qpdf’s new JSON representation.</p></li>
<li><p>Add new <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::Matrix</span></code> class along with a few
convenience methods for dealing with six-element numerical
arrays as matrices.</p></li>
<li><p>Add new method <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::wrapInArray</span></code>, which returns
the object itself if it is an array, or an array containing the
object otherwise. This is a common construct in PDF. This
method prevents you from having to explicitly test whether
something is a single element or an array.</p></li>
</ul>
</li>
<li><p>Build Improvements</p>
<ul>
<li><p>It is no longer necessary to run
<strong class="command">autogen.sh</strong> to build from a pristine
checkout. Automatically generated files are now committed so
that it is possible to build on platforms without autoconf
directly from a clean checkout of the repository. The
<strong class="command">configure</strong> script detects if the files
are out of date when it also determines that the tools are
present to regenerate them.</p></li>
<li><p>Pull requests and the master branch are now built automatically
in <a class="reference external" href="https://dev.azure.com/qpdf/qpdf/_build">Azure
Pipelines</a>, which is
free for open source projects. The build includes Linux, mac,
Windows 32-bit and 64-bit with mingw and MSVC, and an AppImage
build. Official qpdf releases are now built with Azure
Pipelines.</p></li>
</ul>
</li>
<li><p>Notes for Packagers</p>
<ul>
<li><p>A new section has been added to the documentation with notes
for packagers. Please see <a class="reference internal" href="packaging.html#packaging"><span class="std std-ref">Notes for Packagers</span></a>.</p></li>
<li><p>The qpdf detects out-of-date automatically generated files. If
your packaging system automatically refreshes libtool or
autoconf files, it could cause this check to fail. To avoid
this problem, pass
<code class="samp docutils literal notranslate"><span class="pre">--disable-check-autofiles</span></code> to
<strong class="command">configure</strong>.</p></li>
<li><p>If you would like to have qpdf completion enabled
automatically, you can install completion files in the
distribution’s default location. You can find sample completion
files to install in the <code class="file docutils literal notranslate"><span class="pre">completions</span></code>
directory.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>8.2.1: August 18, 2018</dt><dd><ul class="simple">
<li><p>Command-line Enhancements</p>
<ul>
<li><p>Add
<code class="samp docutils literal notranslate"><span class="pre">--keep-files-open=</span><em><span class="pre">[yn]</span></em></code>
to override default determination of whether to keep files open
when merging. Please see the discussion of
<a class="reference internal" href="cli.html#option-keep-files-open" title="option-keep-files-open"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--keep-files-open</span></code></a> for additional details.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>8.2.0: August 16, 2018</dt><dd><ul class="simple">
<li><p>Command-line Enhancements</p>
<ul>
<li><p>Add <a class="reference internal" href="cli.html#option-no-warn" title="option-no-warn"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--no-warn</span></code></a> option to suppress
issuing warning messages. If there are any conditions that
would have caused warnings to be issued, the exit status is
still 3.</p></li>
</ul>
</li>
<li><p>Bug Fixes and Optimizations</p>
<ul>
<li><p>Performance fix: optimize page merging operation to avoid
unnecessary open/close calls on files being merged. This solves
a dramatic slow-down that was observed when merging certain
types of files.</p></li>
<li><p>Optimize how memory was used for the TIFF predictor,
drastically improving performance and memory usage for files
containing high-resolution images compressed with Flate using
the TIFF predictor.</p></li>
<li><p>Bug fix: end of line characters were not properly handled
inside strings in some cases.</p></li>
<li><p>Bug fix: using <a class="reference internal" href="cli.html#option-progress" title="option-progress"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--progress</span></code></a> on very small
files could cause an infinite loop.</p></li>
</ul>
</li>
<li><p>API enhancements</p>
<ul>
<li><p>Add new class <code class="docutils literal notranslate"><span class="pre">QPDFSystemError</span></code>, derived from
<code class="docutils literal notranslate"><span class="pre">std::runtime_error</span></code>, which is now thrown by
<code class="docutils literal notranslate"><span class="pre">QUtil::throw_system_error</span></code>. This enables the triggering
<code class="docutils literal notranslate"><span class="pre">errno</span></code> value to be retrieved.</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">ClosedFileInputSource::stayOpen</span></code> method, enabling a
<code class="docutils literal notranslate"><span class="pre">ClosedFileInputSource</span></code> to stay open during manually
indicated periods of high activity, thus reducing the overhead
of frequent open/close operations.</p></li>
</ul>
</li>
<li><p>Build Changes</p>
<ul>
<li><p>For the mingw builds, change the name of the DLL import library
from <code class="file docutils literal notranslate"><span class="pre">libqpdf.a</span></code> to
<code class="file docutils literal notranslate"><span class="pre">libqpdf.dll.a</span></code> to more accurately
reflect that it is an import library rather than a static
library. This potentially clears the way for supporting a
static library in the future, though presently, the qpdf
Windows build only builds the DLL and executables.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>8.1.0: June 23, 2018</dt><dd><ul class="simple">
<li><p>Usability Improvements</p>
<ul>
<li><p>When splitting files, qpdf detects fonts and images that the
document metadata claims are referenced from a page but are not
actually referenced and omits them from the output file. This
change can cause a significant reduction in the size of split
PDF files for files created by some software packages. In some
cases, it can also make page splitting slower. Prior versions
of qpdf would believe the document metadata and sometimes
include all the images from all the other pages even though the
pages were no longer present. In the unlikely event that the
old behavior should be desired, or if you have a case where
page splitting is very slow, the old behavior (and speed) can
be enabled by specifying
<a class="reference internal" href="cli.html#option-preserve-unreferenced-resources" title="option-preserve-unreferenced-resources"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--preserve-unreferenced-resources</span></code></a>.</p></li>
<li><p>When merging multiple PDF files, qpdf no longer leaves all the
files open. This makes it possible to merge numbers of files
that may exceed the operating system’s limit for the maximum
number of open files.</p></li>
<li><p>The <a class="reference internal" href="cli.html#option-rotate" title="option-rotate"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--rotate</span></code></a> option’s syntax has been
extended to make the page range optional. If you specify
<code class="samp docutils literal notranslate"><span class="pre">--rotate=</span><em><span class="pre">angle</span></em></code>
without specifying a page range, the rotation will be applied
to all pages. This can be especially useful for adjusting a PDF
created from a multi-page document that was scanned upside
down.</p></li>
<li><p>When merging multiple files, the
<a class="reference internal" href="cli.html#option-verbose" title="option-verbose"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--verbose</span></code></a> option now prints information
about each file as it operates on that file.</p></li>
<li><p>When the <a class="reference internal" href="cli.html#option-progress" title="option-progress"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--progress</span></code></a> option is
specified, qpdf will print a running indicator of its best
guess at how far through the writing process it is. Note that,
as with all progress meters, it’s an approximation. This option
is implemented in a way that makes it useful for software that
uses the qpdf library; see API Enhancements below.</p></li>
</ul>
</li>
<li><p>Bug Fixes</p>
<ul>
<li><p>Properly decrypt files that use revision 3 of the standard
security handler but use 40 bit keys (even though revision 3
supports 128-bit keys).</p></li>
<li><p>Limit depth of nested data structures to prevent crashes from
certain types of malformed (malicious) PDFs.</p></li>
<li><p>In “newline before endstream” mode, insert the required extra
newline before the <code class="docutils literal notranslate"><span class="pre">endstream</span></code> at the end of object streams.
This one case was previously omitted.</p></li>
</ul>
</li>
<li><p>API Enhancements</p>
<ul>
<li><p>The first round of higher level “helper” interfaces has been
introduced. These are designed to provide a more convenient way
of interacting with certain document features than using
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> directly. For details on helpers, see
<a class="reference internal" href="design.html#helper-classes"><span class="std std-ref">Helper Classes</span></a>. Specific additional
interfaces are described below.</p></li>
<li><p>Add two new document helper classes: <code class="docutils literal notranslate"><span class="pre">QPDFPageDocumentHelper</span></code>
for working with pages, and <code class="docutils literal notranslate"><span class="pre">QPDFAcroFormDocumentHelper</span></code> for
working with interactive forms. No old methods have been
removed, but <code class="docutils literal notranslate"><span class="pre">QPDFPageDocumentHelper</span></code> is now the preferred
way to perform operations on pages rather than calling the old
methods in <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> and <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> directly. Comments
in the header files direct you to the new interfaces. Please
see the header files and <code class="file docutils literal notranslate"><span class="pre">ChangeLog</span></code>
for additional details.</p></li>
<li><p>Add three new object helper class: <code class="docutils literal notranslate"><span class="pre">QPDFPageObjectHelper</span></code> for
pages, <code class="docutils literal notranslate"><span class="pre">QPDFFormFieldObjectHelper</span></code> for interactive form
fields, and <code class="docutils literal notranslate"><span class="pre">QPDFAnnotationObjectHelper</span></code> for annotations. All
three classes are fairly sparse at the moment, but they have
some useful, basic functionality.</p></li>
<li><p>A new example program
<code class="file docutils literal notranslate"><span class="pre">examples/pdf-set-form-values.cc</span></code> has
been added that illustrates use of the new document and object
helpers.</p></li>
<li><p>The method <code class="docutils literal notranslate"><span class="pre">QPDFWriter::registerProgressReporter</span></code> has been
added. This method allows you to register a function that is
called by <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> to update your idea of the percentage
it thinks it is through writing its output. Client programs can
use this to implement reasonably accurate progress meters. The
<strong class="command">qpdf</strong> command line tool uses this to
implement its <a class="reference internal" href="cli.html#option-progress" title="option-progress"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--progress</span></code></a> option.</p></li>
<li><p>New methods <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::newUnicodeString</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFObject::unparseBinary</span></code> have been added to allow for more
convenient creation of strings that are explicitly encoded
using big-endian UTF-16. This is useful for creating strings
that appear outside of content streams, such as labels, form
fields, outlines, document metadata, etc.</p></li>
<li><p>A new class <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::Rectangle</span></code> has been added to
ease working with PDF rectangles, which are just arrays of four
numeric values.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>8.0.2: March 6, 2018</dt><dd><ul class="simple">
<li><p>When a loop is detected while following cross reference streams or
tables, treat this as damage instead of silently ignoring the
previous table. This prevents loss of otherwise recoverable data
in some damaged files.</p></li>
<li><p>Properly handle pages with no contents.</p></li>
</ul>
</dd>
<dt>8.0.1: March 4, 2018</dt><dd><ul class="simple">
<li><p>Disregard data check errors when uncompressing <code class="docutils literal notranslate"><span class="pre">/FlateDecode</span></code>
streams. This is consistent with most other PDF readers and allows
qpdf to recover data from another class of malformed PDF files.</p></li>
<li><p>On the command line when specifying page ranges, support preceding
a page number by “r” to indicate that it should be counted from
the end. For example, the range <code class="docutils literal notranslate"><span class="pre">r3-r1</span></code> would indicate the last
three pages of a document.</p></li>
</ul>
</dd>
<dt>8.0.0: February 25, 2018</dt><dd><ul class="simple">
<li><p>Packaging and Distribution Changes</p>
<ul>
<li><p>QPDF is now distributed as an
<a class="reference external" href="https://appimage.org/">AppImage</a> in addition to all the
other ways it is distributed. The AppImage can be found in the
download area with the other packages. Thanks to Kurt Pfeifle
and Simon Peter for their contributions.</p></li>
</ul>
</li>
<li><p>Bug Fixes</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getUTF8Val</span></code> now properly treats
non-Unicode strings as encoded with PDF Doc Encoding.</p></li>
<li><p>Improvements to handling of objects in PDF files that are not
of the expected type. In most cases, qpdf will be able to warn
for such cases rather than fail with an exception. Previous
versions of qpdf would sometimes fail with errors such as
“operation for dictionary object attempted on object of wrong
type”. This situation should be mostly or entirely eliminated
now.</p></li>
</ul>
</li>
<li><p>Enhancements to the <strong class="command">qpdf</strong> Command-line
Tool. All new options listed here are documented in more detail in
<a class="reference internal" href="cli.html#using"><span class="std std-ref">Running qpdf</span></a>.</p>
<ul>
<li><p>The option
<code class="samp docutils literal notranslate"><span class="pre">--linearize-pass1=</span><em><span class="pre">file</span></em></code>
has been added for debugging qpdf’s linearization code.</p></li>
<li><p>The option <a class="reference internal" href="cli.html#option-coalesce-contents" title="option-coalesce-contents"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--coalesce-contents</span></code></a> can be
used to combine content streams of a page whose contents are an
array of streams into a single stream.</p></li>
</ul>
</li>
<li><p>API Enhancements. All new API calls are documented in their
respective classes’ header files. There are no non-compatible
changes to the API.</p>
<ul>
<li><p>Add function <code class="docutils literal notranslate"><span class="pre">qpdf_check_pdf</span></code> to the C API. This function
does basic checking that is a subset of what <strong class="command">qpdf
--check</strong> performs.</p></li>
<li><p>Major enhancements to the lexical layer of qpdf. For a complete
list of enhancements, please refer to the
<code class="file docutils literal notranslate"><span class="pre">ChangeLog</span></code> file. Most of the changes
result in improvements to qpdf’s ability handle erroneous
files. It is also possible for programs to handle whitespace,
comments, and inline images as tokens.</p></li>
<li><p>New API for working with PDF content streams at a lexical
level. The new class <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::TokenFilter</span></code> allows
the developer to provide token handlers. Token filters can be
used with several different methods in <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> as
well as with a lower-level interface. See comments in
<code class="file docutils literal notranslate"><span class="pre">QPDFObjectHandle.hh</span></code> as well as the
new examples
<code class="file docutils literal notranslate"><span class="pre">examples/pdf-filter-tokens.cc</span></code> and
<code class="file docutils literal notranslate"><span class="pre">examples/pdf-count-strings.cc</span></code> for
details.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>7.1.1: February 4, 2018</dt><dd><ul class="simple">
<li><p>Bug fix: files whose /ID fields were other than 16 bytes long can
now be properly linearized</p></li>
<li><p>A few compile and link issues have been corrected for some
platforms.</p></li>
</ul>
</dd>
<dt>7.1.0: January 14, 2018</dt><dd><ul class="simple">
<li><p>PDF files contain streams that may be compressed with various
compression algorithms which, in some cases, may be enhanced by
various predictor functions. Previously only the PNG up predictor
was supported. In this version, all the PNG predictors as well as
the TIFF predictor are supported. This increases the range of
files that qpdf is able to handle.</p></li>
<li><p>QPDF now allows a raw encryption key to be specified in place of a
password when opening encrypted files, and will optionally display
the encryption key used by a file. This is a non-standard
operation, but it can be useful in certain situations. Please see
the discussion of <a class="reference internal" href="cli.html#option-password-is-hex-key" title="option-password-is-hex-key"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--password-is-hex-key</span></code></a> or the comments around
<code class="docutils literal notranslate"><span class="pre">QPDF::setPasswordIsHexKey</span></code> in
<code class="file docutils literal notranslate"><span class="pre">QPDF.hh</span></code> for additional details.</p></li>
<li><p>Bug fix: numbers ending with a trailing decimal point are now
properly recognized as numbers.</p></li>
<li><p>Bug fix: when building qpdf from source on some platforms
(especially MacOS), the build could get confused by older versions
of qpdf installed on the system. This has been corrected.</p></li>
</ul>
</dd>
<dt>7.0.0: September 15, 2017</dt><dd><ul class="simple">
<li><p>Packaging and Distribution Changes</p>
<ul>
<li><p>QPDF’s primary license is now <a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0">version 2.0 of the Apache
License</a> rather
than version 2.0 of the Artistic License. You may still, at
your option, consider qpdf to be licensed with version 2.0 of
the Artistic license.</p></li>
<li><p>QPDF no longer has a dependency on the PCRE (Perl-Compatible
Regular Expression) library. QPDF now has an added dependency
on the JPEG library.</p></li>
</ul>
</li>
<li><p>Bug Fixes</p>
<ul>
<li><p>This release contains many bug fixes for various infinite
loops, memory leaks, and other memory errors that could be
encountered with specially crafted or otherwise erroneous PDF
files.</p></li>
</ul>
</li>
<li><p>New Features</p>
<ul>
<li><p>QPDF now supports reading and writing streams encoded with JPEG
or RunLength encoding. Library API enhancements and
command-line options have been added to control this behavior.
See command-line options
<a class="reference internal" href="cli.html#option-compress-streams" title="option-compress-streams"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--compress-streams</span></code></a> and
<a class="reference internal" href="cli.html#option-decode-level" title="option-decode-level"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--decode-level</span></code></a> and methods
<code class="docutils literal notranslate"><span class="pre">QPDFWriter::setCompressStreams</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFWriter::setDecodeLevel</span></code>.</p></li>
<li><p>QPDF is much better at recovering from broken files. In most
cases, qpdf will skip invalid objects and will preserve broken
stream data by not attempting to filter broken streams. QPDF is
now able to recover or at least not crash on dozens of broken
test files I have received over the past few years.</p></li>
<li><p>Page rotation is now supported and accessible from both the
library and the command line.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> supports writing files in a way that preserves
PCLm compliance in support of driverless printing. This is very
specialized and is only useful to applications that already
know how to create PCLm files.</p></li>
</ul>
</li>
<li><p>Enhancements to the <strong class="command">qpdf</strong> Command-line
Tool. All new options listed here are documented in more detail in
<a class="reference internal" href="cli.html#using"><span class="std std-ref">Running qpdf</span></a>.</p>
<ul>
<li><p>Command-line arguments can now be read from files or standard
input using <code class="docutils literal notranslate"><span class="pre">&#64;file</span></code> or <code class="docutils literal notranslate"><span class="pre">&#64;-</span></code> syntax. Please see <a class="reference internal" href="cli.html#invocation"><span class="std std-ref">Basic Invocation</span></a>.</p></li>
<li><p><a class="reference internal" href="cli.html#option-rotate" title="option-rotate"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--rotate</span></code></a>: request page rotation</p></li>
<li><p><a class="reference internal" href="cli.html#option-newline-before-endstream" title="option-newline-before-endstream"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--newline-before-endstream</span></code></a>: ensure that
a newline appears before every <code class="docutils literal notranslate"><span class="pre">endstream</span></code> keyword in the
file; used to prevent qpdf from breaking PDF/A compliance on
already compliant files.</p></li>
<li><p><a class="reference internal" href="cli.html#option-preserve-unreferenced" title="option-preserve-unreferenced"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--preserve-unreferenced</span></code></a>: preserve
unreferenced objects in the input PDF</p></li>
<li><p><a class="reference internal" href="cli.html#option-split-pages" title="option-split-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--split-pages</span></code></a>: break output into chunks
with fixed numbers of pages</p></li>
<li><p><a class="reference internal" href="cli.html#option-verbose" title="option-verbose"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--verbose</span></code></a>: print the name of each
output file that is created</p></li>
<li><p><a class="reference internal" href="cli.html#option-compress-streams" title="option-compress-streams"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--compress-streams</span></code></a> and
<a class="reference internal" href="cli.html#option-decode-level" title="option-decode-level"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--decode-level</span></code></a> replace
<a class="reference internal" href="cli.html#option-stream-data" title="option-stream-data"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--stream-data</span></code></a> for improving granularity
of controlling compression and decompression of stream data.
The <a class="reference internal" href="cli.html#option-stream-data" title="option-stream-data"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--stream-data</span></code></a> option will remain
available.</p></li>
<li><p>When running <strong class="command">qpdf --check</strong> with other
options, checks are always run first. This enables qpdf to
perform its full recovery logic before outputting other
information. This can be especially useful when manually
recovering broken files, looking at qpdf’s regenerated cross
reference table, or other similar operations.</p></li>
<li><p>Process <strong class="command">--pages</strong> earlier so that other
options like <a class="reference internal" href="cli.html#option-show-pages" title="option-show-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--show-pages</span></code></a> or
<a class="reference internal" href="cli.html#option-split-pages" title="option-split-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--split-pages</span></code></a> can operate on the file
after page splitting/merging has occurred.</p></li>
</ul>
</li>
<li><p>API Changes. All new API calls are documented in their respective
classes’ header files.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::rotatePage</span></code>: apply rotation to a page
object</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDFWriter::setNewlineBeforeEndstream</span></code>: force newline to
appear before <code class="docutils literal notranslate"><span class="pre">endstream</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDFWriter::setPreserveUnreferencedObjects</span></code>: preserve
unreferenced objects that appear in the input PDF. The default
behavior is to discard them.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code> types <code class="docutils literal notranslate"><span class="pre">Pl_RunLength</span></code> and <code class="docutils literal notranslate"><span class="pre">Pl_DCT</span></code> are
available for developers who wish to produce or consume
RunLength or DCT stream data directly. The
<code class="file docutils literal notranslate"><span class="pre">examples/pdf-create.cc</span></code> example
illustrates their use.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDFWriter::setCompressStreams</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFWriter::setDecodeLevel</span></code> methods control handling of
different types of stream compression.</p></li>
<li><p>Add new C API functions <code class="docutils literal notranslate"><span class="pre">qpdf_set_compress_streams</span></code>,
<code class="docutils literal notranslate"><span class="pre">qpdf_set_decode_level</span></code>,
<code class="docutils literal notranslate"><span class="pre">qpdf_set_preserve_unreferenced_objects</span></code>, and
<code class="docutils literal notranslate"><span class="pre">qpdf_set_newline_before_endstream</span></code> corresponding to the new
<code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> methods.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>6.0.0: November 10, 2015</dt><dd><ul class="simple">
<li><p>Implement <a class="reference internal" href="cli.html#option-deterministic-id" title="option-deterministic-id"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--deterministic-id</span></code></a> command-line
option and <code class="docutils literal notranslate"><span class="pre">QPDFWriter::setDeterministicID</span></code> as well as C API
function <code class="docutils literal notranslate"><span class="pre">qpdf_set_deterministic_ID</span></code> for generating a
deterministic ID for non-encrypted files. When this option is
selected, the ID of the file depends on the contents of the output
file, and not on transient items such as the timestamp or output
file name.</p></li>
<li><p>Make qpdf more tolerant of files whose xref table entries are not
the correct length.</p></li>
</ul>
</dd>
<dt>5.1.3: May 24, 2015</dt><dd><ul class="simple">
<li><p>Bug fix: fix-qdf was not properly handling files that contained
object streams with more than 255 objects in them.</p></li>
<li><p>Bug fix: qpdf was not properly initializing Microsoft’s secure
crypto provider on fresh Windows installations that had not had
any keys created yet.</p></li>
<li><p>Fix a few errors found by Gynvael Coldwind and Mateusz Jurczyk of
the Google Security Team. Please see the ChangeLog for details.</p></li>
<li><p>Properly handle pages that have no contents at all. There were
many cases in which qpdf handled this fine, but a few methods
blindly obtained page contents with handling the possibility that
there were no contents.</p></li>
<li><p>Make qpdf more robust for a few more kinds of problems that may
occur in invalid PDF files.</p></li>
</ul>
</dd>
<dt>5.1.2: June 7, 2014</dt><dd><ul class="simple">
<li><p>Bug fix: linearizing files could create a corrupted output file
under extremely unlikely file size circumstances. See ChangeLog
for details. The odds of getting hit by this are very low, though
one person did.</p></li>
<li><p>Bug fix: qpdf would fail to write files that had streams with
decode parameters referencing other streams.</p></li>
<li><p>New example program: <strong class="command">pdf-split-pages</strong>:
efficiently split PDF files into individual pages. The example
program does this more efficiently than using <strong class="command">qpdf
--pages</strong> to do it.</p></li>
<li><p>Packaging fix: Visual C++ binaries did not support Windows XP.
This has been rectified by updating the compilers used to generate
the release binaries.</p></li>
</ul>
</dd>
<dt>5.1.1: January 14, 2014</dt><dd><ul class="simple">
<li><p>Performance fix: copying foreign objects could be very slow with
certain types of files. This was most likely to be visible during
page splitting and was due to traversing the same objects multiple
times in some cases.</p></li>
</ul>
</dd>
<dt>5.1.0: December 17, 2013</dt><dd><ul class="simple">
<li><p>Added runtime option (<code class="docutils literal notranslate"><span class="pre">QUtil::setRandomDataProvider</span></code>) to supply
your own random data provider. You can use this if you want to
avoid using the OS-provided secure random number generation
facility or stdlib’s less secure version. See comments in
include/qpdf/QUtil.hh for details.</p></li>
<li><p>Fixed image comparison tests to not create 12-bit-per-pixel images
since some versions of tiffcmp have bugs in comparing them in some
cases. This increases the disk space required by the image
comparison tests, which are off by default anyway.</p></li>
<li><p>Introduce a number of small fixes for compilation on the latest
clang in MacOS and the latest Visual C++ in Windows.</p></li>
<li><p>Be able to handle broken files that end the xref table header with
a space instead of a newline.</p></li>
</ul>
</dd>
<dt>5.0.1: October 18, 2013</dt><dd><ul class="simple">
<li><p>Thanks to a detailed review by Florian Weimer and the Red Hat
Product Security Team, this release includes a number of
non-user-visible security hardening changes. Please see the
ChangeLog file in the source distribution for the complete list.</p></li>
<li><p>When available, operating system-specific secure random number
generation is used for generating initialization vectors and other
random values used during encryption or file creation. For the
Windows build, this results in an added dependency on Microsoft’s
cryptography API. To disable the OS-specific cryptography and use
the old version, pass the
<code class="samp docutils literal notranslate"><span class="pre">--enable-insecure-random</span></code> option to
<strong class="command">./configure</strong>.</p></li>
<li><p>The <strong class="command">qpdf</strong> command-line tool now issues a
warning when <code class="samp docutils literal notranslate"><span class="pre">-accessibility=n</span></code> is specified
for newer encryption versions stating that the option is ignored.
qpdf, per the spec, has always ignored this flag, but it
previously did so silently. This warning is issued only by the
command-line tool, not by the library. The library’s handling of
this flag is unchanged.</p></li>
</ul>
</dd>
<dt>5.0.0: July 10, 2013</dt><dd><ul class="simple">
<li><p>Bug fix: previous versions of qpdf would lose objects with
generation != 0 when generating object streams. Fixing this
required changes to the public API.</p></li>
<li><p>Removed methods from public API that were only supposed to be
called by QPDFWriter and couldn’t realistically be called anywhere
else. See ChangeLog for details.</p></li>
<li><p>New <code class="docutils literal notranslate"><span class="pre">QPDFObjGen</span></code> class added to represent an object
ID/generation pair. <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getObjGen()</span></code> is now
preferred over <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getObjectID()</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getGeneration()</span></code> as it makes it less likely
for people to accidentally write code that ignores the generation
number. See <code class="file docutils literal notranslate"><span class="pre">QPDF.hh</span></code> and
<code class="file docutils literal notranslate"><span class="pre">QPDFObjectHandle.hh</span></code> for additional
notes.</p></li>
<li><p>Add <a class="reference internal" href="cli.html#option-show-npages" title="option-show-npages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--show-npages</span></code></a> command-line option to
the <strong class="command">qpdf</strong> command to show the number of
pages in a file.</p></li>
<li><p>Allow omission of the page range within
<a class="reference internal" href="cli.html#option-pages" title="option-pages"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--pages</span></code></a> for the
<strong class="command">qpdf</strong> command. When omitted, the page
range is implicitly taken to be all the pages in the file.</p></li>
<li><p>Various enhancements were made to support different types of
broken files or broken readers. Details can be found in
<code class="file docutils literal notranslate"><span class="pre">ChangeLog</span></code>.</p></li>
</ul>
</dd>
<dt>4.1.0: April 14, 2013</dt><dd><ul class="simple">
<li><p>Note to people including qpdf in distributions: the
<code class="file docutils literal notranslate"><span class="pre">.la</span></code> files generated by libtool are now
installed by qpdf’s <strong class="command">make install</strong> target.
Before, they were not installed. This means that if your
distribution does not want to include
<code class="file docutils literal notranslate"><span class="pre">.la</span></code> files, you must remove them as
part of your packaging process.</p></li>
<li><p>Major enhancement: API enhancements have been made to support
parsing of content streams. This enhancement includes the
following changes:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::parseContentStream</span></code> method parses objects
in a content stream and calls handlers in a callback class. The
example
<code class="file docutils literal notranslate"><span class="pre">examples/pdf-parse-content.cc</span></code>
illustrates how this may be used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> can now represent operators and inline
images, object types that may only appear in content streams.</p></li>
<li><p>Method <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getTypeCode()</span></code> returns an
enumerated type value representing the underlying object type.
Method <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getTypeName()</span></code> returns a text
string describing the name of the type of a
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> object. These methods can be used for more
efficient parsing and debugging/diagnostic messages.</p></li>
</ul>
</li>
<li><p><strong class="command">qpdf --check</strong> now parses all pages’
content streams in addition to doing other checks. While there are
still many types of errors that cannot be detected, syntactic
errors in content streams will now be reported.</p></li>
<li><p>Minor compilation enhancements have been made to facilitate easier
for support for a broader range of compilers and compiler
versions.</p>
<ul>
<li><p>Warning flags have been moved into a separate variable in
<code class="file docutils literal notranslate"><span class="pre">autoconf.mk</span></code></p></li>
<li><p>The configure flag <code class="samp docutils literal notranslate"><span class="pre">--enable-werror</span></code> work
for Microsoft compilers</p></li>
<li><p>All MSVC CRT security warnings have been resolved.</p></li>
<li><p>All C-style casts in C++ Code have been replaced by C++ casts,
and many casts that had been included to suppress higher
warning levels for some compilers have been removed, primarily
for clarity. Places where integer type coercion occurs have
been scrutinized. A new casting policy has been documented in
the manual. This is of concern mainly to people porting qpdf to
new platforms or compilers. It is not visible to programmers
writing code that uses the library</p></li>
<li><p>Some internal limits have been removed in code that converts
numbers to strings. This is largely invisible to users, but it
does trigger a bug in some older versions of mingw-w64’s C++
library. See <code class="file docutils literal notranslate"><span class="pre">README-windows.md</span></code> in
the source distribution if you think this may affect you. The
copy of the DLL distributed with qpdf’s binary distribution is
not affected by this problem.</p></li>
</ul>
</li>
<li><p>The RPM spec file previously included with qpdf has been removed.
This is because virtually all Linux distributions include qpdf now
that it is a dependency of CUPS filters.</p></li>
<li><p>A few bug fixes are included:</p>
<ul>
<li><p>Overridden compressed objects are properly handled. Before,
there were certain constructs that could cause qpdf to see old
versions of some objects. The most usual manifestation of this
was loss of filled in form values for certain files.</p></li>
<li><p>Installation no longer uses GNU/Linux-specific versions of some
commands, so <strong class="command">make install</strong> works on
Solaris with native tools.</p></li>
<li><p>The 64-bit mingw Windows binary package no longer includes a
32-bit DLL.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>4.0.1: January 17, 2013</dt><dd><ul class="simple">
<li><p>Fix detection of binary attachments in test suite to avoid false
test failures on some platforms.</p></li>
<li><p>Add clarifying comment in <code class="file docutils literal notranslate"><span class="pre">QPDF.hh</span></code> to
methods that return the user password explaining that it is no
longer possible with newer encryption formats to recover the user
password knowing the owner password. In earlier encryption
formats, the user password was encrypted in the file using the
owner password. In newer encryption formats, a separate encryption
key is used on the file, and that key is independently encrypted
using both the user password and the owner password.</p></li>
</ul>
</dd>
<dt>4.0.0: December 31, 2012</dt><dd><ul class="simple">
<li><p>Major enhancement: support has been added for newer encryption
schemes supported by version X of Adobe Acrobat. This includes use
of 127-character passwords, 256-bit encryption keys, and the
encryption scheme specified in ISO 32000-2, the PDF 2.0
specification. This scheme can be chosen from the command line by
specifying use of 256-bit keys. qpdf also supports the deprecated
encryption method used by Acrobat IX. This encryption style has
known security weaknesses and should not be used in practice.
However, such files exist “in the wild,” so support for this
scheme is still useful. New methods
<code class="docutils literal notranslate"><span class="pre">QPDFWriter::setR6EncryptionParameters</span></code> (for the PDF 2.0 scheme)
and <code class="docutils literal notranslate"><span class="pre">QPDFWriter::setR5EncryptionParameters</span></code> (for the deprecated
scheme) have been added to enable these new encryption schemes.
Corresponding functions have been added to the C API as well.</p></li>
<li><p>Full support for Adobe extension levels in PDF version
information. Starting with PDF version 1.7, corresponding to ISO
32000, Adobe adds new functionality by increasing the extension
level rather than increasing the version. This support includes
addition of the <code class="docutils literal notranslate"><span class="pre">QPDF::getExtensionLevel</span></code> method for retrieving
the document’s extension level, addition of versions of
<code class="docutils literal notranslate"><span class="pre">QPDFWriter::setMinimumPDFVersion</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFWriter::forcePDFVersion</span></code> that accept an extension level,
and extended syntax for specifying forced and minimum versions on
the command line as described in <a class="reference internal" href="cli.html#option-force-version" title="option-force-version"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--force-version</span></code></a> and
<a class="reference internal" href="cli.html#option-min-version" title="option-min-version"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--min-version</span></code></a>. Corresponding functions have been added
to the C API as well.</p></li>
<li><p>Minor fixes to prevent qpdf from referencing objects in the file
that are not referenced in the file’s overall structure. Most
files don’t have any such objects, but some files have contain
unreferenced objects with errors, so these fixes prevent qpdf from
needlessly rejecting or complaining about such objects.</p></li>
<li><p>Add new generalized methods for reading and writing files from/to
programmer-defined sources. The method
<code class="docutils literal notranslate"><span class="pre">QPDF::processInputSource</span></code> allows the programmer to use any
input source for the input file, and
<code class="docutils literal notranslate"><span class="pre">QPDFWriter::setOutputPipeline</span></code> allows the programmer to write
the output file through any pipeline. These methods would make it
possible to perform any number of specialized operations, such as
accessing external storage systems, creating bindings for qpdf in
other programming languages that have their own I/O systems, etc.</p></li>
<li><p>Add new method <code class="docutils literal notranslate"><span class="pre">QPDF::getEncryptionKey</span></code> for retrieving the
underlying encryption key used in the file.</p></li>
<li><p>This release includes a small handful of non-compatible API
changes. While effort is made to avoid such changes, all the
non-compatible API changes in this version were to parts of the
API that would likely never be used outside the library itself. In
all cases, the altered methods or structures were parts of the
<code class="docutils literal notranslate"><span class="pre">QPDF</span></code> that were public to enable them to be called from either
<code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> or were part of validation code that was
over-zealous in reporting problems in parts of the file that would
not ordinarily be referenced. In no case did any of the removed
methods do anything worse that falsely report error conditions in
files that were broken in ways that didn’t matter. The following
public parts of the <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> class were changed in a
non-compatible way:</p>
<ul>
<li><p>Updated nested <code class="docutils literal notranslate"><span class="pre">QPDF::EncryptionData</span></code> class to add fields
needed by the newer encryption formats, member variables
changed to private so that future changes will not require
breaking backward compatibility.</p></li>
<li><p>Added additional parameters to <code class="docutils literal notranslate"><span class="pre">compute_data_key</span></code>, which is
used by <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> to compute the encryption key used to
encrypt a specific object.</p></li>
<li><p>Removed the method <code class="docutils literal notranslate"><span class="pre">flattenScalarReferences</span></code>. This method was
previously used prior to writing a new PDF file, but it has the
undesired side effect of causing qpdf to read objects in the
file that were not referenced. Some otherwise files have
unreferenced objects with errors in them, so this could cause
qpdf to reject files that would be accepted by virtually all
other PDF readers. In fact, qpdf relied on only a very small
part of what flattenScalarReferences did, so only this part has
been preserved, and it is now done directly inside
<code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code>.</p></li>
<li><p>Removed the method <code class="docutils literal notranslate"><span class="pre">decodeStreams</span></code>. This method was used by
the <a class="reference internal" href="cli.html#option-check" title="option-check"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--check</span></code></a> option of the
<strong class="command">qpdf</strong> command-line tool to force all
streams in the file to be decoded, but it also suffered from
the problem of opening otherwise unreferenced streams and thus
could report false positive. The
<a class="reference internal" href="cli.html#option-check" title="option-check"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--check</span></code></a> option now causes qpdf to go
through all the motions of writing a new file based on the
original one, so it will always reference and check exactly
those parts of a file that any ordinary viewer would check.</p></li>
<li><p>Removed the method <code class="docutils literal notranslate"><span class="pre">trimTrailerForWrite</span></code>. This method was
used by <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> to modify the original QPDF object by
removing fields from the trailer dictionary that wouldn’t apply
to the newly written file. This functionality, though generally
harmless, was a poor implementation and has been replaced by
having QPDFWriter filter these out when copying the trailer
rather than modifying the original QPDF object. (Note that qpdf
never modifies the original file itself.)</p></li>
</ul>
</li>
<li><p>Allow the PDF header to appear anywhere in the first 1024 bytes of
the file. This is consistent with what other readers do.</p></li>
<li><p>Fix the <strong class="command">pkg-config</strong> files to list zlib
and pcre in <code class="docutils literal notranslate"><span class="pre">Requires.private</span></code> to better support static linking
using <strong class="command">pkg-config</strong>.</p></li>
</ul>
</dd>
<dt>3.0.2: September 6, 2012</dt><dd><ul class="simple">
<li><p>Bug fix: <code class="docutils literal notranslate"><span class="pre">QPDFWriter::setOutputMemory</span></code> did not work when not
used with <code class="docutils literal notranslate"><span class="pre">QPDFWriter::setStaticID</span></code>, which made it pretty much
useless. This has been fixed.</p></li>
<li><p>New API call <code class="docutils literal notranslate"><span class="pre">QPDFWriter::setExtraHeaderText</span></code> inserts additional
text near the header of the PDF file. The intended use case is to
insert comments that may be consumed by a downstream application,
though other use cases may exist.</p></li>
</ul>
</dd>
<dt>3.0.1: August 11, 2012</dt><dd><ul class="simple">
<li><p>Version 3.0.0 included addition of files for
<strong class="command">pkg-config</strong>, but this was not mentioned
in the release notes. The release notes for 3.0.0 were updated to
mention this.</p></li>
<li><p>Bug fix: if an object stream ended with a scalar object not
followed by space, qpdf would incorrectly report that it
encountered a premature EOF. This bug has been in qpdf since
version 2.0.</p></li>
</ul>
</dd>
<dt>3.0.0: August 2, 2012</dt><dd><ul class="simple">
<li><p>Acknowledgment: I would like to express gratitude for the
contributions of Tobias Hoffmann toward the release of qpdf
version 3.0. He is responsible for most of the implementation and
design of the new API for manipulating pages, and contributed code
and ideas for many of the improvements made in version 3.0.
Without his work, this release would certainly not have happened
as soon as it did, if at all.</p></li>
<li><p><em>Non-compatible API changes:</em></p>
<ul>
<li><p>The method <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::replaceStreamData</span></code> that uses a
<code class="docutils literal notranslate"><span class="pre">StreamDataProvider</span></code> to provide the stream data no longer
takes a <code class="docutils literal notranslate"><span class="pre">length</span></code> parameter. The parameter was removed since
this provides the user an opportunity to simplify the calling
code. This method was introduced in version 2.2. At the time,
the <code class="docutils literal notranslate"><span class="pre">length</span></code> parameter was required in order to ensure that
calls to the stream data provider returned the same length for a
specific stream every time they were invoked. In particular, the
linearization code depends on this. Instead, qpdf 3.0 and newer
check for that constraint explicitly. The first time the stream
data provider is called for a specific stream, the actual length
is saved, and subsequent calls are required to return the same
number of bytes. This means the calling code no longer has to
compute the length in advance, which can be a significant
simplification. If your code fails to compile because of the
extra argument and you don’t want to make other changes to your
code, just omit the argument.</p></li>
<li><p>Many methods take <code class="docutils literal notranslate"><span class="pre">long</span> <span class="pre">long</span></code> instead of other integer types.
Most if not all existing code should compile fine with this
change since such parameters had always previously been smaller
types. This change was required to support files larger than two
gigabytes in size.</p></li>
</ul>
</li>
<li><p>Support has been added for large files. The test suite verifies
support for files larger than 4 gigabytes, and manual testing has
verified support for files larger than 10 gigabytes. Large file
support is available for both 32-bit and 64-bit platforms as long
as the compiler and underlying platforms support it.</p></li>
<li><p>Support for page selection (splitting and merging PDF files) has
been added to the <strong class="command">qpdf</strong> command-line
tool. See <a class="reference internal" href="cli.html#page-selection"><span class="std std-ref">Page Selection</span></a>.</p></li>
<li><p>The <a class="reference internal" href="cli.html#option-copy-encryption" title="option-copy-encryption"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--copy-encryption</span></code></a> option have been added to the
<strong class="command">qpdf</strong> command-line tool for copying encryption
parameters from another file.</p></li>
<li><p>New methods have been added to the <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object for adding and
removing pages. See <a class="reference internal" href="design.html#adding-and-remove-pages"><span class="std std-ref">Adding and Removing Pages</span></a>.</p></li>
<li><p>New methods have been added to the <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object for copying
objects from other PDF files. See <a class="reference internal" href="design.html#foreign-objects"><span class="std std-ref">Copying Objects From Other PDF Files</span></a></p></li>
<li><p>A new method <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::parse</span></code> has been added for
constructing <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> objects from a string
description.</p></li>
<li><p>Methods have been added to <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> to allow writing to an
already open stdio <code class="docutils literal notranslate"><span class="pre">FILE*</span></code> addition to writing to standard
output or a named file. Methods have been added to <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> to be
able to process a file from an already open stdio <code class="docutils literal notranslate"><span class="pre">FILE*</span></code>. This
makes it possible to read and write PDF from secure temporary
files that have been unlinked prior to being fully read or
written.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">QPDF::emptyPDF</span></code> can be used to allow creation of PDF files
from scratch. The example
<code class="file docutils literal notranslate"><span class="pre">examples/pdf-create.cc</span></code> illustrates how
it can be used.</p></li>
<li><p>Several methods to take <code class="docutils literal notranslate"><span class="pre">PointerHolder&lt;Buffer&gt;</span></code> can now also
accept <code class="docutils literal notranslate"><span class="pre">std::string</span></code> arguments.</p></li>
<li><p>Many new convenience methods have been added to the library, most
in <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>. See <code class="file docutils literal notranslate"><span class="pre">ChangeLog</span></code>
for a full list.</p></li>
<li><p>When building on a platform that supports ELF shared libraries
(such as Linux), symbol versions are enabled by default. They can
be disabled by passing
<code class="samp docutils literal notranslate"><span class="pre">--disable-ld-version-script</span></code> to
<strong class="command">./configure</strong>.</p></li>
<li><p>The file <code class="file docutils literal notranslate"><span class="pre">libqpdf.pc</span></code> is now installed
to support <strong class="command">pkg-config</strong>.</p></li>
<li><p>Image comparison tests are off by default now since they are not
needed to verify a correct build or port of qpdf. They are needed
only when changing the actual PDF output generated by qpdf. You
should enable them if you are making deep changes to qpdf itself.
See <code class="file docutils literal notranslate"><span class="pre">README.md</span></code> for details.</p></li>
<li><p>Large file tests are off by default but can be turned on with
<strong class="command">./configure</strong> or by setting an environment
variable before running the test suite. See
<code class="file docutils literal notranslate"><span class="pre">README.md</span></code> for details.</p></li>
<li><p>When qpdf’s test suite fails, failures are not printed to the
terminal anymore by default. Instead, find them in
<code class="file docutils literal notranslate"><span class="pre">build/qtest.log</span></code>. For packagers who are
building with an autobuilder, you can add the
<code class="samp docutils literal notranslate"><span class="pre">--enable-show-failed-test-output</span></code> option to
<strong class="command">./configure</strong> to restore the old behavior.</p></li>
</ul>
</dd>
<dt>2.3.1: December 28, 2011</dt><dd><ul class="simple">
<li><p>Fix thread-safety problem resulting from non-thread-safe use of
the PCRE library.</p></li>
<li><p>Made a few minor documentation fixes.</p></li>
<li><p>Add workaround for a bug that appears in some versions of
ghostscript to the test suite</p></li>
<li><p>Fix minor build issue for Visual C++ 2010.</p></li>
</ul>
</dd>
<dt>2.3.0: August 11, 2011</dt><dd><ul class="simple">
<li><p>Bug fix: when preserving existing encryption on encrypted files
with cleartext metadata, older qpdf versions would generate
password-protected files with no valid password. This operation
now works. This bug only affected files created by copying
existing encryption parameters; explicit encryption with
specification of cleartext metadata worked before and continues to
work.</p></li>
<li><p>Enhance <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> with a new constructor that allows you to
delay the specification of the output file. When using this
constructor, you may now call <code class="docutils literal notranslate"><span class="pre">QPDFWriter::setOutputFilename</span></code> to
specify the output file, or you may use
<code class="docutils literal notranslate"><span class="pre">QPDFWriter::setOutputMemory</span></code> to cause <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code> to write
the resulting PDF file to a memory buffer. You may then use
<code class="docutils literal notranslate"><span class="pre">QPDFWriter::getBuffer</span></code> to retrieve the memory buffer.</p></li>
<li><p>Add new API call <code class="docutils literal notranslate"><span class="pre">QPDF::replaceObject</span></code> for replacing objects by
object ID</p></li>
<li><p>Add new API call <code class="docutils literal notranslate"><span class="pre">QPDF::swapObjects</span></code> for swapping two objects by
object ID</p></li>
<li><p>Add <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getDictAsMap</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle::getArrayAsVector</span></code> to allow retrieval of
dictionary objects as maps and array objects as vectors.</p></li>
<li><p>Add functions <code class="docutils literal notranslate"><span class="pre">qpdf_get_info_key</span></code> and <code class="docutils literal notranslate"><span class="pre">qpdf_set_info_key</span></code> to
the C API for manipulating string fields of the document’s
<code class="docutils literal notranslate"><span class="pre">/Info</span></code> dictionary.</p></li>
<li><p>Add functions <code class="docutils literal notranslate"><span class="pre">qpdf_init_write_memory</span></code>,
<code class="docutils literal notranslate"><span class="pre">qpdf_get_buffer_length</span></code>, and <code class="docutils literal notranslate"><span class="pre">qpdf_get_buffer</span></code> to the C API
for writing PDF files to a memory buffer instead of a file.</p></li>
</ul>
</dd>
<dt>2.2.4: June 25, 2011</dt><dd><ul class="simple">
<li><p>Fix installation and compilation issues; no functionality changes.</p></li>
</ul>
</dd>
<dt>2.2.3: April 30, 2011</dt><dd><ul class="simple">
<li><p>Handle some damaged streams with incorrect characters following
the stream keyword.</p></li>
<li><p>Improve handling of inline images when normalizing content
streams.</p></li>
<li><p>Enhance error recovery to properly handle files that use object 0
as a regular object, which is specifically disallowed by the spec.</p></li>
</ul>
</dd>
<dt>2.2.2: October 4, 2010</dt><dd><ul class="simple">
<li><p>Add new function <code class="docutils literal notranslate"><span class="pre">qpdf_read_memory</span></code> to the C API to call
<code class="docutils literal notranslate"><span class="pre">QPDF::processMemoryFile</span></code>. This was an omission in qpdf 2.2.1.</p></li>
</ul>
</dd>
<dt>2.2.1: October 1, 2010</dt><dd><ul class="simple">
<li><p>Add new method <code class="docutils literal notranslate"><span class="pre">QPDF::setOutputStreams</span></code> to replace <code class="docutils literal notranslate"><span class="pre">std::cout</span></code>
and <code class="docutils literal notranslate"><span class="pre">std::cerr</span></code> with other streams for generation of diagnostic
messages and error messages. This can be useful for GUIs or other
applications that want to capture any output generated by the
library to present to the user in some other way. Note that QPDF
does not write to <code class="docutils literal notranslate"><span class="pre">std::cout</span></code> (or the specified output stream)
except where explicitly mentioned in
<code class="file docutils literal notranslate"><span class="pre">QPDF.hh</span></code>, and that the only use of the
error stream is for warnings. Note also that output of warnings is
suppressed when <code class="docutils literal notranslate"><span class="pre">setSuppressWarnings(true)</span></code> is called.</p></li>
<li><p>Add new method <code class="docutils literal notranslate"><span class="pre">QPDF::processMemoryFile</span></code> for operating on PDF
files that are loaded into memory rather than in a file on disk.</p></li>
<li><p>Give a warning but otherwise ignore empty PDF objects by treating
them as null. Empty object are not permitted by the PDF
specification but have been known to appear in some actual PDF
files.</p></li>
<li><p>Handle inline image filter abbreviations when the appear as stream
filter abbreviations. The PDF specification does not allow use of
stream filter abbreviations in this way, but Adobe Reader and some
other PDF readers accept them since they sometimes appear
incorrectly in actual PDF files.</p></li>
<li><p>Implement miscellaneous enhancements to <code class="docutils literal notranslate"><span class="pre">PointerHolder</span></code> and
<code class="docutils literal notranslate"><span class="pre">Buffer</span></code> to support other changes.</p></li>
</ul>
</dd>
<dt>2.2.0: August 14, 2010</dt><dd><ul class="simple">
<li><p>Add new methods to <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code> (<code class="docutils literal notranslate"><span class="pre">newStream</span></code> and
<code class="docutils literal notranslate"><span class="pre">replaceStreamData</span></code> for creating new streams and replacing
stream data. This makes it possible to perform a wide range of
operations that were not previously possible.</p></li>
<li><p>Add new helper method in <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>
(<code class="docutils literal notranslate"><span class="pre">addPageContents</span></code>) for appending or prepending new content
streams to a page. This method makes it possible to manipulate
content streams without having to be concerned whether a page’s
contents are a single stream or an array of streams.</p></li>
<li><p>Add new method in <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>: <code class="docutils literal notranslate"><span class="pre">replaceOrRemoveKey</span></code>,
which replaces a dictionary key with a given value unless the
value is null, in which case it removes the key instead.</p></li>
<li><p>Add new method in <code class="docutils literal notranslate"><span class="pre">QPDFObjectHandle</span></code>: <code class="docutils literal notranslate"><span class="pre">getRawStreamData</span></code>,
which returns the raw (unfiltered) stream data into a buffer. This
complements the <code class="docutils literal notranslate"><span class="pre">getStreamData</span></code> method, which returns the
filtered (uncompressed) stream data and can only be used when the
stream’s data is filterable.</p></li>
<li><p>Provide two new examples:
<strong class="command">pdf-double-page-size</strong> and
<strong class="command">pdf-invert-images</strong> that illustrate the
newly added interfaces.</p></li>
<li><p>Fix a memory leak that would cause loss of a few bytes for every
object involved in a cycle of object references. Thanks to Jian Ma
for calling my attention to the leak.</p></li>
</ul>
</dd>
<dt>2.1.5: April 25, 2010</dt><dd><ul class="simple">
<li><p>Remove restriction of file identifier strings to 16 bytes. This
unnecessary restriction was preventing qpdf from being able to
encrypt or decrypt files with identifier strings that were not
exactly 16 bytes long. The specification imposes no such
restriction.</p></li>
</ul>
</dd>
<dt>2.1.4: April 18, 2010</dt><dd><ul class="simple">
<li><p>Apply the same padding calculation fix from version 2.1.2 to the
main cross reference stream as well.</p></li>
<li><p>Since <strong class="command">qpdf --check</strong> only performs limited
checks, clarify the output to make it clear that there still may
be errors that qpdf can’t check. This should make it less
surprising to people when another PDF reader is unable to read a
file that qpdf thinks is okay.</p></li>
</ul>
</dd>
<dt>2.1.3: March 27, 2010</dt><dd><ul class="simple">
<li><p>Fix bug that could cause a failure when rewriting PDF files that
contain object streams with unreferenced objects that in turn
reference indirect scalars.</p></li>
<li><p>Don’t complain about (invalid) AES streams that aren’t a multiple
of 16 bytes. Instead, pad them before decrypting.</p></li>
</ul>
</dd>
<dt>2.1.2: January 24, 2010</dt><dd><ul class="simple">
<li><p>Fix bug in padding around first half cross reference stream in
linearized files. The bug could cause an assertion failure when
linearizing certain unlucky files.</p></li>
</ul>
</dd>
<dt>2.1.1: December 14, 2009</dt><dd><ul class="simple">
<li><p>No changes in functionality; insert missing include in an internal
library header file to support gcc 4.4, and update test suite to
ignore broken Adobe Reader installations.</p></li>
</ul>
</dd>
<dt>2.1: October 30, 2009</dt><dd><ul>
<li><p>This is the first version of qpdf to include Windows support. On
Windows, it is possible to build a DLL. Additionally, a partial
C-language API has been introduced, which makes it possible to
call qpdf functions from non-C++ environments. I am very grateful
to Žarko Gajić (<a class="reference external" href="http://zarko-gajic.iz.hr/">http://zarko-gajic.iz.hr/</a>) for tirelessly testing
numerous pre-release versions of this DLL and providing many
excellent suggestions on improving the interface.</p>
<p>For programming to the C interface, please see the header file
<code class="file docutils literal notranslate"><span class="pre">qpdf/qpdf-c.h</span></code> and the example
<code class="file docutils literal notranslate"><span class="pre">examples/pdf-linearize.c</span></code>.</p>
</li>
<li><p>Žarko Gajić has written a Delphi wrapper for qpdf, which can be
downloaded from qpdf’s download side. Žarko’s Delphi wrapper is
released with the same licensing terms as qpdf itself and comes
with this disclaimer: “Delphi wrapper unit
<code class="file docutils literal notranslate"><span class="pre">qpdf.pas</span></code> created by Žarko Gajić
(<a class="reference external" href="http://zarko-gajic.iz.hr/">http://zarko-gajic.iz.hr/</a>). Use at your own risk and for whatever
purpose you want. No support is provided. Sample code is
provided.”</p></li>
<li><p>Support has been added for AES encryption and crypt filters.
Although qpdf does not presently support files that use PKI-based
encryption, with the addition of AES and crypt filters, qpdf is
now be able to open most encrypted files created with newer
versions of Acrobat or other PDF creation software. Note that I
have not been able to get very many files encrypted in this way,
so it’s possible there could still be some cases that qpdf can’t
handle. Please report them if you find them.</p></li>
<li><p>Many error messages have been improved to include more information
in hopes of making qpdf a more useful tool for PDF experts to use
in manually recovering damaged PDF files.</p></li>
<li><p>Attempt to avoid compressing metadata streams if possible. This is
consistent with other PDF creation applications.</p></li>
<li><p>Provide new command-line options for AES encrypt, cleartext
metadata, and setting the minimum and forced PDF versions of
output files.</p></li>
<li><p>Add additional methods to the <code class="docutils literal notranslate"><span class="pre">QPDF</span></code> object for querying the
document’s permissions. Although qpdf does not enforce these
permissions, it does make them available so that applications that
use qpdf can enforce permissions.</p></li>
<li><p>The <a class="reference internal" href="cli.html#option-check" title="option-check"><code class="xref qpdf qpdf-ref docutils literal notranslate"><span class="pre">--check</span></code></a> option to
<strong class="command">qpdf</strong> has been extended to include some
additional information.</p></li>
<li><p><em>Non-compatible API changes:</em></p>
<ul class="simple">
<li><p>QPDF’s exception handling mechanism now uses
<code class="docutils literal notranslate"><span class="pre">std::logic_error</span></code> for internal errors and
<code class="docutils literal notranslate"><span class="pre">std::runtime_error</span></code> for runtime errors in favor of the now
removed <code class="docutils literal notranslate"><span class="pre">QEXC</span></code> classes used in previous versions. The <code class="docutils literal notranslate"><span class="pre">QEXC</span></code>
exception classes predated the addition of the
<code class="file docutils literal notranslate"><span class="pre">&lt;stdexcept&gt;</span></code> header file to the C++ standard library.
Most of the exceptions thrown by the qpdf library itself are
still of type <code class="docutils literal notranslate"><span class="pre">QPDFExc</span></code> which is now derived from
<code class="docutils literal notranslate"><span class="pre">std::runtime_error</span></code>. Programs that catch an instance of
<code class="docutils literal notranslate"><span class="pre">std::exception</span></code> and displayed it by calling the <code class="docutils literal notranslate"><span class="pre">what()</span></code>
method will not need to be changed.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">QPDFExc</span></code> class now internally represents various fields
of the error condition and provides interfaces for querying
them. Among the fields is a numeric error code that can help
applications act differently on (a small number of) different
error conditions. See <code class="file docutils literal notranslate"><span class="pre">QPDFExc.hh</span></code> for details.</p></li>
<li><p>Warnings can be retrieved from qpdf as instances of <code class="docutils literal notranslate"><span class="pre">QPDFExc</span></code>
instead of strings.</p></li>
<li><p>The nested <code class="docutils literal notranslate"><span class="pre">QPDF::EncryptionData</span></code> class’s constructor takes an
additional argument. This class is primarily intended to be used
by <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code>. There’s not really anything useful an
end-user application could do with it. It probably shouldn’t
really be part of the public interface to begin with. Likewise,
some of the methods for computing internal encryption dictionary
parameters have changed to support <code class="docutils literal notranslate"><span class="pre">/R=4</span></code> encryption.</p></li>
<li><p>The method <code class="docutils literal notranslate"><span class="pre">QPDF::getUserPassword</span></code> has been removed since it
didn’t do what people would think it did. There are now two new
methods: <code class="docutils literal notranslate"><span class="pre">QPDF::getPaddedUserPassword</span></code> and
<code class="docutils literal notranslate"><span class="pre">QPDF::getTrimmedUserPassword</span></code>. The first one does what the
old <code class="docutils literal notranslate"><span class="pre">QPDF::getUserPassword</span></code> method used to do, which is to
return the password with possible binary padding as specified by
the PDF specification. The second one returns a human-readable
password string.</p></li>
<li><p>The enumerated types that used to be nested in <code class="docutils literal notranslate"><span class="pre">QPDFWriter</span></code>
have moved to top-level enumerated types and are now defined in
the file <code class="file docutils literal notranslate"><span class="pre">qpdf/Constants.h</span></code>. This enables them to be
shared by both the C and C++ interfaces.</p></li>
</ul>
</li>
</ul>
</dd>
<dt>2.0.6: May 3, 2009</dt><dd><ul class="simple">
<li><p>Do not attempt to uncompress streams that have decode parameters
we don’t recognize. Earlier versions of qpdf would have rejected
files with such streams.</p></li>
</ul>
</dd>
<dt>2.0.5: March 10, 2009</dt><dd><ul class="simple">
<li><p>Improve error handling in the LZW decoder, and fix a small error
introduced in the previous version with regard to handling full
tables. The LZW decoder has been more strongly verified in this
release.</p></li>
</ul>
</dd>
<dt>2.0.4: February 21, 2009</dt><dd><ul class="simple">
<li><p>Include proper support for LZW streams encoded without the “early
code change” flag. Special thanks to Atom Smasher who reported the
problem and provided an input file compressed in this way, which I
did not previously have.</p></li>
<li><p>Implement some improvements to file recovery logic.</p></li>
</ul>
</dd>
<dt>2.0.3: February 15, 2009</dt><dd><ul class="simple">
<li><p>Compile cleanly with gcc 4.4.</p></li>
<li><p>Handle strings encoded as UTF-16BE properly.</p></li>
</ul>
</dd>
<dt>2.0.2: June 30, 2008</dt><dd><ul class="simple">
<li><p>Update test suite to work properly with a
non-<strong class="command">bash</strong>
<code class="file docutils literal notranslate"><span class="pre">/bin/sh</span></code> and with Perl 5.10. No changes
were made to the actual qpdf source code itself for this release.</p></li>
</ul>
</dd>
<dt>2.0.1: May 6, 2008</dt><dd><ul class="simple">
<li><p>No changes in functionality or interface. This release includes
fixes to the source code so that qpdf compiles properly and passes
its test suite on a broader range of platforms. See
<code class="file docutils literal notranslate"><span class="pre">ChangeLog</span></code> in the source distribution
for details.</p></li>
</ul>
</dd>
<dt>2.0: April 29, 2008</dt><dd><ul class="simple">
<li><p>First public release.</p></li>
</ul>
</dd>
</dl>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="encryption.html" class="btn btn-neutral float-left" title="PDF Encryption" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="acknowledgement.html" class="btn btn-neutral float-right" title="Acknowledgments" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2005-2022, Jay Berkenbilt.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>